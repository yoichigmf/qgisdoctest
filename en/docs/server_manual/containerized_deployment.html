<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>8. Containerized deployment &mdash; QGIS Documentation  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/qgis_docs.css?v=5415a924" />
      <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
      <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />

  
    <link rel="shortcut icon" href="../../_static/qgis_logo.ico"/>
    <link rel="canonical" href="https://docs.qgis.org/latest/en/docs/server_manual/containerized_deployment.html"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../../_static/copybutton.js?v=f281be69"></script>
        <script>let toggleHintShow = 'Click to show';</script>
        <script>let toggleHintHide = 'Click to hide';</script>
        <script>let toggleOpenOnPrint = 'true';</script>
        <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="9. Frequently Asked Question" href="faq.html" />
    <link rel="prev" title="7. Development Server" href="development_server.html" />
  <meta name="description" content="QGIS 3.34 documentation: 8. Containerized deployment">
</head>

<body class="wy-body-for-nav">

  <nav class="release_status_topbar">
  </nav>

   

 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
   

          
          
          <a href="../index.html" class="icon icon-home">
            QGIS Documentation
              <img src="../../_static/logo.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                3.34
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
   <a href= "../../genindex.html">Index</a>
 
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">For Users</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../user_manual/index.html">QGIS Desktop User Guide/Manual (QGIS 3.34)</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">QGIS Server Guide/Manual (QGIS 3.34)</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="introduction.html">1. Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="getting_started.html">2. Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="services.html">3. Services</a></li>
<li class="toctree-l2"><a class="reference internal" href="catalog.html">4. Catalog</a></li>
<li class="toctree-l2"><a class="reference internal" href="plugins.html">5. Plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="config.html">6. Advanced configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="development_server.html">7. Development Server</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">8. Containerized deployment</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#simple-docker-images">8.1. Simple docker images</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#first-run">8.1.1. First run</a></li>
<li class="toctree-l4"><a class="reference internal" href="#usable-sample">8.1.2. Usable sample</a></li>
<li class="toctree-l4"><a class="reference internal" href="#cleanup">8.1.3. Cleanup</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#docker-stacks">8.2. Docker stacks</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#swarm-docker-compose">8.2.1. Swarm/docker-compose</a></li>
<li class="toctree-l4"><a class="reference internal" href="#kubernetes">8.2.2. Kubernetes</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#cloud-deployment">8.3. Cloud deployment</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#aws-usecase">8.3.1. AWS usecase</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="faq.html">9. Frequently Asked Question</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../training_manual/index.html">Training Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gentle_gis_introduction/index.html">A Gentle Introduction to GIS</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">For Writers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../documentation_guidelines/index.html">Documentation Guidelines</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">For Developers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../pyqgis_developer_cookbook/index.html">PyQGIS Cookbook (QGIS 3.34)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developers_guide/index.html">Developers Guide</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">QGIS Documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">QGIS Server Guide/Manual</a></li>
      <li class="breadcrumb-item active"><span class="section-number">8. </span>Containerized deployment</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/qgis/QGIS-Documentation/blob/master/docs/server_manual/containerized_deployment.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul><div class="rst-breadcrumbs-buttons" role="navigation" aria-label="Sequential page navigation">
        <a href="development_server.html" class="btn btn-neutral float-left" title="7. Development Server" accesskey="p"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="faq.html" class="btn btn-neutral float-right" title="9. Frequently Asked Question" accesskey="n">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
  </div>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <blockquote>
<div></div></blockquote>
<section id="containerized-deployment">
<h1><span class="section-number">8. </span>Containerized deployment<a class="headerlink" href="#containerized-deployment" title="Link to this heading"></a></h1>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#simple-docker-images" id="id5">Simple docker images</a></p>
<ul>
<li><p><a class="reference internal" href="#first-run" id="id6">First run</a></p></li>
<li><p><a class="reference internal" href="#usable-sample" id="id7">Usable sample</a></p></li>
<li><p><a class="reference internal" href="#cleanup" id="id8">Cleanup</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#docker-stacks" id="id9">Docker stacks</a></p>
<ul>
<li><p><a class="reference internal" href="#swarm-docker-compose" id="id10">Swarm/docker-compose</a></p>
<ul>
<li><p><a class="reference internal" href="#stack-description" id="id11">Stack description</a></p></li>
<li><p><a class="reference internal" href="#id3" id="id12">Cleanup</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#kubernetes" id="id13">Kubernetes</a></p>
<ul>
<li><p><a class="reference internal" href="#installation" id="id14">Installation</a></p></li>
<li><p><a class="reference internal" href="#creating-manifests" id="id15">Creating manifests</a></p></li>
<li><p><a class="reference internal" href="#deploying-manifests" id="id16">Deploying manifests</a></p></li>
<li><p><a class="reference internal" href="#id4" id="id17">Cleanup</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#cloud-deployment" id="id18">Cloud deployment</a></p>
<ul>
<li><p><a class="reference internal" href="#aws-usecase" id="id19">AWS usecase</a></p></li>
</ul>
</li>
</ul>
</nav>
<p>There are many ways to use containerized application, from the most
simple (simple Docker images) to sophisticated (Kubernetes and so on).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This kind of deployment needs the
<a class="reference external" href="https://www.docker.com">docker application</a> to be installed and
running.
Check this <a class="reference external" href="https://www.docker.com/101-tutorial">tutorial</a>.</p>
</div>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>Docker run pre packaged application (aka images)
which can be retrieved as sources (Dockerfile and resources) to
build or already built from registries (private or public).</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>QGIS Debian-Ubuntu package downloads need a valid gpg authentication key.
Please refer to the <a class="reference external" href="https://www.qgis.org/fr/site/forusers/alldownloads.html#debian-ubuntu">installation pages</a>
to update the following Dockerfile.</p>
</div>
<section id="simple-docker-images">
<span id="id1"></span><h2><a class="toc-backref" href="#id5" role="doc-backlink"><span class="section-number">8.1. </span>Simple docker images</a><a class="headerlink" href="#simple-docker-images" title="Link to this heading"></a></h2>
<p>As the docker image does not exist in a public registry. you will need to build
it. To do so create a directory <code class="file docutils literal notranslate"><span class="pre">qgis-server</span></code> and within its directory:</p>
<ul class="simple">
<li><p>create a file <code class="file docutils literal notranslate"><span class="pre">Dockerfile</span></code> with this content:</p></li>
</ul>
<div class="highlight-dockerfile notranslate"><div class="highlight"><pre><span></span><span class="k">FROM</span><span class="w"> </span><span class="s">debian:bookworm-slim</span>

<span class="k">ENV</span><span class="w"> </span><span class="nv">LANG</span><span class="o">=</span>en_EN.UTF-8


<span class="k">RUN</span><span class="w"> </span>apt-get<span class="w"> </span>update<span class="w"> </span><span class="se">\</span>
<span class="w">    </span><span class="o">&amp;&amp;</span><span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>--no-install-recommends<span class="w"> </span>--no-install-suggests<span class="w"> </span>--allow-unauthenticated<span class="w"> </span>-y<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>gnupg<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>ca-certificates<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>wget<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>locales<span class="w"> </span><span class="se">\</span>
<span class="w">    </span><span class="o">&amp;&amp;</span><span class="w"> </span>localedef<span class="w"> </span>-i<span class="w"> </span>en_US<span class="w"> </span>-f<span class="w"> </span>UTF-8<span class="w"> </span>en_US.UTF-8<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>#<span class="w"> </span>Add<span class="w"> </span>the<span class="w"> </span>current<span class="w"> </span>key<span class="w"> </span><span class="k">for</span><span class="w"> </span>package<span class="w"> </span>downloading
<span class="w">    </span>#<span class="w"> </span>Please<span class="w"> </span>refer<span class="w"> </span>to<span class="w"> </span>QGIS<span class="w"> </span>install<span class="w"> </span>documentation<span class="w"> </span><span class="o">(</span>https://www.qgis.org/fr/site/forusers/alldownloads.html#debian-ubuntu<span class="o">)</span>
<span class="w">    </span><span class="o">&amp;&amp;</span><span class="w"> </span>mkdir<span class="w"> </span>-m755<span class="w"> </span>-p<span class="w"> </span>/etc/apt/keyrings<span class="w"> </span><span class="se">\</span>
<span class="w">    </span><span class="o">&amp;&amp;</span><span class="w"> </span>wget<span class="w"> </span>-O<span class="w"> </span>/etc/apt/keyrings/qgis-archive-keyring.gpg<span class="w"> </span>https://download.qgis.org/downloads/qgis-archive-keyring.gpg<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>#<span class="w"> </span>Add<span class="w"> </span>repository<span class="w"> </span><span class="k">for</span><span class="w"> </span>latest<span class="w"> </span>version<span class="w"> </span>of<span class="w"> </span>qgis-server
<span class="w">    </span>#<span class="w"> </span>Please<span class="w"> </span>refer<span class="w"> </span>to<span class="w"> </span>QGIS<span class="w"> </span>repositories<span class="w"> </span>documentation<span class="w"> </span><span class="k">if</span><span class="w"> </span>you<span class="w"> </span>want<span class="w"> </span>other<span class="w"> </span>version<span class="w"> </span><span class="o">(</span>https://qgis.org/en/site/forusers/alldownloads.html#repositories<span class="o">)</span>
<span class="w">    </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;deb [signed-by=/etc/apt/keyrings/qgis-archive-keyring.gpg] https://qgis.org/debian bookworm main&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tee<span class="w"> </span>/etc/apt/sources.list.d/qgis.list<span class="w"> </span><span class="se">\</span>
<span class="w">    </span><span class="o">&amp;&amp;</span><span class="w"> </span>apt-get<span class="w"> </span>update<span class="w"> </span><span class="se">\</span>
<span class="w">    </span><span class="o">&amp;&amp;</span><span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>--no-install-recommends<span class="w"> </span>--no-install-suggests<span class="w"> </span>--allow-unauthenticated<span class="w"> </span>-y<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>qgis-server<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>spawn-fcgi<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>xauth<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>xvfb<span class="w"> </span><span class="se">\</span>
<span class="w">    </span><span class="o">&amp;&amp;</span><span class="w"> </span>apt-get<span class="w"> </span>remove<span class="w"> </span>--purge<span class="w"> </span>-y<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>gnupg<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>wget<span class="w"> </span><span class="se">\</span>
<span class="w">    </span><span class="o">&amp;&amp;</span><span class="w"> </span>rm<span class="w"> </span>-rf<span class="w"> </span>/var/lib/apt/lists/*

<span class="k">RUN</span><span class="w"> </span>useradd<span class="w"> </span>-m<span class="w"> </span>qgis

<span class="k">ENV</span><span class="w"> </span>TINI_VERSION<span class="w"> </span>v0.19.0
<span class="k">ADD</span><span class="w"> </span>https://github.com/krallin/tini/releases/download/<span class="si">${</span><span class="nv">TINI_VERSION</span><span class="si">}</span>/tini<span class="w"> </span>/tini
<span class="k">RUN</span><span class="w"> </span>chmod<span class="w"> </span>+x<span class="w"> </span>/tini

<span class="k">ENV</span><span class="w"> </span>QGIS_PREFIX_PATH<span class="w"> </span>/usr
<span class="k">ENV</span><span class="w"> </span>QGIS_SERVER_LOG_STDERR<span class="w"> </span><span class="m">1</span>
<span class="k">ENV</span><span class="w"> </span>QGIS_SERVER_LOG_LEVEL<span class="w"> </span><span class="m">2</span>

<span class="k">COPY</span><span class="w"> </span>cmd.sh<span class="w"> </span>/home/qgis/cmd.sh
<span class="k">RUN</span><span class="w"> </span>chmod<span class="w"> </span>-R<span class="w"> </span><span class="m">777</span><span class="w"> </span>/home/qgis/cmd.sh
<span class="k">RUN</span><span class="w"> </span>chown<span class="w"> </span>qgis:qgis<span class="w"> </span>/home/qgis/cmd.sh

<span class="k">USER</span><span class="w"> </span><span class="s">qgis</span>
<span class="k">WORKDIR</span><span class="w"> </span><span class="s">/home/qgis</span>

<span class="k">ENTRYPOINT</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;/tini&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;--&quot;</span><span class="p">]</span>

<span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;/home/qgis/cmd.sh&quot;</span><span class="p">]</span>
</pre></div>
</div>
<ul class="simple">
<li><p>create a file <code class="file docutils literal notranslate"><span class="pre">cmd.sh</span></code> with this content:</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>

<span class="o">[[</span><span class="w"> </span><span class="nv">$DEBUG</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;1&quot;</span><span class="w"> </span><span class="o">]]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>env

<span class="nb">exec</span><span class="w"> </span>/usr/bin/xvfb-run<span class="w"> </span>--auto-servernum<span class="w"> </span>--server-num<span class="o">=</span><span class="m">1</span><span class="w"> </span>/usr/bin/spawn-fcgi<span class="w"> </span>-p<span class="w"> </span><span class="m">5555</span><span class="w"> </span>-n<span class="w"> </span>-d<span class="w"> </span>/home/qgis<span class="w"> </span>--<span class="w"> </span>/usr/lib/cgi-bin/qgis_mapserv.fcgi
</pre></div>
</div>
<ul class="simple">
<li><p>build the image with:</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span>build<span class="w"> </span>-f<span class="w"> </span>Dockerfile<span class="w"> </span>-t<span class="w"> </span>qgis-server<span class="w"> </span>./
</pre></div>
</div>
<section id="first-run">
<h3><a class="toc-backref" href="#id6" role="doc-backlink"><span class="section-number">8.1.1. </span>First run</a><a class="headerlink" href="#first-run" title="Link to this heading"></a></h3>
<p>To run the server you will need a QGIS project file. You can use one of yours or pick
<a class="reference external" href="https://gitlab.com/Oslandia/qgis/docker-qgis/-/blob/cc1798074d4a66a472721352f3984bb318777a5a/qgis-exec/data/osm.qgs">this sample</a>.</p>
<p>To do so, create a directory <code class="file docutils literal notranslate"><span class="pre">data</span></code> within the directory
<code class="file docutils literal notranslate"><span class="pre">qgis-server</span></code> and copy your file in it. To comply with the following
explanations, rename it to <code class="file docutils literal notranslate"><span class="pre">osm.qgs</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You may need to add advertised URLs under the <span class="guilabel">QGIS Server</span> tab of the
<span class="menuselection">Project ► Properties</span> if the GetCapabilites are broken.
For example if your server is exposed on port 8080, you will put this for
advertised URL <code class="docutils literal notranslate"><span class="pre">http://localhost:8080/qgis-server/</span></code>. More information
available in section <a class="reference internal" href="getting_started.html#creatingwmsfromproject"><span class="std std-ref">Configure your project</span></a> and subsequent.</p>
</div>
<p>Now, you can run the server with:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span>network<span class="w"> </span>create<span class="w"> </span>qgis
docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--rm<span class="w"> </span>--name<span class="w"> </span>qgis-server<span class="w"> </span>--net<span class="o">=</span>qgis<span class="w"> </span>--hostname<span class="o">=</span>qgis-server<span class="w"> </span><span class="se">\</span>
<span class="w">              </span>-v<span class="w"> </span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>/data:/data:ro<span class="w"> </span>-p<span class="w"> </span><span class="m">5555</span>:5555<span class="w"> </span><span class="se">\</span>
<span class="w">              </span>-e<span class="w"> </span><span class="s2">&quot;QGIS_PROJECT_FILE=/data/osm.qgs&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">              </span>qgis-server
</pre></div>
</div>
<p>Options used:</p>
<ul class="simple">
<li><p><strong>-d</strong>: run in the background</p></li>
<li><p><strong>–rm</strong>: remove the container when it is stopped</p></li>
<li><p><strong>–name</strong>: name of the container to be created</p></li>
<li><p><strong>–net</strong>: (previously created) sub network</p></li>
<li><p><strong>–hostname</strong>: container hostname, for later referencing</p></li>
<li><p><strong>-v</strong>: local data directory to be mounted in the container</p></li>
<li><p><strong>-p</strong>: host/container port mapping</p></li>
<li><p><strong>-e</strong>: environment variable to be used in the container</p></li>
</ul>
<p>To check, type <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">ps</span> <span class="pre">|</span> <span class="pre">grep</span> <span class="pre">qgis-server</span></code> and you should see a
line with <strong>qgis-server</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CONTAINER</span> <span class="n">ID</span>   <span class="n">IMAGE</span>         <span class="n">COMMAND</span>                  <span class="n">CREATED</span>         <span class="n">STATUS</span>         <span class="n">PORTS</span>                    <span class="n">NAMES</span>
<span class="mi">4</span><span class="n">de8192da76e</span>   <span class="n">qgis</span><span class="o">-</span><span class="n">server</span>   <span class="s2">&quot;/tini -- /home/qgis…&quot;</span>   <span class="mi">3</span> <span class="n">seconds</span> <span class="n">ago</span>   <span class="n">Up</span> <span class="mi">2</span> <span class="n">seconds</span>   <span class="mf">0.0.0.0</span><span class="p">:</span><span class="mi">5555</span><span class="o">-&gt;</span><span class="mi">5555</span><span class="o">/</span><span class="n">tcp</span>   <span class="n">qgis</span><span class="o">-</span><span class="n">server</span>
</pre></div>
</div>
</section>
<section id="usable-sample">
<h3><a class="toc-backref" href="#id7" role="doc-backlink"><span class="section-number">8.1.2. </span>Usable sample</a><a class="headerlink" href="#usable-sample" title="Link to this heading"></a></h3>
<p>As the server is only accepting fastcgi connections, you need
an HTTP server that handles this protocol.
To do so we have to create a simple Nginx configuration file and start
a Nginx image.</p>
<p>Create a file <code class="file docutils literal notranslate"><span class="pre">nginx.conf</span></code> in the current directory with this
content:</p>
<div class="highlight-nginx notranslate"><div class="highlight"><pre><span></span><span class="k">server</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kn">listen</span><span class="w"> </span><span class="mi">80</span><span class="p">;</span>
<span class="w">  </span><span class="kn">server_name</span><span class="w"> </span><span class="s">_</span><span class="p">;</span>
<span class="w">  </span><span class="kn">location</span><span class="w"> </span><span class="s">/</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kn">root</span><span class="w">  </span><span class="s">/usr/share/nginx/html</span><span class="p">;</span>
<span class="w">    </span><span class="kn">index</span><span class="w"> </span><span class="s">index.html</span><span class="w"> </span><span class="s">index.htm</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="kn">location</span><span class="w"> </span><span class="s">/qgis-server</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kn">proxy_buffers</span><span class="w"> </span><span class="mi">16</span><span class="w"> </span><span class="mi">16k</span><span class="p">;</span>
<span class="w">    </span><span class="kn">proxy_buffer_size</span><span class="w"> </span><span class="mi">16k</span><span class="p">;</span>
<span class="w">    </span><span class="kn">gzip</span><span class="w"> </span><span class="no">off</span><span class="p">;</span>
<span class="w">    </span><span class="kn">include</span><span class="w"> </span><span class="s">fastcgi_params</span><span class="p">;</span>
<span class="w">    </span><span class="kn">fastcgi_pass</span><span class="w"> </span><span class="n">qgis-server</span><span class="p">:</span><span class="mi">5555</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>And type this command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--rm<span class="w"> </span>--name<span class="w"> </span>nginx<span class="w"> </span>--net<span class="o">=</span>qgis<span class="w"> </span>--hostname<span class="o">=</span>nginx<span class="w"> </span><span class="se">\</span>
<span class="w">              </span>-v<span class="w"> </span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>/nginx.conf:/etc/nginx/conf.d/default.conf:ro<span class="w"> </span>-p<span class="w"> </span><span class="m">8080</span>:80<span class="w"> </span><span class="se">\</span>
<span class="w">              </span>nginx:1.13
</pre></div>
</div>
<p>To check capabilities availability, type in a browser
<a class="reference external" href="http://localhost:8080/qgis-server/?SERVICE=WMS&amp;VERSION=1.3.0&amp;REQUEST=GetCapabilities">http://localhost:8080/qgis-server/?SERVICE=WMS&amp;VERSION=1.3.0&amp;REQUEST=GetCapabilities</a></p>
</section>
<section id="cleanup">
<h3><a class="toc-backref" href="#id8" role="doc-backlink"><span class="section-number">8.1.3. </span>Cleanup</a><a class="headerlink" href="#cleanup" title="Link to this heading"></a></h3>
<p>To cleanup the running images, type:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span>stop<span class="w"> </span>qgis-server<span class="w"> </span>nginx
</pre></div>
</div>
</section>
</section>
<section id="docker-stacks">
<span id="id2"></span><h2><a class="toc-backref" href="#id9" role="doc-backlink"><span class="section-number">8.2. </span>Docker stacks</a><a class="headerlink" href="#docker-stacks" title="Link to this heading"></a></h2>
<p>The previous method is scriptable, but not easily packageable nor
standardized or easily manageable.</p>
<p>To work with a docker image set you could use a docker stack managed
by an orchestrator.
In a stack, the images are working in the same private network, and
you can start / stop the whole stack or deploy the stack to other
workers.
There are many orchestrators, for example Swarm, Kubernetes and Mesos.</p>
<p>In the following, we will present simple configurations for testing
purposes.
They are not suitable for production.</p>
<section id="swarm-docker-compose">
<h3><a class="toc-backref" href="#id10" role="doc-backlink"><span class="section-number">8.2.1. </span>Swarm/docker-compose</a><a class="headerlink" href="#swarm-docker-compose" title="Link to this heading"></a></h3>
<p>Docker now has its own orchestrator: Swarm (compatible with docker-compose
files). You have to
<a class="reference external" href="https://docs.docker.com/get-started/orchestration/#enable-docker-swarm">enable it</a>
(the Mac version will also work with Linux).</p>
<section id="stack-description">
<span id="docker-compose-file"></span><h4><a class="toc-backref" href="#id11" role="doc-backlink">Stack description</a><a class="headerlink" href="#stack-description" title="Link to this heading"></a></h4>
<p>Now that you have Swarm working, create the service file (see
<a class="reference external" href="https://docs.docker.com/get-started/swarm-deploy/">Deploy to Swarm</a>)
<code class="file docutils literal notranslate"><span class="pre">qgis-stack.yaml</span></code>:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.7&#39;</span>

<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">qgis-server</span><span class="p">:</span>
<span class="w">    </span><span class="c1"># Should use version with utf-8 locale support:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">qgis-server:latest</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">REPLACE_WITH_FULL_PATH/data:/data:ro</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LANG=en_EN.UTF-8</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">QGIS_PROJECT_FILE=/data/osm.qgs</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">QGIS_SERVER_LOG_LEVEL=0</span><span class="w">  </span><span class="c1"># INFO (log all requests)</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DEBUG=1</span><span class="w">                  </span><span class="c1"># display env before spawning QGIS Server</span>

<span class="w">  </span><span class="nt">nginx</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx:1.13</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080:80</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">REPLACE_WITH_FULL_PATH/nginx.conf:/etc/nginx/conf.d/default.conf:ro</span>
<span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">qgis-server</span>
</pre></div>
</div>
<p>To deploy (or update) the stack, type:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span>stack<span class="w"> </span>deploy<span class="w"> </span>-c<span class="w"> </span>qgis-stack.yaml<span class="w"> </span>qgis-stack
</pre></div>
</div>
<p>Check the stack deployment status until you obtain <strong>1/1</strong> in the
<strong>replicas</strong> column:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span>stack<span class="w"> </span>services<span class="w"> </span>qgis-stack
</pre></div>
</div>
<p>Something like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ID</span>                  <span class="n">NAME</span>                <span class="n">MODE</span>                <span class="n">REPLICAS</span>            <span class="n">IMAGE</span>               <span class="n">PORTS</span>
<span class="n">gmx7ewlvwsqt</span>        <span class="n">qgis_nginx</span>          <span class="n">replicated</span>          <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>                 <span class="n">nginx</span><span class="p">:</span><span class="mf">1.13</span>          <span class="o">*</span><span class="p">:</span><span class="mi">8080</span><span class="o">-&gt;</span><span class="mi">80</span><span class="o">/</span><span class="n">tcp</span>
<span class="n">l0v2e7cl43u3</span>        <span class="n">qgis_qgis</span><span class="o">-</span><span class="n">server</span>    <span class="n">replicated</span>          <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>                 <span class="n">qgis</span><span class="o">-</span><span class="n">server</span><span class="p">:</span><span class="n">latest</span>
</pre></div>
</div>
<p>To check WMS capabilities, type in a web browser
<a class="reference external" href="http://localhost:8080/qgis-server/?SERVICE=WMS&amp;VERSION=1.3.0&amp;REQUEST=GetCapabilities">http://localhost:8080/qgis-server/?SERVICE=WMS&amp;VERSION=1.3.0&amp;REQUEST=GetCapabilities</a></p>
</section>
<section id="id3">
<h4><a class="toc-backref" href="#id12" role="doc-backlink">Cleanup</a><a class="headerlink" href="#id3" title="Link to this heading"></a></h4>
<p>To cleanup, type:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span>stack<span class="w"> </span>rm<span class="w"> </span>qgis-stack
</pre></div>
</div>
</section>
</section>
<section id="kubernetes">
<h3><a class="toc-backref" href="#id13" role="doc-backlink"><span class="section-number">8.2.2. </span>Kubernetes</a><a class="headerlink" href="#kubernetes" title="Link to this heading"></a></h3>
<section id="installation">
<h4><a class="toc-backref" href="#id14" role="doc-backlink">Installation</a><a class="headerlink" href="#installation" title="Link to this heading"></a></h4>
<p>If you have a <strong>Docker Desktop</strong> installation, using Kubernetes (aka
k8s) is pretty straight forward:
<a class="reference external" href="https://docs.docker.com/get-started/orchestration/#enable-kubernetes">enable k8s</a>.</p>
<p>If not, follow the
<a class="reference external" href="https://kubernetes.io/docs/tutorials/hello-minikube/">minikube tutorial</a>
or
<a class="reference external" href="https://ubuntu.com/tutorials/install-a-local-kubernetes-with-microk8s">microk8s for Ubuntu</a>.</p>
<p>As Kubernetes installation can be really complex, we will only focus
on aspects used by this demo.
For further / deeper information, check the
<a class="reference external" href="https://kubernetes.io/docs/home/">official documentation</a>.</p>
<section id="microk8s">
<h5>microk8s<a class="headerlink" href="#microk8s" title="Link to this heading"></a></h5>
<p>microk8s needs extra steps: you have to enable the registry and tag
the qgis-server image in order to have Kubernetes to find the created
images.</p>
<p>First, enable the registry:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>microk8s<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>dashboard<span class="w"> </span>dns<span class="w"> </span>registry
</pre></div>
</div>
<p>Then, tag and push the image to your newly created registry:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span>tag<span class="w"> </span>qgis-server<span class="w"> </span><span class="m">127</span>.0.0.1:32000/qgis-server<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>docker<span class="w"> </span>push<span class="w"> </span><span class="m">127</span>.0.0.1:32000/qgis-server
</pre></div>
</div>
<p>Finally, add or complete the <code class="file docutils literal notranslate"><span class="pre">/etc/docker/daemon.json</span></code> to have
your registry <strong>127.0.0.1:32000</strong> listed in the
<strong>insecure-registries</strong> field:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;insecure-registries&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;127.0.0.1:32000&quot;</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="creating-manifests">
<span id="k8s-manifests"></span><h4><a class="toc-backref" href="#id15" role="doc-backlink">Creating manifests</a><a class="headerlink" href="#creating-manifests" title="Link to this heading"></a></h4>
<p>Kubernetes describes the objects to deploy in yaml manifests.
There are many different kinds, but we will only use deployments
(handle pods, i.e. docker images) and services to expose the
deployments to internal or external purposes.</p>
<section id="deployment-manifests">
<h5>Deployment manifests<a class="headerlink" href="#deployment-manifests" title="Link to this heading"></a></h5>
<p>Create a file <code class="file docutils literal notranslate"><span class="pre">deployments.yaml</span></code> with this content:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">qgis-server</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">myLabel</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">qgis-server</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="nt">myLabel</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">qgis-server</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">qgis-server</span>
<span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">localhost:32000/qgis-server:latest</span>
<span class="w">          </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Always</span>
<span class="w">          </span><span class="nt">env</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LANG</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">en_EN.UTF-8</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">QGIS_PROJECT_FILE</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/data/osm.qgs</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">QGIS_SERVER_LOG_LEVEL</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;0&quot;</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DEBUG</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1&quot;</span>
<span class="w">          </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5555</span>
<span class="w">          </span><span class="nt">volumeMounts</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">qgis-data</span>
<span class="w">              </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/data/</span>
<span class="w">      </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">qgis-data</span>
<span class="w">          </span><span class="nt">hostPath</span><span class="p">:</span>
<span class="w">            </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">REPLACE_WITH_FULL_PATH/data</span>

<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">qgis-nginx</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">myLabel</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">qgis-nginx</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="nt">myLabel</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">qgis-nginx</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">qgis-nginx</span>
<span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx:1.13</span>
<span class="w">          </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="w">          </span><span class="nt">volumeMounts</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx-conf</span>
<span class="w">              </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/nginx/conf.d/</span>
<span class="w">      </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx-conf</span>
<span class="w">          </span><span class="nt">configMap</span><span class="p">:</span>
<span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx-configuration</span>

<span class="nn">---</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ConfigMap</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx-configuration</span>
<span class="nt">data</span><span class="p">:</span>
<span class="w">  </span><span class="nt">nginx.conf</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">    </span><span class="no">server {</span>
<span class="w">      </span><span class="no">listen 80;</span>
<span class="w">      </span><span class="no">server_name _;</span>
<span class="w">      </span><span class="no">location / {</span>
<span class="w">        </span><span class="no">root  /usr/share/nginx/html;</span>
<span class="w">        </span><span class="no">index index.html index.htm;</span>
<span class="w">      </span><span class="no">}</span>
<span class="w">      </span><span class="no">location /qgis-server {</span>
<span class="w">        </span><span class="no">proxy_buffers 16 16k;</span>
<span class="w">        </span><span class="no">proxy_buffer_size 16k;</span>
<span class="w">        </span><span class="no">gzip off;</span>
<span class="w">        </span><span class="no">include fastcgi_params;</span>
<span class="w">        </span><span class="no">fastcgi_pass qgis-server:5555;</span>
<span class="w">        </span><span class="no">}</span>
<span class="w">      </span><span class="no">}</span>
</pre></div>
</div>
</section>
<section id="service-manifests">
<h5>Service manifests<a class="headerlink" href="#service-manifests" title="Link to this heading"></a></h5>
<p>Create a file <code class="file docutils literal notranslate"><span class="pre">services.yaml</span></code> with this content:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">qgis-server</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterIP</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">myLabel</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">qgis-server</span>
<span class="w">  </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5555</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5555</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">qgis-nginx</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NodePort</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">myLabel</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">qgis-nginx</span>
<span class="w">  </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="w">      </span><span class="nt">nodePort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30080</span>
</pre></div>
</div>
</section>
</section>
<section id="deploying-manifests">
<h4><a class="toc-backref" href="#id16" role="doc-backlink">Deploying manifests</a><a class="headerlink" href="#deploying-manifests" title="Link to this heading"></a></h4>
<p>To deploy the images and services in Kubernetes, one can use the
dashboard (click on the <strong>+</strong> on the upper right) or the command line.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When using the command line with microk8s you will have to prefix
each command with <cite>microk8s</cite>.</p>
</div>
<p>To deploy or update your manifests:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>./
</pre></div>
</div>
<p>To check what is currently deployed:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>kubectl<span class="w"> </span>get<span class="w"> </span>pods,services,deployment
</pre></div>
</div>
<p>You should obtain something like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">NAME</span>                               <span class="n">READY</span>   <span class="n">STATUS</span>    <span class="n">RESTARTS</span>   <span class="n">AGE</span>
<span class="n">pod</span><span class="o">/</span><span class="n">qgis</span><span class="o">-</span><span class="n">nginx</span><span class="o">-</span><span class="mi">54845</span><span class="n">ff6f6</span><span class="o">-</span><span class="mi">8</span><span class="n">skp9</span>    <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>     <span class="n">Running</span>   <span class="mi">0</span>          <span class="mi">27</span><span class="n">m</span>
<span class="n">pod</span><span class="o">/</span><span class="n">qgis</span><span class="o">-</span><span class="n">server</span><span class="o">-</span><span class="mi">75</span><span class="n">df8ddd89</span><span class="o">-</span><span class="n">c7t7s</span>   <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>     <span class="n">Running</span>   <span class="mi">0</span>          <span class="mi">27</span><span class="n">m</span>

<span class="n">NAME</span>                       <span class="n">TYPE</span>        <span class="n">CLUSTER</span><span class="o">-</span><span class="n">IP</span>       <span class="n">EXTERNAL</span><span class="o">-</span><span class="n">IP</span>   <span class="n">PORT</span><span class="p">(</span><span class="n">S</span><span class="p">)</span>        <span class="n">AGE</span>
<span class="n">service</span><span class="o">/</span><span class="n">Kubernetes</span>         <span class="n">ClusterIP</span>   <span class="mf">10.152.183.1</span>     <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>        <span class="mi">443</span><span class="o">/</span><span class="n">TCP</span>        <span class="mi">5</span><span class="n">h51m</span>
<span class="n">service</span><span class="o">/</span><span class="n">qgis</span><span class="o">-</span><span class="n">exec</span><span class="o">-</span><span class="n">server</span>   <span class="n">ClusterIP</span>   <span class="mf">10.152.183.218</span>   <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>        <span class="mi">5555</span><span class="o">/</span><span class="n">TCP</span>       <span class="mi">35</span><span class="n">m</span>
<span class="n">service</span><span class="o">/</span><span class="n">qgis</span><span class="o">-</span><span class="n">nginx</span>         <span class="n">NodePort</span>    <span class="mf">10.152.183.234</span>   <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>        <span class="mi">80</span><span class="p">:</span><span class="mi">30080</span><span class="o">/</span><span class="n">TCP</span>   <span class="mi">27</span><span class="n">m</span>
<span class="n">service</span><span class="o">/</span><span class="n">qgis</span><span class="o">-</span><span class="n">server</span>        <span class="n">ClusterIP</span>   <span class="mf">10.152.183.132</span>   <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>        <span class="mi">5555</span><span class="o">/</span><span class="n">TCP</span>       <span class="mi">27</span><span class="n">m</span>

<span class="n">NAME</span>                          <span class="n">READY</span>   <span class="n">UP</span><span class="o">-</span><span class="n">TO</span><span class="o">-</span><span class="n">DATE</span>   <span class="n">AVAILABLE</span>   <span class="n">AGE</span>
<span class="n">deployment</span><span class="o">.</span><span class="n">apps</span><span class="o">/</span><span class="n">qgis</span><span class="o">-</span><span class="n">nginx</span>    <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>     <span class="mi">1</span>            <span class="mi">1</span>           <span class="mi">27</span><span class="n">m</span>
<span class="n">deployment</span><span class="o">.</span><span class="n">apps</span><span class="o">/</span><span class="n">qgis</span><span class="o">-</span><span class="n">server</span>   <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>     <span class="mi">1</span>            <span class="mi">1</span>           <span class="mi">27</span><span class="n">m</span>
</pre></div>
</div>
<p>To read nginx/qgis logs, type:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>kubectl<span class="w"> </span>logs<span class="w"> </span>-f<span class="w"> </span>POD_NAME
</pre></div>
</div>
<p>To check WMS capabilities, type in a web browser
<a class="reference external" href="http://localhost:30080/qgis-server/?SERVICE=WMS&amp;VERSION=1.3.0&amp;REQUEST=GetCapabilities">http://localhost:30080/qgis-server/?SERVICE=WMS&amp;VERSION=1.3.0&amp;REQUEST=GetCapabilities</a></p>
</section>
<section id="id4">
<h4><a class="toc-backref" href="#id17" role="doc-backlink">Cleanup</a><a class="headerlink" href="#id4" title="Link to this heading"></a></h4>
<p>To clean up, type:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>kubectl<span class="w"> </span>delete<span class="w"> </span>service/qgis-server<span class="w"> </span>service/qgis-nginx<span class="w"> </span>deployment/qgis-nginx<span class="w"> </span>deployment/qgis-server<span class="w"> </span>configmap/nginx-configuration
</pre></div>
</div>
</section>
</section>
</section>
<section id="cloud-deployment">
<h2><a class="toc-backref" href="#id18" role="doc-backlink"><span class="section-number">8.3. </span>Cloud deployment</a><a class="headerlink" href="#cloud-deployment" title="Link to this heading"></a></h2>
<p>Managing your own cluster of servers to handle the deployment of
containerized applications, is a complex job.
You have to handle multiple issues, such as hardware, bandwidth and
security at different levels.</p>
<p>Cloud deployment solutions can be a good alternative when you do not
want to focus on infrastructure management.</p>
<p>A cloud deployment may use proprietary mechanisms, but they are also
compatible with the stages explained previously
(<a class="reference internal" href="#simple-docker-images"><span class="std std-ref">docker images</span></a> and
<a class="reference internal" href="#docker-stacks"><span class="std std-ref">stack management</span></a>).</p>
<section id="aws-usecase">
<h3><a class="toc-backref" href="#id19" role="doc-backlink"><span class="section-number">8.3.1. </span>AWS usecase</a><a class="headerlink" href="#aws-usecase" title="Link to this heading"></a></h3>
<p>With Amazon AWS, through
<a class="reference external" href="https://console.aws.amazon.com/ecs/home">ECS (Elastic Container Service)</a>
functionalities, you can use docker-compose or Kubernetes compatible
wrappers to manage your stack.
You will have to create an
<a class="reference external" href="https://console.aws.amazon.com/ecr/home">image registry</a> for your
custom images to be accessible.</p>
<p>To use docker-compose alike functionalities, you need to install the
<strong>ecs-cli</strong> client and have <a class="reference external" href="https://docs.aws.amazon.com/AmazonECS/latest/developerguide/task_execution_IAM_role.html">proper permissions / roles</a>.
Then, with the help of the <a class="reference external" href="https://github.com/aws/amazon-ecs-cli">ecs-cli compose</a> commands,
you can reuse the <a class="reference internal" href="#docker-compose-file"><span class="std std-ref">stack description</span></a>.</p>
<p>To use Kubernetes, you can use the AWS web console or the command line
tool
<a class="reference external" href="https://docs.aws.amazon.com/eks/latest/userguide/getting-started.html">eksctl</a>
and have the proper permissions / roles. Then with a well configured
kubectl environment, you can reuse the <a class="reference internal" href="#k8s-manifests"><span class="std std-ref">Kubernetes manifests</span></a>.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="development_server.html" class="btn btn-neutral float-left" title="7. Development Server" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="faq.html" class="btn btn-neutral float-right" title="9. Frequently Asked Question" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2002-now, QGIS project.
      <span class="lastupdated">Last updated on 2024 May 30, 01:27 +0900.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <!-- Transifex follows a particular logic to build target pages:
Expected French translation link for https://docs.qgis.org/3.28/en/docs/user_manual/print_composer/overview_composer.html
would return https://app.transifex.com/qgis/qgis-documentation/translate/#fr/aa6d8bc653526d38b295ca94bf8eee5e
with the md5 value of "github#qgis/QGIS-Documentation#release_3.28#locale/en/LC_MESSAGES/docs/user_manual/print_composer/overview_composer.po"-->
<!--Make sure that mismatching language codes between Transifex and Sphinx are converted-->


  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-info-circle"> QGIS Documentation </span>
      v: 3.34
      <span class="fa fa-caret-down"></span>
    </span>

    <div class="rst-other-versions">
      <dl>
        <dt>Languages</dt>
        
          <dd><a href="https://docs.qgis.org/3.34/en/docs/server_manual/containerized_deployment.html">en</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/cs/docs/server_manual/containerized_deployment.html">cs</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/de/docs/server_manual/containerized_deployment.html">de</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/es/docs/server_manual/containerized_deployment.html">es</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/fr/docs/server_manual/containerized_deployment.html">fr</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/hu/docs/server_manual/containerized_deployment.html">hu</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/it/docs/server_manual/containerized_deployment.html">it</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/ja/docs/server_manual/containerized_deployment.html">ja</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/ko/docs/server_manual/containerized_deployment.html">ko</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/lt/docs/server_manual/containerized_deployment.html">lt</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/nl/docs/server_manual/containerized_deployment.html">nl</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/pt_BR/docs/server_manual/containerized_deployment.html">pt_BR</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/pt_PT/docs/server_manual/containerized_deployment.html">pt_PT</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/ro/docs/server_manual/containerized_deployment.html">ro</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/ru/docs/server_manual/containerized_deployment.html">ru</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/zh-Hans/docs/server_manual/containerized_deployment.html">zh-Hans</a></dd>
        
      </dl>

      <dl>
        <dt>Versions</dt>
        
          <dd><a href="https://docs.qgis.org/testing/en/docs/server_manual/containerized_deployment.html">testing</a></dd>
        
          <dd><a href="https://docs.qgis.org/latest/en/docs/server_manual/containerized_deployment.html">latest</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/en/docs/server_manual/containerized_deployment.html">3.34</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.28/en/docs/server_manual/containerized_deployment.html">3.28</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.22/en/docs/server_manual/containerized_deployment.html">3.22</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.16/en/docs/server_manual/containerized_deployment.html">3.16</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.10/en/docs/server_manual/containerized_deployment.html">3.10</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.4/en/docs/server_manual/containerized_deployment.html">3.4</a></dd>
        
          <dd><a href="https://docs.qgis.org/2.18/en/docs/server_manual/containerized_deployment.html">2.18</a></dd>
        
      </dl>

       
       <dl>
        <dt>Downloads</dt>
        
          <dd><a href="https://docs.qgis.org/3.34/pdf">PDF</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/zip">HTML</a></dd>
        
      </dl>
      

      
       
      <dl>
        <dt>Contribute to Docs</dt>
          <dd>
            <a href="https://github.com/qgis/QGIS-Documentation/edit/master/docs/server_manual/containerized_deployment.rst" target="_blank" rel="noopener noreferrer">Edit on GitHub</a>
          </dd>
          
          
          <dd>
            <a href="https://app.transifex.com/qgis/qgis-documentation/translate/#en/48a45deaa7fa6664bc80bff50e857b23" target="_blank" rel="noopener noreferrer">Translate Page</a>
          </dd>
          
          <dd>
            <a href="https://github.com/qgis/QGIS-Documentation/issues" target="_blank" rel="noopener noreferrer">Report Issue</a>
          </dd>
      </dl>
      

      <dl>
        <dt>On QGIS Project</dt>
          <dd>
            <a href="https://qgis.org/en" target="_blank" rel="noopener noreferrer">Home</a>
          </dd>
          <dd>
            <a href="https://qgis.org/api/3.34" target="_blank" rel="noopener noreferrer">C++ API</a>
          </dd>
          <dd>
            <a href="https://qgis.org/pyqgis/3.34" target="_blank" rel="noopener noreferrer">PyQGIS API</a>
          </dd>
          <dd>
            <a href="https://github.com/qgis/QGIS/tree/release-3_34" target="_blank" rel="noopener noreferrer">Source</a>
          </dd>
      </dl>

    </div>
  </div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>