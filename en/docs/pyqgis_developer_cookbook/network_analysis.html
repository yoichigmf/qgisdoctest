<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>19. Network analysis library &mdash; QGIS Documentation  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/qgis_docs.css?v=5415a924" />
      <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
      <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />

  
    <link rel="shortcut icon" href="../../_static/qgis_logo.ico"/>
    <link rel="canonical" href="https://docs.qgis.org/latest/en/docs/pyqgis_developer_cookbook/network_analysis.html"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../../_static/copybutton.js?v=f281be69"></script>
        <script>let toggleHintShow = 'Click to show';</script>
        <script>let toggleHintHide = 'Click to hide';</script>
        <script>let toggleOpenOnPrint = 'true';</script>
        <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="20. QGIS Server and Python" href="server.html" />
    <link rel="prev" title="18. Using Plugin Layers" href="pluginlayer.html" />
  <meta name="description" content="QGIS 3.34 documentation: 19. Network analysis library">
</head>

<body class="wy-body-for-nav">

  <nav class="release_status_topbar">
  </nav>

   

 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
   

          
          
          <a href="../index.html" class="icon icon-home">
            QGIS Documentation
              <img src="../../_static/logo.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                3.34
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
   <a href= "../../genindex.html">Index</a>
 
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">For Users</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/index.html">QGIS Desktop User Guide/Manual (QGIS 3.34)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../server_manual/index.html">QGIS Server Guide/Manual (QGIS 3.34)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../training_manual/index.html">Training Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gentle_gis_introduction/index.html">A Gentle Introduction to GIS</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">For Writers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../documentation_guidelines/index.html">Documentation Guidelines</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">For Developers</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">PyQGIS Cookbook (QGIS 3.34)</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="intro.html">1. Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="loadproject.html">2. Loading Projects</a></li>
<li class="toctree-l2"><a class="reference internal" href="loadlayer.html">3. Loading Layers</a></li>
<li class="toctree-l2"><a class="reference internal" href="legend.html">4. Accessing the Table Of Contents (TOC)</a></li>
<li class="toctree-l2"><a class="reference internal" href="raster.html">5. Using Raster Layers</a></li>
<li class="toctree-l2"><a class="reference internal" href="vector.html">6. Using Vector Layers</a></li>
<li class="toctree-l2"><a class="reference internal" href="geometry.html">7. Geometry Handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="crs.html">8. Projections Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="canvas.html">9. Using the Map Canvas</a></li>
<li class="toctree-l2"><a class="reference internal" href="composer.html">10. Map Rendering and Printing</a></li>
<li class="toctree-l2"><a class="reference internal" href="expressions.html">11. Expressions, Filtering and Calculating Values</a></li>
<li class="toctree-l2"><a class="reference internal" href="settings.html">12. Reading And Storing Settings</a></li>
<li class="toctree-l2"><a class="reference internal" href="communicating.html">13. Communicating with the user</a></li>
<li class="toctree-l2"><a class="reference internal" href="authentication.html">14. Authentication infrastructure</a></li>
<li class="toctree-l2"><a class="reference internal" href="tasks.html">15. Tasks - doing heavy work in the background</a></li>
<li class="toctree-l2"><a class="reference internal" href="plugins/index.html">16. Developing Python Plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="processing.html">17. Writing a Processing plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="pluginlayer.html">18. Using Plugin Layers</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">19. Network analysis library</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#general-information">19.1. General information</a></li>
<li class="toctree-l3"><a class="reference internal" href="#building-a-graph">19.2. Building a graph</a></li>
<li class="toctree-l3"><a class="reference internal" href="#graph-analysis">19.3. Graph analysis</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#finding-shortest-paths">19.3.1. Finding shortest paths</a></li>
<li class="toctree-l4"><a class="reference internal" href="#areas-of-availability">19.3.2. Areas of availability</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="server.html">20. QGIS Server and Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="cheat_sheet.html">21. Cheat sheet for PyQGIS</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../developers_guide/index.html">Developers Guide</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">QGIS Documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">PyQGIS Developer Cookbook</a></li>
      <li class="breadcrumb-item active"><span class="section-number">19. </span>Network analysis library</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/qgis/QGIS-Documentation/blob/master/docs/pyqgis_developer_cookbook/network_analysis.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul><div class="rst-breadcrumbs-buttons" role="navigation" aria-label="Sequential page navigation">
        <a href="pluginlayer.html" class="btn btn-neutral float-left" title="18. Using Plugin Layers" accesskey="p"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="server.html" class="btn btn-neutral float-right" title="20. QGIS Server and Python" accesskey="n">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
  </div>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <blockquote>
<div></div></blockquote>
<section id="network-analysis-library">
<span id="network-analysis"></span><h1><span class="section-number">19. </span>Network analysis library<a class="headerlink" href="#network-analysis-library" title="Link to this heading"></a></h1>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>The code snippets on this page need the following imports if you’re outside the pyqgis console:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">qgis.core</span> <span class="kn">import</span> <span class="p">(</span>
  <span class="n">QgsVectorLayer</span><span class="p">,</span>
  <span class="n">QgsPointXY</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#general-information" id="id1">General information</a></p></li>
<li><p><a class="reference internal" href="#building-a-graph" id="id2">Building a graph</a></p></li>
<li><p><a class="reference internal" href="#graph-analysis" id="id3">Graph analysis</a></p>
<ul>
<li><p><a class="reference internal" href="#finding-shortest-paths" id="id4">Finding shortest paths</a></p></li>
<li><p><a class="reference internal" href="#areas-of-availability" id="id5">Areas of availability</a></p></li>
</ul>
</li>
</ul>
</nav>
<p>The network analysis library can be used to:</p>
<ul class="simple">
<li><p>create mathematical graph from geographical data (polyline vector layers)</p></li>
<li><p>implement basic methods from graph theory (currently only Dijkstra’s
algorithm)</p></li>
</ul>
<p>The network analysis library was created by exporting basic functions from the
RoadGraph core plugin and now you can use it’s methods in plugins or
directly from the Python console.</p>
<section id="general-information">
<h2><a class="toc-backref" href="#id1" role="doc-backlink"><span class="section-number">19.1. </span>General information</a><a class="headerlink" href="#general-information" title="Link to this heading"></a></h2>
<p>Briefly, a typical use case can be described as:</p>
<ol class="arabic simple">
<li><p>create graph from geodata (usually polyline vector layer)</p></li>
<li><p>run graph analysis</p></li>
<li><p>use analysis results (for example, visualize them)</p></li>
</ol>
</section>
<section id="building-a-graph">
<h2><a class="toc-backref" href="#id2" role="doc-backlink"><span class="section-number">19.2. </span>Building a graph</a><a class="headerlink" href="#building-a-graph" title="Link to this heading"></a></h2>
<p>The first thing you need to do — is to prepare input data, that is to
convert a vector layer into a graph. All further actions will use this graph,
not the layer.</p>
<p>As a source we can use any polyline vector layer. Nodes of the polylines
become graph vertexes, and segments of the polylines are graph edges.
If several nodes have the same coordinates then they are the same graph vertex.
So two lines that have a common node become connected to each other.</p>
<p>Additionally, during graph creation it is possible to “fix” (“tie”) to the
input vector layer any number of additional points. For each additional
point a match will be found — the closest graph vertex or closest graph edge.
In the latter case the edge will be split and a new vertex added.</p>
<p>Vector layer attributes and length of an edge can be used as the properties
of an edge.</p>
<p>Converting from a vector layer to the graph is done using the
<a class="reference external" href="https://en.wikipedia.org/wiki/Builder_pattern">Builder</a>
programming pattern. A graph is constructed using a so-called Director.
There is only one Director for now: <a class="reference external" href="https://qgis.org/pyqgis/3.34/analysis/QgsVectorLayerDirector.html#qgis.analysis.QgsVectorLayerDirector" title="(in QGIS Python API v3.34)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QgsVectorLayerDirector</span></code></a>.
The director sets the basic settings that will be used to construct a graph
from a line vector layer, used by the builder to create the graph. Currently, as
in the case with the director, only one builder exists: <a class="reference external" href="https://qgis.org/pyqgis/3.34/analysis/QgsGraphBuilder.html#qgis.analysis.QgsGraphBuilder" title="(in QGIS Python API v3.34)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QgsGraphBuilder</span></code></a>,
that creates <a class="reference external" href="https://qgis.org/pyqgis/3.34/analysis/QgsGraph.html#qgis.analysis.QgsGraph" title="(in QGIS Python API v3.34)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QgsGraph</span></code></a> objects.
You may want to implement your own builders that will build a graph compatible
with such libraries as <a class="reference external" href="https://www.boost.org/doc/libs/1_48_0/libs/graph/doc/index.html">BGL</a>
or <a class="reference external" href="https://networkx.org/">NetworkX</a>.</p>
<p>To calculate edge properties the programming pattern <a class="reference external" href="https://en.wikipedia.org/wiki/Strategy_pattern">strategy</a>
is used. For now only <a class="reference external" href="https://qgis.org/pyqgis/3.34/analysis/QgsNetworkDistanceStrategy.html#qgis.analysis.QgsNetworkDistanceStrategy" title="(in QGIS Python API v3.34)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QgsNetworkDistanceStrategy</span></code></a>
strategy (that takes into account the length of the route) and
<a class="reference external" href="https://qgis.org/pyqgis/3.34/analysis/QgsNetworkSpeedStrategy.html#qgis.analysis.QgsNetworkSpeedStrategy" title="(in QGIS Python API v3.34)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QgsNetworkSpeedStrategy</span></code></a> (that also considers
the speed) are availabile. You can implement your own strategy that will use all
necessary parameters.
For example, RoadGraph plugin uses a strategy that computes travel time
using edge length and speed value from attributes.</p>
<p>It’s time to dive into the process.</p>
<p>First of all, to use this library we should import the analysis module</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">qgis.analysis</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>
</div>
<p>Then some examples for creating a director</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1"># don&#39;t use information about road direction from layer attributes,</span>
<span class="linenos"> 2</span><span class="c1"># all roads are treated as two-way</span>
<span class="linenos"> 3</span><span class="n">director</span> <span class="o">=</span> <span class="n">QgsVectorLayerDirector</span><span class="p">(</span><span class="n">vectorLayer</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">QgsVectorLayerDirector</span><span class="o">.</span><span class="n">DirectionBoth</span><span class="p">)</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="c1"># use field with index 5 as source of information about road direction.</span>
<span class="linenos"> 6</span><span class="c1"># one-way roads with direct direction have attribute value &quot;yes&quot;,</span>
<span class="linenos"> 7</span><span class="c1"># one-way roads with reverse direction have the value &quot;1&quot;, and accordingly</span>
<span class="linenos"> 8</span><span class="c1"># bidirectional roads have &quot;no&quot;. By default roads are treated as two-way.</span>
<span class="linenos"> 9</span><span class="c1"># This scheme can be used with OpenStreetMap data</span>
<span class="linenos">10</span><span class="n">director</span> <span class="o">=</span> <span class="n">QgsVectorLayerDirector</span><span class="p">(</span><span class="n">vectorLayer</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;yes&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;no&#39;</span><span class="p">,</span> <span class="n">QgsVectorLayerDirector</span><span class="o">.</span><span class="n">DirectionBoth</span><span class="p">)</span>
</pre></div>
</div>
<p>To construct a director, we should pass a vector layer that will be used
as the source for the graph structure and information about allowed movement on
each road segment (one-way or bidirectional movement, direct or reverse
direction). The call looks like this</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="n">director</span> <span class="o">=</span> <span class="n">QgsVectorLayerDirector</span><span class="p">(</span><span class="n">vectorLayer</span><span class="p">,</span>
<span class="linenos">2</span>                                  <span class="n">directionFieldId</span><span class="p">,</span>
<span class="linenos">3</span>                                  <span class="n">directDirectionValue</span><span class="p">,</span>
<span class="linenos">4</span>                                  <span class="n">reverseDirectionValue</span><span class="p">,</span>
<span class="linenos">5</span>                                  <span class="n">bothDirectionValue</span><span class="p">,</span>
<span class="linenos">6</span>                                  <span class="n">defaultDirection</span><span class="p">)</span>
</pre></div>
</div>
<p>And here is full list of what these parameters mean:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">vectorLayer</span></code> — vector layer used to build the graph</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">directionFieldId</span></code> — index of the attribute table field, where
information about roads direction is stored. If <code class="docutils literal notranslate"><span class="pre">-1</span></code>, then don’t use this
info at all. An integer.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">directDirectionValue</span></code> — field value for roads with direct direction
(moving from first line point to last one). A string.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">reverseDirectionValue</span></code> — field value for roads with reverse direction
(moving from last line point to first one). A string.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bothDirectionValue</span></code> — field value for bidirectional roads (for such
roads we can move from first point to last and from last to first). A string.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">defaultDirection</span></code> — default road direction. This value will be used for
those roads where field <code class="docutils literal notranslate"><span class="pre">directionFieldId</span></code> is not set or has some value
different from any of the three values specified above. Possible values are:</p>
<ul>
<li><p><a class="reference external" href="https://qgis.org/pyqgis/3.34/analysis/QgsVectorLayerDirector.html#qgis.analysis.QgsVectorLayerDirector.DirectionForward" title="(in QGIS Python API v3.34)"><code class="xref py py-attr docutils literal notranslate"><span class="pre">QgsVectorLayerDirector.DirectionForward</span></code></a> — One-way direct</p></li>
<li><p><a class="reference external" href="https://qgis.org/pyqgis/3.34/analysis/QgsVectorLayerDirector.html#qgis.analysis.QgsVectorLayerDirector.DirectionBackward" title="(in QGIS Python API v3.34)"><code class="xref py py-attr docutils literal notranslate"><span class="pre">QgsVectorLayerDirector.DirectionBackward</span></code></a> — One-way reverse</p></li>
<li><p><a class="reference external" href="https://qgis.org/pyqgis/3.34/analysis/QgsVectorLayerDirector.html#qgis.analysis.QgsVectorLayerDirector.DirectionBoth" title="(in QGIS Python API v3.34)"><code class="xref py py-attr docutils literal notranslate"><span class="pre">QgsVectorLayerDirector.DirectionBoth</span></code></a> — Two-way</p></li>
</ul>
</li>
</ul>
<p>It is necessary then to create a strategy for calculating edge properties</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="c1"># The index of the field that contains information about the edge speed</span>
<span class="linenos">2</span><span class="n">attributeId</span> <span class="o">=</span> <span class="mi">1</span>
<span class="linenos">3</span><span class="c1"># Default speed value</span>
<span class="linenos">4</span><span class="n">defaultValue</span> <span class="o">=</span> <span class="mi">50</span>
<span class="linenos">5</span><span class="c1"># Conversion from speed to metric units (&#39;1&#39; means no conversion)</span>
<span class="linenos">6</span><span class="n">toMetricFactor</span> <span class="o">=</span> <span class="mi">1</span>
<span class="linenos">7</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">QgsNetworkSpeedStrategy</span><span class="p">(</span><span class="n">attributeId</span><span class="p">,</span> <span class="n">defaultValue</span><span class="p">,</span> <span class="n">toMetricFactor</span><span class="p">)</span>
</pre></div>
</div>
<p>And tell the director about this strategy</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">director</span> <span class="o">=</span> <span class="n">QgsVectorLayerDirector</span><span class="p">(</span><span class="n">vectorLayer</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">director</span><span class="o">.</span><span class="n">addStrategy</span><span class="p">(</span><span class="n">strategy</span><span class="p">)</span>
</pre></div>
</div>
<p>Now we can use the builder, which will create the graph. The <a class="reference external" href="https://qgis.org/pyqgis/3.34/analysis/QgsGraphBuilder.html#qgis.analysis.QgsGraphBuilder" title="(in QGIS Python API v3.34)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QgsGraphBuilder</span></code></a> class constructor takes several arguments:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">crs</span></code> — coordinate reference system to use. Mandatory argument.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">otfEnabled</span></code> — use “on the fly” reprojection or no. By default <code class="xref py py-const docutils literal notranslate"><span class="pre">True</span></code>
(use OTF).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">topologyTolerance</span></code> — topological tolerance. Default value is 0.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ellipsoidID</span></code> — ellipsoid to use. By default “WGS84”.</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># only CRS is set, all other values are defaults</span>
<span class="n">builder</span> <span class="o">=</span> <span class="n">QgsGraphBuilder</span><span class="p">(</span><span class="n">vectorLayer</span><span class="o">.</span><span class="n">crs</span><span class="p">())</span>
</pre></div>
</div>
<p>Also we can define several points, which will be used in the analysis. For
example</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">startPoint</span> <span class="o">=</span> <span class="n">QgsPointXY</span><span class="p">(</span><span class="mf">1179720.1871</span><span class="p">,</span> <span class="mf">5419067.3507</span><span class="p">)</span>
<span class="n">endPoint</span> <span class="o">=</span> <span class="n">QgsPointXY</span><span class="p">(</span><span class="mf">1180616.0205</span><span class="p">,</span> <span class="mf">5419745.7839</span><span class="p">)</span>
</pre></div>
</div>
<p>Now all is in place so we can build the graph and “tie” these points to it</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">tiedPoints</span> <span class="o">=</span> <span class="n">director</span><span class="o">.</span><span class="n">makeGraph</span><span class="p">(</span><span class="n">builder</span><span class="p">,</span> <span class="p">[</span><span class="n">startPoint</span><span class="p">,</span> <span class="n">endPoint</span><span class="p">])</span>
</pre></div>
</div>
<p>Building the graph can take some time (which depends on the number of features
in a layer and layer size). <code class="docutils literal notranslate"><span class="pre">tiedPoints</span></code> is a list with coordinates of “tied”
points. When the build operation is finished we can get the graph and use it
for the analysis</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">graph</span><span class="p">()</span>
</pre></div>
</div>
<p>With the next code we can get the vertex indexes of our points</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">startId</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">findVertex</span><span class="p">(</span><span class="n">tiedPoints</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">endId</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">findVertex</span><span class="p">(</span><span class="n">tiedPoints</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</section>
<section id="graph-analysis">
<h2><a class="toc-backref" href="#id3" role="doc-backlink"><span class="section-number">19.3. </span>Graph analysis</a><a class="headerlink" href="#graph-analysis" title="Link to this heading"></a></h2>
<p>Networks analysis is used to find answers to two questions: which vertexes
are connected and how to find a shortest path. To solve these problems the
network analysis library provides Dijkstra’s algorithm.</p>
<p>Dijkstra’s algorithm finds the shortest route from one of the vertexes of the
graph to all the others and the values of the optimization parameters.
The results can be represented as a shortest path tree.</p>
<p>The shortest path tree is a directed weighted graph (or more precisely a tree)
with the following properties:</p>
<ul class="simple">
<li><p>only one vertex has no incoming edges — the root of the tree</p></li>
<li><p>all other vertexes have only one incoming edge</p></li>
<li><p>if vertex B is reachable from vertex A, then the path from A to B is the
single available path and it is optimal (shortest) on this graph</p></li>
</ul>
<p>To get the shortest path tree use the methods <a class="reference external" href="https://qgis.org/pyqgis/3.34/analysis/QgsGraphAnalyzer.html#qgis.analysis.QgsGraphAnalyzer.shortestTree" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">shortestTree()</span></code></a> and <a class="reference external" href="https://qgis.org/pyqgis/3.34/analysis/QgsGraphAnalyzer.html#qgis.analysis.QgsGraphAnalyzer.dijkstra" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">dijkstra()</span></code></a> of the <a class="reference external" href="https://qgis.org/pyqgis/3.34/analysis/QgsGraphAnalyzer.html#qgis.analysis.QgsGraphAnalyzer" title="(in QGIS Python API v3.34)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QgsGraphAnalyzer</span></code></a> class. It is recommended to use the
<a class="reference external" href="https://qgis.org/pyqgis/3.34/analysis/QgsGraphAnalyzer.html#qgis.analysis.QgsGraphAnalyzer.dijkstra" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">dijkstra()</span></code></a> method because it works
faster and uses memory more efficiently.</p>
<p>The <a class="reference external" href="https://qgis.org/pyqgis/3.34/analysis/QgsGraphAnalyzer.html#qgis.analysis.QgsGraphAnalyzer.shortestTree" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">shortestTree()</span></code></a> method
is useful when you want to walk around the
shortest path tree. It always creates a new graph object (QgsGraph) and accepts
three variables:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">source</span></code> — input graph</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">startVertexIdx</span></code> — index of the point on the tree (the root of the tree)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">criterionNum</span></code> — number of edge property to use (started from 0).</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">tree</span> <span class="o">=</span> <span class="n">QgsGraphAnalyzer</span><span class="o">.</span><span class="n">shortestTree</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">startId</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>The <a class="reference external" href="https://qgis.org/pyqgis/3.34/analysis/QgsGraphAnalyzer.html#qgis.analysis.QgsGraphAnalyzer.dijkstra" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">dijkstra()</span></code></a> method has the
same arguments, but returns two arrays.
In the first array element <cite>n</cite> contains index of the incoming edge or -1 if there
are no incoming edges. In the second array element <cite>n</cite> contains the distance from
the root of the tree to vertex <cite>n</cite> or DOUBLE_MAX if vertex <cite>n</cite> is unreachable
from the root.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">cost</span><span class="p">)</span> <span class="o">=</span> <span class="n">QgsGraphAnalyzer</span><span class="o">.</span><span class="n">dijkstra</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">startId</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>Here is some very simple code to display the shortest path tree using the graph
created with the <a class="reference external" href="https://qgis.org/pyqgis/3.34/analysis/QgsGraphAnalyzer.html#qgis.analysis.QgsGraphAnalyzer.shortestTree" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">shortestTree()</span></code></a>
method (select linestring layer in <span class="guilabel">Layers</span> panel
and replace coordinates with your own).</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Use this code only as an example, it creates a lot of
<a class="reference external" href="https://qgis.org/pyqgis/3.34/gui/QgsRubberBand.html#qgis.gui.QgsRubberBand" title="(in QGIS Python API v3.34)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QgsRubberBand</span></code></a> objects and may be slow on
large datasets.</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">from</span> <span class="nn">qgis.core</span> <span class="kn">import</span> <span class="o">*</span>
<span class="linenos"> 2</span><span class="kn">from</span> <span class="nn">qgis.gui</span> <span class="kn">import</span> <span class="o">*</span>
<span class="linenos"> 3</span><span class="kn">from</span> <span class="nn">qgis.analysis</span> <span class="kn">import</span> <span class="o">*</span>
<span class="linenos"> 4</span><span class="kn">from</span> <span class="nn">qgis.PyQt.QtCore</span> <span class="kn">import</span> <span class="o">*</span>
<span class="linenos"> 5</span><span class="kn">from</span> <span class="nn">qgis.PyQt.QtGui</span> <span class="kn">import</span> <span class="o">*</span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span><span class="n">vectorLayer</span> <span class="o">=</span> <span class="n">QgsVectorLayer</span><span class="p">(</span><span class="s1">&#39;testdata/network.gpkg|layername=network_lines&#39;</span><span class="p">,</span> <span class="s1">&#39;lines&#39;</span><span class="p">)</span>
<span class="linenos"> 8</span><span class="n">director</span> <span class="o">=</span> <span class="n">QgsVectorLayerDirector</span><span class="p">(</span><span class="n">vectorLayer</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">QgsVectorLayerDirector</span><span class="o">.</span><span class="n">DirectionBoth</span><span class="p">)</span>
<span class="linenos"> 9</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">QgsNetworkDistanceStrategy</span><span class="p">()</span>
<span class="linenos">10</span><span class="n">director</span><span class="o">.</span><span class="n">addStrategy</span><span class="p">(</span><span class="n">strategy</span><span class="p">)</span>
<span class="linenos">11</span><span class="n">builder</span> <span class="o">=</span> <span class="n">QgsGraphBuilder</span><span class="p">(</span><span class="n">vectorLayer</span><span class="o">.</span><span class="n">crs</span><span class="p">())</span>
<span class="linenos">12</span>
<span class="linenos">13</span><span class="n">pStart</span> <span class="o">=</span> <span class="n">QgsPointXY</span><span class="p">(</span><span class="mf">1179661.925139</span><span class="p">,</span><span class="mf">5419188.074362</span><span class="p">)</span>
<span class="linenos">14</span><span class="n">tiedPoint</span> <span class="o">=</span> <span class="n">director</span><span class="o">.</span><span class="n">makeGraph</span><span class="p">(</span><span class="n">builder</span><span class="p">,</span> <span class="p">[</span><span class="n">pStart</span><span class="p">])</span>
<span class="linenos">15</span><span class="n">pStart</span> <span class="o">=</span> <span class="n">tiedPoint</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="linenos">16</span>
<span class="linenos">17</span><span class="n">graph</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">graph</span><span class="p">()</span>
<span class="linenos">18</span>
<span class="linenos">19</span><span class="n">idStart</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">findVertex</span><span class="p">(</span><span class="n">pStart</span><span class="p">)</span>
<span class="linenos">20</span>
<span class="linenos">21</span><span class="n">tree</span> <span class="o">=</span> <span class="n">QgsGraphAnalyzer</span><span class="o">.</span><span class="n">shortestTree</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">idStart</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="linenos">22</span>
<span class="linenos">23</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos">24</span><span class="k">while</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">tree</span><span class="o">.</span><span class="n">edgeCount</span><span class="p">()):</span>
<span class="linenos">25</span>  <span class="n">rb</span> <span class="o">=</span> <span class="n">QgsRubberBand</span><span class="p">(</span><span class="n">iface</span><span class="o">.</span><span class="n">mapCanvas</span><span class="p">())</span>
<span class="linenos">26</span>  <span class="n">rb</span><span class="o">.</span><span class="n">setColor</span> <span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">red</span><span class="p">)</span>
<span class="linenos">27</span>  <span class="n">rb</span><span class="o">.</span><span class="n">addPoint</span> <span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">vertex</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">fromVertex</span><span class="p">())</span><span class="o">.</span><span class="n">point</span><span class="p">())</span>
<span class="linenos">28</span>  <span class="n">rb</span><span class="o">.</span><span class="n">addPoint</span> <span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">vertex</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">toVertex</span><span class="p">())</span><span class="o">.</span><span class="n">point</span><span class="p">())</span>
<span class="linenos">29</span>  <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
</pre></div>
</div>
<p>Same thing but using the <a class="reference external" href="https://qgis.org/pyqgis/3.34/analysis/QgsGraphAnalyzer.html#qgis.analysis.QgsGraphAnalyzer.dijkstra" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">dijkstra()</span></code></a>
method</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">from</span> <span class="nn">qgis.core</span> <span class="kn">import</span> <span class="o">*</span>
<span class="linenos"> 2</span><span class="kn">from</span> <span class="nn">qgis.gui</span> <span class="kn">import</span> <span class="o">*</span>
<span class="linenos"> 3</span><span class="kn">from</span> <span class="nn">qgis.analysis</span> <span class="kn">import</span> <span class="o">*</span>
<span class="linenos"> 4</span><span class="kn">from</span> <span class="nn">qgis.PyQt.QtCore</span> <span class="kn">import</span> <span class="o">*</span>
<span class="linenos"> 5</span><span class="kn">from</span> <span class="nn">qgis.PyQt.QtGui</span> <span class="kn">import</span> <span class="o">*</span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span><span class="n">vectorLayer</span> <span class="o">=</span> <span class="n">QgsVectorLayer</span><span class="p">(</span><span class="s1">&#39;testdata/network.gpkg|layername=network_lines&#39;</span><span class="p">,</span> <span class="s1">&#39;lines&#39;</span><span class="p">)</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span><span class="n">director</span> <span class="o">=</span> <span class="n">QgsVectorLayerDirector</span><span class="p">(</span><span class="n">vectorLayer</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">QgsVectorLayerDirector</span><span class="o">.</span><span class="n">DirectionBoth</span><span class="p">)</span>
<span class="linenos">10</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">QgsNetworkDistanceStrategy</span><span class="p">()</span>
<span class="linenos">11</span><span class="n">director</span><span class="o">.</span><span class="n">addStrategy</span><span class="p">(</span><span class="n">strategy</span><span class="p">)</span>
<span class="linenos">12</span><span class="n">builder</span> <span class="o">=</span> <span class="n">QgsGraphBuilder</span><span class="p">(</span><span class="n">vectorLayer</span><span class="o">.</span><span class="n">crs</span><span class="p">())</span>
<span class="linenos">13</span>
<span class="linenos">14</span><span class="n">pStart</span> <span class="o">=</span> <span class="n">QgsPointXY</span><span class="p">(</span><span class="mf">1179661.925139</span><span class="p">,</span><span class="mf">5419188.074362</span><span class="p">)</span>
<span class="linenos">15</span><span class="n">tiedPoint</span> <span class="o">=</span> <span class="n">director</span><span class="o">.</span><span class="n">makeGraph</span><span class="p">(</span><span class="n">builder</span><span class="p">,</span> <span class="p">[</span><span class="n">pStart</span><span class="p">])</span>
<span class="linenos">16</span><span class="n">pStart</span> <span class="o">=</span> <span class="n">tiedPoint</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="linenos">17</span>
<span class="linenos">18</span><span class="n">graph</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">graph</span><span class="p">()</span>
<span class="linenos">19</span>
<span class="linenos">20</span><span class="n">idStart</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">findVertex</span><span class="p">(</span><span class="n">pStart</span><span class="p">)</span>
<span class="linenos">21</span>
<span class="linenos">22</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">costs</span><span class="p">)</span> <span class="o">=</span> <span class="n">QgsGraphAnalyzer</span><span class="o">.</span><span class="n">dijkstra</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">idStart</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="linenos">23</span>
<span class="linenos">24</span><span class="k">for</span> <span class="n">edgeId</span> <span class="ow">in</span> <span class="n">tree</span><span class="p">:</span>
<span class="linenos">25</span>  <span class="k">if</span> <span class="n">edgeId</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
<span class="linenos">26</span>    <span class="k">continue</span>
<span class="linenos">27</span>  <span class="n">rb</span> <span class="o">=</span> <span class="n">QgsRubberBand</span><span class="p">(</span><span class="n">iface</span><span class="o">.</span><span class="n">mapCanvas</span><span class="p">())</span>
<span class="linenos">28</span>  <span class="n">rb</span><span class="o">.</span><span class="n">setColor</span> <span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">red</span><span class="p">)</span>
<span class="linenos">29</span>  <span class="n">rb</span><span class="o">.</span><span class="n">addPoint</span> <span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">vertex</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="n">edgeId</span><span class="p">)</span><span class="o">.</span><span class="n">fromVertex</span><span class="p">())</span><span class="o">.</span><span class="n">point</span><span class="p">())</span>
<span class="linenos">30</span>  <span class="n">rb</span><span class="o">.</span><span class="n">addPoint</span> <span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">vertex</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="n">edgeId</span><span class="p">)</span><span class="o">.</span><span class="n">toVertex</span><span class="p">())</span><span class="o">.</span><span class="n">point</span><span class="p">())</span>
</pre></div>
</div>
<section id="finding-shortest-paths">
<h3><a class="toc-backref" href="#id4" role="doc-backlink"><span class="section-number">19.3.1. </span>Finding shortest paths</a><a class="headerlink" href="#finding-shortest-paths" title="Link to this heading"></a></h3>
<p>To find the optimal path between two points the following approach is used.
Both points (start A and end B) are “tied” to the graph when it is built. Then
using the <a class="reference external" href="https://qgis.org/pyqgis/3.34/analysis/QgsGraphAnalyzer.html#qgis.analysis.QgsGraphAnalyzer.shortestTree" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">shortestTree()</span></code></a>
or <a class="reference external" href="https://qgis.org/pyqgis/3.34/analysis/QgsGraphAnalyzer.html#qgis.analysis.QgsGraphAnalyzer.dijkstra" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">dijkstra()</span></code></a> method we build the
shortest path tree with root in the start point A. In the same tree we also
find the end point B and start to walk through the tree from point B to point
A. The whole algorithm can be written as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="n">assign</span> <span class="n">T</span> <span class="o">=</span> <span class="n">B</span>
<span class="linenos">2</span><span class="k">while</span> <span class="n">T</span> <span class="o">!=</span> <span class="n">B</span>
<span class="linenos">3</span>    <span class="n">add</span> <span class="n">point</span> <span class="n">T</span> <span class="n">to</span> <span class="n">path</span>
<span class="linenos">4</span>    <span class="n">get</span> <span class="n">incoming</span> <span class="n">edge</span> <span class="k">for</span> <span class="n">point</span> <span class="n">T</span>
<span class="linenos">5</span>    <span class="n">look</span> <span class="k">for</span> <span class="n">point</span> <span class="n">TT</span><span class="p">,</span> <span class="n">that</span> <span class="ow">is</span> <span class="n">start</span> <span class="n">point</span> <span class="n">of</span> <span class="n">this</span> <span class="n">edge</span>
<span class="linenos">6</span>    <span class="n">assign</span> <span class="n">T</span> <span class="o">=</span> <span class="n">TT</span>
<span class="linenos">7</span><span class="n">add</span> <span class="n">point</span> <span class="n">A</span> <span class="n">to</span> <span class="n">path</span>
</pre></div>
</div>
<p>At this point we have the path, in the form of the inverted list of vertexes
(vertexes are listed in reversed order from end point to start point) that will
be visited during traveling by this path.</p>
<p>Here is the sample code for QGIS Python Console (you may need to load and
select a linestring layer in TOC and replace coordinates in the code with yours) that
uses the <a class="reference external" href="https://qgis.org/pyqgis/3.34/analysis/QgsGraphAnalyzer.html#qgis.analysis.QgsGraphAnalyzer.shortestTree" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">shortestTree()</span></code></a> method</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">from</span> <span class="nn">qgis.core</span> <span class="kn">import</span> <span class="o">*</span>
<span class="linenos"> 2</span><span class="kn">from</span> <span class="nn">qgis.gui</span> <span class="kn">import</span> <span class="o">*</span>
<span class="linenos"> 3</span><span class="kn">from</span> <span class="nn">qgis.analysis</span> <span class="kn">import</span> <span class="o">*</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="kn">from</span> <span class="nn">qgis.PyQt.QtCore</span> <span class="kn">import</span> <span class="o">*</span>
<span class="linenos"> 6</span><span class="kn">from</span> <span class="nn">qgis.PyQt.QtGui</span> <span class="kn">import</span> <span class="o">*</span>
<span class="linenos"> 7</span>
<span class="linenos"> 8</span><span class="n">vectorLayer</span> <span class="o">=</span> <span class="n">QgsVectorLayer</span><span class="p">(</span><span class="s1">&#39;testdata/network.gpkg|layername=network_lines&#39;</span><span class="p">,</span> <span class="s1">&#39;lines&#39;</span><span class="p">)</span>
<span class="linenos"> 9</span><span class="n">builder</span> <span class="o">=</span> <span class="n">QgsGraphBuilder</span><span class="p">(</span><span class="n">vectorLayer</span><span class="o">.</span><span class="n">sourceCrs</span><span class="p">())</span>
<span class="linenos">10</span><span class="n">director</span> <span class="o">=</span> <span class="n">QgsVectorLayerDirector</span><span class="p">(</span><span class="n">vectorLayer</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">QgsVectorLayerDirector</span><span class="o">.</span><span class="n">DirectionBoth</span><span class="p">)</span>
<span class="linenos">11</span>
<span class="linenos">12</span><span class="n">startPoint</span> <span class="o">=</span> <span class="n">QgsPointXY</span><span class="p">(</span><span class="mf">1179661.925139</span><span class="p">,</span><span class="mf">5419188.074362</span><span class="p">)</span>
<span class="linenos">13</span><span class="n">endPoint</span> <span class="o">=</span> <span class="n">QgsPointXY</span><span class="p">(</span><span class="mf">1180942.970617</span><span class="p">,</span><span class="mf">5420040.097560</span><span class="p">)</span>
<span class="linenos">14</span>
<span class="linenos">15</span><span class="n">tiedPoints</span> <span class="o">=</span> <span class="n">director</span><span class="o">.</span><span class="n">makeGraph</span><span class="p">(</span><span class="n">builder</span><span class="p">,</span> <span class="p">[</span><span class="n">startPoint</span><span class="p">,</span> <span class="n">endPoint</span><span class="p">])</span>
<span class="linenos">16</span><span class="n">tStart</span><span class="p">,</span> <span class="n">tStop</span> <span class="o">=</span> <span class="n">tiedPoints</span>
<span class="linenos">17</span>
<span class="linenos">18</span><span class="n">graph</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">graph</span><span class="p">()</span>
<span class="linenos">19</span><span class="n">idxStart</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">findVertex</span><span class="p">(</span><span class="n">tStart</span><span class="p">)</span>
<span class="linenos">20</span>
<span class="linenos">21</span><span class="n">tree</span> <span class="o">=</span> <span class="n">QgsGraphAnalyzer</span><span class="o">.</span><span class="n">shortestTree</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">idxStart</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="linenos">22</span>
<span class="linenos">23</span><span class="n">idxStart</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">findVertex</span><span class="p">(</span><span class="n">tStart</span><span class="p">)</span>
<span class="linenos">24</span><span class="n">idxEnd</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">findVertex</span><span class="p">(</span><span class="n">tStop</span><span class="p">)</span>
<span class="linenos">25</span>
<span class="linenos">26</span><span class="k">if</span> <span class="n">idxEnd</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
<span class="linenos">27</span>    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;No route!&#39;</span><span class="p">)</span>
<span class="linenos">28</span>
<span class="linenos">29</span><span class="c1"># Add last point</span>
<span class="linenos">30</span><span class="n">route</span> <span class="o">=</span> <span class="p">[</span><span class="n">tree</span><span class="o">.</span><span class="n">vertex</span><span class="p">(</span><span class="n">idxEnd</span><span class="p">)</span><span class="o">.</span><span class="n">point</span><span class="p">()]</span>
<span class="linenos">31</span>
<span class="linenos">32</span><span class="c1"># Iterate the graph</span>
<span class="linenos">33</span><span class="k">while</span> <span class="n">idxEnd</span> <span class="o">!=</span> <span class="n">idxStart</span><span class="p">:</span>
<span class="linenos">34</span>    <span class="n">edgeIds</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">vertex</span><span class="p">(</span><span class="n">idxEnd</span><span class="p">)</span><span class="o">.</span><span class="n">incomingEdges</span><span class="p">()</span>
<span class="linenos">35</span>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">edgeIds</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<span class="linenos">36</span>        <span class="k">break</span>
<span class="linenos">37</span>    <span class="n">edge</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="n">edgeIds</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="linenos">38</span>    <span class="n">route</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">tree</span><span class="o">.</span><span class="n">vertex</span><span class="p">(</span><span class="n">edge</span><span class="o">.</span><span class="n">fromVertex</span><span class="p">())</span><span class="o">.</span><span class="n">point</span><span class="p">())</span>
<span class="linenos">39</span>    <span class="n">idxEnd</span> <span class="o">=</span> <span class="n">edge</span><span class="o">.</span><span class="n">fromVertex</span><span class="p">()</span>
<span class="linenos">40</span>
<span class="linenos">41</span><span class="c1"># Display</span>
<span class="linenos">42</span><span class="n">rb</span> <span class="o">=</span> <span class="n">QgsRubberBand</span><span class="p">(</span><span class="n">iface</span><span class="o">.</span><span class="n">mapCanvas</span><span class="p">())</span>
<span class="linenos">43</span><span class="n">rb</span><span class="o">.</span><span class="n">setColor</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">green</span><span class="p">)</span>
<span class="linenos">44</span>
<span class="linenos">45</span><span class="c1"># This may require coordinate transformation if project&#39;s CRS</span>
<span class="linenos">46</span><span class="c1"># is different than layer&#39;s CRS</span>
<span class="linenos">47</span><span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">route</span><span class="p">:</span>
<span class="linenos">48</span>    <span class="n">rb</span><span class="o">.</span><span class="n">addPoint</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</pre></div>
</div>
<p>And here is the same sample but using the <a class="reference external" href="https://qgis.org/pyqgis/3.34/analysis/QgsGraphAnalyzer.html#qgis.analysis.QgsGraphAnalyzer.dijkstra" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">dijkstra()</span></code></a> method</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">from</span> <span class="nn">qgis.core</span> <span class="kn">import</span> <span class="o">*</span>
<span class="linenos"> 2</span><span class="kn">from</span> <span class="nn">qgis.gui</span> <span class="kn">import</span> <span class="o">*</span>
<span class="linenos"> 3</span><span class="kn">from</span> <span class="nn">qgis.analysis</span> <span class="kn">import</span> <span class="o">*</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="kn">from</span> <span class="nn">qgis.PyQt.QtCore</span> <span class="kn">import</span> <span class="o">*</span>
<span class="linenos"> 6</span><span class="kn">from</span> <span class="nn">qgis.PyQt.QtGui</span> <span class="kn">import</span> <span class="o">*</span>
<span class="linenos"> 7</span>
<span class="linenos"> 8</span><span class="n">vectorLayer</span> <span class="o">=</span> <span class="n">QgsVectorLayer</span><span class="p">(</span><span class="s1">&#39;testdata/network.gpkg|layername=network_lines&#39;</span><span class="p">,</span> <span class="s1">&#39;lines&#39;</span><span class="p">)</span>
<span class="linenos"> 9</span><span class="n">director</span> <span class="o">=</span> <span class="n">QgsVectorLayerDirector</span><span class="p">(</span><span class="n">vectorLayer</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">QgsVectorLayerDirector</span><span class="o">.</span><span class="n">DirectionBoth</span><span class="p">)</span>
<span class="linenos">10</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">QgsNetworkDistanceStrategy</span><span class="p">()</span>
<span class="linenos">11</span><span class="n">director</span><span class="o">.</span><span class="n">addStrategy</span><span class="p">(</span><span class="n">strategy</span><span class="p">)</span>
<span class="linenos">12</span>
<span class="linenos">13</span><span class="n">builder</span> <span class="o">=</span> <span class="n">QgsGraphBuilder</span><span class="p">(</span><span class="n">vectorLayer</span><span class="o">.</span><span class="n">sourceCrs</span><span class="p">())</span>
<span class="linenos">14</span>
<span class="linenos">15</span><span class="n">startPoint</span> <span class="o">=</span> <span class="n">QgsPointXY</span><span class="p">(</span><span class="mf">1179661.925139</span><span class="p">,</span><span class="mf">5419188.074362</span><span class="p">)</span>
<span class="linenos">16</span><span class="n">endPoint</span> <span class="o">=</span> <span class="n">QgsPointXY</span><span class="p">(</span><span class="mf">1180942.970617</span><span class="p">,</span><span class="mf">5420040.097560</span><span class="p">)</span>
<span class="linenos">17</span>
<span class="linenos">18</span><span class="n">tiedPoints</span> <span class="o">=</span> <span class="n">director</span><span class="o">.</span><span class="n">makeGraph</span><span class="p">(</span><span class="n">builder</span><span class="p">,</span> <span class="p">[</span><span class="n">startPoint</span><span class="p">,</span> <span class="n">endPoint</span><span class="p">])</span>
<span class="linenos">19</span><span class="n">tStart</span><span class="p">,</span> <span class="n">tStop</span> <span class="o">=</span> <span class="n">tiedPoints</span>
<span class="linenos">20</span>
<span class="linenos">21</span><span class="n">graph</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">graph</span><span class="p">()</span>
<span class="linenos">22</span><span class="n">idxStart</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">findVertex</span><span class="p">(</span><span class="n">tStart</span><span class="p">)</span>
<span class="linenos">23</span><span class="n">idxEnd</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">findVertex</span><span class="p">(</span><span class="n">tStop</span><span class="p">)</span>
<span class="linenos">24</span>
<span class="linenos">25</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">costs</span><span class="p">)</span> <span class="o">=</span> <span class="n">QgsGraphAnalyzer</span><span class="o">.</span><span class="n">dijkstra</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">idxStart</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="linenos">26</span>
<span class="linenos">27</span><span class="k">if</span> <span class="n">tree</span><span class="p">[</span><span class="n">idxEnd</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
<span class="linenos">28</span>    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;No route!&#39;</span><span class="p">)</span>
<span class="linenos">29</span>
<span class="linenos">30</span><span class="c1"># Total cost</span>
<span class="linenos">31</span><span class="n">cost</span> <span class="o">=</span> <span class="n">costs</span><span class="p">[</span><span class="n">idxEnd</span><span class="p">]</span>
<span class="linenos">32</span>
<span class="linenos">33</span><span class="c1"># Add last point</span>
<span class="linenos">34</span><span class="n">route</span> <span class="o">=</span> <span class="p">[</span><span class="n">graph</span><span class="o">.</span><span class="n">vertex</span><span class="p">(</span><span class="n">idxEnd</span><span class="p">)</span><span class="o">.</span><span class="n">point</span><span class="p">()]</span>
<span class="linenos">35</span>
<span class="linenos">36</span><span class="c1"># Iterate the graph</span>
<span class="linenos">37</span><span class="k">while</span> <span class="n">idxEnd</span> <span class="o">!=</span> <span class="n">idxStart</span><span class="p">:</span>
<span class="linenos">38</span>    <span class="n">idxEnd</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="n">tree</span><span class="p">[</span><span class="n">idxEnd</span><span class="p">])</span><span class="o">.</span><span class="n">fromVertex</span><span class="p">()</span>
<span class="linenos">39</span>    <span class="n">route</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">graph</span><span class="o">.</span><span class="n">vertex</span><span class="p">(</span><span class="n">idxEnd</span><span class="p">)</span><span class="o">.</span><span class="n">point</span><span class="p">())</span>
<span class="linenos">40</span>
<span class="linenos">41</span><span class="c1"># Display</span>
<span class="linenos">42</span><span class="n">rb</span> <span class="o">=</span> <span class="n">QgsRubberBand</span><span class="p">(</span><span class="n">iface</span><span class="o">.</span><span class="n">mapCanvas</span><span class="p">())</span>
<span class="linenos">43</span><span class="n">rb</span><span class="o">.</span><span class="n">setColor</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">red</span><span class="p">)</span>
<span class="linenos">44</span>
<span class="linenos">45</span><span class="c1"># This may require coordinate transformation if project&#39;s CRS</span>
<span class="linenos">46</span><span class="c1"># is different than layer&#39;s CRS</span>
<span class="linenos">47</span><span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">route</span><span class="p">:</span>
<span class="linenos">48</span>    <span class="n">rb</span><span class="o">.</span><span class="n">addPoint</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="areas-of-availability">
<h3><a class="toc-backref" href="#id5" role="doc-backlink"><span class="section-number">19.3.2. </span>Areas of availability</a><a class="headerlink" href="#areas-of-availability" title="Link to this heading"></a></h3>
<p>The area of availability for vertex A is the subset of graph vertexes that are
accessible from vertex A and the cost of the paths from A to these vertexes are
not greater that some value.</p>
<p>More clearly this can be shown with the following example: “There is a fire
station. Which parts of city can a fire truck reach in 5 minutes? 10 minutes?
15 minutes?”. Answers to these questions are fire station’s areas of
availability.</p>
<p>To find the areas of availability we can use the <a class="reference external" href="https://qgis.org/pyqgis/3.34/analysis/QgsGraphAnalyzer.html#qgis.analysis.QgsGraphAnalyzer.dijkstra" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">dijkstra()</span></code></a> method of the <a class="reference external" href="https://qgis.org/pyqgis/3.34/analysis/QgsGraphAnalyzer.html#qgis.analysis.QgsGraphAnalyzer" title="(in QGIS Python API v3.34)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QgsGraphAnalyzer</span></code></a> class. It is enough to compare the elements of
the cost array with a predefined value. If cost[i] is less than or equal to a
predefined value, then vertex i is inside the area of availability, otherwise
it is outside.</p>
<p>A more difficult problem is to get the borders of the area of availability.
The bottom border is the set of vertexes that are still accessible, and the top
border is the set of vertexes that are not accessible. In fact this is simple:
it is the availability border based on the edges of the shortest path tree for
which the source vertex of the edge is accessible and the target vertex of the
edge is not.</p>
<p>Here is an example</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="n">director</span> <span class="o">=</span> <span class="n">QgsVectorLayerDirector</span><span class="p">(</span><span class="n">vectorLayer</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">QgsVectorLayerDirector</span><span class="o">.</span><span class="n">DirectionBoth</span><span class="p">)</span>
<span class="linenos"> 2</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">QgsNetworkDistanceStrategy</span><span class="p">()</span>
<span class="linenos"> 3</span><span class="n">director</span><span class="o">.</span><span class="n">addStrategy</span><span class="p">(</span><span class="n">strategy</span><span class="p">)</span>
<span class="linenos"> 4</span><span class="n">builder</span> <span class="o">=</span> <span class="n">QgsGraphBuilder</span><span class="p">(</span><span class="n">vectorLayer</span><span class="o">.</span><span class="n">crs</span><span class="p">())</span>
<span class="linenos"> 5</span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span><span class="n">pStart</span> <span class="o">=</span> <span class="n">QgsPointXY</span><span class="p">(</span><span class="mf">1179661.925139</span><span class="p">,</span> <span class="mf">5419188.074362</span><span class="p">)</span>
<span class="linenos"> 8</span><span class="n">delta</span> <span class="o">=</span> <span class="n">iface</span><span class="o">.</span><span class="n">mapCanvas</span><span class="p">()</span><span class="o">.</span><span class="n">getCoordinateTransform</span><span class="p">()</span><span class="o">.</span><span class="n">mapUnitsPerPixel</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1</span>
<span class="linenos"> 9</span>
<span class="linenos">10</span><span class="n">rb</span> <span class="o">=</span> <span class="n">QgsRubberBand</span><span class="p">(</span><span class="n">iface</span><span class="o">.</span><span class="n">mapCanvas</span><span class="p">())</span>
<span class="linenos">11</span><span class="n">rb</span><span class="o">.</span><span class="n">setColor</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">green</span><span class="p">)</span>
<span class="linenos">12</span><span class="n">rb</span><span class="o">.</span><span class="n">addPoint</span><span class="p">(</span><span class="n">QgsPointXY</span><span class="p">(</span><span class="n">pStart</span><span class="o">.</span><span class="n">x</span><span class="p">()</span> <span class="o">-</span> <span class="n">delta</span><span class="p">,</span> <span class="n">pStart</span><span class="o">.</span><span class="n">y</span><span class="p">()</span> <span class="o">-</span> <span class="n">delta</span><span class="p">))</span>
<span class="linenos">13</span><span class="n">rb</span><span class="o">.</span><span class="n">addPoint</span><span class="p">(</span><span class="n">QgsPointXY</span><span class="p">(</span><span class="n">pStart</span><span class="o">.</span><span class="n">x</span><span class="p">()</span> <span class="o">+</span> <span class="n">delta</span><span class="p">,</span> <span class="n">pStart</span><span class="o">.</span><span class="n">y</span><span class="p">()</span> <span class="o">-</span> <span class="n">delta</span><span class="p">))</span>
<span class="linenos">14</span><span class="n">rb</span><span class="o">.</span><span class="n">addPoint</span><span class="p">(</span><span class="n">QgsPointXY</span><span class="p">(</span><span class="n">pStart</span><span class="o">.</span><span class="n">x</span><span class="p">()</span> <span class="o">+</span> <span class="n">delta</span><span class="p">,</span> <span class="n">pStart</span><span class="o">.</span><span class="n">y</span><span class="p">()</span> <span class="o">+</span> <span class="n">delta</span><span class="p">))</span>
<span class="linenos">15</span><span class="n">rb</span><span class="o">.</span><span class="n">addPoint</span><span class="p">(</span><span class="n">QgsPointXY</span><span class="p">(</span><span class="n">pStart</span><span class="o">.</span><span class="n">x</span><span class="p">()</span> <span class="o">-</span> <span class="n">delta</span><span class="p">,</span> <span class="n">pStart</span><span class="o">.</span><span class="n">y</span><span class="p">()</span> <span class="o">+</span> <span class="n">delta</span><span class="p">))</span>
<span class="linenos">16</span>
<span class="linenos">17</span><span class="n">tiedPoints</span> <span class="o">=</span> <span class="n">director</span><span class="o">.</span><span class="n">makeGraph</span><span class="p">(</span><span class="n">builder</span><span class="p">,</span> <span class="p">[</span><span class="n">pStart</span><span class="p">])</span>
<span class="linenos">18</span><span class="n">graph</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">graph</span><span class="p">()</span>
<span class="linenos">19</span><span class="n">tStart</span> <span class="o">=</span> <span class="n">tiedPoints</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="linenos">20</span>
<span class="linenos">21</span><span class="n">idStart</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">findVertex</span><span class="p">(</span><span class="n">tStart</span><span class="p">)</span>
<span class="linenos">22</span>
<span class="linenos">23</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">cost</span><span class="p">)</span> <span class="o">=</span> <span class="n">QgsGraphAnalyzer</span><span class="o">.</span><span class="n">dijkstra</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">idStart</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="linenos">24</span>
<span class="linenos">25</span><span class="n">upperBound</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos">26</span><span class="n">r</span> <span class="o">=</span> <span class="mf">1500.0</span>
<span class="linenos">27</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos">28</span><span class="n">tree</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
<span class="linenos">29</span>
<span class="linenos">30</span><span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">cost</span><span class="p">):</span>
<span class="linenos">31</span>    <span class="k">if</span> <span class="n">cost</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">r</span> <span class="ow">and</span> <span class="n">tree</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
<span class="linenos">32</span>        <span class="n">outVertexId</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="n">tree</span> <span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">toVertex</span><span class="p">()</span>
<span class="linenos">33</span>        <span class="k">if</span> <span class="n">cost</span><span class="p">[</span><span class="n">outVertexId</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">r</span><span class="p">:</span>
<span class="linenos">34</span>            <span class="n">upperBound</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="linenos">35</span>    <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
<span class="linenos">36</span>
<span class="linenos">37</span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">upperBound</span><span class="p">:</span>
<span class="linenos">38</span>    <span class="n">centerPoint</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">vertex</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">point</span><span class="p">()</span>
<span class="linenos">39</span>    <span class="n">rb</span> <span class="o">=</span> <span class="n">QgsRubberBand</span><span class="p">(</span><span class="n">iface</span><span class="o">.</span><span class="n">mapCanvas</span><span class="p">())</span>
<span class="linenos">40</span>    <span class="n">rb</span><span class="o">.</span><span class="n">setColor</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">red</span><span class="p">)</span>
<span class="linenos">41</span>    <span class="n">rb</span><span class="o">.</span><span class="n">addPoint</span><span class="p">(</span><span class="n">QgsPointXY</span><span class="p">(</span><span class="n">centerPoint</span><span class="o">.</span><span class="n">x</span><span class="p">()</span> <span class="o">-</span> <span class="n">delta</span><span class="p">,</span> <span class="n">centerPoint</span><span class="o">.</span><span class="n">y</span><span class="p">()</span> <span class="o">-</span> <span class="n">delta</span><span class="p">))</span>
<span class="linenos">42</span>    <span class="n">rb</span><span class="o">.</span><span class="n">addPoint</span><span class="p">(</span><span class="n">QgsPointXY</span><span class="p">(</span><span class="n">centerPoint</span><span class="o">.</span><span class="n">x</span><span class="p">()</span> <span class="o">+</span> <span class="n">delta</span><span class="p">,</span> <span class="n">centerPoint</span><span class="o">.</span><span class="n">y</span><span class="p">()</span> <span class="o">-</span> <span class="n">delta</span><span class="p">))</span>
<span class="linenos">43</span>    <span class="n">rb</span><span class="o">.</span><span class="n">addPoint</span><span class="p">(</span><span class="n">QgsPointXY</span><span class="p">(</span><span class="n">centerPoint</span><span class="o">.</span><span class="n">x</span><span class="p">()</span> <span class="o">+</span> <span class="n">delta</span><span class="p">,</span> <span class="n">centerPoint</span><span class="o">.</span><span class="n">y</span><span class="p">()</span> <span class="o">+</span> <span class="n">delta</span><span class="p">))</span>
<span class="linenos">44</span>    <span class="n">rb</span><span class="o">.</span><span class="n">addPoint</span><span class="p">(</span><span class="n">QgsPointXY</span><span class="p">(</span><span class="n">centerPoint</span><span class="o">.</span><span class="n">x</span><span class="p">()</span> <span class="o">-</span> <span class="n">delta</span><span class="p">,</span> <span class="n">centerPoint</span><span class="o">.</span><span class="n">y</span><span class="p">()</span> <span class="o">+</span> <span class="n">delta</span><span class="p">))</span>
</pre></div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="pluginlayer.html" class="btn btn-neutral float-left" title="18. Using Plugin Layers" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="server.html" class="btn btn-neutral float-right" title="20. QGIS Server and Python" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2002-now, QGIS project.
      <span class="lastupdated">Last updated on 2024 May 30, 01:27 +0900.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <!-- Transifex follows a particular logic to build target pages:
Expected French translation link for https://docs.qgis.org/3.28/en/docs/user_manual/print_composer/overview_composer.html
would return https://app.transifex.com/qgis/qgis-documentation/translate/#fr/aa6d8bc653526d38b295ca94bf8eee5e
with the md5 value of "github#qgis/QGIS-Documentation#release_3.28#locale/en/LC_MESSAGES/docs/user_manual/print_composer/overview_composer.po"-->
<!--Make sure that mismatching language codes between Transifex and Sphinx are converted-->


  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-info-circle"> QGIS Documentation </span>
      v: 3.34
      <span class="fa fa-caret-down"></span>
    </span>

    <div class="rst-other-versions">
      <dl>
        <dt>Languages</dt>
        
          <dd><a href="https://docs.qgis.org/3.34/en/docs/pyqgis_developer_cookbook/network_analysis.html">en</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/cs/docs/pyqgis_developer_cookbook/network_analysis.html">cs</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/de/docs/pyqgis_developer_cookbook/network_analysis.html">de</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/es/docs/pyqgis_developer_cookbook/network_analysis.html">es</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/fr/docs/pyqgis_developer_cookbook/network_analysis.html">fr</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/hu/docs/pyqgis_developer_cookbook/network_analysis.html">hu</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/it/docs/pyqgis_developer_cookbook/network_analysis.html">it</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/ja/docs/pyqgis_developer_cookbook/network_analysis.html">ja</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/ko/docs/pyqgis_developer_cookbook/network_analysis.html">ko</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/lt/docs/pyqgis_developer_cookbook/network_analysis.html">lt</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/nl/docs/pyqgis_developer_cookbook/network_analysis.html">nl</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/pt_BR/docs/pyqgis_developer_cookbook/network_analysis.html">pt_BR</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/pt_PT/docs/pyqgis_developer_cookbook/network_analysis.html">pt_PT</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/ro/docs/pyqgis_developer_cookbook/network_analysis.html">ro</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/ru/docs/pyqgis_developer_cookbook/network_analysis.html">ru</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/zh-Hans/docs/pyqgis_developer_cookbook/network_analysis.html">zh-Hans</a></dd>
        
      </dl>

      <dl>
        <dt>Versions</dt>
        
          <dd><a href="https://docs.qgis.org/testing/en/docs/pyqgis_developer_cookbook/network_analysis.html">testing</a></dd>
        
          <dd><a href="https://docs.qgis.org/latest/en/docs/pyqgis_developer_cookbook/network_analysis.html">latest</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/en/docs/pyqgis_developer_cookbook/network_analysis.html">3.34</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.28/en/docs/pyqgis_developer_cookbook/network_analysis.html">3.28</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.22/en/docs/pyqgis_developer_cookbook/network_analysis.html">3.22</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.16/en/docs/pyqgis_developer_cookbook/network_analysis.html">3.16</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.10/en/docs/pyqgis_developer_cookbook/network_analysis.html">3.10</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.4/en/docs/pyqgis_developer_cookbook/network_analysis.html">3.4</a></dd>
        
          <dd><a href="https://docs.qgis.org/2.18/en/docs/pyqgis_developer_cookbook/network_analysis.html">2.18</a></dd>
        
      </dl>

       
       <dl>
        <dt>Downloads</dt>
        
          <dd><a href="https://docs.qgis.org/3.34/pdf">PDF</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/zip">HTML</a></dd>
        
      </dl>
      

      
       
      <dl>
        <dt>Contribute to Docs</dt>
          <dd>
            <a href="https://github.com/qgis/QGIS-Documentation/edit/master/docs/pyqgis_developer_cookbook/network_analysis.rst" target="_blank" rel="noopener noreferrer">Edit on GitHub</a>
          </dd>
          
          
          <dd>
            <a href="https://app.transifex.com/qgis/qgis-documentation/translate/#en/7576b22d462f9f1a87323bd11d803567" target="_blank" rel="noopener noreferrer">Translate Page</a>
          </dd>
          
          <dd>
            <a href="https://github.com/qgis/QGIS-Documentation/issues" target="_blank" rel="noopener noreferrer">Report Issue</a>
          </dd>
      </dl>
      

      <dl>
        <dt>On QGIS Project</dt>
          <dd>
            <a href="https://qgis.org/en" target="_blank" rel="noopener noreferrer">Home</a>
          </dd>
          <dd>
            <a href="https://qgis.org/api/3.34" target="_blank" rel="noopener noreferrer">C++ API</a>
          </dd>
          <dd>
            <a href="https://qgis.org/pyqgis/3.34" target="_blank" rel="noopener noreferrer">PyQGIS API</a>
          </dd>
          <dd>
            <a href="https://github.com/qgis/QGIS/tree/release-3_34" target="_blank" rel="noopener noreferrer">Source</a>
          </dd>
      </dl>

    </div>
  </div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>