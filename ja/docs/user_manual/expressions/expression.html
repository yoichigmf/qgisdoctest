<!DOCTYPE html>
<html class="writer-html5" lang="ja" data-content_root="../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>13.1. 式 &mdash; QGIS Documentation  ドキュメント</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/qgis_docs.css?v=5415a924" />
      <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css?v=13237357" />
      <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />

  
    <link rel="shortcut icon" href="../../../_static/qgis_logo.ico"/>
    <link rel="canonical" href="https://docs.qgis.org/latest/en/docs/user_manual/expressions/expression.html"/>
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../_static/documentation_options.js?v=c033477b"></script>
        <script src="../../../_static/doctools.js?v=888ff710"></script>
        <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../../../_static/copybutton.js?v=f281be69"></script>
        <script>let toggleHintShow = 'Click to show';</script>
        <script>let toggleHintHide = 'Click to hide';</script>
        <script>let toggleOpenOnPrint = 'true';</script>
        <script src="../../../_static/togglebutton.js?v=4a39c7ea"></script>
        <script src="../../../_static/translations.js?v=4dbe4bdc"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="索引" href="../../../genindex.html" />
    <link rel="search" title="検索" href="../../../search.html" />
    <link rel="next" title="13.2. 関数のリスト" href="functions_list.html" />
    <link rel="prev" title="13. 式でレベルアップ" href="index.html" />
  <meta name="description" content="QGIS 3.34 documentation: 13.1. 式">
</head>

<body class="wy-body-for-nav">

  <nav class="release_status_topbar">
  </nav>

   

 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
   

          
          
          <a href="../../index.html" class="icon icon-home">
            QGIS Documentation
              <img src="../../../_static/logo.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                3.34
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
   <a href= "../../../genindex.html">Index</a>
 
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">ユーザ向け</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">QGIS Desktopユーザーガイド／マニュアル (QGIS 3.34)</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../preamble/preamble.html">1. はじめに</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preamble/foreword.html">2. 序文</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preamble/conventions.html">3. 記述ルール</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preamble/features.html">4. 機能</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/getting_started.html">5. 最初のステップ</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/project_files.html">6. プロジェクトファイルの操作</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/qgis_gui.html">7. QGISのユーザインタフェース</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/browser.html">8. ブラウザパネル</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/qgis_configuration.html">9. QGISの設定</a></li>
<li class="toctree-l2"><a class="reference internal" href="../working_with_projections/working_with_projections.html">10. 投影法の操作</a></li>
<li class="toctree-l2"><a class="reference internal" href="../map_views/index.html">11. 地図の可視化</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/general_tools.html">12. 一般ツール</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">13. 式でレベルアップ</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">13.1. 式</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#the-expression-string-builder">13.1.1. 式文字列ビルダー</a></li>
<li class="toctree-l4"><a class="reference internal" href="#function-editor">13.1.2. 関数エディタ</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="functions_list.html">13.2. 関数のリスト</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../style_library/index.html">14. スタイルライブラリ</a></li>
<li class="toctree-l2"><a class="reference internal" href="../managing_data_source/index.html">15. データソースの管理</a></li>
<li class="toctree-l2"><a class="reference internal" href="../working_with_vector/index.html">16. ベクタデータの操作</a></li>
<li class="toctree-l2"><a class="reference internal" href="../working_with_raster/index.html">17. ラスタデータの操作</a></li>
<li class="toctree-l2"><a class="reference internal" href="../working_with_mesh/mesh.html">18. メッシュデータの操作</a></li>
<li class="toctree-l2"><a class="reference internal" href="../working_with_vector_tiles/vector_tiles.html">19. ベクタタイルの操作</a></li>
<li class="toctree-l2"><a class="reference internal" href="../working_with_point_clouds/point_clouds.html">20. 点群の操作</a></li>
<li class="toctree-l2"><a class="reference internal" href="../working_with_3d_tiles/3d_tiles.html">21. 3Dタイルの操作</a></li>
<li class="toctree-l2"><a class="reference internal" href="../print_composer/index.html">22. 地図のレイアウト</a></li>
<li class="toctree-l2"><a class="reference internal" href="../working_with_ogc/ogc_client_support.html">23. OGC / ISOプロトコルの操作</a></li>
<li class="toctree-l2"><a class="reference internal" href="../working_with_gps/index.html">24. GPSデータの操作</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auth_system/index.html">25. 認証システム</a></li>
<li class="toctree-l2"><a class="reference internal" href="../grass_integration/grass_integration.html">26. GRASS GIS の統合</a></li>
<li class="toctree-l2"><a class="reference internal" href="../processing/index.html">27. QGIS プロセシングフレームワーク</a></li>
<li class="toctree-l2"><a class="reference internal" href="../processing_algs/index.html">28. プロセシングプロバイダとアルゴリズム</a></li>
<li class="toctree-l2"><a class="reference internal" href="../plugins/index.html">29. プラグイン</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preamble/help_and_support.html">30. ヘルプとサポート</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preamble/contributors.html">31. 協力者</a></li>
<li class="toctree-l2"><a class="reference internal" href="../appendices/index.html">32. 付録</a></li>
<li class="toctree-l2"><a class="reference internal" href="../literature_web/literature_and_web_references.html">33. 文献とWeb参照</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../server_manual/index.html">QGIS Serverガイド／マニュアル (QGIS 3.34)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../training_manual/index.html">トレーニングマニュアル</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gentle_gis_introduction/index.html">やさしい GIS 入門</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">ドキュメント執筆者向け</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../documentation_guidelines/index.html">ドキュメント作成のガイドライン</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">開発者向け</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../pyqgis_developer_cookbook/index.html">PyQGISクックブック (QGIS 3.34)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developers_guide/index.html">開発者ガイド</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">QGIS Documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">QGISユーザガイド</a></li>
          <li class="breadcrumb-item"><a href="index.html"><span class="section-number">13. </span>式でレベルアップ</a></li>
      <li class="breadcrumb-item active"><span class="section-number">13.1. </span>式</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/qgis/QGIS-Documentation/blob/master/docs/user_manual/expressions/expression.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul><div class="rst-breadcrumbs-buttons" role="navigation" aria-label="Sequential page navigation">
        <a href="index.html" class="btn btn-neutral float-left" title="13. 式でレベルアップ" accesskey="p"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="functions_list.html" class="btn btn-neutral float-right" title="13.2. 関数のリスト" accesskey="n">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
  </div>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <blockquote>
<div><div class="admonition important">
<p class="admonition-title">重要</p>
<p>翻訳は <a class="reference external" href="https://qgis.org/en/site/getinvolved/translate.html#becoming-a-translator">あなたが参加できる</a> コミュニティの取り組みです。このページは現在 100.00% 翻訳されています。</p>
</div>
</div></blockquote>
<section id="expressions">
<span id="vector-expressions"></span><span id="index-0"></span><h1><span class="section-number">13.1. </span>式<a class="headerlink" href="#expressions" title="Link to this heading"></a></h1>
<nav class="contents local" id="id1">
<ul class="simple">
<li><p><a class="reference internal" href="#the-expression-string-builder" id="id6">式文字列ビルダー</a></p>
<ul>
<li><p><a class="reference internal" href="#the-interface" id="id7">インターフェース</a></p></li>
<li><p><a class="reference internal" href="#writing-an-expression" id="id8">式の作成</a></p></li>
<li><p><a class="reference internal" href="#some-use-cases-of-expressions" id="id9">式の使用例</a></p></li>
<li><p><a class="reference internal" href="#saving-expressions" id="id10">式の保存</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#function-editor" id="id11">関数エディタ</a></p></li>
</ul>
</nav>
<p>レイヤのデータと組み込みの関数やユーザー定義の関数に基づいた <strong>式</strong> は、属性値やジオメトリ、変数を操作する強力な方法です。ジオメトリのスタイル、ラベルの内容や位置、ダイアグラムの値、レイアウトアイテムの高さ、地物の一部の選択、仮想フィールドの作成などを動的に変更することができます。</p>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p>式の作成に使えるデフォルトの関数や変数のリストは、詳細な情報や例付きで <a class="reference internal" href="functions_list.html#functions-list"><span class="std std-ref">関数のリスト</span></a> にあります。</p>
</div>
<section id="the-expression-string-builder">
<span id="expression-builder"></span><h2><a class="toc-backref" href="#id6" role="doc-backlink"><span class="section-number">13.1.1. </span>式文字列ビルダー</a><a class="headerlink" href="#the-expression-string-builder" title="Link to this heading"></a></h2>
<p>式を組み立てるための主要なダイアログである <span class="guilabel">式文字列ビルダー</span> は、QGISの多くの部分から使用することができますが、特に以下のような時に使うことができます。</p>
<ul class="simple">
<li><p><a class="reference internal" href="../../../_images/mIconExpression.png"><img alt="expression" src="../../../_images/mIconExpression.png" style="width: 1.5em;" /></a> ボタンをクリックしたとき</p></li>
<li><p><a class="reference internal" href="../../../_images/mIconExpressionSelect.png"><img alt="expressionSelect" src="../../../_images/mIconExpressionSelect.png" style="width: 1.5em;" /></a> <sup>式による地物選択...</sup> ツールで <a class="reference internal" href="../introduction/general_tools.html#sec-selection"><span class="std std-ref">地物を選択</span></a> するとき</p></li>
<li><p>例えば <a class="reference internal" href="../../../_images/mActionCalculateField.png"><img alt="calculateField" src="../../../_images/mActionCalculateField.png" style="width: 1.5em;" /></a> <sup>フィールド計算機</sup> ツールで <a class="reference internal" href="../working_with_vector/attribute_table.html#calculate-fields-values"><span class="std std-ref">属性を編集する</span></a> とき</p></li>
<li><p><a class="reference internal" href="../../../_images/mIconDataDefine.png"><img alt="dataDefine" src="../../../_images/mIconDataDefine.png" style="width: 1.5em;" /></a> <sup>データによって定義された上書き</sup> ツールを使用して、シンボロジやラベル、レイアウトアイテムのパラメータを操作するとき（ <a class="reference internal" href="../introduction/general_tools.html#data-defined"><span class="std std-ref">データによって定義された上書きの設定</span></a> 参照）</p></li>
<li><p><a class="reference internal" href="../style_library/symbol_selector.html#geometry-generator-symbol"><span class="std std-ref">ジオメトリジェネレータ</span></a> のシンボルレイヤを作成するとき</p></li>
<li><p>何らかの <a class="reference internal" href="../processing/index.html#label-processing"><span class="std std-ref">ジオプロセシング</span></a> を行うとき</p></li>
</ul>
<p>式ビルダーダイアログからは、以下のタブにアクセス可能です。</p>
<ul class="simple">
<li><p><span class="guilabel">式</span> タブは、<a class="reference internal" href="functions_list.html#functions-list"><span class="std std-ref">predefined functions</span></a> のリストを利用して、使用する式の作成や確認ができます。</p></li>
<li><p><a class="reference internal" href="#function-editor"><span class="std std-ref">関数エディタタブ</span></a> は、カスタムの関数を作成することで、関数リストの拡張ができます。</p></li>
</ul>
<section id="the-interface">
<h3><a class="toc-backref" href="#id7" role="doc-backlink"><span class="section-number">13.1.1.1. </span>インターフェース</a><a class="headerlink" href="#the-interface" title="Link to this heading"></a></h3>
<p><span class="guilabel">式</span> タブには関数やレイヤのフィールド、値を使用して式を作成するためのメインのインターフェースがあります。これには、以下のウィジェットが含まれます：</p>
<figure class="align-center" id="id3">
<span id="figure-expression-tab"></span><a class="reference internal image-reference" href="../../../_images/function_list.png"><img alt="../../../_images/function_list.png" src="../../../_images/function_list.png" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-number">図 13.1 </span><span class="caption-text">式タブ</span><a class="headerlink" href="#id3" title="Link to this image"></a></p>
</figcaption>
</figure>
<ul>
<li><p>式を入力したり張り付けたりするための式エディタ領域。以下のような自動補完を利用でき、式の入力を短縮できます：</p>
<ul class="simple">
<li><p>入力したテキストに応じた変数名、関数名、フィールド名が下に表示されます。 <kbd class="kbd docutils literal notranslate">Up</kbd> 矢印キーと <kbd class="kbd docutils literal notranslate">Down</kbd> 矢印キーを使って項目間を移動することができます。式に挿入するには <kbd class="kbd docutils literal notranslate">Tab</kbd> キーを押すか、挿入したい項目を単にクリックします。</p></li>
<li><p>関数を入力している間、関数のパラメータが表示されます。</p></li>
</ul>
<p>また、QGISは式が正しいかをチェックし、エラーを以下の方法で強調表示します：</p>
<ul class="simple">
<li><p><em>アンダーライン</em> ：未定義の関数や、間違ったあるいは無効な引数</p></li>
<li><p><em>マーカー</em> ：単一の場所でのその他エラー（対応していない括弧、不要な文字など）</p></li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p><strong>コメントで式をドキュメンテーションする</strong></p>
<p>複雑な式を使用する場合には、思い出しやすいように複数行コメントやインラインコメントとしてテキストを追加するのがよいでしょう。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/*</span>
<span class="n">Labels</span> <span class="n">each</span> <span class="n">region</span> <span class="k">with</span> <span class="n">its</span> <span class="n">highest</span> <span class="p">(</span><span class="ow">in</span> <span class="n">altitude</span><span class="p">)</span> <span class="n">airport</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="ow">and</span> <span class="n">altitude</span><span class="p">,</span> <span class="n">eg</span> <span class="s1">&#39;AMBLER : 264m&#39;</span> <span class="k">for</span> <span class="n">the</span> <span class="s1">&#39;Northwest Artic&#39;</span> <span class="n">region</span>
<span class="o">*/</span>
<span class="n">with_variable</span><span class="p">(</span>
  <span class="s1">&#39;airport_alti&#39;</span><span class="p">,</span> <span class="o">--</span> <span class="n">stores</span> <span class="n">the</span> <span class="n">highest</span> <span class="n">altitude</span> <span class="n">of</span> <span class="n">the</span> <span class="n">region</span>
  <span class="n">aggregate</span><span class="p">(</span>
    <span class="s1">&#39;airports&#39;</span><span class="p">,</span>
    <span class="s1">&#39;max&#39;</span><span class="p">,</span>
    <span class="s2">&quot;ELEV&quot;</span><span class="p">,</span> <span class="o">--</span> <span class="n">the</span> <span class="n">field</span> <span class="n">containing</span> <span class="n">the</span> <span class="n">altitude</span>
    <span class="o">--</span> <span class="ow">and</span> <span class="n">limit</span> <span class="n">the</span> <span class="n">airports</span> <span class="n">to</span> <span class="n">the</span> <span class="n">region</span> <span class="n">they</span> <span class="n">are</span> <span class="n">within</span>
    <span class="nb">filter</span> <span class="o">:=</span> <span class="n">within</span><span class="p">(</span> <span class="nd">@geometry</span><span class="p">,</span> <span class="n">geometry</span><span class="p">(</span> <span class="nd">@parent</span> <span class="p">)</span> <span class="p">)</span>
  <span class="p">),</span>
    <span class="n">aggregate</span><span class="p">(</span> <span class="o">--</span> <span class="n">finds</span> <span class="n">airports</span> <span class="n">at</span> <span class="n">the</span> <span class="n">same</span> <span class="n">altitude</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">region</span>
      <span class="s1">&#39;airports&#39;</span><span class="p">,</span>
      <span class="s1">&#39;concatenate&#39;</span><span class="p">,</span>
      <span class="s2">&quot;NAME&quot;</span><span class="p">,</span>
      <span class="nb">filter</span> <span class="o">:=</span> <span class="n">within</span><span class="p">(</span> <span class="nd">@geometry</span><span class="p">,</span> <span class="n">geometry</span><span class="p">(</span> <span class="nd">@parent</span> <span class="p">)</span> <span class="p">)</span>
        <span class="ow">and</span> <span class="s2">&quot;ELEV&quot;</span> <span class="o">=</span> <span class="nd">@airport_alti</span>
    <span class="p">)</span>
    <span class="o">||</span> <span class="s1">&#39; : &#39;</span> <span class="o">||</span> <span class="nd">@airport_alti</span> <span class="o">||</span> <span class="s1">&#39;m&#39;</span>
    <span class="o">--</span> <span class="n">using</span> <span class="o">||</span> <span class="n">allows</span> <span class="n">regions</span> <span class="n">without</span> <span class="n">airports</span> <span class="n">to</span> <span class="n">be</span> <span class="n">skipped</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</li>
<li><p>式エディタの上部には、以下のようなツールセットがあります：</p>
<ul class="simple">
<li><p><a class="reference internal" href="../../../_images/mActionFileNew.png"><img alt="fileNew" src="../../../_images/mActionFileNew.png" style="width: 1.5em;" /></a><sup>式エディタをクリア</sup></p></li>
<li><p><a class="reference internal" href="#user-expressions-functions"><span class="std std-ref">ユーザー式</span></a> を作成、管理する</p></li>
</ul>
</li>
<li><p>式エディタの下部には、以下のものがあります：</p>
<ul>
<li><p>式を構築するのに役立つ基本的な演算子のセット</p></li>
<li><p>データで地物のプロパティを決める際に、出力の期待されるフォーマットの表示</p></li>
<li><p>デフォルトでレイヤの最初の地物で評価された、式のライブ <span class="guilabel">プレビュー</span> (最大60文字) 。60文字を超える出力プレビューテキストを表示するには、テキストにカーソルを合わせ、出力プレビュー全体を含むツールチップのポップアップを表示します。出力プレビューテキストをクリップボードにコピーするには、出力プレビューテキストを右クリックして、<a class="reference internal" href="../../../_images/mActionEditCopy.png"><img alt="editCopy" src="../../../_images/mActionEditCopy.png" style="width: 1.5em;" /></a> <span class="guilabel">式の値をコピー</span> を選択します。</p>
<p>レイヤの他の地物は、 <span class="guilabel">地物</span> コンボボックスを使って閲覧・評価することができます（値はレイヤの <a class="reference internal" href="../working_with_vector/vector_properties.html#maptips"><span class="std std-ref">表示名</span></a> プロパティから取得されます）。</p>
<p>エラーとなった場合には、エラーが表示され、ハイパーリンクからエラーの詳細情報にアクセスできます。</p>
</li>
</ul>
</li>
<li><p>関数セレクタには、関数や変数、フィールドなどのグループ化されたリストが表示されます。検索ボックスを利用して、リストをフィルタし特定の関数やフィールドを素早く見つけることができます。アイテムをダブルクリックすると、そのアイテムが式エディタに追加されます。</p></li>
<li><p>ヘルプパネルには、関数セレクタで選択したアイテムに対するヘルプが表示されます。</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>式内で関数名にカーソルを乗せて <kbd class="kbd compound docutils literal notranslate"><kbd class="kbd docutils literal notranslate">Ctrl</kbd>+<kbd class="kbd docutils literal notranslate">Click</kbd></kbd> すると、ダイアログでその関数のヘルプが表示されます。</p>
</div>
<p>関数セレクタでフィールドを選択している場合には、フィールドの値ウィジェットが表示され、以下のように地物の属性値の取得に役立ちます。</p>
<ul>
<li><p>特定のフィールド値を検索する</p></li>
<li><p><span class="guilabel">全ユニーク</span> または <span class="guilabel">10個のサンプル</span> 値のリストを表示する。これはフィールドの右クリックからも利用できます。</p>
<p>フィールドが他のレイヤや値のセットにマッピングされている場合、すなわち、 <a class="reference internal" href="../working_with_vector/vector_properties.html#edit-widgets"><span class="std std-ref">フィールド編集ウィジェット</span></a> が <em>リレーションの参照</em> 、 <em>値のリレーション</em> または <em>バリューマップ</em> タイプの場合には、（参照されたレイヤ、テーブル、リストから）マッピングされたフィールドの値をすべてリストすることができます。さらに、このリストをフィルタリングして、現在のフィールドで <a class="reference internal" href="../../../_images/checkbox.png"><img alt="checkbox" src="../../../_images/checkbox.png" style="width: 1.3em;" /></a> <span class="guilabel">使用中の値のみ表示</span> することもできます。</p>
</li>
</ul>
<p>ウィジェット内でフィールド値をダブルクリックすると、式エディタに値が追加されます。</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>関数のヘルプやフィールドの値が表示される右側パネルは、ダイアログ内でたたむ（非表示にする）ことができます。 <span class="guilabel">値を表示</span> や <span class="guilabel">ヘルプを表示</span> ボタンを押すと、非表示状態から表示状態に戻すことができます。</p>
</div>
</li>
</ul>
</section>
<section id="writing-an-expression">
<h3><a class="toc-backref" href="#id8" role="doc-backlink"><span class="section-number">13.1.1.2. </span>式の作成</a><a class="headerlink" href="#writing-an-expression" title="Link to this heading"></a></h3>
<p>QGISの式は、地物の選択や値の設定に使われます。QGISで式を作成するには、以下のいくつかのルールに従います。</p>
<ol class="arabic">
<li><p><strong>ダイアログでコンテキストを定義する</strong>: SQLに慣れているならば、 <em>select features from layer where condition</em> や、 <em>update layer set field = new_value where condition</em> といった形式のクエリを知っているでしょう。QGIS式もこれらの情報すべてを必要としますが、式ビルダーダイアログを開くためのツールが、必要な情報の一部を提供します。例えば、あるレイヤ（ <code class="docutils literal notranslate"><span class="pre">buildings</span></code> ）が、あるフィールド（ <code class="docutils literal notranslate"><span class="pre">height</span></code> ）を持っているとします:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../../../_images/mIconExpressionSelect.png"><img alt="expressionSelect" src="../../../_images/mIconExpressionSelect.png" style="width: 1.5em;" /></a><sup>式による地物選択</sup> ツールを押すことは、 &quot;select features from buildings&quot; を意味します。式テキストウィジェットに入力する必要がある情報は <strong>condition</strong> のみです。つまり、 <code class="docutils literal notranslate"><span class="pre">&quot;height&quot;</span> <span class="pre">&gt;</span> <span class="pre">20</span></code> と入力すれば、高さが20よりも大きい建物を選択します。</p></li>
<li><p>この地物選択を行った状態で、 <a class="reference internal" href="../../../_images/mActionCalculateField.png"><img alt="calculateField" src="../../../_images/mActionCalculateField.png" style="width: 1.5em;" /></a> <sup>フィールド計算機</sup> ボタンを押して <span class="guilabel">既存のフィールドを更新する</span> で &quot;height&quot; を選択することは、コマンド &quot;update buildings set height = ??? where height &gt; 20&quot; を入力したのと同じです。この場合に、残りで入力する必要のあるものは、 <strong>新しい値</strong> だけです。つまり、式エディタのテキストボックスに単に <code class="docutils literal notranslate"><span class="pre">50</span></code> と入力すれば、上で選択した buildings レイヤの height フィールドがこの値に設定されます。</p></li>
</ul>
</li>
<li><p><strong>引用符に注意</strong> ：シングルクォートはリテラルを返します。このため、シングルクォートに挟まれたテキスト（ <code class="docutils literal notranslate"><span class="pre">'145'</span></code> ）は文字列として解釈されます。ダブルクォートはそのテキストの値を返すので、フィールドにはダブルクォートを使用してください（ <code class="docutils literal notranslate"><span class="pre">&quot;myfield&quot;</span></code> ）。フィールドは引用符なしでも使用できます（ <code class="docutils literal notranslate"><span class="pre">myfield</span></code> ）。数値には引用符は不要です（ <code class="docutils literal notranslate"><span class="pre">3.16</span></code> ）。</p>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p>関数は通常、フィールド名を表す文字列を引数にとります。次のようにしてください:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">attribute</span><span class="p">(</span> <span class="nd">@atlas_feature</span><span class="p">,</span> <span class="s1">&#39;height&#39;</span> <span class="p">)</span> <span class="o">--</span> <span class="n">returns</span> <span class="n">the</span> <span class="n">value</span> <span class="n">stored</span> <span class="ow">in</span> <span class="n">the</span> <span class="s2">&quot;height&quot;</span> <span class="n">attribute</span> <span class="n">of</span> <span class="n">the</span> <span class="n">current</span> <span class="n">atlas</span> <span class="n">feature</span>
</pre></div>
</div>
<p>以下のようにしてはいけません:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">attribute</span><span class="p">(</span> <span class="nd">@atlas_feature</span><span class="p">,</span> <span class="s2">&quot;height&quot;</span> <span class="p">)</span> <span class="o">--</span> <span class="n">fetches</span> <span class="n">the</span> <span class="n">value</span> <span class="n">of</span> <span class="n">the</span> <span class="n">attribute</span> <span class="n">named</span> <span class="s2">&quot;height&quot;</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span> <span class="mi">100</span><span class="p">),</span> <span class="ow">and</span> <span class="n">use</span> <span class="n">that</span> <span class="n">value</span> <span class="k">as</span> <span class="n">a</span> <span class="n">field</span>
                                      <span class="o">--</span> <span class="kn">from</span> <span class="nn">which</span> <span class="n">to</span> <span class="k">return</span> <span class="n">the</span> <span class="n">atlas</span> <span class="n">feature</span> <span class="n">value</span><span class="o">.</span> <span class="n">Probably</span> <span class="n">wrong</span> <span class="k">as</span> <span class="n">a</span> <span class="n">field</span> <span class="n">named</span> <span class="s2">&quot;100&quot;</span> <span class="n">may</span> <span class="ow">not</span> <span class="n">exist</span><span class="o">.</span>
</pre></div>
</div>
</div>
</li>
</ol>
<div class="admonition tip" id="index-1">
<p class="admonition-title">Tip</p>
<p><strong>名前付きパラメータを使用して式を読みやすくする</strong></p>
<p>いくつかの関数は多数のパラメータを設定する必要があります。式エンジンは名前付きパラメータの使用をサポートしています。つまり、暗号めいた式 <code class="docutils literal notranslate"><span class="pre">clamp(</span> <span class="pre">1,</span> <span class="pre">2,</span> <span class="pre">9)</span></code> と書く代わりに、 <code class="docutils literal notranslate"><span class="pre">clamp(</span> <span class="pre">min:=1,</span> <span class="pre">value:=2,</span> <span class="pre">max:=9)</span></code> を使うことができます。引数を入れ替え、例えば <code class="docutils literal notranslate"><span class="pre">clamp(</span> <span class="pre">value:=2,</span> <span class="pre">max:=9,</span> <span class="pre">min:=1)</span></code> とすることもできます。名前付きパラメータを使うことで、式の関数の引数が何を指しているのかを明確にすることができ、後で式を理解しようとするときに役立ちます。</p>
</div>
</section>
<section id="some-use-cases-of-expressions">
<h3><a class="toc-backref" href="#id9" role="doc-backlink"><span class="section-number">13.1.1.3. </span>式の使用例</a><a class="headerlink" href="#some-use-cases-of-expressions" title="Link to this heading"></a></h3>
<ul>
<li><p>フィールド計算機を使用して、既存の &quot;total_pop&quot; と &quot;area_km2&quot; フィールドを用いた &quot;pop_density&quot; フィールドの計算:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;total_pop&quot;</span> <span class="o">/</span> <span class="s2">&quot;area_km2&quot;</span>
</pre></div>
</div>
</li>
<li><p>面積に基づいた地物のラベル付けやカテゴリ分け:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>CASE WHEN $area &gt; 10 000 THEN &#39;Larger&#39; ELSE &#39;Smaller&#39; END
</pre></div>
</div>
</li>
<li><p>&quot;pop_density&quot; の値に応じた ”density_level” フィールドのカテゴリ更新:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CASE</span> <span class="n">WHEN</span> <span class="s2">&quot;pop_density&quot;</span> <span class="o">&lt;</span> <span class="mi">50</span> <span class="n">THEN</span> <span class="s1">&#39;Low population density&#39;</span>
     <span class="n">WHEN</span> <span class="s2">&quot;pop_density&quot;</span> <span class="o">&gt;=</span> <span class="mi">50</span> <span class="ow">and</span> <span class="s2">&quot;pop_density&quot;</span> <span class="o">&lt;</span> <span class="mi">150</span> <span class="n">THEN</span> <span class="s1">&#39;Medium population density&#39;</span>
     <span class="n">WHEN</span> <span class="s2">&quot;pop_density&quot;</span> <span class="o">&gt;=</span> <span class="mi">150</span> <span class="n">THEN</span> <span class="s1">&#39;High population density&#39;</span>
<span class="n">END</span>
</pre></div>
</div>
</li>
<li><p>すべての地物に対して、住宅の平均価格が平方メートル当たり10000€より小さいか大きいかに応じたカテゴリ値スタイルを適用:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;price_m2&quot;</span> <span class="o">&gt;</span> <span class="mi">10000</span>
</pre></div>
</div>
</li>
<li><p>「式による地物選択...」ツールを使用して、“High population density” に相当し、加えて平方メートルあたりの住宅の平均価格が10000€よりも高いエリアの地物をすべて選択:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;density_level&quot;</span> <span class="o">=</span> <span class="s1">&#39;High population density&#39;</span> <span class="ow">and</span> <span class="s2">&quot;price_m2&quot;</span> <span class="o">&gt;</span> <span class="mi">10000</span>
</pre></div>
</div>
<p>この式は、どの地物をラベル付けするか、あるいはどの地物を地図に表示するかを定義するためにも使用できます。</p>
</li>
<li><p>&quot;lands&quot;レイヤから自然地帯と重なる地物を選択:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">overlay_intersects</span><span class="p">(</span> <span class="n">layer</span><span class="o">:=</span><span class="s1">&#39;lands&#39;</span><span class="p">,</span> <span class="nb">filter</span><span class="o">:=</span><span class="s2">&quot;zone_type&quot;</span><span class="o">=</span><span class="s1">&#39;Natural&#39;</span> <span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>各地物ごとにそれが含んでいる建物の数を数える:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">array_length</span><span class="p">(</span> <span class="n">overlay_contains</span><span class="p">(</span> <span class="n">layer</span><span class="o">:=</span><span class="s1">&#39;buildings&#39;</span><span class="p">,</span> <span class="n">expression</span><span class="o">:=</span><span class="nd">@id</span> <span class="p">)</span> <span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>ジオメトリジェネレータを使用した、レイヤの様々なシンボル（タイプ）の作成:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">point_on_surface</span><span class="p">(</span> <span class="nd">@geometry</span> <span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>ポイント地物に対して、ジオメトリの周囲に閉じた輪を生成（ <code class="docutils literal notranslate"><span class="pre">make_line</span></code> 関数を利用）:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>make_line(
  -- using an array of points placed around the original
  array_foreach(
    -- list of angles for placing the projected points (every 90°)
    array:=generate_series( 0, 360, 90 ),
    -- translate the point 20 units in the given direction (angle)
    expression:=project( @geometry, distance:=20, azimuth:=radians( @element ) )
  )
)
</pre></div>
</div>
</li>
<li><p>印刷レイアウトのラベルにおいて、レイアウトの &quot;Map 1&quot; アイテム内にある &quot;airports&quot; 地物の名前を表示:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">with_variable</span><span class="p">(</span> <span class="s1">&#39;extent&#39;</span><span class="p">,</span>
               <span class="n">map_get</span><span class="p">(</span> <span class="n">item_variables</span><span class="p">(</span> <span class="s1">&#39;Map 1&#39;</span> <span class="p">),</span> <span class="s1">&#39;map_extent&#39;</span> <span class="p">),</span>
               <span class="n">aggregate</span><span class="p">(</span> <span class="s1">&#39;airports&#39;</span><span class="p">,</span> <span class="s1">&#39;concatenate&#39;</span><span class="p">,</span> <span class="s2">&quot;NAME&quot;</span><span class="p">,</span>
                          <span class="n">intersects</span><span class="p">(</span> <span class="nd">@geometry</span><span class="p">,</span> <span class="nd">@extent</span> <span class="p">),</span> <span class="s1">&#39; ,&#39;</span>
                        <span class="p">)</span>
             <span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="saving-expressions">
<span id="user-expressions-functions"></span><span id="index-2"></span><h3><a class="toc-backref" href="#id10" role="doc-backlink"><span class="section-number">13.1.1.4. </span>式の保存</a><a class="headerlink" href="#saving-expressions" title="Link to this heading"></a></h3>
<p>式エディタフレームの上部にある <a class="reference internal" href="../../../_images/mActionFileSave.png"><img alt="fileSave" src="../../../_images/mActionFileSave.png" style="width: 1.5em;" /></a> <sup>現在の式をユーザー保存式に追加</sup> ボタンを使用すると、簡単にアクセスしたい重要な式を保存することができます。この式は中央のパネルの <strong>ユーザー式</strong> グループから利用することができます。ユーザー保存式は <a class="reference internal" href="../introduction/qgis_configuration.html#user-profiles"><span class="std std-ref">ユーザープロファイル</span></a> （ <code class="file docutils literal notranslate"><span class="pre">&lt;userprofile&gt;/QGIS/QGIS3.ini</span></code> ファイル）内に保存され、あらゆるプロジェクトで現在のユーザープロファイルを使用すれば、すべての式ダイアログで利用可能です。</p>
<p>式エディタフレームの上部にあるツール群を使用して、ユーザー式の管理ができます：</p>
<ul class="simple">
<li><p><a class="reference internal" href="../../../_images/mActionFileSave.png"><img alt="fileSave" src="../../../_images/mActionFileSave.png" style="width: 1.5em;" /></a><sup>現在の式をユーザー保存式に追加</sup> ：式をユーザープロファイル内に保存します。ラベルとヘルプ文を追加して、識別しやすくできます。</p></li>
<li><p><a class="reference internal" href="../../../_images/symbologyEdit.png"><img alt="symbologyEdit" src="../../../_images/symbologyEdit.png" style="width: 1.5em;" /></a> <sup>ユーザー保存式から選択した式を編集</sup> は、式やヘルプ文、ラベルを編集できます。</p></li>
<li><p><a class="reference internal" href="../../../_images/mActionDeleteSelected.png"><img alt="deleteSelected" src="../../../_images/mActionDeleteSelected.png" style="width: 1.5em;" /></a> <sup>選択した式をユーザー保存式から削除</sup></p></li>
<li><p><a class="reference internal" href="../../../_images/mActionSharingImport.png"><img alt="sharingImport" src="../../../_images/mActionSharingImport.png" style="width: 1.5em;" /></a> <sup>ユーザー式をインポート</sup> は、 <code class="docutils literal notranslate"><span class="pre">.json</span></code> ファイルからユーザー式をアクティブなユーザープロファイルのフォルダ内にインポートします。</p></li>
<li><p><a class="reference internal" href="../../../_images/mActionSharingExport.png"><img alt="sharingExport" src="../../../_images/mActionSharingExport.png" style="width: 1.5em;" /></a> <sup>ユーザー式をエクスポート</sup> は、ユーザー式を <code class="docutils literal notranslate"><span class="pre">.json</span></code> ファイルとしてエクスポートします。ユーザープロファイル <code class="file docutils literal notranslate"><span class="pre">QGIS3.ini</span></code> ファイル内のユーザー式をすべて共有することができます。</p></li>
</ul>
</section>
</section>
<section id="function-editor">
<span id="index-3"></span><span id="id2"></span><h2><a class="toc-backref" href="#id11" role="doc-backlink"><span class="section-number">13.1.2. </span>関数エディタ</a><a class="headerlink" href="#function-editor" title="Link to this heading"></a></h2>
<p><span class="guilabel">関数エディタ</span> タブでは、Python言語を使って独自の関数を書くことができます。これにより、定義済みの関数ではカバーできない特定のニーズに対処するための、手軽で簡単な手段を手に入れることができます。</p>
<figure class="align-center" id="id4">
<span id="figure-expression-function"></span><img alt="../../../_images/function_editor.png" src="../../../_images/function_editor.png" />
<figcaption>
<p><span class="caption-number">図 13.2 </span><span class="caption-text">関数エディタタブ</span><a class="headerlink" href="#id4" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>新しい関数を作成するには次のようにします。</p>
<ol class="arabic">
<li><p><a class="reference internal" href="../../../_images/symbologyAdd.png"><img alt="symbologyAdd" src="../../../_images/symbologyAdd.png" style="width: 1.5em;" /></a> <sup>新規ファイル</sup> ボタンをクリックします。</p></li>
<li><p>フォームがポップアップするので、使用する名前を入力して <span class="guilabel">OK</span> をクリックします。</p>
<p>入力した名前の新しいアイテムが <span class="guilabel">関数エディタ</span> タブの左側のパネルに追加されます。これはQGISのテンプレートから生成されたPython <code class="file docutils literal notranslate"><span class="pre">.py</span></code> ファイルです。このファイルは現在有効になっている <a class="reference internal" href="../introduction/qgis_configuration.html#user-profiles"><span class="std std-ref">ユーザープロファイル</span></a> のディレクトリ下の <code class="file docutils literal notranslate"><span class="pre">/python/expressions</span></code> フォルダに格納されます。</p>
</li>
<li><p>右側のパネルはファイルの内容を表示します。最初はテンプレートのPythonスクリプトが表示されているので、このコードやヘルプを必要に応じて書き換えてください。</p></li>
<li><p><a class="reference internal" href="../../../_images/mActionStart.png"><img alt="start" src="../../../_images/mActionStart.png" style="width: 1.5em;" /></a> <span class="guilabel">関数の保存と読み込み</span> ボタンをクリックします。あなたの書いた関数が <span class="guilabel">式</span> タブの関数ツリーの中に追加されます。デフォルトでは <code class="docutils literal notranslate"><span class="pre">Custom</span></code> グループの中に追加されます。</p></li>
<li><p>新しい関数を使いましょう。</p></li>
<li><p>関数に改善が必要なときは、 <span class="guilabel">関数エディタ</span> タブに戻って修正を加えた後、再度 <a class="reference internal" href="../../../_images/mActionStart.png"><img alt="start" src="../../../_images/mActionStart.png" style="width: 1.5em;" /></a> <span class="guilabel">関数の保存と読み込み</span> ボタンをクリックして、ファイル内、つまりは任意の式タブで利用できるようにします。</p></li>
</ol>
<p>カスタムPython関数はユーザープロファイルのディレクトリ下に格納されます。これはQGISが起動するたびに、現在のユーザープロファイルの下で定義されたすべての関数が自動的に読み込まれることを意味します。新しい関数は <code class="file docutils literal notranslate"><span class="pre">/python/expressions</span></code> フォルダの中にのみ保存されて、プロジェクトファイルには保存されないことに注意してください。カスタム関数を使用したプロジェクトを共有するときは、 <code class="file docutils literal notranslate"><span class="pre">/python/expressions</span></code> フォルダの <code class="file docutils literal notranslate"><span class="pre">.py</span></code> ファイルも共有する必要があります。</p>
<p>カスタム関数を削除するには：</p>
<ol class="arabic simple">
<li><p><span class="guilabel">関数エディタ</span> タブを有効にします。</p></li>
<li><p>リストから削除したい関数を選択します。</p></li>
<li><p><a class="reference internal" href="../../../_images/symbologyRemove.png"><img alt="symbologyRemove" src="../../../_images/symbologyRemove.png" style="width: 1.5em;" /></a> <sup>選択した関数ファイルを削除</sup> ボタンを押します。関数がリストから削除され、対応する <code class="docutils literal notranslate"><span class="pre">.py</span></code> ファイルがユーザープロファイルフォルダから削除されます。</p></li>
</ol>
<p><strong>例</strong></p>
<p>これは、2つの値を操作する独自の <code class="docutils literal notranslate"><span class="pre">my_sum</span></code> 関数を作成する簡単な例です。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">qgis.core</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">qgis.gui</span> <span class="kn">import</span> <span class="o">*</span>

<span class="nd">@qgsfunction</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="s1">&#39;Custom&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">my_sum</span><span class="p">(</span><span class="n">value1</span><span class="p">,</span> <span class="n">value2</span><span class="p">,</span> <span class="n">feature</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the sum of the two parameters value1 and value2.</span>
<span class="sd">    &lt;h2&gt;Example usage:&lt;/h2&gt;</span>
<span class="sd">    &lt;ul&gt;</span>
<span class="sd">      &lt;li&gt;my_sum(5, 8) -&gt; 13&lt;/li&gt;</span>
<span class="sd">      &lt;li&gt;my_sum(&quot;field1&quot;, &quot;field2&quot;) -&gt; 42&lt;/li&gt;</span>
<span class="sd">    &lt;/ul&gt;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">value1</span> <span class="o">+</span> <span class="n">value2</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">&#64;qgsfunction</span></code> デコレーターは次の引数を受け取ります:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">args</span></code>: 引数の数。<code class="docutils literal notranslate"><span class="pre">args='auto'</span></code> を使用すると、必要な関数の引数の数は、Pythonで関数が定義されている引数の数（マイナス2 - <code class="docutils literal notranslate"><span class="pre">feature</span></code> と <code class="docutils literal notranslate"><span class="pre">parent</span></code> ）から計算されます。<code class="docutils literal notranslate"><span class="pre">args</span> <span class="pre">=</span> <span class="pre">-1</span></code> とすると、任意の数の引数を受け取ることができます。</p></li>
<li><p>引数 <code class="docutils literal notranslate"><span class="pre">group</span></code> は、式ダイアログで関数をリストするグループを示します。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">usesgeometry=True</span></code> ：式が地物のジオメトリにアクセスする必要があるかどうか。デフォルトは <code class="xref py py-const docutils literal notranslate"><span class="pre">False</span></code> です。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">handlesnull=True</span></code> ：式がNULL値のカスタム処理を持つかどうか。 <code class="xref py py-const docutils literal notranslate"><span class="pre">False</span></code> （デフォルト）の場合、任意のパラメータがNULLであるときには常に即座に結果がNULLとなります。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">referenced_columns=[list]</span></code> ：この関数が必要とする属性名の配列。デフォルトは <code class="docutils literal notranslate"><span class="pre">[QgsFeatureRequest.ALL_ATTRIBUTES]</span></code> です。</p></li>
</ul>
<p>この関数自体には次のような引数があります:</p>
<ul class="simple">
<li><p>関数に渡したい任意の数と型のパラメータは、以下の引数よりも前に設定します。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">feature</span></code>: 現在の地物</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">parent</span></code>: <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsExpression.html#qgis.core.QgsExpression" title="(in QGIS Python API v3.34)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QgsExpression</span></code></a> オブジェクト</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">context</span></code>: 最後の位置に <code class="docutils literal notranslate"><span class="pre">context</span></code> という引数がある場合、この変数には <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsExpressionContext.html#qgis.core.QgsExpressionContext" title="(in QGIS Python API v3.34)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QgsExpressionContext</span></code></a> オブジェクトが含まれ、式変数のような様々な追加情報へのアクセスを可能にします。例 <code class="docutils literal notranslate"><span class="pre">context.variable(</span> <span class="pre">'layer_id'</span> <span class="pre">)</span></code></p></li>
</ul>
<p>上記の例の関数は、次のように式中で使うことができます。</p>
<figure class="align-center" id="id5">
<span id="figure-expression-custom-function"></span><img alt="../../../_images/customFunction.png" src="../../../_images/customFunction.png" />
<figcaption>
<p><span class="caption-number">図 13.3 </span><span class="caption-text">式タブに追加されたカスタム関数</span><a class="headerlink" href="#id5" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>Pythonコードの作成に関する詳しい情報は <a class="reference internal" href="../../pyqgis_developer_cookbook/index.html#pyqgis-developer-cookbook"><span class="std std-ref">PyQGIS 開発者用 Cookbook</span></a> で見つけることができます。</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="13. 式でレベルアップ" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="functions_list.html" class="btn btn-neutral float-right" title="13.2. 関数のリスト" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2002-now, QGIS project.
      <span class="lastupdated">最終更新: 2024 5月 30, 01:33 +0900
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <!-- Transifex follows a particular logic to build target pages:
Expected French translation link for https://docs.qgis.org/3.28/en/docs/user_manual/print_composer/overview_composer.html
would return https://app.transifex.com/qgis/qgis-documentation/translate/#fr/aa6d8bc653526d38b295ca94bf8eee5e
with the md5 value of "github#qgis/QGIS-Documentation#release_3.28#locale/en/LC_MESSAGES/docs/user_manual/print_composer/overview_composer.po"-->
<!--Make sure that mismatching language codes between Transifex and Sphinx are converted-->


  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-info-circle"> QGIS Documentation </span>
      v: 3.34
      <span class="fa fa-caret-down"></span>
    </span>

    <div class="rst-other-versions">
      <dl>
        <dt>Languages</dt>
        
          <dd><a href="https://docs.qgis.org/3.34/en/docs/user_manual/expressions/expression.html">en</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/cs/docs/user_manual/expressions/expression.html">cs</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/de/docs/user_manual/expressions/expression.html">de</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/es/docs/user_manual/expressions/expression.html">es</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/fr/docs/user_manual/expressions/expression.html">fr</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/hu/docs/user_manual/expressions/expression.html">hu</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/it/docs/user_manual/expressions/expression.html">it</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/ja/docs/user_manual/expressions/expression.html">ja</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/ko/docs/user_manual/expressions/expression.html">ko</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/lt/docs/user_manual/expressions/expression.html">lt</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/nl/docs/user_manual/expressions/expression.html">nl</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/pt_BR/docs/user_manual/expressions/expression.html">pt_BR</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/pt_PT/docs/user_manual/expressions/expression.html">pt_PT</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/ro/docs/user_manual/expressions/expression.html">ro</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/ru/docs/user_manual/expressions/expression.html">ru</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/zh-Hans/docs/user_manual/expressions/expression.html">zh-Hans</a></dd>
        
      </dl>

      <dl>
        <dt>Versions</dt>
        
          <dd><a href="https://docs.qgis.org/testing/ja/docs/user_manual/expressions/expression.html">testing</a></dd>
        
          <dd><a href="https://docs.qgis.org/latest/ja/docs/user_manual/expressions/expression.html">latest</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/ja/docs/user_manual/expressions/expression.html">3.34</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.28/ja/docs/user_manual/expressions/expression.html">3.28</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.22/ja/docs/user_manual/expressions/expression.html">3.22</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.16/ja/docs/user_manual/expressions/expression.html">3.16</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.10/ja/docs/user_manual/expressions/expression.html">3.10</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.4/ja/docs/user_manual/expressions/expression.html">3.4</a></dd>
        
          <dd><a href="https://docs.qgis.org/2.18/ja/docs/user_manual/expressions/expression.html">2.18</a></dd>
        
      </dl>

       
       <dl>
        <dt>Downloads</dt>
        
          <dd><a href="https://docs.qgis.org/3.34/pdf">PDF</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/zip">HTML</a></dd>
        
      </dl>
      

      
       
      <dl>
        <dt>Contribute to Docs</dt>
          <dd>
            <a href="https://github.com/qgis/QGIS-Documentation/edit/master/docs/user_manual/expressions/expression.rst" target="_blank" rel="noopener noreferrer">Edit on GitHub</a>
          </dd>
          
          
          <dd>
            <a href="https://app.transifex.com/qgis/qgis-documentation/translate/#ja/ee147693bca66d96f860ae0699472614" target="_blank" rel="noopener noreferrer">Translate Page</a>
          </dd>
          
          <dd>
            <a href="https://github.com/qgis/QGIS-Documentation/issues" target="_blank" rel="noopener noreferrer">Report Issue</a>
          </dd>
      </dl>
      

      <dl>
        <dt>On QGIS Project</dt>
          <dd>
            <a href="https://qgis.org/ja" target="_blank" rel="noopener noreferrer">Home</a>
          </dd>
          <dd>
            <a href="https://qgis.org/api/3.34" target="_blank" rel="noopener noreferrer">C++ API</a>
          </dd>
          <dd>
            <a href="https://qgis.org/pyqgis/3.34" target="_blank" rel="noopener noreferrer">PyQGIS API</a>
          </dd>
          <dd>
            <a href="https://github.com/qgis/QGIS/tree/release-3_34" target="_blank" rel="noopener noreferrer">Source</a>
          </dd>
      </dl>

    </div>
  </div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>