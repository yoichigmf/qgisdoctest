<!DOCTYPE html>
<html class="writer-html5" lang="ja" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>6. ベクタレイヤを使う &mdash; QGIS Documentation  ドキュメント</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/qgis_docs.css?v=5415a924" />
      <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
      <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />

  
    <link rel="shortcut icon" href="../../_static/qgis_logo.ico"/>
    <link rel="canonical" href="https://docs.qgis.org/latest/en/docs/pyqgis_developer_cookbook/vector.html"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=c033477b"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../../_static/copybutton.js?v=f281be69"></script>
        <script>let toggleHintShow = 'Click to show';</script>
        <script>let toggleHintHide = 'Click to hide';</script>
        <script>let toggleOpenOnPrint = 'true';</script>
        <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
        <script src="../../_static/translations.js?v=4dbe4bdc"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="索引" href="../../genindex.html" />
    <link rel="search" title="検索" href="../../search.html" />
    <link rel="next" title="7. ジオメトリの操作" href="geometry.html" />
    <link rel="prev" title="5. ラスタレイヤを使う" href="raster.html" />
  <meta name="description" content="QGIS 3.34 documentation: 6. ベクタレイヤを使う">
</head>

<body class="wy-body-for-nav">

  <nav class="release_status_topbar">
  </nav>

   

 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
   

          
          
          <a href="../index.html" class="icon icon-home">
            QGIS Documentation
              <img src="../../_static/logo.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                3.34
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
   <a href= "../../genindex.html">Index</a>
 
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">ユーザ向け</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/index.html">QGIS Desktopユーザーガイド／マニュアル (QGIS 3.34)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../server_manual/index.html">QGIS Serverガイド／マニュアル (QGIS 3.34)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../training_manual/index.html">トレーニングマニュアル</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gentle_gis_introduction/index.html">やさしい GIS 入門</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">ドキュメント執筆者向け</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../documentation_guidelines/index.html">ドキュメント作成のガイドライン</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">開発者向け</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">PyQGISクックブック (QGIS 3.34)</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="intro.html">1. はじめに</a></li>
<li class="toctree-l2"><a class="reference internal" href="loadproject.html">2. プロジェクトをロードする</a></li>
<li class="toctree-l2"><a class="reference internal" href="loadlayer.html">3. レイヤをロードする</a></li>
<li class="toctree-l2"><a class="reference internal" href="legend.html">4. 目次（TOC）へのアクセス</a></li>
<li class="toctree-l2"><a class="reference internal" href="raster.html">5. ラスタレイヤを使う</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">6. ベクタレイヤを使う</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#retrieving-information-about-attributes">6.1. 属性に関する情報を取得する</a></li>
<li class="toctree-l3"><a class="reference internal" href="#iterating-over-vector-layer">6.2. ベクタレイヤの反復処理</a></li>
<li class="toctree-l3"><a class="reference internal" href="#selecting-features">6.3. 地物の選択</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#accessing-attributes">6.3.1. 属性にアクセスする</a></li>
<li class="toctree-l4"><a class="reference internal" href="#iterating-over-selected-features">6.3.2. 選択された地物への反復処理</a></li>
<li class="toctree-l4"><a class="reference internal" href="#iterating-over-a-subset-of-features">6.3.3. 一部の地物の反復処理</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#modifying-vector-layers">6.4. ベクタレイヤを修正する</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#add-features">6.4.1. 地物の追加</a></li>
<li class="toctree-l4"><a class="reference internal" href="#delete-features">6.4.2. 地物の削除</a></li>
<li class="toctree-l4"><a class="reference internal" href="#modify-features">6.4.3. 地物の修正</a></li>
<li class="toctree-l4"><a class="reference internal" href="#modifying-vector-layers-with-an-editing-buffer">6.4.4. ベクタレイヤを編集バッファで修正する</a></li>
<li class="toctree-l4"><a class="reference internal" href="#adding-and-removing-fields">6.4.5. フィールドを追加または削除する</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#using-spatial-index">6.5. 空間インデックスを使う</a></li>
<li class="toctree-l3"><a class="reference internal" href="#the-qgsvectorlayerutils-class">6.6. QgsVectorLayerUtilsクラス</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creating-vector-layers">6.7. ベクタレイヤを作る</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#from-an-instance-of-qgsvectorfilewriter">6.7.1. <code class="xref py py-class docutils literal notranslate"><span class="pre">QgsVectorFileWriter</span></code> のインスタンスから</a></li>
<li class="toctree-l4"><a class="reference internal" href="#directly-from-features">6.7.2. 地物から直接</a></li>
<li class="toctree-l4"><a class="reference internal" href="#from-an-instance-of-qgsvectorlayer">6.7.3. <code class="xref py py-class docutils literal notranslate"><span class="pre">QgsVectorLayer</span></code> クラスのインスタンスから作成する</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#appearance-symbology-of-vector-layers">6.8. ベクタレイヤの表現(シンボロジ)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#single-symbol-renderer">6.8.1. 単一シンボルレンダラー</a></li>
<li class="toctree-l4"><a class="reference internal" href="#categorized-symbol-renderer">6.8.2. カテゴリ値シンボル・レンダラー</a></li>
<li class="toctree-l4"><a class="reference internal" href="#graduated-symbol-renderer">6.8.3. 連続値シンボルレンダラー</a></li>
<li class="toctree-l4"><a class="reference internal" href="#working-with-symbols">6.8.4. シンボルを操作する</a></li>
<li class="toctree-l4"><a class="reference internal" href="#creating-custom-renderers">6.8.5. カスタムレンダラーの作成</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#further-topics">6.9. より詳しいトピック</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="geometry.html">7. ジオメトリの操作</a></li>
<li class="toctree-l2"><a class="reference internal" href="crs.html">8. 投影法サポート</a></li>
<li class="toctree-l2"><a class="reference internal" href="canvas.html">9. マップキャンバスを使う</a></li>
<li class="toctree-l2"><a class="reference internal" href="composer.html">10. 地図のレンダリングと印刷</a></li>
<li class="toctree-l2"><a class="reference internal" href="expressions.html">11. 式、フィルタ適用および値の算出</a></li>
<li class="toctree-l2"><a class="reference internal" href="settings.html">12. 設定の読み込みと保存</a></li>
<li class="toctree-l2"><a class="reference internal" href="communicating.html">13. ユーザーとコミュニケーションする</a></li>
<li class="toctree-l2"><a class="reference internal" href="authentication.html">14. 認証インフラストラクチャ</a></li>
<li class="toctree-l2"><a class="reference internal" href="tasks.html">15. タスク - バックグラウンドで重い仕事をする</a></li>
<li class="toctree-l2"><a class="reference internal" href="plugins/index.html">16. Pythonプラグインを開発する</a></li>
<li class="toctree-l2"><a class="reference internal" href="processing.html">17. プロセシングプラグインを書く</a></li>
<li class="toctree-l2"><a class="reference internal" href="pluginlayer.html">18. プラグインレイヤを使う</a></li>
<li class="toctree-l2"><a class="reference internal" href="network_analysis.html">19. ネットワーク分析ライブラリ</a></li>
<li class="toctree-l2"><a class="reference internal" href="server.html">20. QGIS ServerとPython</a></li>
<li class="toctree-l2"><a class="reference internal" href="cheat_sheet.html">21. PyQGISチートシート</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../developers_guide/index.html">開発者ガイド</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">QGIS Documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">PyQGIS 開発者用 Cookbook</a></li>
      <li class="breadcrumb-item active"><span class="section-number">6. </span>ベクタレイヤを使う</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/qgis/QGIS-Documentation/blob/master/docs/pyqgis_developer_cookbook/vector.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul><div class="rst-breadcrumbs-buttons" role="navigation" aria-label="Sequential page navigation">
        <a href="raster.html" class="btn btn-neutral float-left" title="5. ラスタレイヤを使う" accesskey="p"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="geometry.html" class="btn btn-neutral float-right" title="7. ジオメトリの操作" accesskey="n">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
  </div>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <blockquote>
<div><div class="admonition important">
<p class="admonition-title">重要</p>
<p>翻訳は <a class="reference external" href="https://qgis.org/en/site/getinvolved/translate.html#becoming-a-translator">あなたが参加できる</a> コミュニティの取り組みです。このページは現在 99.49% 翻訳されています。</p>
</div>
</div></blockquote>
<section id="using-vector-layers">
<span id="vector"></span><h1><span class="section-number">6. </span>ベクタレイヤを使う<a class="headerlink" href="#using-vector-layers" title="Link to this heading"></a></h1>
<div class="admonition hint">
<p class="admonition-title">ヒント</p>
<p>pyqgisコンソールを使わない場合、このページにあるコードスニペットは次のインポートが必要です:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">from</span> <span class="nn">qgis.core</span> <span class="kn">import</span> <span class="p">(</span>
<span class="linenos"> 2</span>  <span class="n">QgsApplication</span><span class="p">,</span>
<span class="linenos"> 3</span>  <span class="n">QgsDataSourceUri</span><span class="p">,</span>
<span class="linenos"> 4</span>  <span class="n">QgsCategorizedSymbolRenderer</span><span class="p">,</span>
<span class="linenos"> 5</span>  <span class="n">QgsClassificationRange</span><span class="p">,</span>
<span class="linenos"> 6</span>  <span class="n">QgsPointXY</span><span class="p">,</span>
<span class="linenos"> 7</span>  <span class="n">QgsProject</span><span class="p">,</span>
<span class="linenos"> 8</span>  <span class="n">QgsExpression</span><span class="p">,</span>
<span class="linenos"> 9</span>  <span class="n">QgsField</span><span class="p">,</span>
<span class="linenos">10</span>  <span class="n">QgsFields</span><span class="p">,</span>
<span class="linenos">11</span>  <span class="n">QgsFeature</span><span class="p">,</span>
<span class="linenos">12</span>  <span class="n">QgsFeatureRequest</span><span class="p">,</span>
<span class="linenos">13</span>  <span class="n">QgsFeatureRenderer</span><span class="p">,</span>
<span class="linenos">14</span>  <span class="n">QgsGeometry</span><span class="p">,</span>
<span class="linenos">15</span>  <span class="n">QgsGraduatedSymbolRenderer</span><span class="p">,</span>
<span class="linenos">16</span>  <span class="n">QgsMarkerSymbol</span><span class="p">,</span>
<span class="linenos">17</span>  <span class="n">QgsMessageLog</span><span class="p">,</span>
<span class="linenos">18</span>  <span class="n">QgsRectangle</span><span class="p">,</span>
<span class="linenos">19</span>  <span class="n">QgsRendererCategory</span><span class="p">,</span>
<span class="linenos">20</span>  <span class="n">QgsRendererRange</span><span class="p">,</span>
<span class="linenos">21</span>  <span class="n">QgsSymbol</span><span class="p">,</span>
<span class="linenos">22</span>  <span class="n">QgsVectorDataProvider</span><span class="p">,</span>
<span class="linenos">23</span>  <span class="n">QgsVectorLayer</span><span class="p">,</span>
<span class="linenos">24</span>  <span class="n">QgsVectorFileWriter</span><span class="p">,</span>
<span class="linenos">25</span>  <span class="n">QgsWkbTypes</span><span class="p">,</span>
<span class="linenos">26</span>  <span class="n">QgsSpatialIndex</span><span class="p">,</span>
<span class="linenos">27</span>  <span class="n">QgsVectorLayerUtils</span>
<span class="linenos">28</span><span class="p">)</span>
<span class="linenos">29</span>
<span class="linenos">30</span><span class="kn">from</span> <span class="nn">qgis.core.additions.edit</span> <span class="kn">import</span> <span class="n">edit</span>
<span class="linenos">31</span>
<span class="linenos">32</span><span class="kn">from</span> <span class="nn">qgis.PyQt.QtGui</span> <span class="kn">import</span> <span class="p">(</span>
<span class="linenos">33</span>    <span class="n">QColor</span><span class="p">,</span>
<span class="linenos">34</span><span class="p">)</span>
</pre></div>
</div>
</div>
<nav class="contents local" id="id1">
<ul class="simple">
<li><p><a class="reference internal" href="#retrieving-information-about-attributes" id="id2">属性に関する情報を取得する</a></p></li>
<li><p><a class="reference internal" href="#iterating-over-vector-layer" id="id3">ベクタレイヤの反復処理</a></p></li>
<li><p><a class="reference internal" href="#selecting-features" id="id4">地物の選択</a></p>
<ul>
<li><p><a class="reference internal" href="#accessing-attributes" id="id5">属性にアクセスする</a></p></li>
<li><p><a class="reference internal" href="#iterating-over-selected-features" id="id6">選択された地物への反復処理</a></p></li>
<li><p><a class="reference internal" href="#iterating-over-a-subset-of-features" id="id7">一部の地物の反復処理</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#modifying-vector-layers" id="id8">ベクタレイヤを修正する</a></p>
<ul>
<li><p><a class="reference internal" href="#add-features" id="id9">地物の追加</a></p></li>
<li><p><a class="reference internal" href="#delete-features" id="id10">地物の削除</a></p></li>
<li><p><a class="reference internal" href="#modify-features" id="id11">地物の修正</a></p></li>
<li><p><a class="reference internal" href="#modifying-vector-layers-with-an-editing-buffer" id="id12">ベクタレイヤを編集バッファで修正する</a></p></li>
<li><p><a class="reference internal" href="#adding-and-removing-fields" id="id13">フィールドを追加または削除する</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#using-spatial-index" id="id14">空間インデックスを使う</a></p></li>
<li><p><a class="reference internal" href="#the-qgsvectorlayerutils-class" id="id15">QgsVectorLayerUtilsクラス</a></p></li>
<li><p><a class="reference internal" href="#creating-vector-layers" id="id16">ベクタレイヤを作る</a></p>
<ul>
<li><p><a class="reference internal" href="#from-an-instance-of-qgsvectorfilewriter" id="id17"><a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsVectorFileWriter.html#qgis.core.QgsVectorFileWriter" title="(in QGIS Python API v3.34)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QgsVectorFileWriter</span></code></a> のインスタンスから</a></p></li>
<li><p><a class="reference internal" href="#directly-from-features" id="id18">地物から直接</a></p></li>
<li><p><a class="reference internal" href="#from-an-instance-of-qgsvectorlayer" id="id19"><a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsVectorLayer.html#qgis.core.QgsVectorLayer" title="(in QGIS Python API v3.34)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QgsVectorLayer</span></code></a> クラスのインスタンスから作成する</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#appearance-symbology-of-vector-layers" id="id20">ベクタレイヤの表現(シンボロジ)</a></p>
<ul>
<li><p><a class="reference internal" href="#single-symbol-renderer" id="id21">単一シンボルレンダラー</a></p></li>
<li><p><a class="reference internal" href="#categorized-symbol-renderer" id="id22">カテゴリ値シンボル・レンダラー</a></p></li>
<li><p><a class="reference internal" href="#graduated-symbol-renderer" id="id23">連続値シンボルレンダラー</a></p></li>
<li><p><a class="reference internal" href="#working-with-symbols" id="id24">シンボルを操作する</a></p>
<ul>
<li><p><a class="reference internal" href="#working-with-symbol-layers" id="id25">シンボルレイヤーの操作</a></p></li>
<li><p><a class="reference internal" href="#creating-custom-symbol-layer-types" id="id26">カスタムシンボルレイヤタイプの作成</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#creating-custom-renderers" id="id27">カスタムレンダラーの作成</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#further-topics" id="id28">より詳しいトピック</a></p></li>
</ul>
</nav>
<p>このセクションではベクタレイヤに対して行える様々な操作について紹介していきます.</p>
<p>ここでのほとんどの作業は <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsVectorLayer.html#qgis.core.QgsVectorLayer" title="(in QGIS Python API v3.34)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QgsVectorLayer</span></code></a> クラスのメソッドに基づきます。</p>
<section id="retrieving-information-about-attributes">
<span id="index-0"></span><h2><a class="toc-backref" href="#id2" role="doc-backlink"><span class="section-number">6.1. </span>属性に関する情報を取得する</a><a class="headerlink" href="#retrieving-information-about-attributes" title="Link to this heading"></a></h2>
<p>クラス :<cite>QgsVectorLayer &lt;qgis.core.QgsVectorLayer&gt;</cite> オブジェクトに対して <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsVectorLayer.html#qgis.core.QgsVectorLayer.fields" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">fields()</span></code></a> を呼び出すことでベクタレイヤに関連するフィールドに関する情報を取得することができます:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">vlayer</span> <span class="o">=</span> <span class="n">QgsVectorLayer</span><span class="p">(</span><span class="s2">&quot;testdata/airports.shp&quot;</span><span class="p">,</span> <span class="s2">&quot;airports&quot;</span><span class="p">,</span> <span class="s2">&quot;ogr&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">vlayer</span><span class="o">.</span><span class="n">fields</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">(),</span> <span class="n">field</span><span class="o">.</span><span class="n">typeName</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>ID Integer64
<span class="linenos">2</span>fk_region Integer64
<span class="linenos">3</span>ELEV Real
<span class="linenos">4</span>NAME String
<span class="linenos">5</span>USE String
</pre></div>
</div>
<p><a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsVectorLayer.html#qgis.core.QgsVectorLayer.displayField" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">displayField()</span></code></a> と <code class="xref py py-meth docutils literal notranslate"><span class="pre">mapTipTemplate()</span></code> メソッドは、 <a class="reference internal" href="../user_manual/working_with_vector/vector_properties.html#maptips"><span class="std std-ref">表示名プロパティ</span></a> タブで使用するフィールドとテンプレートについての情報を提供します。</p>
<p>ベクタレイヤを読み込むと、常にフィールドが <code class="docutils literal notranslate"><span class="pre">Display</span> <span class="pre">Name</span></code> としてQGISによって選択され、<code class="docutils literal notranslate"><span class="pre">HTML</span> <span class="pre">Map</span> <span class="pre">Tip</span></code> はデフォルトで空になっています。これらのメソッドを使用すると、簡単に両方を取得することができます:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">vlayer</span> <span class="o">=</span> <span class="n">QgsVectorLayer</span><span class="p">(</span><span class="s2">&quot;testdata/airports.shp&quot;</span><span class="p">,</span> <span class="s2">&quot;airports&quot;</span><span class="p">,</span> <span class="s2">&quot;ogr&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">vlayer</span><span class="o">.</span><span class="n">displayField</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>NAME
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p><code class="docutils literal notranslate"><span class="pre">表示名</span></code> をフィールドから式に変更する場合、 <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsVectorLayer.html#qgis.core.QgsVectorLayer.displayField" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">displayField()</span></code></a> の代わりに <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsVectorLayer.html#qgis.core.QgsVectorLayer.displayExpression" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">displayExpression()</span></code></a> を使用しなければなりません。</p>
</div>
</section>
<section id="iterating-over-vector-layer">
<span id="index-1"></span><h2><a class="toc-backref" href="#id3" role="doc-backlink"><span class="section-number">6.2. </span>ベクタレイヤの反復処理</a><a class="headerlink" href="#iterating-over-vector-layer" title="Link to this heading"></a></h2>
<p>ベクタレイヤの地物を反復することは、最も一般的なタスクの1つです。以下は、このタスクを実行するためのシンプルな基本コードの例で、各地物に関するいくつかの情報を表示します。変数 <code class="docutils literal notranslate"><span class="pre">layer</span></code> には <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsVectorLayer.html#qgis.core.QgsVectorLayer" title="(in QGIS Python API v3.34)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QgsVectorLayer</span></code></a> オブジェクトが含まれていると仮定しています。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1"># &quot;layer&quot; is a QgsVectorLayer instance</span>
<span class="linenos"> 2</span><span class="n">layer</span> <span class="o">=</span> <span class="n">iface</span><span class="o">.</span><span class="n">activeLayer</span><span class="p">()</span>
<span class="linenos"> 3</span><span class="n">features</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">getFeatures</span><span class="p">()</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">features</span><span class="p">:</span>
<span class="linenos"> 6</span>    <span class="c1"># retrieve every feature with its geometry and attributes</span>
<span class="linenos"> 7</span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Feature ID: &quot;</span><span class="p">,</span> <span class="n">feature</span><span class="o">.</span><span class="n">id</span><span class="p">())</span>
<span class="linenos"> 8</span>    <span class="c1"># fetch geometry</span>
<span class="linenos"> 9</span>    <span class="c1"># show some information about the feature geometry</span>
<span class="linenos">10</span>    <span class="n">geom</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">geometry</span><span class="p">()</span>
<span class="linenos">11</span>    <span class="n">geomSingleType</span> <span class="o">=</span> <span class="n">QgsWkbTypes</span><span class="o">.</span><span class="n">isSingleType</span><span class="p">(</span><span class="n">geom</span><span class="o">.</span><span class="n">wkbType</span><span class="p">())</span>
<span class="linenos">12</span>    <span class="k">if</span> <span class="n">geom</span><span class="o">.</span><span class="n">type</span><span class="p">()</span> <span class="o">==</span> <span class="n">QgsWkbTypes</span><span class="o">.</span><span class="n">PointGeometry</span><span class="p">:</span>
<span class="linenos">13</span>        <span class="c1"># the geometry type can be of single or multi type</span>
<span class="linenos">14</span>        <span class="k">if</span> <span class="n">geomSingleType</span><span class="p">:</span>
<span class="linenos">15</span>            <span class="n">x</span> <span class="o">=</span> <span class="n">geom</span><span class="o">.</span><span class="n">asPoint</span><span class="p">()</span>
<span class="linenos">16</span>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Point: &quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="linenos">17</span>        <span class="k">else</span><span class="p">:</span>
<span class="linenos">18</span>            <span class="n">x</span> <span class="o">=</span> <span class="n">geom</span><span class="o">.</span><span class="n">asMultiPoint</span><span class="p">()</span>
<span class="linenos">19</span>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;MultiPoint: &quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="linenos">20</span>    <span class="k">elif</span> <span class="n">geom</span><span class="o">.</span><span class="n">type</span><span class="p">()</span> <span class="o">==</span> <span class="n">QgsWkbTypes</span><span class="o">.</span><span class="n">LineGeometry</span><span class="p">:</span>
<span class="linenos">21</span>        <span class="k">if</span> <span class="n">geomSingleType</span><span class="p">:</span>
<span class="linenos">22</span>            <span class="n">x</span> <span class="o">=</span> <span class="n">geom</span><span class="o">.</span><span class="n">asPolyline</span><span class="p">()</span>
<span class="linenos">23</span>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Line: &quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="s2">&quot;length: &quot;</span><span class="p">,</span> <span class="n">geom</span><span class="o">.</span><span class="n">length</span><span class="p">())</span>
<span class="linenos">24</span>        <span class="k">else</span><span class="p">:</span>
<span class="linenos">25</span>            <span class="n">x</span> <span class="o">=</span> <span class="n">geom</span><span class="o">.</span><span class="n">asMultiPolyline</span><span class="p">()</span>
<span class="linenos">26</span>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;MultiLine: &quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="s2">&quot;length: &quot;</span><span class="p">,</span> <span class="n">geom</span><span class="o">.</span><span class="n">length</span><span class="p">())</span>
<span class="linenos">27</span>    <span class="k">elif</span> <span class="n">geom</span><span class="o">.</span><span class="n">type</span><span class="p">()</span> <span class="o">==</span> <span class="n">QgsWkbTypes</span><span class="o">.</span><span class="n">PolygonGeometry</span><span class="p">:</span>
<span class="linenos">28</span>        <span class="k">if</span> <span class="n">geomSingleType</span><span class="p">:</span>
<span class="linenos">29</span>            <span class="n">x</span> <span class="o">=</span> <span class="n">geom</span><span class="o">.</span><span class="n">asPolygon</span><span class="p">()</span>
<span class="linenos">30</span>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Polygon: &quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="s2">&quot;Area: &quot;</span><span class="p">,</span> <span class="n">geom</span><span class="o">.</span><span class="n">area</span><span class="p">())</span>
<span class="linenos">31</span>        <span class="k">else</span><span class="p">:</span>
<span class="linenos">32</span>            <span class="n">x</span> <span class="o">=</span> <span class="n">geom</span><span class="o">.</span><span class="n">asMultiPolygon</span><span class="p">()</span>
<span class="linenos">33</span>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;MultiPolygon: &quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="s2">&quot;Area: &quot;</span><span class="p">,</span> <span class="n">geom</span><span class="o">.</span><span class="n">area</span><span class="p">())</span>
<span class="linenos">34</span>    <span class="k">else</span><span class="p">:</span>
<span class="linenos">35</span>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Unknown or invalid geometry&quot;</span><span class="p">)</span>
<span class="linenos">36</span>    <span class="c1"># fetch attributes</span>
<span class="linenos">37</span>    <span class="n">attrs</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">attributes</span><span class="p">()</span>
<span class="linenos">38</span>    <span class="c1"># attrs is a list. It contains all the attribute values of this feature</span>
<span class="linenos">39</span>    <span class="nb">print</span><span class="p">(</span><span class="n">attrs</span><span class="p">)</span>
<span class="linenos">40</span>    <span class="c1"># for this test only print the first feature</span>
<span class="linenos">41</span>    <span class="k">break</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Feature ID:  1
Point:  &lt;QgsPointXY: POINT(7 45)&gt;
[1, &#39;First feature&#39;]
</pre></div>
</div>
</section>
<section id="selecting-features">
<span id="index-2"></span><h2><a class="toc-backref" href="#id4" role="doc-backlink"><span class="section-number">6.3. </span>地物の選択</a><a class="headerlink" href="#selecting-features" title="Link to this heading"></a></h2>
<p>QGISデスクトップでは、地物の選択はさまざまな方法で行うことができます: 地物をクリックする、マップキャンバス上に矩形を描く、または式フィルタを使用する。選択された地物は通常、ユーザーの注意を引くよう、別の色（デフォルトは黄色）でハイライトされます。</p>
<p>プログラムで地物を選択したり、デフォルトの色を変更したりすることが便利な場合もあります。</p>
<p>全ての地物を選択するためには、 <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsVectorLayer.html#qgis.core.QgsVectorLayer.selectAll" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">selectAll()</span></code></a> メソッドを使うことができます:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get the active layer (must be a vector layer)</span>
<span class="n">layer</span> <span class="o">=</span> <span class="n">iface</span><span class="o">.</span><span class="n">activeLayer</span><span class="p">()</span>
<span class="n">layer</span><span class="o">.</span><span class="n">selectAll</span><span class="p">()</span>
</pre></div>
</div>
<p>式を使用して選択するには、 <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsVectorLayer.html#qgis.core.QgsVectorLayer.selectByExpression" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">selectByExpression()</span></code></a> メソッドを使います:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Assumes that the active layer is points.shp file from the QGIS test suite</span>
<span class="c1"># (Class (string) and Heading (number) are attributes in points.shp)</span>
<span class="n">layer</span> <span class="o">=</span> <span class="n">iface</span><span class="o">.</span><span class="n">activeLayer</span><span class="p">()</span>
<span class="n">layer</span><span class="o">.</span><span class="n">selectByExpression</span><span class="p">(</span><span class="s1">&#39;&quot;Class&quot;=</span><span class="se">\&#39;</span><span class="s1">B52</span><span class="se">\&#39;</span><span class="s1"> and &quot;Heading&quot; &gt; 10 and &quot;Heading&quot; &lt;70&#39;</span><span class="p">,</span> <span class="n">QgsVectorLayer</span><span class="o">.</span><span class="n">SetSelection</span><span class="p">)</span>
</pre></div>
</div>
<p>選択色を変更するには、次の例のように、 <a class="reference external" href="https://qgis.org/pyqgis/3.34/gui/QgsMapCanvas.html#qgis.gui.QgsMapCanvas" title="(in QGIS Python API v3.34)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QgsMapCanvas</span></code></a> の <a class="reference external" href="https://qgis.org/pyqgis/3.34/gui/QgsMapCanvas.html#qgis.gui.QgsMapCanvas.setSelectionColor" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">setSelectionColor()</span></code></a> メソッドを使うことができます:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">iface</span><span class="o">.</span><span class="n">mapCanvas</span><span class="p">()</span><span class="o">.</span><span class="n">setSelectionColor</span><span class="p">(</span> <span class="n">QColor</span><span class="p">(</span><span class="s2">&quot;red&quot;</span><span class="p">)</span> <span class="p">)</span>
</pre></div>
</div>
<p>指定されたレイヤの選択された地物リストに地物を追加するには、 <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsVectorLayer.html#qgis.core.QgsVectorLayer.select" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">select()</span></code></a> を呼び出し、地物IDのリストを渡します:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="n">selected_fid</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos">2</span>
<span class="linenos">3</span><span class="c1"># Get the first feature id from the layer</span>
<span class="linenos">4</span><span class="n">feature</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">layer</span><span class="o">.</span><span class="n">getFeatures</span><span class="p">())</span>
<span class="linenos">5</span><span class="k">if</span> <span class="n">feature</span><span class="p">:</span>
<span class="linenos">6</span>    <span class="n">selected_fid</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">feature</span><span class="o">.</span><span class="n">id</span><span class="p">())</span>
<span class="linenos">7</span>
<span class="linenos">8</span><span class="c1"># Add that features to the selected list</span>
<span class="linenos">9</span><span class="n">layer</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">selected_fid</span><span class="p">)</span>
</pre></div>
</div>
<p>選択を解除するには:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">layer</span><span class="o">.</span><span class="n">removeSelection</span><span class="p">()</span>
</pre></div>
</div>
<section id="accessing-attributes">
<h3><a class="toc-backref" href="#id5" role="doc-backlink"><span class="section-number">6.3.1. </span>属性にアクセスする</a><a class="headerlink" href="#accessing-attributes" title="Link to this heading"></a></h3>
<p>属性は名前で参照することができます:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">feature</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>First feature
</pre></div>
</div>
<p>また、属性はインデックスで参照することもできます。これは名前を使うより少し速いです。例えば、2番目の属性を取得する場合:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">feature</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>First feature
</pre></div>
</div>
</section>
<section id="iterating-over-selected-features">
<h3><a class="toc-backref" href="#id6" role="doc-backlink"><span class="section-number">6.3.2. </span>選択された地物への反復処理</a><a class="headerlink" href="#iterating-over-selected-features" title="Link to this heading"></a></h3>
<p>選択された地物のみが必要な場合は、ベクタレイヤの <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsVectorLayer.html#qgis.core.QgsVectorLayer.selectedFeatures" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">selectedFeatures()</span></code></a> メソッドを使用することができます:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">selection</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">selectedFeatures</span><span class="p">()</span>
<span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">selection</span><span class="p">:</span>
    <span class="c1"># do whatever you need with the feature</span>
    <span class="k">pass</span>
</pre></div>
</div>
</section>
<section id="iterating-over-a-subset-of-features">
<h3><a class="toc-backref" href="#id7" role="doc-backlink"><span class="section-number">6.3.3. </span>一部の地物の反復処理</a><a class="headerlink" href="#iterating-over-a-subset-of-features" title="Link to this heading"></a></h3>
<p>もし、レイヤ内のあるエリア内の地物のサブセットを反復処理したい場合、 <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsVectorLayer.html#qgis.core.QgsVectorLayer.getFeatures" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">getFeatures()</span></code></a> 呼び出しに <code class="xref py py-class docutils literal notranslate"><span class="pre">QgsFeatureRequest&gt;</span></code> オブジェクトを追加する必要があります。以下はその例です:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="n">areaOfInterest</span> <span class="o">=</span> <span class="n">QgsRectangle</span><span class="p">(</span><span class="mi">450290</span><span class="p">,</span><span class="mi">400520</span><span class="p">,</span> <span class="mi">450750</span><span class="p">,</span><span class="mi">400780</span><span class="p">)</span>
<span class="linenos">2</span>
<span class="linenos">3</span><span class="n">request</span> <span class="o">=</span> <span class="n">QgsFeatureRequest</span><span class="p">()</span><span class="o">.</span><span class="n">setFilterRect</span><span class="p">(</span><span class="n">areaOfInterest</span><span class="p">)</span>
<span class="linenos">4</span>
<span class="linenos">5</span><span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">layer</span><span class="o">.</span><span class="n">getFeatures</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
<span class="linenos">6</span>    <span class="c1"># do whatever you need with the feature</span>
<span class="linenos">7</span>    <span class="k">pass</span>
</pre></div>
</div>
<p>高速化のため、多くの場合、地物のバウンディングボックスのみを使用して交差が行われます。しかし、フラグ <code class="docutils literal notranslate"><span class="pre">ExactIntersect</span></code> を指定することで、交差する地物のみが返されるようにすることができます:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">request</span> <span class="o">=</span> <span class="n">QgsFeatureRequest</span><span class="p">()</span><span class="o">.</span><span class="n">setFilterRect</span><span class="p">(</span><span class="n">areaOfInterest</span><span class="p">)</span> \
                             <span class="o">.</span><span class="n">setFlags</span><span class="p">(</span><span class="n">QgsFeatureRequest</span><span class="o">.</span><span class="n">ExactIntersect</span><span class="p">)</span>
</pre></div>
</div>
<p>;meth:<cite>setLimit() &lt;qgis.core.QgsFeatureRequest.setLimit&gt;</cite> を使用すると、リクエストした地物の数を制限することができます。以下はその例です:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">request</span> <span class="o">=</span> <span class="n">QgsFeatureRequest</span><span class="p">()</span>
<span class="n">request</span><span class="o">.</span><span class="n">setLimit</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">layer</span><span class="o">.</span><span class="n">getFeatures</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;qgis._core.QgsFeature object at 0x7f9b78590948&gt;
&lt;qgis._core.QgsFeature object at 0x7faef5881670&gt;
</pre></div>
</div>
<p>上記の例のように空間的なフィルタの代わりに、または加えて、属性ベースのフィルタが必要な場合は、 <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsExpression.html#qgis.core.QgsExpression" title="(in QGIS Python API v3.34)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QgsExpression</span></code></a> オブジェクトを作って <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsFeatureRequest.html#qgis.core.QgsFeatureRequest" title="(in QGIS Python API v3.34)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QgsFeatureRequest</span></code></a> コンストラクタに渡せばよいでしょう。以下はその例です:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># The expression will filter the features where the field &quot;location_name&quot;</span>
<span class="c1"># contains the word &quot;Lake&quot; (case insensitive)</span>
<span class="n">exp</span> <span class="o">=</span> <span class="n">QgsExpression</span><span class="p">(</span><span class="s1">&#39;location_name ILIKE </span><span class="se">\&#39;</span><span class="si">%La</span><span class="s1">ke%</span><span class="se">\&#39;</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">request</span> <span class="o">=</span> <span class="n">QgsFeatureRequest</span><span class="p">(</span><span class="n">exp</span><span class="p">)</span>
</pre></div>
</div>
<p><a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsExpression.html#qgis.core.QgsExpression" title="(in QGIS Python API v3.34)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QgsExpression</span></code></a> がサポートする構文の詳細については、 <a class="reference internal" href="expressions.html#expressions"><span class="std std-ref">式、フィルタ適用および値の算出</span></a> を参照してください。</p>
<p>要求は、地物ごとに取得したデータを定義するために使用できるので、反復子はすべての地物を返しますが、それぞれの地物については部分的データを返します。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1"># Only return selected fields to increase the &quot;speed&quot; of the request</span>
<span class="linenos"> 2</span><span class="n">request</span><span class="o">.</span><span class="n">setSubsetOfAttributes</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
<span class="linenos"> 3</span>
<span class="linenos"> 4</span><span class="c1"># More user friendly version</span>
<span class="linenos"> 5</span><span class="n">request</span><span class="o">.</span><span class="n">setSubsetOfAttributes</span><span class="p">([</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;id&#39;</span><span class="p">],</span><span class="n">layer</span><span class="o">.</span><span class="n">fields</span><span class="p">())</span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span><span class="c1"># Don&#39;t return geometry objects to increase the &quot;speed&quot; of the request</span>
<span class="linenos"> 8</span><span class="n">request</span><span class="o">.</span><span class="n">setFlags</span><span class="p">(</span><span class="n">QgsFeatureRequest</span><span class="o">.</span><span class="n">NoGeometry</span><span class="p">)</span>
<span class="linenos"> 9</span>
<span class="linenos">10</span><span class="c1"># Fetch only the feature with id 45</span>
<span class="linenos">11</span><span class="n">request</span><span class="o">.</span><span class="n">setFilterFid</span><span class="p">(</span><span class="mi">45</span><span class="p">)</span>
<span class="linenos">12</span>
<span class="linenos">13</span><span class="c1"># The options may be chained</span>
<span class="linenos">14</span><span class="n">request</span><span class="o">.</span><span class="n">setFilterRect</span><span class="p">(</span><span class="n">areaOfInterest</span><span class="p">)</span><span class="o">.</span><span class="n">setFlags</span><span class="p">(</span><span class="n">QgsFeatureRequest</span><span class="o">.</span><span class="n">NoGeometry</span><span class="p">)</span><span class="o">.</span><span class="n">setFilterFid</span><span class="p">(</span><span class="mi">45</span><span class="p">)</span><span class="o">.</span><span class="n">setSubsetOfAttributes</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
</pre></div>
</div>
</section>
</section>
<section id="modifying-vector-layers">
<span id="editing"></span><span id="index-3"></span><h2><a class="toc-backref" href="#id8" role="doc-backlink"><span class="section-number">6.4. </span>ベクタレイヤを修正する</a><a class="headerlink" href="#modifying-vector-layers" title="Link to this heading"></a></h2>
<p>大部分のベクタデータプロバイダーは、レイヤデータの編集をサポートしています。プロバイダーによっては、編集操作の一部しかサポートしていないこともあります。どの機能をサポートしているかを知るには、 <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsVectorDataProvider.html#qgis.core.QgsVectorDataProvider.capabilities" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">capabilities()</span></code></a> 関数を使ってください。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">caps</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">dataProvider</span><span class="p">()</span><span class="o">.</span><span class="n">capabilities</span><span class="p">()</span>
<span class="c1"># Check if a particular capability is supported:</span>
<span class="k">if</span> <span class="n">caps</span> <span class="o">&amp;</span> <span class="n">QgsVectorDataProvider</span><span class="o">.</span><span class="n">DeleteFeatures</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The layer supports DeleteFeatures&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>The layer supports DeleteFeatures
</pre></div>
</div>
<p>利用可能なすべての機能のリストについては、 <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsVectorDataProvider.html#qgis.core.QgsVectorDataProvider" title="(in QGIS Python API v3.34)"><code class="xref py py-class docutils literal notranslate"><span class="pre">API</span> <span class="pre">Documentation</span> <span class="pre">of</span> <span class="pre">QgsVectorDataProvider</span></code></a> を参照してください。</p>
<p><a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsVectorDataProvider.html#qgis.core.QgsVectorDataProvider.capabilitiesString" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">capabilitiesString()</span></code></a> を使うと、下記の例に見るように、レイヤの機能の説明文をコンマで区切られたリストの形で表示することができます:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="n">caps_string</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">dataProvider</span><span class="p">()</span><span class="o">.</span><span class="n">capabilitiesString</span><span class="p">()</span>
<span class="linenos">2</span><span class="c1"># Print:</span>
<span class="linenos">3</span><span class="c1"># &#39;Add Features, Delete Features, Change Attribute Values, Add Attributes,</span>
<span class="linenos">4</span><span class="c1"># Delete Attributes, Rename Attributes, Fast Access to Features at ID,</span>
<span class="linenos">5</span><span class="c1"># Presimplify Geometries, Presimplify Geometries with Validity Check,</span>
<span class="linenos">6</span><span class="c1"># Transactions, Curved Geometries&#39;</span>
</pre></div>
</div>
<p>ベクタレイヤを編集する以下の方法はいずれも、変更が直接、レイヤの裏にあるデータストア（ファイルやデータベースなど）にコミットされます。一時的な変更をしたいだけの場合にどうすればよいかの説明は、次のセクション <a class="reference internal" href="#editing-buffer"><span class="std std-ref">ベクタレイヤを編集バッファで修正する</span></a> でしているので、以下を飛ばしてそちらに進んでください。</p>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p>QGISの内部（コンソールまたはプラグインのいずれか）で作業している場合、ジオメトリ、スタイル、属性に加えられた変更を確認するために、以下のようにマップキャンバスの強制的な再描画が必要になることもあります:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="c1"># If caching is enabled, a simple canvas refresh might not be sufficient</span>
<span class="linenos">2</span><span class="c1"># to trigger a redraw and you must clear the cached image for the layer</span>
<span class="linenos">3</span><span class="k">if</span> <span class="n">iface</span><span class="o">.</span><span class="n">mapCanvas</span><span class="p">()</span><span class="o">.</span><span class="n">isCachingEnabled</span><span class="p">():</span>
<span class="linenos">4</span>    <span class="n">layer</span><span class="o">.</span><span class="n">triggerRepaint</span><span class="p">()</span>
<span class="linenos">5</span><span class="k">else</span><span class="p">:</span>
<span class="linenos">6</span>    <span class="n">iface</span><span class="o">.</span><span class="n">mapCanvas</span><span class="p">()</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
</pre></div>
</div>
</div>
<section id="add-features">
<h3><a class="toc-backref" href="#id9" role="doc-backlink"><span class="section-number">6.4.1. </span>地物の追加</a><a class="headerlink" href="#add-features" title="Link to this heading"></a></h3>
<p><a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsFeature.html#qgis.core.QgsFeature" title="(in QGIS Python API v3.34)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QgsFeature</span></code></a> インスタンスをいくつか作成し、プロバイダの <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsVectorDataProvider.html#qgis.core.QgsVectorDataProvider.addFeatures" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">addFeatures()</span></code></a> メソッドにそれらのリストを渡します。このメソッドは、結果 (<code class="xref py py-const docutils literal notranslate"><span class="pre">True</span></code> または <code class="xref py py-const docutils literal notranslate"><span class="pre">False</span></code>) と追加された地物のリスト (それらのIDはデータストアによって設定されます)ｍｐ2つの値を返します。</p>
<p>地物の属性を設定するには、 <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsFields.html#qgis.core.QgsFields" title="(in QGIS Python API v3.34)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QgsFields</span></code></a> オブジェクト（ベクタレイヤの <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsVectorLayer.html#qgis.core.QgsVectorLayer.fields" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">fields()</span></code></a> メソッドから取得できます）を渡して地物を初期化するか、追加したいフィールド数を渡して <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsFeature.html#qgis.core.QgsFeature.initAttributes" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">initAttributes()</span></code></a> を呼び出す方法があります。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="k">if</span> <span class="n">caps</span> <span class="o">&amp;</span> <span class="n">QgsVectorDataProvider</span><span class="o">.</span><span class="n">AddFeatures</span><span class="p">:</span>
<span class="linenos">2</span>    <span class="n">feat</span> <span class="o">=</span> <span class="n">QgsFeature</span><span class="p">(</span><span class="n">layer</span><span class="o">.</span><span class="n">fields</span><span class="p">())</span>
<span class="linenos">3</span>    <span class="n">feat</span><span class="o">.</span><span class="n">setAttributes</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;hello&#39;</span><span class="p">])</span>
<span class="linenos">4</span>    <span class="c1"># Or set a single attribute by key or by index:</span>
<span class="linenos">5</span>    <span class="n">feat</span><span class="o">.</span><span class="n">setAttribute</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;hello&#39;</span><span class="p">)</span>
<span class="linenos">6</span>    <span class="n">feat</span><span class="o">.</span><span class="n">setAttribute</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;hello&#39;</span><span class="p">)</span>
<span class="linenos">7</span>    <span class="n">feat</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QgsGeometry</span><span class="o">.</span><span class="n">fromPointXY</span><span class="p">(</span><span class="n">QgsPointXY</span><span class="p">(</span><span class="mi">123</span><span class="p">,</span> <span class="mi">456</span><span class="p">)))</span>
<span class="linenos">8</span>    <span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">outFeats</span><span class="p">)</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">dataProvider</span><span class="p">()</span><span class="o">.</span><span class="n">addFeatures</span><span class="p">([</span><span class="n">feat</span><span class="p">])</span>
</pre></div>
</div>
</section>
<section id="delete-features">
<h3><a class="toc-backref" href="#id10" role="doc-backlink"><span class="section-number">6.4.2. </span>地物の削除</a><a class="headerlink" href="#delete-features" title="Link to this heading"></a></h3>
<p>一部の地物を削除するには、その地物IDのリストを提供するだけです。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">caps</span> <span class="o">&amp;</span> <span class="n">QgsVectorDataProvider</span><span class="o">.</span><span class="n">DeleteFeatures</span><span class="p">:</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">dataProvider</span><span class="p">()</span><span class="o">.</span><span class="n">deleteFeatures</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span>
</pre></div>
</div>
</section>
<section id="modify-features">
<h3><a class="toc-backref" href="#id11" role="doc-backlink"><span class="section-number">6.4.3. </span>地物の修正</a><a class="headerlink" href="#modify-features" title="Link to this heading"></a></h3>
<p>地物のジオメトリを変更することも、一部の属性を変更することも可能です。次の例では、まずインデックス 0 と 1 の属性値を変更し、次に地物のジオメトリを変更します。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="n">fid</span> <span class="o">=</span> <span class="mi">100</span>   <span class="c1"># ID of the feature we will modify</span>
<span class="linenos">2</span>
<span class="linenos">3</span><span class="k">if</span> <span class="n">caps</span> <span class="o">&amp;</span> <span class="n">QgsVectorDataProvider</span><span class="o">.</span><span class="n">ChangeAttributeValues</span><span class="p">:</span>
<span class="linenos">4</span>    <span class="n">attrs</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span> <span class="p">:</span> <span class="s2">&quot;hello&quot;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">:</span> <span class="mi">123</span> <span class="p">}</span>
<span class="linenos">5</span>    <span class="n">layer</span><span class="o">.</span><span class="n">dataProvider</span><span class="p">()</span><span class="o">.</span><span class="n">changeAttributeValues</span><span class="p">({</span> <span class="n">fid</span> <span class="p">:</span> <span class="n">attrs</span> <span class="p">})</span>
<span class="linenos">6</span>
<span class="linenos">7</span><span class="k">if</span> <span class="n">caps</span> <span class="o">&amp;</span> <span class="n">QgsVectorDataProvider</span><span class="o">.</span><span class="n">ChangeGeometries</span><span class="p">:</span>
<span class="linenos">8</span>    <span class="n">geom</span> <span class="o">=</span> <span class="n">QgsGeometry</span><span class="o">.</span><span class="n">fromPointXY</span><span class="p">(</span><span class="n">QgsPointXY</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span><span class="mi">222</span><span class="p">))</span>
<span class="linenos">9</span>    <span class="n">layer</span><span class="o">.</span><span class="n">dataProvider</span><span class="p">()</span><span class="o">.</span><span class="n">changeGeometryValues</span><span class="p">({</span> <span class="n">fid</span> <span class="p">:</span> <span class="n">geom</span> <span class="p">})</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p><strong>ジオメトリのみの編集にはQgsVectorLayerEditUtilsクラスをお勧めします</strong></p>
<p>もし、ジオメトリを変更するだけなら、ジオメトリを編集（移動、頂点の挿入または移動など）するのに便利なメソッドを提供する <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsVectorLayerEditUtils.html#qgis.core.QgsVectorLayerEditUtils" title="(in QGIS Python API v3.34)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QgsVectorLayerEditUtils</span></code></a> を使うことを検討できるかもしれません。</p>
</div>
</section>
<section id="modifying-vector-layers-with-an-editing-buffer">
<span id="editing-buffer"></span><h3><a class="toc-backref" href="#id12" role="doc-backlink"><span class="section-number">6.4.4. </span>ベクタレイヤを編集バッファで修正する</a><a class="headerlink" href="#modifying-vector-layers-with-an-editing-buffer" title="Link to this heading"></a></h3>
<p>QGISアプリケーションでベクタを編集する場合、まず特定のレイヤの編集モードを開始し、次にいくつかの変更を行い、最後に変更をコミット（またはロールバック）する必要があります。コミットするまでは、変更内容はすべて書き込まれず、レイヤのインメモリ編集バッファに残ります。この機能はプログラムでも使用できます。これは、データプロバイダの直接利用を補完する、ベクタレイヤ編集の別の方法です。ベクタレイヤ編集用のGUIツールを提供する場合、このオプションを使用します。これは、コミット/ロールバックするかどうかをユーザーが決定でき、元に戻す/やり直すが使用できるようになるからです。変更がコミットされると、編集バッファのすべての変更がデータプロバイダーに保存されます。</p>
<p>メソッドはすでに見たプロバイダにおけるものとよく似ていますが、プロバイダではなく <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsVectorLayer.html#qgis.core.QgsVectorLayer" title="(in QGIS Python API v3.34)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QgsVectorLayer</span></code></a> オブジェクトで呼び出されます。</p>
<p>これらのメソッドが機能するためには、そのレイヤは編集モードでなければいけません。編集モードを開始するには、 <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsVectorLayer.html#qgis.core.QgsVectorLayer.startEditing" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">startEditing()</span></code></a> メソッドを使用します。編集を終了するには、 <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsVectorLayer.html#qgis.core.QgsVectorLayer.commitChanges" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">commitChanges()</span></code></a> メソッドか、もしくは <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsVectorLayer.html#qgis.core.QgsVectorLayer.rollBack" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">rollBack()</span></code></a> メソッドを使用します。前者はすべての変更をデータソースにコミットします。一方後者は変更をすべて破棄し、データソースには一切、手をつけません。</p>
<p>あるレイヤが編集モードかどうかを知るには、 <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsVectorLayer.html#qgis.core.QgsVectorLayer.isEditable" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">isEditable()</span></code></a> メソッドを使用してください。</p>
<p>では、これら編集メソッドの使用方法を示す実例をいくつか見てもらいます。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">from</span> <span class="nn">qgis.PyQt.QtCore</span> <span class="kn">import</span> <span class="n">QVariant</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="n">feat1</span> <span class="o">=</span> <span class="n">feat2</span> <span class="o">=</span> <span class="n">QgsFeature</span><span class="p">(</span><span class="n">layer</span><span class="o">.</span><span class="n">fields</span><span class="p">())</span>
<span class="linenos"> 4</span><span class="n">fid</span> <span class="o">=</span> <span class="mi">99</span>
<span class="linenos"> 5</span><span class="n">feat1</span><span class="o">.</span><span class="n">setId</span><span class="p">(</span><span class="n">fid</span><span class="p">)</span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span><span class="c1"># add two features (QgsFeature instances)</span>
<span class="linenos"> 8</span><span class="n">layer</span><span class="o">.</span><span class="n">addFeatures</span><span class="p">([</span><span class="n">feat1</span><span class="p">,</span><span class="n">feat2</span><span class="p">])</span>
<span class="linenos"> 9</span><span class="c1"># delete a feature with specified ID</span>
<span class="linenos">10</span><span class="n">layer</span><span class="o">.</span><span class="n">deleteFeature</span><span class="p">(</span><span class="n">fid</span><span class="p">)</span>
<span class="linenos">11</span>
<span class="linenos">12</span><span class="c1"># set new geometry (QgsGeometry instance) for a feature</span>
<span class="linenos">13</span><span class="n">geometry</span> <span class="o">=</span> <span class="n">QgsGeometry</span><span class="o">.</span><span class="n">fromWkt</span><span class="p">(</span><span class="s2">&quot;POINT(7 45)&quot;</span><span class="p">)</span>
<span class="linenos">14</span><span class="n">layer</span><span class="o">.</span><span class="n">changeGeometry</span><span class="p">(</span><span class="n">fid</span><span class="p">,</span> <span class="n">geometry</span><span class="p">)</span>
<span class="linenos">15</span><span class="c1"># update an attribute with given field index (int) to a given value</span>
<span class="linenos">16</span><span class="n">fieldIndex</span> <span class="o">=</span><span class="mi">1</span>
<span class="linenos">17</span><span class="n">value</span> <span class="o">=</span><span class="s1">&#39;My new name&#39;</span>
<span class="linenos">18</span><span class="n">layer</span><span class="o">.</span><span class="n">changeAttributeValue</span><span class="p">(</span><span class="n">fid</span><span class="p">,</span> <span class="n">fieldIndex</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
<span class="linenos">19</span>
<span class="linenos">20</span><span class="c1"># add new field</span>
<span class="linenos">21</span><span class="n">layer</span><span class="o">.</span><span class="n">addAttribute</span><span class="p">(</span><span class="n">QgsField</span><span class="p">(</span><span class="s2">&quot;mytext&quot;</span><span class="p">,</span> <span class="n">QVariant</span><span class="o">.</span><span class="n">String</span><span class="p">))</span>
<span class="linenos">22</span><span class="c1"># remove a field</span>
<span class="linenos">23</span><span class="n">layer</span><span class="o">.</span><span class="n">deleteAttribute</span><span class="p">(</span><span class="n">fieldIndex</span><span class="p">)</span>
</pre></div>
</div>
<p>取り消し／やり直しを適切に機能させるためには、上記のメソッド呼び出しを undo コマンドでラップしなければなりません。取り消し／やり直し機能が不要で、変更を即座に保存したい場合は、 <a class="reference internal" href="#editing"><span class="std std-ref">データプロバイダを使って編集</span></a> したほうが手軽でしょう。</p>
<p>取り消し機能を使用するには次のように行います。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="n">layer</span><span class="o">.</span><span class="n">beginEditCommand</span><span class="p">(</span><span class="s2">&quot;Feature triangulation&quot;</span><span class="p">)</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="c1"># ... call layer&#39;s editing methods ...</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="k">if</span> <span class="n">problem_occurred</span><span class="p">:</span>
<span class="linenos"> 6</span>  <span class="n">layer</span><span class="o">.</span><span class="n">destroyEditCommand</span><span class="p">()</span>
<span class="linenos"> 7</span>  <span class="c1"># ... tell the user that there was a problem</span>
<span class="linenos"> 8</span>  <span class="c1"># and return</span>
<span class="linenos"> 9</span>
<span class="linenos">10</span><span class="c1"># ... more editing ...</span>
<span class="linenos">11</span>
<span class="linenos">12</span><span class="n">layer</span><span class="o">.</span><span class="n">endEditCommand</span><span class="p">()</span>
</pre></div>
</div>
<p><a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsVectorLayer.html#qgis.core.QgsVectorLayer.beginEditCommand" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">beginEditCommand()</span></code></a> メソッドは内部的に「アクティブな」コマンドを生成し、ベクタレイヤでその後に起こる変化を記録し続けます。 <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsVectorLayer.html#qgis.core.QgsVectorLayer.endEditCommand" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">endEditCommand()</span></code></a> メソッドの呼び出しによって、コマンドはアンドゥスタックにプッシュされ、ユーザーがGUIから取り消し／やり直しをすることができるようになります。変更の最中に何か不具合が生じたときは、 <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsVectorLayer.html#qgis.core.QgsVectorLayer.destroyEditCommand" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">destroyEditCommand()</span></code></a> メソッドによってコマンドは削除され、コマンドがアクティブな間に行われたすべての変更はロールバックされます。</p>
<p>次の例に示すように、よりセマンティックなコードブロックにコミットとロールバックをラップする <code class="code docutils literal notranslate"><span class="pre">with</span> <span class="pre">edit(layer)</span></code> 文も使用できます。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">edit</span><span class="p">(</span><span class="n">layer</span><span class="p">):</span>
  <span class="n">feat</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">layer</span><span class="o">.</span><span class="n">getFeatures</span><span class="p">())</span>
  <span class="n">feat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>
  <span class="n">layer</span><span class="o">.</span><span class="n">updateFeature</span><span class="p">(</span><span class="n">feat</span><span class="p">)</span>
</pre></div>
</div>
<p>これは最後に <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsVectorLayer.html#qgis.core.QgsVectorLayer.commitChanges" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">commitChanges()</span></code></a> メソッドを自動的に呼び出します。もし何らかの例外が発生したときは、 <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsVectorLayer.html#qgis.core.QgsVectorLayer.rollBack" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">rollBack()</span></code></a> メソッドを呼び出してすべての変更をロールバックします。 <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsVectorLayer.html#qgis.core.QgsVectorLayer.commitChanges" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">commitChanges()</span></code></a> メソッドの実行の最中に問題に遭遇したとき（メソッドが False を返したとき）は、 <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsEditError.html#qgis.core.QgsEditError" title="(in QGIS Python API v3.34)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QgsEditError</span></code></a> 例外を送出します。</p>
</section>
<section id="adding-and-removing-fields">
<h3><a class="toc-backref" href="#id13" role="doc-backlink"><span class="section-number">6.4.5. </span>フィールドを追加または削除する</a><a class="headerlink" href="#adding-and-removing-fields" title="Link to this heading"></a></h3>
<p>フィールド（属性）を追加するには、フィールドの定義を配列で指定する必要があります。フィールドを削除するにはフィールドのインデックスを配列で渡すだけです。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="kn">from</span> <span class="nn">qgis.PyQt.QtCore</span> <span class="kn">import</span> <span class="n">QVariant</span>
<span class="linenos">2</span>
<span class="linenos">3</span><span class="k">if</span> <span class="n">caps</span> <span class="o">&amp;</span> <span class="n">QgsVectorDataProvider</span><span class="o">.</span><span class="n">AddAttributes</span><span class="p">:</span>
<span class="linenos">4</span>    <span class="n">res</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">dataProvider</span><span class="p">()</span><span class="o">.</span><span class="n">addAttributes</span><span class="p">(</span>
<span class="linenos">5</span>        <span class="p">[</span><span class="n">QgsField</span><span class="p">(</span><span class="s2">&quot;mytext&quot;</span><span class="p">,</span> <span class="n">QVariant</span><span class="o">.</span><span class="n">String</span><span class="p">),</span>
<span class="linenos">6</span>        <span class="n">QgsField</span><span class="p">(</span><span class="s2">&quot;myint&quot;</span><span class="p">,</span> <span class="n">QVariant</span><span class="o">.</span><span class="n">Int</span><span class="p">)])</span>
<span class="linenos">7</span>
<span class="linenos">8</span><span class="k">if</span> <span class="n">caps</span> <span class="o">&amp;</span> <span class="n">QgsVectorDataProvider</span><span class="o">.</span><span class="n">DeleteAttributes</span><span class="p">:</span>
<span class="linenos">9</span>    <span class="n">res</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">dataProvider</span><span class="p">()</span><span class="o">.</span><span class="n">deleteAttributes</span><span class="p">([</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1"># Alternate methods for removing fields</span>
<span class="linenos"> 2</span><span class="c1"># first create temporary fields to be removed (f1-3)</span>
<span class="linenos"> 3</span><span class="n">layer</span><span class="o">.</span><span class="n">dataProvider</span><span class="p">()</span><span class="o">.</span><span class="n">addAttributes</span><span class="p">([</span><span class="n">QgsField</span><span class="p">(</span><span class="s2">&quot;f1&quot;</span><span class="p">,</span><span class="n">QVariant</span><span class="o">.</span><span class="n">Int</span><span class="p">),</span><span class="n">QgsField</span><span class="p">(</span><span class="s2">&quot;f2&quot;</span><span class="p">,</span><span class="n">QVariant</span><span class="o">.</span><span class="n">Int</span><span class="p">),</span><span class="n">QgsField</span><span class="p">(</span><span class="s2">&quot;f3&quot;</span><span class="p">,</span><span class="n">QVariant</span><span class="o">.</span><span class="n">Int</span><span class="p">)])</span>
<span class="linenos"> 4</span><span class="n">layer</span><span class="o">.</span><span class="n">updateFields</span><span class="p">()</span>
<span class="linenos"> 5</span><span class="n">count</span><span class="o">=</span><span class="n">layer</span><span class="o">.</span><span class="n">fields</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="c1"># count of layer fields</span>
<span class="linenos"> 6</span><span class="n">ind_list</span><span class="o">=</span><span class="nb">list</span><span class="p">((</span><span class="n">count</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="n">count</span><span class="o">-</span><span class="mi">2</span><span class="p">))</span> <span class="c1"># create list</span>
<span class="linenos"> 7</span>
<span class="linenos"> 8</span><span class="c1"># remove a single field with an index</span>
<span class="linenos"> 9</span><span class="n">layer</span><span class="o">.</span><span class="n">dataProvider</span><span class="p">()</span><span class="o">.</span><span class="n">deleteAttributes</span><span class="p">([</span><span class="n">count</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="linenos">10</span>
<span class="linenos">11</span><span class="c1"># remove multiple fields with a list of indices</span>
<span class="linenos">12</span><span class="n">layer</span><span class="o">.</span><span class="n">dataProvider</span><span class="p">()</span><span class="o">.</span><span class="n">deleteAttributes</span><span class="p">(</span><span class="n">ind_list</span><span class="p">)</span>
</pre></div>
</div>
<p>データプロバイダのフィールドを追加または削除した後、レイヤのフィールドは、変更が自動的に反映されていないため、更新する必要があります。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">layer</span><span class="o">.</span><span class="n">updateFields</span><span class="p">()</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p><code class="docutils literal notranslate"><span class="pre">with</span></code> <strong>に基づくコマンドを使って変更を直接保存する</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">with</span> <span class="pre">edit(layer):</span></code> を使うと、最後に <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsVectorLayer.html#qgis.core.QgsVectorLayer.commitChanges" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">commitChanges()</span></code></a> を呼び出して自動的に変更がコミットされます。例外が発生した場合は、全ての変更を <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsVectorLayer.html#qgis.core.QgsVectorLayer.rollBack" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">rollBack()</span></code></a> します。<a class="reference internal" href="#editing-buffer"><span class="std std-ref">ベクタレイヤを編集バッファで修正する</span></a> を参照してください。</p>
</div>
</section>
</section>
<section id="using-spatial-index">
<span id="index-4"></span><h2><a class="toc-backref" href="#id14" role="doc-backlink"><span class="section-number">6.5. </span>空間インデックスを使う</a><a class="headerlink" href="#using-spatial-index" title="Link to this heading"></a></h2>
<p>空間インデックスは、頻繁にベクタレイヤに問い合わせをする必要がある場合、コードのパフォーマンスを劇的に改善します。例えば、補間アルゴリズムを書いていて、補間値の計算に使用するために与えられた位置に対して最も近い10点をポイントレイヤから求める必要がある、と想像してください。空間インデックスが無いと、QGISがこれらの10ポイントを求める方法は、すべてのポイントから指定の場所への距離を計算してそれらの距離を比較することしかありません。これは、いくつかの場所について繰り返す必要がある場合は特に、非常に時間のかかる処理となります。もし空間インデックスがレイヤに作成されていれば、処理はもっと効率的になります。</p>
<p>空間インデックスの無いレイヤは、電話番号が順番に並んでいない、もしくは索引の無い電話帳と思ってください。所定の人の電話番号を見つける唯一の方法は、巻頭からその番号を見つけるまで読むだけです。</p>
<p>空間インデックスは、QGISベクタレイヤに対してデフォルトでは作成されていませんが、簡単に作成できます。しなければいけないことはこうです：</p>
<ul>
<li><p><a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsSpatialIndex.html#qgis.core.QgsSpatialIndex" title="(in QGIS Python API v3.34)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QgsSpatialIndex</span></code></a> クラスを使用して空間インデックスを作成します：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">index</span> <span class="o">=</span> <span class="n">QgsSpatialIndex</span><span class="p">()</span>
</pre></div>
</div>
</li>
<li><p>インデックスに地物を追加します --- インデックスは <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsFeature.html#qgis.core.QgsFeature" title="(in QGIS Python API v3.34)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QgsFeature</span></code></a> オブジェクトを受け取り、内部のデータ構造に追加します。オブジェクトは手動で作成するか、プロバイダの <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsVectorDataProvider.html#qgis.core.QgsVectorDataProvider.getFeatures" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">getFeatures()</span></code></a> メソッドを過去に呼び出したときのものを使用することができます。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">index</span><span class="o">.</span><span class="n">addFeature</span><span class="p">(</span><span class="n">feat</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>代わりに、一括読み込みを使用してレイヤのすべての地物を一度に読み込むことができます</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">index</span> <span class="o">=</span> <span class="n">QgsSpatialIndex</span><span class="p">(</span><span class="n">layer</span><span class="o">.</span><span class="n">getFeatures</span><span class="p">())</span>
</pre></div>
</div>
</li>
<li><p>空間インデックスに何かしらの値が入れられると検索ができるようになります</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="c1"># returns array of feature IDs of five nearest features</span>
<span class="linenos">2</span><span class="n">nearest</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">nearestNeighbor</span><span class="p">(</span><span class="n">QgsPointXY</span><span class="p">(</span><span class="mf">25.4</span><span class="p">,</span> <span class="mf">12.7</span><span class="p">),</span> <span class="mi">5</span><span class="p">)</span>
<span class="linenos">3</span>
<span class="linenos">4</span><span class="c1"># returns array of IDs of features which intersect the rectangle</span>
<span class="linenos">5</span><span class="n">intersect</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">intersects</span><span class="p">(</span><span class="n">QgsRectangle</span><span class="p">(</span><span class="mf">22.5</span><span class="p">,</span> <span class="mf">15.3</span><span class="p">,</span> <span class="mf">23.1</span><span class="p">,</span> <span class="mf">17.2</span><span class="p">))</span>
</pre></div>
</div>
</li>
</ul>
<p>また、 <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsSpatialIndexKDBush.html#qgis.core.QgsSpatialIndexKDBush" title="(in QGIS Python API v3.34)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QgsSpatialIndexKDBush</span></code></a> 空間インデックスを使うこともできます。このインデックスは <em>標準</em> の <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsSpatialIndex.html#qgis.core.QgsSpatialIndex" title="(in QGIS Python API v3.34)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QgsSpatialIndex</span></code></a> と似ていますが:</p>
<ul class="simple">
<li><p>単独のポイント地物 <strong>だけ</strong> をサポートします</p></li>
<li><p>is <strong>static</strong> (no additional features can be added to the index after the
construction)</p></li>
<li><p><strong>とても高速です！</strong></p></li>
<li><p>追加の地物要求を必要とせず、元の地物のポイントを直接検索することができます</p></li>
<li><p>真の <em>距離ベース</em> の検索に対応しています。つまり検索点からある半径にあるすべての点を返します</p></li>
</ul>
</section>
<section id="the-qgsvectorlayerutils-class">
<span id="index-5"></span><h2><a class="toc-backref" href="#id15" role="doc-backlink"><span class="section-number">6.6. </span>QgsVectorLayerUtilsクラス</a><a class="headerlink" href="#the-qgsvectorlayerutils-class" title="Link to this heading"></a></h2>
<p><a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsVectorLayerUtils.html#qgis.core.QgsVectorLayerUtils" title="(in QGIS Python API v3.34)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QgsVectorLayerUtils</span></code></a> クラスには、ベクタレイヤで使用できる非常に便利なメソッドがいくつかあります。</p>
<p>例えば、 <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsVectorLayerUtils.html#qgis.core.QgsVectorLayerUtils.createFeature" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">createFeature()</span></code></a> メソッドは 、各フィールドのすべての最終的な制約とデフォルト値を保持してベクタレイヤに追加される <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsFeature.html#qgis.core.QgsFeature" title="(in QGIS Python API v3.34)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QgsFeature</span></code></a> を準備します:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">vlayer</span> <span class="o">=</span> <span class="n">QgsVectorLayer</span><span class="p">(</span><span class="s2">&quot;testdata/airports.shp&quot;</span><span class="p">,</span> <span class="s2">&quot;airports&quot;</span><span class="p">,</span> <span class="s2">&quot;ogr&quot;</span><span class="p">)</span>
<span class="n">feat</span> <span class="o">=</span> <span class="n">QgsVectorLayerUtils</span><span class="o">.</span><span class="n">createFeature</span><span class="p">(</span><span class="n">vlayer</span><span class="p">)</span>
</pre></div>
</div>
<p><a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsVectorLayerUtils.html#qgis.core.QgsVectorLayerUtils.getValues" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">getValues()</span></code></a> メソッドは、フィールドや式の値を素早く取得することができます:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="n">vlayer</span> <span class="o">=</span> <span class="n">QgsVectorLayer</span><span class="p">(</span><span class="s2">&quot;testdata/airports.shp&quot;</span><span class="p">,</span> <span class="s2">&quot;airports&quot;</span><span class="p">,</span> <span class="s2">&quot;ogr&quot;</span><span class="p">)</span>
<span class="linenos">2</span><span class="c1"># select only the first feature to make the output shorter</span>
<span class="linenos">3</span><span class="n">vlayer</span><span class="o">.</span><span class="n">selectByIds</span><span class="p">([</span><span class="mi">1</span><span class="p">])</span>
<span class="linenos">4</span><span class="n">val</span> <span class="o">=</span> <span class="n">QgsVectorLayerUtils</span><span class="o">.</span><span class="n">getValues</span><span class="p">(</span><span class="n">vlayer</span><span class="p">,</span> <span class="s2">&quot;NAME&quot;</span><span class="p">,</span> <span class="n">selectedOnly</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos">5</span><span class="nb">print</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>([&#39;AMBLER&#39;], True)
</pre></div>
</div>
</section>
<section id="creating-vector-layers">
<span id="index-6"></span><h2><a class="toc-backref" href="#id16" role="doc-backlink"><span class="section-number">6.7. </span>ベクタレイヤを作る</a><a class="headerlink" href="#creating-vector-layers" title="Link to this heading"></a></h2>
<p>ベクタレイヤデータセットを作るには幾つかの方法があります:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsVectorFileWriter.html#qgis.core.QgsVectorFileWriter" title="(in QGIS Python API v3.34)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QgsVectorFileWriter</span></code></a> クラス: ディスクにベクタファイルを書き込むための便利なクラスです。ベクタレイヤ全体を保存する <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsVectorFileWriter.html#qgis.core.QgsVectorFileWriter.writeAsVectorFormatV3" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">writeAsVectorFormatV3()</span></code></a> への静的呼び出しか、このクラスのインスタンスを作成して <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsVectorFileWriter.html#qgis.core.QgsVectorFileWriter.addFeature" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">addFeature()</span></code></a> への呼び出しのどちらかを使います。このクラスは、GDALがサポートする全てのベクタ形式（GeoPackage、Shapefile、GeoJSON、KML、その他）をサポートします。</p></li>
<li><p><a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsVectorLayer.html#qgis.core.QgsVectorLayer" title="(in QGIS Python API v3.34)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QgsVectorLayer</span></code></a> クラス: データプロバイダーをインスタンス化し、データソースのパス (url) を解釈してデータに接続しアクセスします。一時的なメモリベースのレイヤ (<code class="docutils literal notranslate"><span class="pre">memory</span></code>) を作成し、GDAL ベクタデータセット (<code class="docutils literal notranslate"><span class="pre">ogr</span></code>) やデータベース (<code class="docutils literal notranslate"><span class="pre">postgres</span></code>, <code class="docutils literal notranslate"><span class="pre">spatialite</span></code>, <code class="docutils literal notranslate"><span class="pre">mysql</span></code>, <code class="docutils literal notranslate"><span class="pre">mssql</span></code>) など (<code class="docutils literal notranslate"><span class="pre">wfs`,</span> <span class="pre">``gpx</span></code>, <code class="docutils literal notranslate"><span class="pre">delimitedtext</span></code>...)へ接続するために使用することが出来ます。</p></li>
</ul>
<section id="from-an-instance-of-qgsvectorfilewriter">
<h3><a class="toc-backref" href="#id17" role="doc-backlink"><span class="section-number">6.7.1. </span><a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsVectorFileWriter.html#qgis.core.QgsVectorFileWriter" title="(in QGIS Python API v3.34)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QgsVectorFileWriter</span></code></a> のインスタンスから</a><a class="headerlink" href="#from-an-instance-of-qgsvectorfilewriter" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1"># SaveVectorOptions contains many settings for the writer process</span>
<span class="linenos"> 2</span><span class="n">save_options</span> <span class="o">=</span> <span class="n">QgsVectorFileWriter</span><span class="o">.</span><span class="n">SaveVectorOptions</span><span class="p">()</span>
<span class="linenos"> 3</span><span class="n">transform_context</span> <span class="o">=</span> <span class="n">QgsProject</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span><span class="o">.</span><span class="n">transformContext</span><span class="p">()</span>
<span class="linenos"> 4</span><span class="c1"># Write to a GeoPackage (default)</span>
<span class="linenos"> 5</span><span class="n">error</span> <span class="o">=</span> <span class="n">QgsVectorFileWriter</span><span class="o">.</span><span class="n">writeAsVectorFormatV3</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span>
<span class="linenos"> 6</span>                                                  <span class="s2">&quot;testdata/my_new_file.gpkg&quot;</span><span class="p">,</span>
<span class="linenos"> 7</span>                                                  <span class="n">transform_context</span><span class="p">,</span>
<span class="linenos"> 8</span>                                                  <span class="n">save_options</span><span class="p">)</span>
<span class="linenos"> 9</span><span class="k">if</span> <span class="n">error</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">QgsVectorFileWriter</span><span class="o">.</span><span class="n">NoError</span><span class="p">:</span>
<span class="linenos">10</span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;success!&quot;</span><span class="p">)</span>
<span class="linenos">11</span><span class="k">else</span><span class="p">:</span>
<span class="linenos">12</span>  <span class="nb">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1"># Write to an ESRI Shapefile format dataset using UTF-8 text encoding</span>
<span class="linenos"> 2</span><span class="n">save_options</span> <span class="o">=</span> <span class="n">QgsVectorFileWriter</span><span class="o">.</span><span class="n">SaveVectorOptions</span><span class="p">()</span>
<span class="linenos"> 3</span><span class="n">save_options</span><span class="o">.</span><span class="n">driverName</span> <span class="o">=</span> <span class="s2">&quot;ESRI Shapefile&quot;</span>
<span class="linenos"> 4</span><span class="n">save_options</span><span class="o">.</span><span class="n">fileEncoding</span> <span class="o">=</span> <span class="s2">&quot;UTF-8&quot;</span>
<span class="linenos"> 5</span><span class="n">transform_context</span> <span class="o">=</span> <span class="n">QgsProject</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span><span class="o">.</span><span class="n">transformContext</span><span class="p">()</span>
<span class="linenos"> 6</span><span class="n">error</span> <span class="o">=</span> <span class="n">QgsVectorFileWriter</span><span class="o">.</span><span class="n">writeAsVectorFormatV3</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span>
<span class="linenos"> 7</span>                                                  <span class="s2">&quot;testdata/my_new_shapefile&quot;</span><span class="p">,</span>
<span class="linenos"> 8</span>                                                  <span class="n">transform_context</span><span class="p">,</span>
<span class="linenos"> 9</span>                                                  <span class="n">save_options</span><span class="p">)</span>
<span class="linenos">10</span><span class="k">if</span> <span class="n">error</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">QgsVectorFileWriter</span><span class="o">.</span><span class="n">NoError</span><span class="p">:</span>
<span class="linenos">11</span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;success again!&quot;</span><span class="p">)</span>
<span class="linenos">12</span><span class="k">else</span><span class="p">:</span>
<span class="linenos">13</span>  <span class="nb">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1"># Write to an ESRI GDB file</span>
<span class="linenos"> 2</span><span class="n">save_options</span> <span class="o">=</span> <span class="n">QgsVectorFileWriter</span><span class="o">.</span><span class="n">SaveVectorOptions</span><span class="p">()</span>
<span class="linenos"> 3</span><span class="n">save_options</span><span class="o">.</span><span class="n">driverName</span> <span class="o">=</span> <span class="s2">&quot;FileGDB&quot;</span>
<span class="linenos"> 4</span><span class="c1"># if no geometry</span>
<span class="linenos"> 5</span><span class="n">save_options</span><span class="o">.</span><span class="n">overrideGeometryType</span> <span class="o">=</span> <span class="n">QgsWkbTypes</span><span class="o">.</span><span class="n">Unknown</span>
<span class="linenos"> 6</span><span class="n">save_options</span><span class="o">.</span><span class="n">actionOnExistingFile</span> <span class="o">=</span> <span class="n">QgsVectorFileWriter</span><span class="o">.</span><span class="n">CreateOrOverwriteLayer</span>
<span class="linenos"> 7</span><span class="n">save_options</span><span class="o">.</span><span class="n">layerName</span> <span class="o">=</span> <span class="s1">&#39;my_new_layer_name&#39;</span>
<span class="linenos"> 8</span><span class="n">transform_context</span> <span class="o">=</span> <span class="n">QgsProject</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span><span class="o">.</span><span class="n">transformContext</span><span class="p">()</span>
<span class="linenos"> 9</span><span class="n">gdb_path</span> <span class="o">=</span> <span class="s2">&quot;testdata/my_example.gdb&quot;</span>
<span class="linenos">10</span><span class="n">error</span> <span class="o">=</span> <span class="n">QgsVectorFileWriter</span><span class="o">.</span><span class="n">writeAsVectorFormatV3</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span>
<span class="linenos">11</span>                                                <span class="n">gdb_path</span><span class="p">,</span>
<span class="linenos">12</span>                                                <span class="n">transform_context</span><span class="p">,</span>
<span class="linenos">13</span>                                                <span class="n">save_options</span><span class="p">)</span>
<span class="linenos">14</span><span class="k">if</span> <span class="n">error</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">QgsVectorFileWriter</span><span class="o">.</span><span class="n">NoError</span><span class="p">:</span>
<span class="linenos">15</span>  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;success!&quot;</span><span class="p">)</span>
<span class="linenos">16</span><span class="k">else</span><span class="p">:</span>
<span class="linenos">17</span>  <span class="nb">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
</pre></div>
</div>
<p>また、 <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsVectorFileWriter.html#qgis.core.QgsVectorFileWriter.FieldValueConverter" title="(in QGIS Python API v3.34)"><code class="xref py py-class docutils literal notranslate"><span class="pre">FieldValueConverter</span></code></a> を使って、異なる形式と互換性を持つようにフィールドを変換できます。例えば、配列の変数型（Postgresなど）をテキスト型に変換する場合は、以下のようにします:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="n">LIST_FIELD_NAME</span> <span class="o">=</span> <span class="s1">&#39;xxxx&#39;</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="k">class</span> <span class="nc">ESRIValueConverter</span><span class="p">(</span><span class="n">QgsVectorFileWriter</span><span class="o">.</span><span class="n">FieldValueConverter</span><span class="p">):</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layer</span><span class="p">,</span> <span class="n">list_field</span><span class="p">):</span>
<span class="linenos"> 6</span>    <span class="n">QgsVectorFileWriter</span><span class="o">.</span><span class="n">FieldValueConverter</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
<span class="linenos"> 7</span>    <span class="bp">self</span><span class="o">.</span><span class="n">layer</span> <span class="o">=</span> <span class="n">layer</span>
<span class="linenos"> 8</span>    <span class="bp">self</span><span class="o">.</span><span class="n">list_field_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">layer</span><span class="o">.</span><span class="n">fields</span><span class="p">()</span><span class="o">.</span><span class="n">indexFromName</span><span class="p">(</span><span class="n">list_field</span><span class="p">)</span>
<span class="linenos"> 9</span>
<span class="linenos">10</span>  <span class="k">def</span> <span class="nf">convert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fieldIdxInLayer</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="linenos">11</span>    <span class="k">if</span> <span class="n">fieldIdxInLayer</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_field_idx</span><span class="p">:</span>
<span class="linenos">12</span>      <span class="k">return</span> <span class="n">QgsListFieldFormatter</span><span class="p">()</span><span class="o">.</span><span class="n">representValue</span><span class="p">(</span><span class="n">layer</span><span class="o">=</span><span class="n">vlayer</span><span class="p">,</span>
<span class="linenos">13</span>                                                    <span class="n">fieldIndex</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">list_field_idx</span><span class="p">,</span>
<span class="linenos">14</span>                                                    <span class="n">config</span><span class="o">=</span><span class="p">{},</span>
<span class="linenos">15</span>                                                    <span class="n">cache</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="linenos">16</span>                                                    <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">)</span>
<span class="linenos">17</span>    <span class="k">else</span><span class="p">:</span>
<span class="linenos">18</span>      <span class="k">return</span> <span class="n">value</span>
<span class="linenos">19</span>
<span class="linenos">20</span>  <span class="k">def</span> <span class="nf">fieldDefinition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">):</span>
<span class="linenos">21</span>    <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">layer</span><span class="o">.</span><span class="n">fields</span><span class="p">()</span><span class="o">.</span><span class="n">indexFromName</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">())</span>
<span class="linenos">22</span>    <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_field_idx</span><span class="p">:</span>
<span class="linenos">23</span>      <span class="k">return</span> <span class="n">QgsField</span><span class="p">(</span><span class="n">LIST_FIELD_NAME</span><span class="p">,</span> <span class="n">QVariant</span><span class="o">.</span><span class="n">String</span><span class="p">)</span>
<span class="linenos">24</span>    <span class="k">else</span><span class="p">:</span>
<span class="linenos">25</span>      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">layer</span><span class="o">.</span><span class="n">fields</span><span class="p">()[</span><span class="n">idx</span><span class="p">]</span>
<span class="linenos">26</span>
<span class="linenos">27</span><span class="n">converter</span> <span class="o">=</span> <span class="n">ESRIValueConverter</span><span class="p">(</span><span class="n">vlayer</span><span class="p">,</span> <span class="n">LIST_FIELD_NAME</span><span class="p">)</span>
<span class="linenos">28</span><span class="n">opts</span> <span class="o">=</span> <span class="n">QgsVectorFileWriter</span><span class="o">.</span><span class="n">SaveVectorOptions</span><span class="p">()</span>
<span class="linenos">29</span><span class="n">opts</span><span class="o">.</span><span class="n">fieldValueConverter</span> <span class="o">=</span> <span class="n">converter</span>
</pre></div>
</div>
<p>デスティネーションCRSを指定することもできます --  <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsCoordinateReferenceSystem.html#qgis.core.QgsCoordinateReferenceSystem" title="(in QGIS Python API v3.34)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QgsCoordinateReferenceSystem</span></code></a> の有効なインスタンスが第4パラメータとして渡された場合、レイヤはそのCRSに変換されます。</p>
<p>有効なドライバ名については、 <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsVectorFileWriter.html#qgis.core.QgsVectorFileWriter.supportedFiltersAndFormats" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">supportedFiltersAndFormats()</span></code></a> メソッドを呼ぶか、‘OGRのサポートフォーマットを参照してください`_ --- &quot;Code&quot; 列にドライバ名として値を渡す必要があります。</p>
<p>オプションとして、選択された地物のみをエクスポートするかどうか、作成時にさらにドライバ固有のオプションを渡すか、ライターに属性を作成しないように指示するかどうかを設定できます... その他にもたくさんの（オプション）パラメータがあります; 詳細は <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsVectorFileWriter.html#qgis.core.QgsVectorFileWriter" title="(in QGIS Python API v3.34)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QgsVectorFileWriter</span></code></a> のドキュメントを参照してください。</p>
</section>
<section id="directly-from-features">
<h3><a class="toc-backref" href="#id18" role="doc-backlink"><span class="section-number">6.7.2. </span>地物から直接</a><a class="headerlink" href="#directly-from-features" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">from</span> <span class="nn">qgis.PyQt.QtCore</span> <span class="kn">import</span> <span class="n">QVariant</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="c1"># define fields for feature attributes. A QgsFields object is needed</span>
<span class="linenos"> 4</span><span class="n">fields</span> <span class="o">=</span> <span class="n">QgsFields</span><span class="p">()</span>
<span class="linenos"> 5</span><span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">QgsField</span><span class="p">(</span><span class="s2">&quot;first&quot;</span><span class="p">,</span> <span class="n">QVariant</span><span class="o">.</span><span class="n">Int</span><span class="p">))</span>
<span class="linenos"> 6</span><span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">QgsField</span><span class="p">(</span><span class="s2">&quot;second&quot;</span><span class="p">,</span> <span class="n">QVariant</span><span class="o">.</span><span class="n">String</span><span class="p">))</span>
<span class="linenos"> 7</span>
<span class="linenos"> 8</span><span class="sd">&quot;&quot;&quot; create an instance of vector file writer, which will create the vector file.</span>
<span class="linenos"> 9</span><span class="sd">Arguments:</span>
<span class="linenos">10</span><span class="sd">1. path to new file (will fail if exists already)</span>
<span class="linenos">11</span><span class="sd">2. field map</span>
<span class="linenos">12</span><span class="sd">3. geometry type - from WKBTYPE enum</span>
<span class="linenos">13</span><span class="sd">4. layer&#39;s spatial reference (instance of</span>
<span class="linenos">14</span><span class="sd">   QgsCoordinateReferenceSystem)</span>
<span class="linenos">15</span><span class="sd">5. coordinate transform context</span>
<span class="linenos">16</span><span class="sd">6. save options (driver name for the output file, encoding etc.)</span>
<span class="linenos">17</span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">18</span>
<span class="linenos">19</span><span class="n">crs</span> <span class="o">=</span> <span class="n">QgsProject</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span><span class="o">.</span><span class="n">crs</span><span class="p">()</span>
<span class="linenos">20</span><span class="n">transform_context</span> <span class="o">=</span> <span class="n">QgsProject</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span><span class="o">.</span><span class="n">transformContext</span><span class="p">()</span>
<span class="linenos">21</span><span class="n">save_options</span> <span class="o">=</span> <span class="n">QgsVectorFileWriter</span><span class="o">.</span><span class="n">SaveVectorOptions</span><span class="p">()</span>
<span class="linenos">22</span><span class="n">save_options</span><span class="o">.</span><span class="n">driverName</span> <span class="o">=</span> <span class="s2">&quot;ESRI Shapefile&quot;</span>
<span class="linenos">23</span><span class="n">save_options</span><span class="o">.</span><span class="n">fileEncoding</span> <span class="o">=</span> <span class="s2">&quot;UTF-8&quot;</span>
<span class="linenos">24</span>
<span class="linenos">25</span><span class="n">writer</span> <span class="o">=</span> <span class="n">QgsVectorFileWriter</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
<span class="linenos">26</span>  <span class="s2">&quot;testdata/my_new_shapefile.shp&quot;</span><span class="p">,</span>
<span class="linenos">27</span>  <span class="n">fields</span><span class="p">,</span>
<span class="linenos">28</span>  <span class="n">QgsWkbTypes</span><span class="o">.</span><span class="n">Point</span><span class="p">,</span>
<span class="linenos">29</span>  <span class="n">crs</span><span class="p">,</span>
<span class="linenos">30</span>  <span class="n">transform_context</span><span class="p">,</span>
<span class="linenos">31</span>  <span class="n">save_options</span>
<span class="linenos">32</span><span class="p">)</span>
<span class="linenos">33</span>
<span class="linenos">34</span><span class="k">if</span> <span class="n">writer</span><span class="o">.</span><span class="n">hasError</span><span class="p">()</span> <span class="o">!=</span> <span class="n">QgsVectorFileWriter</span><span class="o">.</span><span class="n">NoError</span><span class="p">:</span>
<span class="linenos">35</span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error when creating shapefile: &quot;</span><span class="p">,</span>  <span class="n">writer</span><span class="o">.</span><span class="n">errorMessage</span><span class="p">())</span>
<span class="linenos">36</span>
<span class="linenos">37</span><span class="c1"># add a feature</span>
<span class="linenos">38</span><span class="n">fet</span> <span class="o">=</span> <span class="n">QgsFeature</span><span class="p">()</span>
<span class="linenos">39</span>
<span class="linenos">40</span><span class="n">fet</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QgsGeometry</span><span class="o">.</span><span class="n">fromPointXY</span><span class="p">(</span><span class="n">QgsPointXY</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">)))</span>
<span class="linenos">41</span><span class="n">fet</span><span class="o">.</span><span class="n">setAttributes</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">])</span>
<span class="linenos">42</span><span class="n">writer</span><span class="o">.</span><span class="n">addFeature</span><span class="p">(</span><span class="n">fet</span><span class="p">)</span>
<span class="linenos">43</span>
<span class="linenos">44</span><span class="c1"># delete the writer to flush features to disk</span>
<span class="linenos">45</span><span class="k">del</span> <span class="n">writer</span>
</pre></div>
</div>
</section>
<section id="from-an-instance-of-qgsvectorlayer">
<span id="index-7"></span><h3><a class="toc-backref" href="#id19" role="doc-backlink"><span class="section-number">6.7.3. </span><a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsVectorLayer.html#qgis.core.QgsVectorLayer" title="(in QGIS Python API v3.34)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QgsVectorLayer</span></code></a> クラスのインスタンスから作成する</a><a class="headerlink" href="#from-an-instance-of-qgsvectorlayer" title="Link to this heading"></a></h3>
<p><a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsVectorLayer.html#qgis.core.QgsVectorLayer" title="(in QGIS Python API v3.34)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QgsVectorLayer</span></code></a> クラスによってサポートされているすべてのデータプロバイダのうちから、ここではメモリレイヤに焦点をあてましょう。メモリプロバイダは主にプラグインやサードパーティ製アプリの開発者に使われることを意図しています。ディスクにデータを格納することをしないため、開発者はなんらかの一時的なレイヤのための手っ取り早いバックエンドとしてこれを使うことができます。</p>
<p>このプロバイダは属性フィールドの型として string、int、double をサポートします。</p>
<p>メモリプロバイダは空間インデックスもサポートしています。これはプロバイダの <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsVectorDataProvider.html#qgis.core.QgsVectorDataProvider.createSpatialIndex" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">createSpatialIndex()</span></code></a> 関数を呼び出すことによって有効になります。空間インデックスが作成されると、複数の地物にわたって行う処理を、より小さな領域内でより速く行うことができます。これはあらためて地物すべてを走査する必要がなく、指定された領域内のみを走査すればよいからです。</p>
<p>メモリプロバイダは <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsVectorLayer.html#qgis.core.QgsVectorLayer" title="(in QGIS Python API v3.34)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QgsVectorLayer</span></code></a> コンストラクタにプロバイダ文字列として <code class="docutils literal notranslate"><span class="pre">&quot;memory&quot;</span></code> を渡すと作ることができます。</p>
<p>コンストラクタはレイヤのジオメトリタイプを定義するURIも必要とします。これは <code class="docutils literal notranslate"><span class="pre">&quot;Point&quot;</span></code>、<code class="docutils literal notranslate"><span class="pre">&quot;LineString&quot;</span></code>、<code class="docutils literal notranslate"><span class="pre">&quot;Polygon&quot;</span></code>、<code class="docutils literal notranslate"><span class="pre">&quot;MultiPoint&quot;</span></code>、<code class="docutils literal notranslate"><span class="pre">&quot;MultiLineString&quot;</span></code>、<code class="docutils literal notranslate"><span class="pre">&quot;MultiPolygon&quot;</span></code>、<a href="#id1"><span class="problematic" id="id2">``</span></a>&quot;None&quot;<a href="#id3"><span class="problematic" id="id4">``</span></a>のうちのひとつです。</p>
<p>URIではメモリプロバイダの座標参照系、属性フィールド、URI内でのメモリプロバイダのインデックスも指定できます。構文は、</p>
<dl class="simple">
<dt>crs=definition</dt><dd><p>座標参照系を指定します。定義には <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsCoordinateReferenceSystem.html#qgis.core.QgsCoordinateReferenceSystem.createFromString" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">QgsCoordinateReferenceSystem.createFromString()</span></code></a> で受け入れられる形式のいずれかを使用できます。</p>
</dd>
<dt>index=yes</dt><dd><p>プロバイダが空間インデックスを使うように指定します。</p>
</dd>
<dt>field=name:type(length,precision)</dt><dd><p>レイヤの属性を指定します。属性は名前を持ち、オプションとして型(integer, double, string)、長さ、および精度を持ちます。フィールドの定義は複数あってかまいません。</p>
</dd>
</dl>
<p>次のサンプルは全てのこれらのオプションを含んだURLです:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;Point?crs=epsg:4326&amp;field=id:integer&amp;field=name:string(20)&amp;index=yes&quot;</span>
</pre></div>
</div>
<p>次のサンプルコードは、メモリプロバイダの作成と投入について説明しています</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">from</span> <span class="nn">qgis.PyQt.QtCore</span> <span class="kn">import</span> <span class="n">QVariant</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="c1"># create layer</span>
<span class="linenos"> 4</span><span class="n">vl</span> <span class="o">=</span> <span class="n">QgsVectorLayer</span><span class="p">(</span><span class="s2">&quot;Point&quot;</span><span class="p">,</span> <span class="s2">&quot;temporary_points&quot;</span><span class="p">,</span> <span class="s2">&quot;memory&quot;</span><span class="p">)</span>
<span class="linenos"> 5</span><span class="n">pr</span> <span class="o">=</span> <span class="n">vl</span><span class="o">.</span><span class="n">dataProvider</span><span class="p">()</span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span><span class="c1"># add fields</span>
<span class="linenos"> 8</span><span class="n">pr</span><span class="o">.</span><span class="n">addAttributes</span><span class="p">([</span><span class="n">QgsField</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">QVariant</span><span class="o">.</span><span class="n">String</span><span class="p">),</span>
<span class="linenos"> 9</span>                    <span class="n">QgsField</span><span class="p">(</span><span class="s2">&quot;age&quot;</span><span class="p">,</span>  <span class="n">QVariant</span><span class="o">.</span><span class="n">Int</span><span class="p">),</span>
<span class="linenos">10</span>                    <span class="n">QgsField</span><span class="p">(</span><span class="s2">&quot;size&quot;</span><span class="p">,</span> <span class="n">QVariant</span><span class="o">.</span><span class="n">Double</span><span class="p">)])</span>
<span class="linenos">11</span><span class="n">vl</span><span class="o">.</span><span class="n">updateFields</span><span class="p">()</span> <span class="c1"># tell the vector layer to fetch changes from the provider</span>
<span class="linenos">12</span>
<span class="linenos">13</span><span class="c1"># add a feature</span>
<span class="linenos">14</span><span class="n">fet</span> <span class="o">=</span> <span class="n">QgsFeature</span><span class="p">()</span>
<span class="linenos">15</span><span class="n">fet</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QgsGeometry</span><span class="o">.</span><span class="n">fromPointXY</span><span class="p">(</span><span class="n">QgsPointXY</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">)))</span>
<span class="linenos">16</span><span class="n">fet</span><span class="o">.</span><span class="n">setAttributes</span><span class="p">([</span><span class="s2">&quot;Johny&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">])</span>
<span class="linenos">17</span><span class="n">pr</span><span class="o">.</span><span class="n">addFeatures</span><span class="p">([</span><span class="n">fet</span><span class="p">])</span>
<span class="linenos">18</span>
<span class="linenos">19</span><span class="c1"># update layer&#39;s extent when new features have been added</span>
<span class="linenos">20</span><span class="c1"># because change of extent in provider is not propagated to the layer</span>
<span class="linenos">21</span><span class="n">vl</span><span class="o">.</span><span class="n">updateExtents</span><span class="p">()</span>
</pre></div>
</div>
<p>最後に、全てうまくいったかどうか確認しましょう</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1"># show some stats</span>
<span class="linenos"> 2</span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;fields:&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">pr</span><span class="o">.</span><span class="n">fields</span><span class="p">()))</span>
<span class="linenos"> 3</span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;features:&quot;</span><span class="p">,</span> <span class="n">pr</span><span class="o">.</span><span class="n">featureCount</span><span class="p">())</span>
<span class="linenos"> 4</span><span class="n">e</span> <span class="o">=</span> <span class="n">vl</span><span class="o">.</span><span class="n">extent</span><span class="p">()</span>
<span class="linenos"> 5</span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;extent:&quot;</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">xMinimum</span><span class="p">(),</span> <span class="n">e</span><span class="o">.</span><span class="n">yMinimum</span><span class="p">(),</span> <span class="n">e</span><span class="o">.</span><span class="n">xMaximum</span><span class="p">(),</span> <span class="n">e</span><span class="o">.</span><span class="n">yMaximum</span><span class="p">())</span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span><span class="c1"># iterate over features</span>
<span class="linenos"> 8</span><span class="n">features</span> <span class="o">=</span> <span class="n">vl</span><span class="o">.</span><span class="n">getFeatures</span><span class="p">()</span>
<span class="linenos"> 9</span><span class="k">for</span> <span class="n">fet</span> <span class="ow">in</span> <span class="n">features</span><span class="p">:</span>
<span class="linenos">10</span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;F:&quot;</span><span class="p">,</span> <span class="n">fet</span><span class="o">.</span><span class="n">id</span><span class="p">(),</span> <span class="n">fet</span><span class="o">.</span><span class="n">attributes</span><span class="p">(),</span> <span class="n">fet</span><span class="o">.</span><span class="n">geometry</span><span class="p">()</span><span class="o">.</span><span class="n">asPoint</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>fields: 3
features: 1
extent: 10.0 10.0 10.0 10.0
F: 1 [&#39;Johny&#39;, 2, 0.3] &lt;QgsPointXY: POINT(10 10)&gt;
</pre></div>
</div>
</section>
</section>
<section id="appearance-symbology-of-vector-layers">
<span id="index-8"></span><h2><a class="toc-backref" href="#id20" role="doc-backlink"><span class="section-number">6.8. </span>ベクタレイヤの表現(シンボロジ)</a><a class="headerlink" href="#appearance-symbology-of-vector-layers" title="Link to this heading"></a></h2>
<p>ベクタレイヤがレンダリングされるとき、データの表現はレイヤに関連付けられた <strong>レンダラー</strong> と <strong>シンボル</strong> によって決定されます。シンボルは地物の視覚的表現を処理するクラスで、レンダラはそれぞれの地物でどのシンボルが使われるかを決定します。</p>
<p>指定したレイヤのレンダラは、以下のように取得することができます:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">renderer</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">renderer</span><span class="p">()</span>
</pre></div>
</div>
<p>この参照を利用して、少しだけ探索してみましょう:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Type:&quot;</span><span class="p">,</span> <span class="n">renderer</span><span class="o">.</span><span class="n">type</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Type: singleSymbol
</pre></div>
</div>
<p>QGISのコアライブラリには、いくつかの既知のレンダラータイプが用意されています:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>タイプ</p></th>
<th class="head"><p>クラス</p></th>
<th class="head"><p>詳細</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>singleSymbol</p></td>
<td><p><a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsSingleSymbolRenderer.html#qgis.core.QgsSingleSymbolRenderer" title="(in QGIS Python API v3.34)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QgsSingleSymbolRenderer</span></code></a></p></td>
<td><p>単一シンボル。全ての地物を同じシンボルでレンダリングします</p></td>
</tr>
<tr class="row-odd"><td><p>categorizedSymbol</p></td>
<td><p><a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsCategorizedSymbolRenderer.html#qgis.core.QgsCategorizedSymbolRenderer" title="(in QGIS Python API v3.34)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QgsCategorizedSymbolRenderer</span></code></a></p></td>
<td><p>カテゴリごとに違うシンボルを使って地物をレンダリングします</p></td>
</tr>
<tr class="row-even"><td><p>graduatedSymbol</p></td>
<td><p><a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsGraduatedSymbolRenderer.html#qgis.core.QgsGraduatedSymbolRenderer" title="(in QGIS Python API v3.34)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QgsGraduatedSymbolRenderer</span></code></a></p></td>
<td><p>段階に分けられたシンボル。それぞれの範囲の値によって違うシンボルを使って地物をレンダリングします</p></td>
</tr>
</tbody>
</table>
<p>カスタムレンダラータイプもあるかもしれないので、これらのタイプだけだと決めつけないようにしてください。アプリケーションの <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsRendererRegistry.html#qgis.core.QgsRendererRegistry" title="(in QGIS Python API v3.34)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QgsRendererRegistry</span></code></a> に問い合わせれば、現在利用できるレンダラーを調べることができます:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">QgsApplication</span><span class="o">.</span><span class="n">rendererRegistry</span><span class="p">()</span><span class="o">.</span><span class="n">renderersList</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[&#39;nullSymbol&#39;, &#39;singleSymbol&#39;, &#39;categorizedSymbol&#39;, &#39;graduatedSymbol&#39;, &#39;RuleRenderer&#39;, &#39;pointDisplacement&#39;, &#39;pointCluster&#39;, &#39;mergedFeatureRenderer&#39;, &#39;invertedPolygonRenderer&#39;, &#39;heatmapRenderer&#39;, &#39;25dRenderer&#39;, &#39;embeddedSymbol&#39;]
</pre></div>
</div>
<p>レンダラーの中身をテキストフォームにダンプできます --- デバッグ時に役に立つでしょう:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">renderer</span><span class="o">.</span><span class="n">dump</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">SINGLE</span><span class="p">:</span> <span class="n">MARKER</span> <span class="n">SYMBOL</span> <span class="p">(</span><span class="mi">1</span> <span class="n">layers</span><span class="p">)</span> <span class="n">color</span> <span class="mi">190</span><span class="p">,</span><span class="mi">207</span><span class="p">,</span><span class="mi">80</span><span class="p">,</span><span class="mi">255</span>
</pre></div>
</div>
<section id="single-symbol-renderer">
<span id="index-9"></span><h3><a class="toc-backref" href="#id21" role="doc-backlink"><span class="section-number">6.8.1. </span>単一シンボルレンダラー</a><a class="headerlink" href="#single-symbol-renderer" title="Link to this heading"></a></h3>
<p>レンダリングに使用されるシンボルは <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsSingleSymbolRenderer.html#qgis.core.QgsSingleSymbolRenderer.symbol" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">symbol()</span></code></a> メソッドで取得し、 <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsSingleSymbolRenderer.html#qgis.core.QgsSingleSymbolRenderer.setSymbol" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">setSymbol()</span></code></a> メソッドで変更できます（C++開発者向け注意：レンダラーがシンボルを所有することになります。）</p>
<p>特定のベクタレイヤで使用されるシンボルは、 <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsSingleSymbolRenderer.html#qgis.core.QgsSingleSymbolRenderer.setSymbol" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">setSymbol()</span></code></a> に該当するシンボルのインスタンスを渡して呼び出すことで変更できます。<em>ポイント</em>、<em>ライン</em>、<em>ポリゴン</em> レイヤのシンボルは、対応するクラス <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsMarkerSymbol.html#qgis.core.QgsMarkerSymbol" title="(in QGIS Python API v3.34)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QgsMarkerSymbol</span></code></a>, <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsLineSymbol.html#qgis.core.QgsLineSymbol" title="(in QGIS Python API v3.34)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QgsLineSymbol</span></code></a>, <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsFillSymbol.html#qgis.core.QgsFillSymbol" title="(in QGIS Python API v3.34)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QgsFillSymbol</span></code></a> の <code class="xref py py-meth docutils literal notranslate"><span class="pre">createSimple()</span></code> 関数を呼び出して作成することができます。</p>
<p><a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsMarkerSymbol.html#qgis.core.QgsMarkerSymbol.createSimple" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">createSimple()</span></code></a> に渡す辞書は、シンボルのスタイルプロパティを設定します。</p>
<p>例えば、次のコード例のように <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsSingleSymbolRenderer.html#qgis.core.QgsSingleSymbolRenderer.setSymbol" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">setSymbol()</span></code></a> に <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsMarkerSymbol.html#qgis.core.QgsMarkerSymbol" title="(in QGIS Python API v3.34)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QgsMarkerSymbol</span></code></a> を渡して呼び出し、特定の <strong>ポイント</strong> レイヤで使用するシンボルを置換することができます:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">symbol</span> <span class="o">=</span> <span class="n">QgsMarkerSymbol</span><span class="o">.</span><span class="n">createSimple</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;square&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;red&#39;</span><span class="p">})</span>
<span class="n">layer</span><span class="o">.</span><span class="n">renderer</span><span class="p">()</span><span class="o">.</span><span class="n">setSymbol</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span>
<span class="c1"># show the change</span>
<span class="n">layer</span><span class="o">.</span><span class="n">triggerRepaint</span><span class="p">()</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">name</span></code> は、マーカーの形状を示しており、以下のいずれかとすることができます。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">circle</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">square</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cross</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rectangle</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">diamond</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pentagon</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">triangle</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">equilateral_triangle</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">star</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">regular_star</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">arrow</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">filled_arrowhead</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">x</span></code></p></li>
</ul>
<p>シンボルインスタンスの最初のシンボルレイヤのプロパティの完全なリストを取得するには、次のサンプルコードに倣うことができます：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">layer</span><span class="o">.</span><span class="n">renderer</span><span class="p">()</span><span class="o">.</span><span class="n">symbol</span><span class="p">()</span><span class="o">.</span><span class="n">symbolLayers</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">properties</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>{&#39;angle&#39;: &#39;0&#39;, &#39;cap_style&#39;: &#39;square&#39;, &#39;color&#39;: &#39;255,0,0,255&#39;, &#39;horizontal_anchor_point&#39;: &#39;1&#39;, &#39;joinstyle&#39;: &#39;bevel&#39;, &#39;name&#39;: &#39;square&#39;, &#39;offset&#39;: &#39;0,0&#39;, &#39;offset_map_unit_scale&#39;: &#39;3x:0,0,0,0,0,0&#39;, &#39;offset_unit&#39;: &#39;MM&#39;, &#39;outline_color&#39;: &#39;35,35,35,255&#39;, &#39;outline_style&#39;: &#39;solid&#39;, &#39;outline_width&#39;: &#39;0&#39;, &#39;outline_width_map_unit_scale&#39;: &#39;3x:0,0,0,0,0,0&#39;, &#39;outline_width_unit&#39;: &#39;MM&#39;, &#39;scale_method&#39;: &#39;diameter&#39;, &#39;size&#39;: &#39;2&#39;, &#39;size_map_unit_scale&#39;: &#39;3x:0,0,0,0,0,0&#39;, &#39;size_unit&#39;: &#39;MM&#39;, &#39;vertical_anchor_point&#39;: &#39;1&#39;}
</pre></div>
</div>
<p>いくつかのプロパティを変更したい場合に便利です:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1"># You can alter a single property...</span>
<span class="linenos"> 2</span><span class="n">layer</span><span class="o">.</span><span class="n">renderer</span><span class="p">()</span><span class="o">.</span><span class="n">symbol</span><span class="p">()</span><span class="o">.</span><span class="n">symbolLayer</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">setSize</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="linenos"> 3</span><span class="c1"># ... but not all properties are accessible from methods,</span>
<span class="linenos"> 4</span><span class="c1"># you can also replace the symbol completely:</span>
<span class="linenos"> 5</span><span class="n">props</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">renderer</span><span class="p">()</span><span class="o">.</span><span class="n">symbol</span><span class="p">()</span><span class="o">.</span><span class="n">symbolLayer</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">()</span>
<span class="linenos"> 6</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;yellow&#39;</span>
<span class="linenos"> 7</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;square&#39;</span>
<span class="linenos"> 8</span><span class="n">layer</span><span class="o">.</span><span class="n">renderer</span><span class="p">()</span><span class="o">.</span><span class="n">setSymbol</span><span class="p">(</span><span class="n">QgsMarkerSymbol</span><span class="o">.</span><span class="n">createSimple</span><span class="p">(</span><span class="n">props</span><span class="p">))</span>
<span class="linenos"> 9</span><span class="c1"># show the changes</span>
<span class="linenos">10</span><span class="n">layer</span><span class="o">.</span><span class="n">triggerRepaint</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="categorized-symbol-renderer">
<span id="index-10"></span><h3><a class="toc-backref" href="#id22" role="doc-backlink"><span class="section-number">6.8.2. </span>カテゴリ値シンボル・レンダラー</a><a class="headerlink" href="#categorized-symbol-renderer" title="Link to this heading"></a></h3>
<p>カテゴリ値レンダラーを使用する場合、分類に使用する属性を照会および設定できます: <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsCategorizedSymbolRenderer.html#qgis.core.QgsCategorizedSymbolRenderer.classAttribute" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">classAttribute()</span></code></a> および <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsCategorizedSymbolRenderer.html#qgis.core.QgsCategorizedSymbolRenderer.setClassAttribute" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">setClassAttribute()</span></code></a> メソッドを用います。</p>
<p>カテゴリ値のリストを取得する</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="n">categorized_renderer</span> <span class="o">=</span> <span class="n">QgsCategorizedSymbolRenderer</span><span class="p">()</span>
<span class="linenos">2</span><span class="c1"># Add a few categories</span>
<span class="linenos">3</span><span class="n">cat1</span> <span class="o">=</span> <span class="n">QgsRendererCategory</span><span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="n">QgsMarkerSymbol</span><span class="p">(),</span> <span class="s1">&#39;category 1&#39;</span><span class="p">)</span>
<span class="linenos">4</span><span class="n">cat2</span> <span class="o">=</span> <span class="n">QgsRendererCategory</span><span class="p">(</span><span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="n">QgsMarkerSymbol</span><span class="p">(),</span> <span class="s1">&#39;category 2&#39;</span><span class="p">)</span>
<span class="linenos">5</span><span class="n">categorized_renderer</span><span class="o">.</span><span class="n">addCategory</span><span class="p">(</span><span class="n">cat1</span><span class="p">)</span>
<span class="linenos">6</span><span class="n">categorized_renderer</span><span class="o">.</span><span class="n">addCategory</span><span class="p">(</span><span class="n">cat2</span><span class="p">)</span>
<span class="linenos">7</span>
<span class="linenos">8</span><span class="k">for</span> <span class="n">cat</span> <span class="ow">in</span> <span class="n">categorized_renderer</span><span class="o">.</span><span class="n">categories</span><span class="p">():</span>
<span class="linenos">9</span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">: </span><span class="si">{}</span><span class="s2"> :: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cat</span><span class="o">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">cat</span><span class="o">.</span><span class="n">label</span><span class="p">(),</span> <span class="n">cat</span><span class="o">.</span><span class="n">symbol</span><span class="p">()))</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>1: category 1 :: &lt;qgis._core.QgsMarkerSymbol object at 0x7f378ffcd9d8&gt;
2: category 2 :: &lt;qgis._core.QgsMarkerSymbol object at 0x7f378ffcd9d8&gt;
</pre></div>
</div>
<p>ここで、 <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsRendererCategory.html#qgis.core.QgsRendererCategory.value" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">value()</span></code></a> はカテゴリ間の識別に用いられる値、 <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsRendererCategory.html#qgis.core.QgsRendererCategory.label" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">label()</span></code></a> はカテゴリ説明に用いられるテキスト、 <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsRendererCategory.html#qgis.core.QgsRendererCategory.symbol" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">symbol()</span></code></a> は割り付けられたシンボルを返すメソッドです。</p>
<p>レンダラーは通常、カテゴリに使用したオリジナルのシンボルとカラーランプも保存します: <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsCategorizedSymbolRenderer.html#qgis.core.QgsCategorizedSymbolRenderer.sourceColorRamp" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">sourceColorRamp()</span></code></a> と <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsCategorizedSymbolRenderer.html#qgis.core.QgsCategorizedSymbolRenderer.sourceSymbol" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">sourceSymbol()</span></code></a> のメソッドです。</p>
</section>
<section id="graduated-symbol-renderer">
<span id="index-11"></span><h3><a class="toc-backref" href="#id23" role="doc-backlink"><span class="section-number">6.8.3. </span>連続値シンボルレンダラー</a><a class="headerlink" href="#graduated-symbol-renderer" title="Link to this heading"></a></h3>
<p>このレンダラーは先ほど扱ったカテゴリ・シンボル・レンダラーととても似ていますが、クラスごとの一つの属性値の代わりに領域の値として動作し、そのため数字の属性のみ使うことができます。</p>
<p>レンダラーで使われている領域の多くの情報を見つけるには</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="n">graduated_renderer</span> <span class="o">=</span> <span class="n">QgsGraduatedSymbolRenderer</span><span class="p">()</span>
<span class="linenos"> 2</span><span class="c1"># Add a few categories</span>
<span class="linenos"> 3</span><span class="n">graduated_renderer</span><span class="o">.</span><span class="n">addClassRange</span><span class="p">(</span><span class="n">QgsRendererRange</span><span class="p">(</span><span class="n">QgsClassificationRange</span><span class="p">(</span><span class="s1">&#39;class 0-100&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="n">QgsMarkerSymbol</span><span class="p">()))</span>
<span class="linenos"> 4</span><span class="n">graduated_renderer</span><span class="o">.</span><span class="n">addClassRange</span><span class="p">(</span><span class="n">QgsRendererRange</span><span class="p">(</span><span class="n">QgsClassificationRange</span><span class="p">(</span><span class="s1">&#39;class 101-200&#39;</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span> <span class="n">QgsMarkerSymbol</span><span class="p">()))</span>
<span class="linenos"> 5</span>
<span class="linenos"> 6</span><span class="k">for</span> <span class="n">ran</span> <span class="ow">in</span> <span class="n">graduated_renderer</span><span class="o">.</span><span class="n">ranges</span><span class="p">():</span>
<span class="linenos"> 7</span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> - </span><span class="si">{}</span><span class="s2">: </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<span class="linenos"> 8</span>        <span class="n">ran</span><span class="o">.</span><span class="n">lowerValue</span><span class="p">(),</span>
<span class="linenos"> 9</span>        <span class="n">ran</span><span class="o">.</span><span class="n">upperValue</span><span class="p">(),</span>
<span class="linenos">10</span>        <span class="n">ran</span><span class="o">.</span><span class="n">label</span><span class="p">(),</span>
<span class="linenos">11</span>        <span class="n">ran</span><span class="o">.</span><span class="n">symbol</span><span class="p">()</span>
<span class="linenos">12</span>      <span class="p">))</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>0.0 - 100.0: class 0-100 &lt;qgis._core.QgsMarkerSymbol object at 0x7f8bad281b88&gt;
101.0 - 200.0: class 101-200 &lt;qgis._core.QgsMarkerSymbol object at 0x7f8bad281b88&gt;
</pre></div>
</div>
<p>ここでも <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsGraduatedSymbolRenderer.html#qgis.core.QgsGraduatedSymbolRenderer.classAttribute" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">classAttribute()</span></code></a>  （分類属性名を見つけるため）、 <code class="xref py py-meth docutils literal notranslate"><span class="pre">sourceSymbol()</span></code>、 <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsGraduatedSymbolRenderer.html#qgis.core.QgsGraduatedSymbolRenderer.sourceColorRamp" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">sourceColorRamp()</span></code></a> メソッドを使うことができます。さらに、 <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsGraduatedSymbolRenderer.html#qgis.core.QgsGraduatedSymbolRenderer.mode" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">mode()</span></code></a> メソッドがあり、等間隔、分位点、その他の方法で範囲を作成する方法を決定します。</p>
<p>もし連続値シンボルレンダラーを作ろうとしているのであれば次のスニペットの例で書かれているようにします(これはシンプルな二つのクラスを作成するものを取り上げています)</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">from</span> <span class="nn">qgis.PyQt</span> <span class="kn">import</span> <span class="n">QtGui</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="n">myVectorLayer</span> <span class="o">=</span> <span class="n">QgsVectorLayer</span><span class="p">(</span><span class="s2">&quot;testdata/airports.shp&quot;</span><span class="p">,</span> <span class="s2">&quot;airports&quot;</span><span class="p">,</span> <span class="s2">&quot;ogr&quot;</span><span class="p">)</span>
<span class="linenos"> 4</span><span class="n">myTargetField</span> <span class="o">=</span> <span class="s1">&#39;ELEV&#39;</span>
<span class="linenos"> 5</span><span class="n">myRangeList</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos"> 6</span><span class="n">myOpacity</span> <span class="o">=</span> <span class="mi">1</span>
<span class="linenos"> 7</span><span class="c1"># Make our first symbol and range...</span>
<span class="linenos"> 8</span><span class="n">myMin</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="linenos"> 9</span><span class="n">myMax</span> <span class="o">=</span> <span class="mf">50.0</span>
<span class="linenos">10</span><span class="n">myLabel</span> <span class="o">=</span> <span class="s1">&#39;Group 1&#39;</span>
<span class="linenos">11</span><span class="n">myColour</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QColor</span><span class="p">(</span><span class="s1">&#39;#ffee00&#39;</span><span class="p">)</span>
<span class="linenos">12</span><span class="n">mySymbol1</span> <span class="o">=</span> <span class="n">QgsSymbol</span><span class="o">.</span><span class="n">defaultSymbol</span><span class="p">(</span><span class="n">myVectorLayer</span><span class="o">.</span><span class="n">geometryType</span><span class="p">())</span>
<span class="linenos">13</span><span class="n">mySymbol1</span><span class="o">.</span><span class="n">setColor</span><span class="p">(</span><span class="n">myColour</span><span class="p">)</span>
<span class="linenos">14</span><span class="n">mySymbol1</span><span class="o">.</span><span class="n">setOpacity</span><span class="p">(</span><span class="n">myOpacity</span><span class="p">)</span>
<span class="linenos">15</span><span class="n">myRange1</span> <span class="o">=</span> <span class="n">QgsRendererRange</span><span class="p">(</span><span class="n">myMin</span><span class="p">,</span> <span class="n">myMax</span><span class="p">,</span> <span class="n">mySymbol1</span><span class="p">,</span> <span class="n">myLabel</span><span class="p">)</span>
<span class="linenos">16</span><span class="n">myRangeList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">myRange1</span><span class="p">)</span>
<span class="linenos">17</span><span class="c1">#now make another symbol and range...</span>
<span class="linenos">18</span><span class="n">myMin</span> <span class="o">=</span> <span class="mf">50.1</span>
<span class="linenos">19</span><span class="n">myMax</span> <span class="o">=</span> <span class="mi">100</span>
<span class="linenos">20</span><span class="n">myLabel</span> <span class="o">=</span> <span class="s1">&#39;Group 2&#39;</span>
<span class="linenos">21</span><span class="n">myColour</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QColor</span><span class="p">(</span><span class="s1">&#39;#00eeff&#39;</span><span class="p">)</span>
<span class="linenos">22</span><span class="n">mySymbol2</span> <span class="o">=</span> <span class="n">QgsSymbol</span><span class="o">.</span><span class="n">defaultSymbol</span><span class="p">(</span>
<span class="linenos">23</span>     <span class="n">myVectorLayer</span><span class="o">.</span><span class="n">geometryType</span><span class="p">())</span>
<span class="linenos">24</span><span class="n">mySymbol2</span><span class="o">.</span><span class="n">setColor</span><span class="p">(</span><span class="n">myColour</span><span class="p">)</span>
<span class="linenos">25</span><span class="n">mySymbol2</span><span class="o">.</span><span class="n">setOpacity</span><span class="p">(</span><span class="n">myOpacity</span><span class="p">)</span>
<span class="linenos">26</span><span class="n">myRange2</span> <span class="o">=</span> <span class="n">QgsRendererRange</span><span class="p">(</span><span class="n">myMin</span><span class="p">,</span> <span class="n">myMax</span><span class="p">,</span> <span class="n">mySymbol2</span><span class="p">,</span> <span class="n">myLabel</span><span class="p">)</span>
<span class="linenos">27</span><span class="n">myRangeList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">myRange2</span><span class="p">)</span>
<span class="linenos">28</span><span class="n">myRenderer</span> <span class="o">=</span> <span class="n">QgsGraduatedSymbolRenderer</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">myRangeList</span><span class="p">)</span>
<span class="linenos">29</span><span class="n">myClassificationMethod</span> <span class="o">=</span> <span class="n">QgsApplication</span><span class="o">.</span><span class="n">classificationMethodRegistry</span><span class="p">()</span><span class="o">.</span><span class="n">method</span><span class="p">(</span><span class="s2">&quot;EqualInterval&quot;</span><span class="p">)</span>
<span class="linenos">30</span><span class="n">myRenderer</span><span class="o">.</span><span class="n">setClassificationMethod</span><span class="p">(</span><span class="n">myClassificationMethod</span><span class="p">)</span>
<span class="linenos">31</span><span class="n">myRenderer</span><span class="o">.</span><span class="n">setClassAttribute</span><span class="p">(</span><span class="n">myTargetField</span><span class="p">)</span>
<span class="linenos">32</span>
<span class="linenos">33</span><span class="n">myVectorLayer</span><span class="o">.</span><span class="n">setRenderer</span><span class="p">(</span><span class="n">myRenderer</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="working-with-symbols">
<span id="index-12"></span><h3><a class="toc-backref" href="#id24" role="doc-backlink"><span class="section-number">6.8.4. </span>シンボルを操作する</a><a class="headerlink" href="#working-with-symbols" title="Link to this heading"></a></h3>
<p>シンボルを表現するために、 <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsSymbol.html#qgis.core.QgsSymbol" title="(in QGIS Python API v3.34)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QgsSymbol</span></code></a> という基本クラスがあり、3つの派生クラスがあります:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsMarkerSymbol.html#qgis.core.QgsMarkerSymbol" title="(in QGIS Python API v3.34)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QgsMarkerSymbol</span></code></a> --- ポイント地物用</p></li>
<li><p><a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsLineSymbol.html#qgis.core.QgsLineSymbol" title="(in QGIS Python API v3.34)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QgsLineSymbol</span></code></a> --- ライン地物用</p></li>
<li><p><a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsFillSymbol.html#qgis.core.QgsFillSymbol" title="(in QGIS Python API v3.34)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QgsFillSymbol</span></code></a> --- ポリゴン地物用</p></li>
</ul>
<p><a href="#id1"><span class="problematic" id="id2">**</span></a>すべてのシンボルは1つ以上のシンボルレイヤ**（ <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsSymbolLayer.html#qgis.core.QgsSymbolLayer" title="(in QGIS Python API v3.34)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QgsSymbolLayer</span></code></a> から派生したクラス）で構成されています。シンボルレイヤは実際のレンダリングを行い、シンボルクラス自体はシンボルレイヤのコンテナとしてのみ機能します。</p>
<p>シンボルのインスタンス（レンダラーなど）があれば、それを探索することができます: <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsSymbol.html#qgis.core.QgsSymbol.type" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">type()</span></code></a> メソッドは、それがマーカー、ライン、塗りつぶしシンボルであるかを示します。また、シンボルの簡単な説明を返す <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsSymbol.html#qgis.core.QgsSymbol.dump" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">dump()</span></code></a> メソッドがあります。シンボルレイヤのリストを取得するには:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">marker_symbol</span> <span class="o">=</span> <span class="n">QgsMarkerSymbol</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">marker_symbol</span><span class="o">.</span><span class="n">symbolLayerCount</span><span class="p">()):</span>
    <span class="n">lyr</span> <span class="o">=</span> <span class="n">marker_symbol</span><span class="o">.</span><span class="n">symbolLayer</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">lyr</span><span class="o">.</span><span class="n">layerType</span><span class="p">()))</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>0: SimpleMarker
</pre></div>
</div>
<p>シンボルの色を調べるには <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsSymbol.html#qgis.core.QgsSymbol.color" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">color()</span></code></a> メソッドを、色を変更するには <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsSymbol.html#qgis.core.QgsSymbol.setColor" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">setColor()</span></code></a> を用います。マーカーシンボルでは、さらに <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsMarkerSymbol.html#qgis.core.QgsMarkerSymbol.size" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">size()</span></code></a> と <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsMarkerSymbol.html#qgis.core.QgsMarkerSymbol.angle" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">angle()</span></code></a> でシンボルのサイズと回転を取得することができます。ラインシンボルの場合、 <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsLineSymbol.html#qgis.core.QgsLineSymbol.width" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">width()</span></code></a> メソッドは、線の幅を返します。</p>
<p>サイズと幅は標準でミリメートルが使われ、角度は 度 が使われます。</p>
<section id="working-with-symbol-layers">
<span id="index-13"></span><h4><a class="toc-backref" href="#id25" role="doc-backlink"><span class="section-number">6.8.4.1. </span>シンボルレイヤーの操作</a><a class="headerlink" href="#working-with-symbol-layers" title="Link to this heading"></a></h4>
<p>前述したように、シンボルレイヤ（ <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsSymbolLayer.html#qgis.core.QgsSymbolLayer" title="(in QGIS Python API v3.34)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QgsSymbolLayer</span></code></a> のサブクラス）は地物の外観を決定します。 一般的に使用されるいくつかの基本的なシンボルレイヤクラスがあります。新しいシンボルレイヤタイプを実装することで、地物がどのようにレンダリングされるかを任意にカスタマイズすることが可能です。<a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsSymbolLayer.html#qgis.core.QgsSymbolLayer.layerType" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">layerType()</span></code></a> メソッドはシンボルレイヤクラスを一意に特定します。基本的でデフォルトのものは <code class="docutils literal notranslate"><span class="pre">SimpleMarker</span></code>, <code class="docutils literal notranslate"><span class="pre">SimpleLine</span></code>, <code class="docutils literal notranslate"><span class="pre">SimpleFill</span></code> というシンボルレイヤクラスです。</p>
<p>シンボルレイヤクラスで作成できるシンボルレイヤの種類は、以下のコードで全て把握することができます:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="kn">from</span> <span class="nn">qgis.core</span> <span class="kn">import</span> <span class="n">QgsSymbolLayerRegistry</span>
<span class="linenos">2</span><span class="n">myRegistry</span> <span class="o">=</span> <span class="n">QgsApplication</span><span class="o">.</span><span class="n">symbolLayerRegistry</span><span class="p">()</span>
<span class="linenos">3</span><span class="n">myMetadata</span> <span class="o">=</span> <span class="n">myRegistry</span><span class="o">.</span><span class="n">symbolLayerMetadata</span><span class="p">(</span><span class="s2">&quot;SimpleFill&quot;</span><span class="p">)</span>
<span class="linenos">4</span><span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">myRegistry</span><span class="o">.</span><span class="n">symbolLayersForType</span><span class="p">(</span><span class="n">QgsSymbol</span><span class="o">.</span><span class="n">Marker</span><span class="p">):</span>
<span class="linenos">5</span>    <span class="nb">print</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span>AnimatedMarker
<span class="linenos"> 2</span>EllipseMarker
<span class="linenos"> 3</span>FilledMarker
<span class="linenos"> 4</span>FontMarker
<span class="linenos"> 5</span>GeometryGenerator
<span class="linenos"> 6</span>MaskMarker
<span class="linenos"> 7</span>RasterMarker
<span class="linenos"> 8</span>SimpleMarker
<span class="linenos"> 9</span>SvgMarker
<span class="linenos">10</span>VectorField
</pre></div>
</div>
<p><a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsSymbolLayerRegistry.html#qgis.core.QgsSymbolLayerRegistry" title="(in QGIS Python API v3.34)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QgsSymbolLayerRegistry</span></code></a> クラスは、利用可能な全てのシンボルレイヤタイプのデータベースを管理するものです。</p>
<p>シンボルレイヤデータにアクセスするには、その <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsSymbolLayer.html#qgis.core.QgsSymbolLayer.properties" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">properties()</span></code></a> メソッドを使用し、外観を決定するプロパティのキー-バリュー辞書を返します。各シンボルレイヤのタイプは、使用するプロパティの特定のセットを持っています。さらに、汎用メソッドである <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsSymbol.html#qgis.core.QgsSymbol.color" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">color()</span></code></a>, <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsMarkerSymbol.html#qgis.core.QgsMarkerSymbol.size" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">size()</span></code></a>, <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsMarkerSymbol.html#qgis.core.QgsMarkerSymbol.angle" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">angle()</span></code></a> および <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsLineSymbol.html#qgis.core.QgsLineSymbol.width" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">width()</span></code></a> とそのセッターも存在する。もちろん、サイズと角度はマーカーシンボルレイヤにのみ、幅はラインシンボルレイヤにのみ有効です。</p>
</section>
<section id="creating-custom-symbol-layer-types">
<span id="index-14"></span><h4><a class="toc-backref" href="#id26" role="doc-backlink"><span class="section-number">6.8.4.2. </span>カスタムシンボルレイヤタイプの作成</a><a class="headerlink" href="#creating-custom-symbol-layer-types" title="Link to this heading"></a></h4>
<p>データをどうレンダリングするかをカスタマイズしたいと考えているとします。思うままに地物を描画する独自のシンボルレイヤクラスを作成できます。次の例は指定した半径で赤い円を描画するマーカーを示しています:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">from</span> <span class="nn">qgis.core</span> <span class="kn">import</span> <span class="n">QgsMarkerSymbolLayer</span>
<span class="linenos"> 2</span><span class="kn">from</span> <span class="nn">qgis.PyQt.QtGui</span> <span class="kn">import</span> <span class="n">QColor</span>
<span class="linenos"> 3</span>
<span class="linenos"> 4</span><span class="k">class</span> <span class="nc">FooSymbolLayer</span><span class="p">(</span><span class="n">QgsMarkerSymbolLayer</span><span class="p">):</span>
<span class="linenos"> 5</span>
<span class="linenos"> 6</span>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mf">4.0</span><span class="p">):</span>
<span class="linenos"> 7</span>      <span class="n">QgsMarkerSymbolLayer</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
<span class="linenos"> 8</span>      <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">=</span> <span class="n">radius</span>
<span class="linenos"> 9</span>      <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">QColor</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="linenos">10</span>
<span class="linenos">11</span>  <span class="k">def</span> <span class="nf">layerType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos">12</span>     <span class="k">return</span> <span class="s2">&quot;FooMarker&quot;</span>
<span class="linenos">13</span>
<span class="linenos">14</span>  <span class="k">def</span> <span class="nf">properties</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos">15</span>      <span class="k">return</span> <span class="p">{</span> <span class="s2">&quot;radius&quot;</span> <span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">)</span> <span class="p">}</span>
<span class="linenos">16</span>
<span class="linenos">17</span>  <span class="k">def</span> <span class="nf">startRender</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
<span class="linenos">18</span>    <span class="k">pass</span>
<span class="linenos">19</span>
<span class="linenos">20</span>  <span class="k">def</span> <span class="nf">stopRender</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
<span class="linenos">21</span>      <span class="k">pass</span>
<span class="linenos">22</span>
<span class="linenos">23</span>  <span class="k">def</span> <span class="nf">renderPoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
<span class="linenos">24</span>      <span class="c1"># Rendering depends on whether the symbol is selected (QGIS &gt;= 1.5)</span>
<span class="linenos">25</span>      <span class="n">color</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">selectionColor</span><span class="p">()</span> <span class="k">if</span> <span class="n">context</span><span class="o">.</span><span class="n">selected</span><span class="p">()</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span>
<span class="linenos">26</span>      <span class="n">p</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">renderContext</span><span class="p">()</span><span class="o">.</span><span class="n">painter</span><span class="p">()</span>
<span class="linenos">27</span>      <span class="n">p</span><span class="o">.</span><span class="n">setPen</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
<span class="linenos">28</span>      <span class="n">p</span><span class="o">.</span><span class="n">drawEllipse</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">)</span>
<span class="linenos">29</span>
<span class="linenos">30</span>  <span class="k">def</span> <span class="nf">clone</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos">31</span>      <span class="k">return</span> <span class="n">FooSymbolLayer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">)</span>
</pre></div>
</div>
<p><a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsSymbolLayer.html#qgis.core.QgsSymbolLayer.layerType" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">layerType()</span></code></a> メソッドはシンボルレイヤの名前を決定します。この名前は全てのシンボルレイヤの中で一意でなければなりません。<a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsSymbolLayer.html#qgis.core.QgsSymbolLayer.properties" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">properties()</span></code></a> メソッドは属性の永続化のために使用されます。<a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsSymbolLayer.html#qgis.core.QgsSymbolLayer.clone" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">clone()</span></code></a> メソッドは全ての属性が全く同じであるシンボルレイヤのコピーを返さなければなりません。最後にレンダリングメソッドです: <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsSymbolLayer.html#qgis.core.QgsSymbolLayer.startRender" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">startRender()</span></code></a> は最初の地物を描画する前に呼ばれ、 <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsSymbolLayer.html#qgis.core.QgsSymbolLayer.stopRender" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">stopRender()</span></code></a> は描画が完了したら呼ばれ、 <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsMarkerSymbolLayer.html#qgis.core.QgsMarkerSymbolLayer.renderPoint" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">renderPoint()</span></code></a> はれレンダリングのために呼ばれます。点の座標はすでに出力座標に変換されています。</p>
<p>ポリラインとポリゴンにとって、違いはレンダリング方法だけです: <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsLineSymbolLayer.html#qgis.core.QgsLineSymbolLayer.renderPolyline" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">renderPolyline()</span></code></a> はラインのリストを受け取り、 <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsFillSymbolLayer.html#qgis.core.QgsFillSymbolLayer.renderPolygon" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">renderPolygon()</span></code></a> は最初のパラメータとして外側のリングの点のリスト、第2のパラメータとして内側のリングのリスト（またはなし）を受け取ります。</p>
<p>普通はユーザーに外観をカスタマイズさせるためにシンボルレイヤータイプの属性を設定するGUIを追加すると使いやすくなります: 上記の例であればユーザーは円の半径を設定できます。次のコードはそのようなウィジェットの実装となります:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">from</span> <span class="nn">qgis.gui</span> <span class="kn">import</span> <span class="n">QgsSymbolLayerWidget</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="k">class</span> <span class="nc">FooSymbolLayerWidget</span><span class="p">(</span><span class="n">QgsSymbolLayerWidget</span><span class="p">):</span>
<span class="linenos"> 4</span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="linenos"> 5</span>        <span class="n">QgsSymbolLayerWidget</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span>        <span class="bp">self</span><span class="o">.</span><span class="n">layer</span> <span class="o">=</span> <span class="kc">None</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span>        <span class="c1"># setup a simple UI</span>
<span class="linenos">10</span>        <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Radius:&quot;</span><span class="p">)</span>
<span class="linenos">11</span>        <span class="bp">self</span><span class="o">.</span><span class="n">spinRadius</span> <span class="o">=</span> <span class="n">QDoubleSpinBox</span><span class="p">()</span>
<span class="linenos">12</span>        <span class="bp">self</span><span class="o">.</span><span class="n">hbox</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
<span class="linenos">13</span>        <span class="bp">self</span><span class="o">.</span><span class="n">hbox</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
<span class="linenos">14</span>        <span class="bp">self</span><span class="o">.</span><span class="n">hbox</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spinRadius</span><span class="p">)</span>
<span class="linenos">15</span>        <span class="bp">self</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hbox</span><span class="p">)</span>
<span class="linenos">16</span>        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spinRadius</span><span class="p">,</span> <span class="n">SIGNAL</span><span class="p">(</span><span class="s2">&quot;valueChanged(double)&quot;</span><span class="p">),</span> \
<span class="linenos">17</span>            <span class="bp">self</span><span class="o">.</span><span class="n">radiusChanged</span><span class="p">)</span>
<span class="linenos">18</span>
<span class="linenos">19</span>    <span class="k">def</span> <span class="nf">setSymbolLayer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layer</span><span class="p">):</span>
<span class="linenos">20</span>        <span class="k">if</span> <span class="n">layer</span><span class="o">.</span><span class="n">layerType</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">&quot;FooMarker&quot;</span><span class="p">:</span>
<span class="linenos">21</span>            <span class="k">return</span>
<span class="linenos">22</span>        <span class="bp">self</span><span class="o">.</span><span class="n">layer</span> <span class="o">=</span> <span class="n">layer</span>
<span class="linenos">23</span>        <span class="bp">self</span><span class="o">.</span><span class="n">spinRadius</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">layer</span><span class="o">.</span><span class="n">radius</span><span class="p">)</span>
<span class="linenos">24</span>
<span class="linenos">25</span>    <span class="k">def</span> <span class="nf">symbolLayer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos">26</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">layer</span>
<span class="linenos">27</span>
<span class="linenos">28</span>    <span class="k">def</span> <span class="nf">radiusChanged</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="linenos">29</span>        <span class="bp">self</span><span class="o">.</span><span class="n">layer</span><span class="o">.</span><span class="n">radius</span> <span class="o">=</span> <span class="n">value</span>
<span class="linenos">30</span>        <span class="bp">self</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">SIGNAL</span><span class="p">(</span><span class="s2">&quot;changed()&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>このウィジェットは、シンボルプロパティダイアログに埋め込むことができます。シンボルプロパティダイアログでシンボルレイヤタイプが選択されると、シンボルレイヤのインスタンスとシンボルレイヤウィジェットのインスタンスが作成されます。そして、 <a class="reference external" href="https://qgis.org/pyqgis/3.34/gui/QgsSymbolLayerWidget.html#qgis.gui.QgsSymbolLayerWidget.setSymbolLayer" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">setSymbolLayer()</span></code></a> メソッドを呼び、シンボルレイヤをウィジェットに割り当てます。そのメソッドの中で、ウィジェットはシンボルレイヤの属性を反映するためにUIを更新する必要があります。<a class="reference external" href="https://qgis.org/pyqgis/3.34/gui/QgsSymbolLayerWidget.html#qgis.gui.QgsSymbolLayerWidget.symbolLayer" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">symbolLayer()</span></code></a> メソッドは、シンボルに使用するために、プロパティダイアログでシンボルレイヤを再度取得するために使用します。</p>
<p>属性が変わるたびに、ウィジェットは <a class="reference external" href="https://qgis.org/pyqgis/3.34/gui/QgsSymbolLayerWidget.html#qgis.gui.QgsSymbolLayerWidget.changed" title="(in QGIS Python API v3.34)"><code class="xref any docutils literal notranslate"><span class="pre">changed()</span></code></a> シグナルを発して、プロパティダイアログにシンボルプレビューを更新させる必要があります。</p>
<p>私達は最後につなげるところだけまだ扱っていません: QGIS にこれらの新しいクラスを知らせる方法です。これはレジストリにシンボルレイヤーを追加すれば完了です。レジストリに追加しなくてもシンボルレイヤーを使うことはできますが、いくつかの機能が動かないでしょう: 例えばカスタムシンボルレイヤーを使ってプロジェクトファイルを読み込んだり、GUIでレイヤーの属性を編集できないなど。</p>
<p>シンボルレイヤーのメタデータを作る必要があるでしょう</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">from</span> <span class="nn">qgis.core</span> <span class="kn">import</span> <span class="n">QgsSymbol</span><span class="p">,</span> <span class="n">QgsSymbolLayerAbstractMetadata</span><span class="p">,</span> <span class="n">QgsSymbolLayerRegistry</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="k">class</span> <span class="nc">FooSymbolLayerMetadata</span><span class="p">(</span><span class="n">QgsSymbolLayerAbstractMetadata</span><span class="p">):</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos"> 6</span>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="s2">&quot;FooMarker&quot;</span><span class="p">,</span> <span class="s2">&quot;My new Foo marker&quot;</span><span class="p">,</span> <span class="n">QgsSymbol</span><span class="o">.</span><span class="n">Marker</span><span class="p">)</span>
<span class="linenos"> 7</span>
<span class="linenos"> 8</span>  <span class="k">def</span> <span class="nf">createSymbolLayer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">props</span><span class="p">):</span>
<span class="linenos"> 9</span>    <span class="n">radius</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">props</span><span class="p">[</span><span class="s2">&quot;radius&quot;</span><span class="p">])</span> <span class="k">if</span> <span class="s2">&quot;radius&quot;</span> <span class="ow">in</span> <span class="n">props</span> <span class="k">else</span> <span class="mf">4.0</span>
<span class="linenos">10</span>    <span class="k">return</span> <span class="n">FooSymbolLayer</span><span class="p">(</span><span class="n">radius</span><span class="p">)</span>
<span class="linenos">11</span>
<span class="linenos">12</span><span class="n">fslmetadata</span> <span class="o">=</span> <span class="n">FooSymbolLayerMetadata</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">QgsApplication</span><span class="o">.</span><span class="n">symbolLayerRegistry</span><span class="p">()</span><span class="o">.</span><span class="n">addSymbolLayerType</span><span class="p">(</span><span class="n">fslmetadata</span><span class="p">)</span>
</pre></div>
</div>
<p>親クラスのコンストラクタにレイヤーのタイプ（レイヤーが返すものと同じ）とシンボルのタイプ（marker/line/fill）を渡す必要があります。<a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsSymbolLayerAbstractMetadata.html#qgis.core.QgsSymbolLayerAbstractMetadata.createSymbolLayer" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">createSymbolLayer()</span></code></a> メソッドは <cite>props</cite> 辞書に指定された属性を持つシンボルレイヤーのインスタンスを作成する処理をします。そして、シンボルレイヤーの設定ウィジェットを返す <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsSymbolLayerAbstractMetadata.html#qgis.core.QgsSymbolLayerAbstractMetadata.createSymbolLayerWidget" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">createSymbolLayerWidget()</span></code></a> メソッドがあります。</p>
<p>最後にこのシンボルレイヤーをレジストリに追加します --- これで完了です。</p>
</section>
</section>
<section id="creating-custom-renderers">
<span id="index-15"></span><h3><a class="toc-backref" href="#id27" role="doc-backlink"><span class="section-number">6.8.5. </span>カスタムレンダラーの作成</a><a class="headerlink" href="#creating-custom-renderers" title="Link to this heading"></a></h3>
<p>もし地物をレンダリングするためのシンボルをどう選択するかをカスタマイズしたいのであれば、新しいレンダラーの実装を作ると便利かもしれません。いくつかのユースケースとしてこんなことをしたいのかもしれません: フィールドの組み合わせからシンボルを決定する、現在の縮尺に合わせてシンボルのサイズを変更するなどなど。</p>
<p>次のコードは二つのマーカーシンボルを作成して全ての地物からランダムに一つ選ぶ簡単なカスタムレンダラーです</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">import</span> <span class="nn">random</span>
<span class="linenos"> 2</span><span class="kn">from</span> <span class="nn">qgis.core</span> <span class="kn">import</span> <span class="n">QgsWkbTypes</span><span class="p">,</span> <span class="n">QgsSymbol</span><span class="p">,</span> <span class="n">QgsFeatureRenderer</span>
<span class="linenos"> 3</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="k">class</span> <span class="nc">RandomRenderer</span><span class="p">(</span><span class="n">QgsFeatureRenderer</span><span class="p">):</span>
<span class="linenos"> 6</span>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">syms</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="linenos"> 7</span>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="s2">&quot;RandomRenderer&quot;</span><span class="p">)</span>
<span class="linenos"> 8</span>    <span class="bp">self</span><span class="o">.</span><span class="n">syms</span> <span class="o">=</span> <span class="n">syms</span> <span class="k">if</span> <span class="n">syms</span> <span class="k">else</span> <span class="p">[</span>
<span class="linenos"> 9</span>      <span class="n">QgsSymbol</span><span class="o">.</span><span class="n">defaultSymbol</span><span class="p">(</span><span class="n">QgsWkbTypes</span><span class="o">.</span><span class="n">geometryType</span><span class="p">(</span><span class="n">QgsWkbTypes</span><span class="o">.</span><span class="n">Point</span><span class="p">)),</span>
<span class="linenos">10</span>      <span class="n">QgsSymbol</span><span class="o">.</span><span class="n">defaultSymbol</span><span class="p">(</span><span class="n">QgsWkbTypes</span><span class="o">.</span><span class="n">geometryType</span><span class="p">(</span><span class="n">QgsWkbTypes</span><span class="o">.</span><span class="n">Point</span><span class="p">))</span>
<span class="linenos">11</span>    <span class="p">]</span>
<span class="linenos">12</span>
<span class="linenos">13</span>  <span class="k">def</span> <span class="nf">symbolForFeature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feature</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
<span class="linenos">14</span>    <span class="k">return</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">syms</span><span class="p">)</span>
<span class="linenos">15</span>
<span class="linenos">16</span>  <span class="k">def</span> <span class="nf">startRender</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">fields</span><span class="p">):</span>
<span class="linenos">17</span>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">startRender</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">fields</span><span class="p">)</span>
<span class="linenos">18</span>    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">syms</span><span class="p">:</span>
<span class="linenos">19</span>      <span class="n">s</span><span class="o">.</span><span class="n">startRender</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">fields</span><span class="p">)</span>
<span class="linenos">20</span>
<span class="linenos">21</span>  <span class="k">def</span> <span class="nf">stopRender</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
<span class="linenos">22</span>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">stopRender</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
<span class="linenos">23</span>    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">syms</span><span class="p">:</span>
<span class="linenos">24</span>      <span class="n">s</span><span class="o">.</span><span class="n">stopRender</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
<span class="linenos">25</span>
<span class="linenos">26</span>  <span class="k">def</span> <span class="nf">usedAttributes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
<span class="linenos">27</span>    <span class="k">return</span> <span class="p">[]</span>
<span class="linenos">28</span>
<span class="linenos">29</span>  <span class="k">def</span> <span class="nf">clone</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos">30</span>    <span class="k">return</span> <span class="n">RandomRenderer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">syms</span><span class="p">)</span>
</pre></div>
</div>
<p>親クラスである <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsFeatureRenderer.html#qgis.core.QgsFeatureRenderer" title="(in QGIS Python API v3.34)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QgsFeatureRenderer</span></code></a> のコンストラクタはレンダラー名（レンダラー間でユニークでなければならない）を必要とします。<a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsFeatureRenderer.html#qgis.core.QgsFeatureRenderer.symbolForFeature" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">symbolForFeature()</span></code></a> メソッドは、特定の地物に対してどのシンボルを使用するかを決定します。 <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsFeatureRenderer.html#qgis.core.QgsFeatureRenderer.startRender" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">startRender()</span></code></a> と <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsFeatureRenderer.html#qgis.core.QgsFeatureRenderer.stopRender" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">stopRender()</span></code></a> ではシンボルレダリングの初期化/最終化の処理に対応します。<a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsFeatureRenderer.html#qgis.core.QgsFeatureRenderer.usedAttributes" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">usedAttributes()</span></code></a> メソッドは、レンダラーが存在すると予想するフィールド名のリストを返すことができます。最後に、 <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsFeatureRenderer.html#qgis.core.QgsFeatureRenderer.clone" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">clone()</span></code></a> メソッドは、レンダラーのコピーを返す必要があります。</p>
<p>シンボルレイヤーと同様に、レンダラーの設定用のGUIを付けることが可能です。これは <a class="reference external" href="https://qgis.org/pyqgis/3.34/gui/QgsRendererWidget.html#qgis.gui.QgsRendererWidget" title="(in QGIS Python API v3.34)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QgsRendererWidget</span></code></a> から派生したものでなければなりません。次のサンプルコードでは、ユーザが最初のシンボルを設定するためのボタンを作成しています</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">from</span> <span class="nn">qgis.gui</span> <span class="kn">import</span> <span class="n">QgsRendererWidget</span><span class="p">,</span> <span class="n">QgsColorButton</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span>
<span class="linenos"> 4</span><span class="k">class</span> <span class="nc">RandomRendererWidget</span><span class="p">(</span><span class="n">QgsRendererWidget</span><span class="p">):</span>
<span class="linenos"> 5</span>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layer</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="n">renderer</span><span class="p">):</span>
<span class="linenos"> 6</span>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">style</span><span class="p">)</span>
<span class="linenos"> 7</span>    <span class="k">if</span> <span class="n">renderer</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">renderer</span><span class="o">.</span><span class="n">type</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">&quot;RandomRenderer&quot;</span><span class="p">:</span>
<span class="linenos"> 8</span>      <span class="bp">self</span><span class="o">.</span><span class="n">r</span> <span class="o">=</span> <span class="n">RandomRenderer</span><span class="p">()</span>
<span class="linenos"> 9</span>    <span class="k">else</span><span class="p">:</span>
<span class="linenos">10</span>      <span class="bp">self</span><span class="o">.</span><span class="n">r</span> <span class="o">=</span> <span class="n">renderer</span>
<span class="linenos">11</span>    <span class="c1"># setup UI</span>
<span class="linenos">12</span>    <span class="bp">self</span><span class="o">.</span><span class="n">btn1</span> <span class="o">=</span> <span class="n">QgsColorButton</span><span class="p">()</span>
<span class="linenos">13</span>    <span class="bp">self</span><span class="o">.</span><span class="n">btn1</span><span class="o">.</span><span class="n">setColor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">syms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">color</span><span class="p">())</span>
<span class="linenos">14</span>    <span class="bp">self</span><span class="o">.</span><span class="n">vbox</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">()</span>
<span class="linenos">15</span>    <span class="bp">self</span><span class="o">.</span><span class="n">vbox</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">btn1</span><span class="p">)</span>
<span class="linenos">16</span>    <span class="bp">self</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vbox</span><span class="p">)</span>
<span class="linenos">17</span>    <span class="bp">self</span><span class="o">.</span><span class="n">btn1</span><span class="o">.</span><span class="n">colorChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">setColor1</span><span class="p">)</span>
<span class="linenos">18</span>
<span class="linenos">19</span>  <span class="k">def</span> <span class="nf">setColor1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos">20</span>    <span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">btn1</span><span class="o">.</span><span class="n">color</span><span class="p">()</span>
<span class="linenos">21</span>    <span class="k">if</span> <span class="ow">not</span> <span class="n">color</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span> <span class="k">return</span>
<span class="linenos">22</span>    <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">syms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">setColor</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
<span class="linenos">23</span>
<span class="linenos">24</span>  <span class="k">def</span> <span class="nf">renderer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos">25</span>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span>
</pre></div>
</div>
<p>コンストラクタはアクティブレイヤー (<code class="xref py py-class docutils literal notranslate"><span class="pre">QgsVectorLayer</span> <span class="pre">&lt;qgis.core.QgsVectorLayer&gt;`</span></code>)、グローバルスタイル (<code class="xref py py-class docutils literal notranslate"><span class="pre">QgsStyle</span> <span class="pre">&lt;qgis.core.QgsStyle&gt;`</span></code>) と現在のレンダラのインスタンスを受け取ります。レンダラーがない場合、またはレンダラーのタイプが異なる場合は、新しいレンダラーに置き換えられ、そうでない場合は、現在のレンダラー（必要なタイプを既に持っている）を使用します。ウィジェットのコンテンツは、レンダラーの現在の状態を示すように更新する必要があります。レンダラダイアログが受け入れられると、ウィジェットの <a class="reference external" href="https://qgis.org/pyqgis/3.34/gui/QgsRendererWidget.html#qgis.gui.QgsRendererWidget.renderer" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">renderer()</span></code></a> メソッドが呼び出されて現在のレンダラーを取得します --- それがレイヤーに割り当てられることになります。</p>
<p>最後のちょっとした作業はレンダラーのメタデータとレジストリへの登録です。これらをしないとレンダラーのレイヤーの読み込みは動かず、ユーザーはレンダラーのリストから選択できないでしょう。では、私達の RandomRenderer の例を終わらせましょう</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">from</span> <span class="nn">qgis.core</span> <span class="kn">import</span> <span class="p">(</span>
<span class="linenos"> 2</span>  <span class="n">QgsRendererAbstractMetadata</span><span class="p">,</span>
<span class="linenos"> 3</span>  <span class="n">QgsRendererRegistry</span><span class="p">,</span>
<span class="linenos"> 4</span>  <span class="n">QgsApplication</span>
<span class="linenos"> 5</span><span class="p">)</span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span><span class="k">class</span> <span class="nc">RandomRendererMetadata</span><span class="p">(</span><span class="n">QgsRendererAbstractMetadata</span><span class="p">):</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos">10</span>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="s2">&quot;RandomRenderer&quot;</span><span class="p">,</span> <span class="s2">&quot;Random renderer&quot;</span><span class="p">)</span>
<span class="linenos">11</span>
<span class="linenos">12</span>  <span class="k">def</span> <span class="nf">createRenderer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element</span><span class="p">):</span>
<span class="linenos">13</span>    <span class="k">return</span> <span class="n">RandomRenderer</span><span class="p">()</span>
<span class="linenos">14</span>
<span class="linenos">15</span>  <span class="k">def</span> <span class="nf">createRendererWidget</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layer</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="n">renderer</span><span class="p">):</span>
<span class="linenos">16</span>    <span class="k">return</span> <span class="n">RandomRendererWidget</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="n">renderer</span><span class="p">)</span>
<span class="linenos">17</span>
<span class="linenos">18</span><span class="n">rrmetadata</span> <span class="o">=</span> <span class="n">RandomRendererMetadata</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">QgsApplication</span><span class="o">.</span><span class="n">rendererRegistry</span><span class="p">()</span><span class="o">.</span><span class="n">addRenderer</span><span class="p">(</span><span class="n">rrmetadata</span><span class="p">)</span>
</pre></div>
</div>
<p>シンボルレイヤーと同様に、抽象メタデータコンストラクタはレンダラー名、ユーザーから見える名前、オプションでレンダラーのアイコンの名前を待ち受けます。<a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsRendererAbstractMetadata.html#qgis.core.QgsRendererAbstractMetadata.createRenderer" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">createRenderer()</span></code></a> メソッドは <code class="xref py py-class docutils literal notranslate"><span class="pre">QDomElement</span></code> インスタンスを渡し、DOMツリーからレンダラーの状態を復元するために使用することができます。<a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsRendererAbstractMetadata.html#qgis.core.QgsRendererAbstractMetadata.createRendererWidget" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">createRendererWidget()</span></code></a> メソッドは、設定ウィジェットを作成します。レンダラーにGUIが付属していない場合は、存在する必要はありませんし、<code class="docutils literal notranslate"><span class="pre">None</span></code> を返すこともできます。</p>
<p>アイコンをレンダラーに関連付けるには、 <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsRendererAbstractMetadata.html#qgis.core.QgsRendererAbstractMetadata" title="(in QGIS Python API v3.34)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QgsRendererAbstractMetadata</span></code></a> コンストラクタで第3引数（オプション）として指定します --- RandomRendererMetadata <code class="xref py py-func docutils literal notranslate"><span class="pre">__init__()</span></code> 関数にある基底クラスのコンストラクタは次のようになります</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">QgsRendererAbstractMetadata</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
       <span class="s2">&quot;RandomRenderer&quot;</span><span class="p">,</span>
       <span class="s2">&quot;Random renderer&quot;</span><span class="p">,</span>
       <span class="n">QIcon</span><span class="p">(</span><span class="n">QPixmap</span><span class="p">(</span><span class="s2">&quot;RandomRendererIcon.png&quot;</span><span class="p">,</span> <span class="s2">&quot;png&quot;</span><span class="p">)))</span>
</pre></div>
</div>
<p>アイコンはメタデータクラスの <a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsRendererAbstractMetadata.html#qgis.core.QgsRendererAbstractMetadata.setIcon" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">setIcon()</span></code></a> メソッドを使って後で関連付けることもできます。アイコンはファイルから読み込むこともできますし、<a class="reference external" href="https://doc.qt.io/qt-5/resources.html">Qt resource</a> （PyQt5はPython用の .qrcコンパイラを含んでいます）からも読み込むことができます。</p>
</section>
</section>
<section id="further-topics">
<h2><a class="toc-backref" href="#id28" role="doc-backlink"><span class="section-number">6.9. </span>より詳しいトピック</a><a class="headerlink" href="#further-topics" title="Link to this heading"></a></h2>
<p><strong>TODO:</strong></p>
<ul class="simple">
<li><p>シンボルの作成や修正</p></li>
<li><p>スタイルの操作 (<a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsStyle.html#qgis.core.QgsStyle" title="(in QGIS Python API v3.34)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QgsStyle</span></code></a>)</p></li>
<li><p>カラーランプの操作 (<a class="reference external" href="https://qgis.org/pyqgis/3.34/core/QgsColorRamp.html#qgis.core.QgsColorRamp" title="(in QGIS Python API v3.34)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QgsColorRamp</span></code></a>)</p></li>
<li><p>シンボルレイヤーとレンダラーのレジストリを調べる方法</p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="raster.html" class="btn btn-neutral float-left" title="5. ラスタレイヤを使う" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="geometry.html" class="btn btn-neutral float-right" title="7. ジオメトリの操作" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2002-now, QGIS project.
      <span class="lastupdated">最終更新: 2024 5月 30, 01:33 +0900
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <!-- Transifex follows a particular logic to build target pages:
Expected French translation link for https://docs.qgis.org/3.28/en/docs/user_manual/print_composer/overview_composer.html
would return https://app.transifex.com/qgis/qgis-documentation/translate/#fr/aa6d8bc653526d38b295ca94bf8eee5e
with the md5 value of "github#qgis/QGIS-Documentation#release_3.28#locale/en/LC_MESSAGES/docs/user_manual/print_composer/overview_composer.po"-->
<!--Make sure that mismatching language codes between Transifex and Sphinx are converted-->


  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-info-circle"> QGIS Documentation </span>
      v: 3.34
      <span class="fa fa-caret-down"></span>
    </span>

    <div class="rst-other-versions">
      <dl>
        <dt>Languages</dt>
        
          <dd><a href="https://docs.qgis.org/3.34/en/docs/pyqgis_developer_cookbook/vector.html">en</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/cs/docs/pyqgis_developer_cookbook/vector.html">cs</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/de/docs/pyqgis_developer_cookbook/vector.html">de</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/es/docs/pyqgis_developer_cookbook/vector.html">es</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/fr/docs/pyqgis_developer_cookbook/vector.html">fr</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/hu/docs/pyqgis_developer_cookbook/vector.html">hu</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/it/docs/pyqgis_developer_cookbook/vector.html">it</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/ja/docs/pyqgis_developer_cookbook/vector.html">ja</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/ko/docs/pyqgis_developer_cookbook/vector.html">ko</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/lt/docs/pyqgis_developer_cookbook/vector.html">lt</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/nl/docs/pyqgis_developer_cookbook/vector.html">nl</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/pt_BR/docs/pyqgis_developer_cookbook/vector.html">pt_BR</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/pt_PT/docs/pyqgis_developer_cookbook/vector.html">pt_PT</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/ro/docs/pyqgis_developer_cookbook/vector.html">ro</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/ru/docs/pyqgis_developer_cookbook/vector.html">ru</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/zh-Hans/docs/pyqgis_developer_cookbook/vector.html">zh-Hans</a></dd>
        
      </dl>

      <dl>
        <dt>Versions</dt>
        
          <dd><a href="https://docs.qgis.org/testing/ja/docs/pyqgis_developer_cookbook/vector.html">testing</a></dd>
        
          <dd><a href="https://docs.qgis.org/latest/ja/docs/pyqgis_developer_cookbook/vector.html">latest</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/ja/docs/pyqgis_developer_cookbook/vector.html">3.34</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.28/ja/docs/pyqgis_developer_cookbook/vector.html">3.28</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.22/ja/docs/pyqgis_developer_cookbook/vector.html">3.22</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.16/ja/docs/pyqgis_developer_cookbook/vector.html">3.16</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.10/ja/docs/pyqgis_developer_cookbook/vector.html">3.10</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.4/ja/docs/pyqgis_developer_cookbook/vector.html">3.4</a></dd>
        
          <dd><a href="https://docs.qgis.org/2.18/ja/docs/pyqgis_developer_cookbook/vector.html">2.18</a></dd>
        
      </dl>

       
       <dl>
        <dt>Downloads</dt>
        
          <dd><a href="https://docs.qgis.org/3.34/pdf">PDF</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/zip">HTML</a></dd>
        
      </dl>
      

      
       
      <dl>
        <dt>Contribute to Docs</dt>
          <dd>
            <a href="https://github.com/qgis/QGIS-Documentation/edit/master/docs/pyqgis_developer_cookbook/vector.rst" target="_blank" rel="noopener noreferrer">Edit on GitHub</a>
          </dd>
          
          
          <dd>
            <a href="https://app.transifex.com/qgis/qgis-documentation/translate/#ja/ceb0ffff1b32b1edf287cfe329c99fad" target="_blank" rel="noopener noreferrer">Translate Page</a>
          </dd>
          
          <dd>
            <a href="https://github.com/qgis/QGIS-Documentation/issues" target="_blank" rel="noopener noreferrer">Report Issue</a>
          </dd>
      </dl>
      

      <dl>
        <dt>On QGIS Project</dt>
          <dd>
            <a href="https://qgis.org/ja" target="_blank" rel="noopener noreferrer">Home</a>
          </dd>
          <dd>
            <a href="https://qgis.org/api/3.34" target="_blank" rel="noopener noreferrer">C++ API</a>
          </dd>
          <dd>
            <a href="https://qgis.org/pyqgis/3.34" target="_blank" rel="noopener noreferrer">PyQGIS API</a>
          </dd>
          <dd>
            <a href="https://github.com/qgis/QGIS/tree/release-3_34" target="_blank" rel="noopener noreferrer">Source</a>
          </dd>
      </dl>

    </div>
  </div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>