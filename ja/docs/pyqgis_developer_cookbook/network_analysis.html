<!DOCTYPE html>
<html class="writer-html5" lang="ja" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>19. ネットワーク分析ライブラリ &mdash; QGIS Documentation  ドキュメント</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/qgis_docs.css?v=5415a924" />
      <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
      <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />

  
    <link rel="shortcut icon" href="../../_static/qgis_logo.ico"/>
    <link rel="canonical" href="https://docs.qgis.org/latest/en/docs/pyqgis_developer_cookbook/network_analysis.html"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=c033477b"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../../_static/copybutton.js?v=f281be69"></script>
        <script>let toggleHintShow = 'Click to show';</script>
        <script>let toggleHintHide = 'Click to hide';</script>
        <script>let toggleOpenOnPrint = 'true';</script>
        <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
        <script src="../../_static/translations.js?v=4dbe4bdc"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="索引" href="../../genindex.html" />
    <link rel="search" title="検索" href="../../search.html" />
    <link rel="next" title="20. QGIS ServerとPython" href="server.html" />
    <link rel="prev" title="18. プラグインレイヤを使う" href="pluginlayer.html" />
  <meta name="description" content="QGIS 3.34 documentation: 19. ネットワーク分析ライブラリ">
</head>

<body class="wy-body-for-nav">

  <nav class="release_status_topbar">
  </nav>

   

 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
   

          
          
          <a href="../index.html" class="icon icon-home">
            QGIS Documentation
              <img src="../../_static/logo.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                3.34
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
   <a href= "../../genindex.html">Index</a>
 
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">ユーザ向け</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/index.html">QGIS Desktopユーザーガイド／マニュアル (QGIS 3.34)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../server_manual/index.html">QGIS Serverガイド／マニュアル (QGIS 3.34)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../training_manual/index.html">トレーニングマニュアル</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gentle_gis_introduction/index.html">やさしい GIS 入門</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">ドキュメント執筆者向け</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../documentation_guidelines/index.html">ドキュメント作成のガイドライン</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">開発者向け</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">PyQGISクックブック (QGIS 3.34)</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="intro.html">1. はじめに</a></li>
<li class="toctree-l2"><a class="reference internal" href="loadproject.html">2. プロジェクトをロードする</a></li>
<li class="toctree-l2"><a class="reference internal" href="loadlayer.html">3. レイヤをロードする</a></li>
<li class="toctree-l2"><a class="reference internal" href="legend.html">4. 目次（TOC）へのアクセス</a></li>
<li class="toctree-l2"><a class="reference internal" href="raster.html">5. ラスタレイヤを使う</a></li>
<li class="toctree-l2"><a class="reference internal" href="vector.html">6. ベクタレイヤを使う</a></li>
<li class="toctree-l2"><a class="reference internal" href="geometry.html">7. ジオメトリの操作</a></li>
<li class="toctree-l2"><a class="reference internal" href="crs.html">8. 投影法サポート</a></li>
<li class="toctree-l2"><a class="reference internal" href="canvas.html">9. マップキャンバスを使う</a></li>
<li class="toctree-l2"><a class="reference internal" href="composer.html">10. 地図のレンダリングと印刷</a></li>
<li class="toctree-l2"><a class="reference internal" href="expressions.html">11. 式、フィルタ適用および値の算出</a></li>
<li class="toctree-l2"><a class="reference internal" href="settings.html">12. 設定の読み込みと保存</a></li>
<li class="toctree-l2"><a class="reference internal" href="communicating.html">13. ユーザーとコミュニケーションする</a></li>
<li class="toctree-l2"><a class="reference internal" href="authentication.html">14. 認証インフラストラクチャ</a></li>
<li class="toctree-l2"><a class="reference internal" href="tasks.html">15. タスク - バックグラウンドで重い仕事をする</a></li>
<li class="toctree-l2"><a class="reference internal" href="plugins/index.html">16. Pythonプラグインを開発する</a></li>
<li class="toctree-l2"><a class="reference internal" href="processing.html">17. プロセシングプラグインを書く</a></li>
<li class="toctree-l2"><a class="reference internal" href="pluginlayer.html">18. プラグインレイヤを使う</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">19. ネットワーク分析ライブラリ</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#general-information">19.1. 一般情報</a></li>
<li class="toctree-l3"><a class="reference internal" href="#building-a-graph">19.2. グラフを構築する</a></li>
<li class="toctree-l3"><a class="reference internal" href="#graph-analysis">19.3. グラフ分析</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#finding-shortest-paths">19.3.1. 最短経路を見つける</a></li>
<li class="toctree-l4"><a class="reference internal" href="#areas-of-availability">19.3.2. 利用可能領域</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="server.html">20. QGIS ServerとPython</a></li>
<li class="toctree-l2"><a class="reference internal" href="cheat_sheet.html">21. PyQGISチートシート</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../developers_guide/index.html">開発者ガイド</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">QGIS Documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">PyQGIS 開発者用 Cookbook</a></li>
      <li class="breadcrumb-item active"><span class="section-number">19. </span>ネットワーク分析ライブラリ</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/qgis/QGIS-Documentation/blob/master/docs/pyqgis_developer_cookbook/network_analysis.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul><div class="rst-breadcrumbs-buttons" role="navigation" aria-label="Sequential page navigation">
        <a href="pluginlayer.html" class="btn btn-neutral float-left" title="18. プラグインレイヤを使う" accesskey="p"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="server.html" class="btn btn-neutral float-right" title="20. QGIS ServerとPython" accesskey="n">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
  </div>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <blockquote>
<div><div class="admonition important">
<p class="admonition-title">重要</p>
<p>翻訳は <a class="reference external" href="https://qgis.org/en/site/getinvolved/translate.html#becoming-a-translator">あなたが参加できる</a> コミュニティの取り組みです。このページは現在 100.00% 翻訳されています。</p>
</div>
</div></blockquote>
<section id="network-analysis-library">
<span id="network-analysis"></span><h1><span class="section-number">19. </span>ネットワーク分析ライブラリ<a class="headerlink" href="#network-analysis-library" title="Link to this heading"></a></h1>
<div class="admonition hint">
<p class="admonition-title">ヒント</p>
<p>pyqgisコンソールを使わない場合、このページにあるコードスニペットは次のインポートが必要です:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">qgis.core</span> <span class="kn">import</span> <span class="p">(</span>
  <span class="n">QgsVectorLayer</span><span class="p">,</span>
  <span class="n">QgsPointXY</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<nav class="contents local" id="id1">
<ul class="simple">
<li><p><a class="reference internal" href="#general-information" id="id2">一般情報</a></p></li>
<li><p><a class="reference internal" href="#building-a-graph" id="id3">グラフを構築する</a></p></li>
<li><p><a class="reference internal" href="#graph-analysis" id="id4">グラフ分析</a></p>
<ul>
<li><p><a class="reference internal" href="#finding-shortest-paths" id="id5">最短経路を見つける</a></p></li>
<li><p><a class="reference internal" href="#areas-of-availability" id="id6">利用可能領域</a></p></li>
</ul>
</li>
</ul>
</nav>
<p>ネットワーク分析ライブラリは次のことに使われます:</p>
<ul class="simple">
<li><p>地理データ（ポリライン・ベクタレイヤ）から数学的グラフを作る</p></li>
<li><p>グラフ理論の基本的な手法を実装する（現在はダイクストラ法のみ）</p></li>
</ul>
<p>ネットワーク分析ライブラリはRoadGraphコアプラグインから基本機能をエクスポートすることによって作成されました。今はそのメソッドをプラグインで、またはPythonのコンソールから直接使用できます。</p>
<section id="general-information">
<h2><a class="toc-backref" href="#id2" role="doc-backlink"><span class="section-number">19.1. </span>一般情報</a><a class="headerlink" href="#general-information" title="Link to this heading"></a></h2>
<p>手短に言えば、一般的なユースケースは、次のように記述できます。</p>
<ol class="arabic simple">
<li><p>地理データから地理的なグラフ（たいていはポリラインベクタレイヤ）を作成する</p></li>
<li><p>グラフ分析を実行する</p></li>
<li><p>分析結果を利用する（例えば、その可視化）</p></li>
</ol>
</section>
<section id="building-a-graph">
<h2><a class="toc-backref" href="#id3" role="doc-backlink"><span class="section-number">19.2. </span>グラフを構築する</a><a class="headerlink" href="#building-a-graph" title="Link to this heading"></a></h2>
<p>最初にする必要がある事は --- 入力データを準備すること、つまりベクタレイヤをグラフに変換することです。これからのすべての操作は、レイヤではなく、このグラフを使用します。</p>
<p>ソースとしてどんなポリラインベクタレイヤも使用できます。ポリラインの頂点は、グラフの頂点となり、ポリラインのセグメントは、グラフの辺です。いくつかのノードが同じ座標を持っている場合、それらは同じグラフの頂点です。だから共通のノードを持つ2つの線は互いに接続しています。</p>
<p>さらに、グラフの作成時には、入力ベクタレイヤに好きな数だけ追加の点を「固定する」（「結びつける」）ことが可能です。追加の点それぞれについて、対応箇所---最も近いグラフの頂点または最も近いグラフの辺、が探し出されます。後者の場合、辺は分割されて新しい頂点が追加されるでしょう。</p>
<p>ベクタレイヤ属性と辺の長さは、辺のプロパティとして使用できます。</p>
<p>ベクタレイヤからグラフへの変換は、<a class="reference external" href="https://en.wikipedia.org/wiki/Builder_pattern">Builder</a> プログラミングパターンを使って行われます。グラフはいわゆるDirectorを使って構築されます。今のところDirectorは1つしかありません: <a class="reference external" href="https://qgis.org/pyqgis/3.34/analysis/QgsVectorLayerDirector.html#qgis.analysis.QgsVectorLayerDirector" title="(in QGIS Python API v3.34)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QgsVectorLayerDirector</span></code></a>。ディレクタは、ビルダがラインベクタレイヤからグラフを作るのに使う基本的な設定を行います。現在のところ、ディレクタと同様に、ビルダは1つしかありません: <a class="reference external" href="https://qgis.org/pyqgis/3.34/analysis/QgsGraphBuilder.html#qgis.analysis.QgsGraphBuilder" title="(in QGIS Python API v3.34)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QgsGraphBuilder</span></code></a> で、 <a class="reference external" href="https://qgis.org/pyqgis/3.34/analysis/QgsGraph.html#qgis.analysis.QgsGraph" title="(in QGIS Python API v3.34)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QgsGraph</span></code></a> オブジェクトを作成します。BGL &lt;<a class="reference external" href="https://www.boost.org/doc/libs/1_48_0/libs/graph/doc/index.html">https://www.boost.org/doc/libs/1_48_0/libs/graph/doc/index.html</a>&gt;`_ や <a class="reference external" href="https://networkx.org/">NetworkX</a> などのライブラリと互換性のあるグラフを構築する独自のビルダを実装することもできます。</p>
<p>辺のプロパティを計算するために、プログラミングパターン <a class="reference external" href="https://en.wikipedia.org/wiki/Strategy_pattern">strategy</a> が使用されます。今のところ（経路の長さを考慮する） <a class="reference external" href="https://qgis.org/pyqgis/3.34/analysis/QgsNetworkDistanceStrategy.html#qgis.analysis.QgsNetworkDistanceStrategy" title="(in QGIS Python API v3.34)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QgsNetworkDistanceStrategy</span></code></a> 戦略と（速度も考慮する）:class:<cite>QgsNetworkSpeedStrategy &lt;qgis.analysis.QgsNetworkSpeedStrategy&gt;</cite> 戦略のみが利用可能です。すべての必要なパラメータを使用する独自の戦略を実装することができます。例えば、RoadGraphプラグインでは、属性から辺の長さと速度の値を使用して移動時間を計算する戦略を使用しています。</p>
<p>では手順に行きましょう。</p>
<p>まず、このライブラリを使うには、解析モジュールをインポートする必要があります</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">qgis.analysis</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>
</div>
<p>それからディレクタを作成するためのいくつかの例</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1"># don&#39;t use information about road direction from layer attributes,</span>
<span class="linenos"> 2</span><span class="c1"># all roads are treated as two-way</span>
<span class="linenos"> 3</span><span class="n">director</span> <span class="o">=</span> <span class="n">QgsVectorLayerDirector</span><span class="p">(</span><span class="n">vectorLayer</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">QgsVectorLayerDirector</span><span class="o">.</span><span class="n">DirectionBoth</span><span class="p">)</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="c1"># use field with index 5 as source of information about road direction.</span>
<span class="linenos"> 6</span><span class="c1"># one-way roads with direct direction have attribute value &quot;yes&quot;,</span>
<span class="linenos"> 7</span><span class="c1"># one-way roads with reverse direction have the value &quot;1&quot;, and accordingly</span>
<span class="linenos"> 8</span><span class="c1"># bidirectional roads have &quot;no&quot;. By default roads are treated as two-way.</span>
<span class="linenos"> 9</span><span class="c1"># This scheme can be used with OpenStreetMap data</span>
<span class="linenos">10</span><span class="n">director</span> <span class="o">=</span> <span class="n">QgsVectorLayerDirector</span><span class="p">(</span><span class="n">vectorLayer</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;yes&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;no&#39;</span><span class="p">,</span> <span class="n">QgsVectorLayerDirector</span><span class="o">.</span><span class="n">DirectionBoth</span><span class="p">)</span>
</pre></div>
</div>
<p>ディレクタを構築するには、グラフ構造のソースとなるベクタレイヤと、各道路セグメントで許容される移動に関する情報（一方通行か双方向移動か、直進か逆走か）を渡す必要があります。呼び出しは次のようになります</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="n">director</span> <span class="o">=</span> <span class="n">QgsVectorLayerDirector</span><span class="p">(</span><span class="n">vectorLayer</span><span class="p">,</span>
<span class="linenos">2</span>                                  <span class="n">directionFieldId</span><span class="p">,</span>
<span class="linenos">3</span>                                  <span class="n">directDirectionValue</span><span class="p">,</span>
<span class="linenos">4</span>                                  <span class="n">reverseDirectionValue</span><span class="p">,</span>
<span class="linenos">5</span>                                  <span class="n">bothDirectionValue</span><span class="p">,</span>
<span class="linenos">6</span>                                  <span class="n">defaultDirection</span><span class="p">)</span>
</pre></div>
</div>
<p>そして、ここでこれらのパラメータは何を意味するかの完全なリストは以下のとおりです：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">vectorLayer</span></code> --- グラフを作るのに使われるベクタレイヤ</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">directionFieldId</span></code> ---道路の方向に関する情報が格納されている属性テーブルのフィールドのインデックス。 <code class="docutils literal notranslate"><span class="pre">-1</span></code> ならこの情報をまったく使用されません。整数。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">directDirectionValue</span></code> ---順方向の道路（線の最初の点から最後の点へ移動）のフィールド値。文字列。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">reverseDirectionValue</span></code> ---逆方向の道路（線の最後の点から最初の点へ移動）のフィールド値。文字列。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bothDirectionValue</span></code> ---双方向道路（最初の点から最後の点まで、且つ、最後の点から最初の点まで移動できるような道路）のフィールド値。文字列。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">defaultDirection</span></code> --- デフォルトの道路の方向。この値はフィールド <code class="docutils literal notranslate"><span class="pre">directionFieldId</span></code> が設定されていない、または上記の3つの値のいずれとも異なる値を持つ道路に使用されます。設定可能な値は以下の通りです：</p>
<ul>
<li><p><a class="reference external" href="https://qgis.org/pyqgis/3.34/analysis/QgsVectorLayerDirector.html#qgis.analysis.QgsVectorLayerDirector.DirectionForward" title="(in QGIS Python API v3.34)"><code class="xref py py-attr docutils literal notranslate"><span class="pre">QgsVectorLayerDirector.DirectionForward</span></code></a> --- 一方向順方向</p></li>
<li><p><a class="reference external" href="https://qgis.org/pyqgis/3.34/analysis/QgsVectorLayerDirector.html#qgis.analysis.QgsVectorLayerDirector.DirectionBackward" title="(in QGIS Python API v3.34)"><code class="xref py py-attr docutils literal notranslate"><span class="pre">QgsVectorLayerDirector.DirectionBackward</span></code></a> --- 一方向逆方向</p></li>
<li><p><a class="reference external" href="https://qgis.org/pyqgis/3.34/analysis/QgsVectorLayerDirector.html#qgis.analysis.QgsVectorLayerDirector.DirectionBoth" title="(in QGIS Python API v3.34)"><code class="xref py py-attr docutils literal notranslate"><span class="pre">QgsVectorLayerDirector.DirectionBoth</span></code></a> --- 両方向</p></li>
</ul>
</li>
</ul>
<p>それから、辺のプロパティを計算するための戦略を作成することが必要です</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="c1"># The index of the field that contains information about the edge speed</span>
<span class="linenos">2</span><span class="n">attributeId</span> <span class="o">=</span> <span class="mi">1</span>
<span class="linenos">3</span><span class="c1"># Default speed value</span>
<span class="linenos">4</span><span class="n">defaultValue</span> <span class="o">=</span> <span class="mi">50</span>
<span class="linenos">5</span><span class="c1"># Conversion from speed to metric units (&#39;1&#39; means no conversion)</span>
<span class="linenos">6</span><span class="n">toMetricFactor</span> <span class="o">=</span> <span class="mi">1</span>
<span class="linenos">7</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">QgsNetworkSpeedStrategy</span><span class="p">(</span><span class="n">attributeId</span><span class="p">,</span> <span class="n">defaultValue</span><span class="p">,</span> <span class="n">toMetricFactor</span><span class="p">)</span>
</pre></div>
</div>
<p>そして、ディレクタにこの戦略について教えます</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">director</span> <span class="o">=</span> <span class="n">QgsVectorLayerDirector</span><span class="p">(</span><span class="n">vectorLayer</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">director</span><span class="o">.</span><span class="n">addStrategy</span><span class="p">(</span><span class="n">strategy</span><span class="p">)</span>
</pre></div>
</div>
<p>これでグラフを作成するビルダを使うことができます。<a class="reference external" href="https://qgis.org/pyqgis/3.34/analysis/QgsGraphBuilder.html#qgis.analysis.QgsGraphBuilder" title="(in QGIS Python API v3.34)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QgsGraphBuilder</span></code></a> クラスのコンストラクタはいくつかの引数を取ります：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">crs</span></code> --- 使用する座標参照系。必須引数。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">otfEnabled</span></code> --- 「オンザフライ」再投影を使用するかどうか。デフォルトは <code class="xref py py-const docutils literal notranslate"><span class="pre">True</span></code> （OTFを使う）。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">topologyTolerance</span></code> --- トポロジの許容範囲。デフォルト値は 0。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ellipsoidID</span></code> --- 使用する楕円体。デフォルトは &quot;WGS84&quot;。</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># only CRS is set, all other values are defaults</span>
<span class="n">builder</span> <span class="o">=</span> <span class="n">QgsGraphBuilder</span><span class="p">(</span><span class="n">vectorLayer</span><span class="o">.</span><span class="n">crs</span><span class="p">())</span>
</pre></div>
</div>
<p>分析に使用されるいくつかの点を定義することもできます。例えば</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">startPoint</span> <span class="o">=</span> <span class="n">QgsPointXY</span><span class="p">(</span><span class="mf">1179720.1871</span><span class="p">,</span> <span class="mf">5419067.3507</span><span class="p">)</span>
<span class="n">endPoint</span> <span class="o">=</span> <span class="n">QgsPointXY</span><span class="p">(</span><span class="mf">1180616.0205</span><span class="p">,</span> <span class="mf">5419745.7839</span><span class="p">)</span>
</pre></div>
</div>
<p>これですべてが整いましたので、グラフを構築し、それにこれらの点を「結びつける」ことができます。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">tiedPoints</span> <span class="o">=</span> <span class="n">director</span><span class="o">.</span><span class="n">makeGraph</span><span class="p">(</span><span class="n">builder</span><span class="p">,</span> <span class="p">[</span><span class="n">startPoint</span><span class="p">,</span> <span class="n">endPoint</span><span class="p">])</span>
</pre></div>
</div>
<p>グラフを構築するには（レイヤ中の地物数とレイヤの大きさに応じて）いくらか時間がかかることがあります。 <code class="docutils literal notranslate"><span class="pre">tiedPoints</span></code> は「結びつけられた」点の座標を持つリストです。ビルド操作が完了するとグラフが得られ、それを分析のために使用できます</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">graph</span><span class="p">()</span>
</pre></div>
</div>
<p>次のコードで、点の頂点インデックスを取得できます</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">startId</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">findVertex</span><span class="p">(</span><span class="n">tiedPoints</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">endId</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">findVertex</span><span class="p">(</span><span class="n">tiedPoints</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</section>
<section id="graph-analysis">
<h2><a class="toc-backref" href="#id4" role="doc-backlink"><span class="section-number">19.3. </span>グラフ分析</a><a class="headerlink" href="#graph-analysis" title="Link to this heading"></a></h2>
<p>ネットワーク分析はこの二つの質問に対する答えを見つけるために使用されます：どの頂点が接続されているか、どのように最短経路を検索するか。これらの問題を解決するため、ネットワーク解析ライブラリではダイクストラのアルゴリズムを提供しています。</p>
<p>ダイクストラ法は、グラフの１つの頂点から他のすべての頂点への最短ルートおよび最適化パラメーターの値を見つけます。結果は、最短経路木として表現できます。</p>
<p>最短経路木は、以下の性質を持つ有向加重グラフ（より正確には木）です：</p>
<ul class="simple">
<li><p>流入する辺がない頂点が1つだけあります - 木の根</p></li>
<li><p>他のすべての頂点には流入する辺が１つだけあります</p></li>
<li><p>頂点Bが頂点Aから到達可能である場合、このグラフ上のAからBへの経路は、単一の利用可能な経路であり、それは最適（最短）です</p></li>
</ul>
<p>最短経路木を得るには <a class="reference external" href="https://qgis.org/pyqgis/3.34/analysis/QgsGraphAnalyzer.html#qgis.analysis.QgsGraphAnalyzer" title="(in QGIS Python API v3.34)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QgsGraphAnalyzer</span></code></a> クラスの <a class="reference external" href="https://qgis.org/pyqgis/3.34/analysis/QgsGraphAnalyzer.html#qgis.analysis.QgsGraphAnalyzer.shortestTree" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">shortestTree()</span></code></a> と <a class="reference external" href="https://qgis.org/pyqgis/3.34/analysis/QgsGraphAnalyzer.html#qgis.analysis.QgsGraphAnalyzer.dijkstra" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">dijkstra()</span></code></a> メソッドを使用します。<a class="reference external" href="https://qgis.org/pyqgis/3.34/analysis/QgsGraphAnalyzer.html#qgis.analysis.QgsGraphAnalyzer.dijkstra" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">dijkstra()</span></code></a> メソッドを使用することを推奨します。なぜなら、このメソッドはより速く動作し、より効率的にメモリを使用するからです。</p>
<p><a class="reference external" href="https://qgis.org/pyqgis/3.34/analysis/QgsGraphAnalyzer.html#qgis.analysis.QgsGraphAnalyzer.shortestTree" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">shortestTree()</span></code></a> メソッドは最短経路木を様々な角度から考えたいときに便利です。それは常に新しいグラフオブジェクト(QgsGraph)を生成し、3つの変数を受け取ります：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">source</span></code> --- 入力グラフ</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">startVertexIdx</span></code> --- 木上の点のインデックス（木の根）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">criterionNum</span></code> --- 使用する辺のプロパティの数（0から始まる）。</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">tree</span> <span class="o">=</span> <span class="n">QgsGraphAnalyzer</span><span class="o">.</span><span class="n">shortestTree</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">startId</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p><a class="reference external" href="https://qgis.org/pyqgis/3.34/analysis/QgsGraphAnalyzer.html#qgis.analysis.QgsGraphAnalyzer.dijkstra" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">dijkstra()</span></code></a> メソッドは同じ引数を持ちますが、2つの配列を返します。最初の配列要素 <cite>n</cite> には入力辺のインデックス、または、入力辺がないときは-1が格納されます。2 番目の配列の要素 <cite>n</cite> には、木の根から頂点 <cite>n</cite> までの距離、または頂点 <cite>n</cite> が根から到達できない場合は DOUBLE_MAX が格納されます。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">cost</span><span class="p">)</span> <span class="o">=</span> <span class="n">QgsGraphAnalyzer</span><span class="o">.</span><span class="n">dijkstra</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">startId</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>以下は、 <a class="reference external" href="https://qgis.org/pyqgis/3.34/analysis/QgsGraphAnalyzer.html#qgis.analysis.QgsGraphAnalyzer.shortestTree" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">shortestTree()</span></code></a> メソッドで作成したグラフを使用して、最短経路木を表示する非常に簡単なコードです（ <span class="guilabel">レイヤ</span> パネルでラインストリングレイヤを選択し、座標をあなたのものに置き換えてください）。</p>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>このコードは例としてだけ使ってください。これは <a class="reference external" href="https://qgis.org/pyqgis/3.34/gui/QgsRubberBand.html#qgis.gui.QgsRubberBand" title="(in QGIS Python API v3.34)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QgsRubberBand</span></code></a> オブジェクトを大量に生成するので、大きなデータセットでは遅くなるかもしれません。</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">from</span> <span class="nn">qgis.core</span> <span class="kn">import</span> <span class="o">*</span>
<span class="linenos"> 2</span><span class="kn">from</span> <span class="nn">qgis.gui</span> <span class="kn">import</span> <span class="o">*</span>
<span class="linenos"> 3</span><span class="kn">from</span> <span class="nn">qgis.analysis</span> <span class="kn">import</span> <span class="o">*</span>
<span class="linenos"> 4</span><span class="kn">from</span> <span class="nn">qgis.PyQt.QtCore</span> <span class="kn">import</span> <span class="o">*</span>
<span class="linenos"> 5</span><span class="kn">from</span> <span class="nn">qgis.PyQt.QtGui</span> <span class="kn">import</span> <span class="o">*</span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span><span class="n">vectorLayer</span> <span class="o">=</span> <span class="n">QgsVectorLayer</span><span class="p">(</span><span class="s1">&#39;testdata/network.gpkg|layername=network_lines&#39;</span><span class="p">,</span> <span class="s1">&#39;lines&#39;</span><span class="p">)</span>
<span class="linenos"> 8</span><span class="n">director</span> <span class="o">=</span> <span class="n">QgsVectorLayerDirector</span><span class="p">(</span><span class="n">vectorLayer</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">QgsVectorLayerDirector</span><span class="o">.</span><span class="n">DirectionBoth</span><span class="p">)</span>
<span class="linenos"> 9</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">QgsNetworkDistanceStrategy</span><span class="p">()</span>
<span class="linenos">10</span><span class="n">director</span><span class="o">.</span><span class="n">addStrategy</span><span class="p">(</span><span class="n">strategy</span><span class="p">)</span>
<span class="linenos">11</span><span class="n">builder</span> <span class="o">=</span> <span class="n">QgsGraphBuilder</span><span class="p">(</span><span class="n">vectorLayer</span><span class="o">.</span><span class="n">crs</span><span class="p">())</span>
<span class="linenos">12</span>
<span class="linenos">13</span><span class="n">pStart</span> <span class="o">=</span> <span class="n">QgsPointXY</span><span class="p">(</span><span class="mf">1179661.925139</span><span class="p">,</span><span class="mf">5419188.074362</span><span class="p">)</span>
<span class="linenos">14</span><span class="n">tiedPoint</span> <span class="o">=</span> <span class="n">director</span><span class="o">.</span><span class="n">makeGraph</span><span class="p">(</span><span class="n">builder</span><span class="p">,</span> <span class="p">[</span><span class="n">pStart</span><span class="p">])</span>
<span class="linenos">15</span><span class="n">pStart</span> <span class="o">=</span> <span class="n">tiedPoint</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="linenos">16</span>
<span class="linenos">17</span><span class="n">graph</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">graph</span><span class="p">()</span>
<span class="linenos">18</span>
<span class="linenos">19</span><span class="n">idStart</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">findVertex</span><span class="p">(</span><span class="n">pStart</span><span class="p">)</span>
<span class="linenos">20</span>
<span class="linenos">21</span><span class="n">tree</span> <span class="o">=</span> <span class="n">QgsGraphAnalyzer</span><span class="o">.</span><span class="n">shortestTree</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">idStart</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="linenos">22</span>
<span class="linenos">23</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos">24</span><span class="k">while</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">tree</span><span class="o">.</span><span class="n">edgeCount</span><span class="p">()):</span>
<span class="linenos">25</span>  <span class="n">rb</span> <span class="o">=</span> <span class="n">QgsRubberBand</span><span class="p">(</span><span class="n">iface</span><span class="o">.</span><span class="n">mapCanvas</span><span class="p">())</span>
<span class="linenos">26</span>  <span class="n">rb</span><span class="o">.</span><span class="n">setColor</span> <span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">red</span><span class="p">)</span>
<span class="linenos">27</span>  <span class="n">rb</span><span class="o">.</span><span class="n">addPoint</span> <span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">vertex</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">fromVertex</span><span class="p">())</span><span class="o">.</span><span class="n">point</span><span class="p">())</span>
<span class="linenos">28</span>  <span class="n">rb</span><span class="o">.</span><span class="n">addPoint</span> <span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">vertex</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">toVertex</span><span class="p">())</span><span class="o">.</span><span class="n">point</span><span class="p">())</span>
<span class="linenos">29</span>  <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
</pre></div>
</div>
<p>同じことですが、<a class="reference external" href="https://qgis.org/pyqgis/3.34/analysis/QgsGraphAnalyzer.html#qgis.analysis.QgsGraphAnalyzer.dijkstra" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">dijkstra()</span></code></a> メソッドを使います</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">from</span> <span class="nn">qgis.core</span> <span class="kn">import</span> <span class="o">*</span>
<span class="linenos"> 2</span><span class="kn">from</span> <span class="nn">qgis.gui</span> <span class="kn">import</span> <span class="o">*</span>
<span class="linenos"> 3</span><span class="kn">from</span> <span class="nn">qgis.analysis</span> <span class="kn">import</span> <span class="o">*</span>
<span class="linenos"> 4</span><span class="kn">from</span> <span class="nn">qgis.PyQt.QtCore</span> <span class="kn">import</span> <span class="o">*</span>
<span class="linenos"> 5</span><span class="kn">from</span> <span class="nn">qgis.PyQt.QtGui</span> <span class="kn">import</span> <span class="o">*</span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span><span class="n">vectorLayer</span> <span class="o">=</span> <span class="n">QgsVectorLayer</span><span class="p">(</span><span class="s1">&#39;testdata/network.gpkg|layername=network_lines&#39;</span><span class="p">,</span> <span class="s1">&#39;lines&#39;</span><span class="p">)</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span><span class="n">director</span> <span class="o">=</span> <span class="n">QgsVectorLayerDirector</span><span class="p">(</span><span class="n">vectorLayer</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">QgsVectorLayerDirector</span><span class="o">.</span><span class="n">DirectionBoth</span><span class="p">)</span>
<span class="linenos">10</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">QgsNetworkDistanceStrategy</span><span class="p">()</span>
<span class="linenos">11</span><span class="n">director</span><span class="o">.</span><span class="n">addStrategy</span><span class="p">(</span><span class="n">strategy</span><span class="p">)</span>
<span class="linenos">12</span><span class="n">builder</span> <span class="o">=</span> <span class="n">QgsGraphBuilder</span><span class="p">(</span><span class="n">vectorLayer</span><span class="o">.</span><span class="n">crs</span><span class="p">())</span>
<span class="linenos">13</span>
<span class="linenos">14</span><span class="n">pStart</span> <span class="o">=</span> <span class="n">QgsPointXY</span><span class="p">(</span><span class="mf">1179661.925139</span><span class="p">,</span><span class="mf">5419188.074362</span><span class="p">)</span>
<span class="linenos">15</span><span class="n">tiedPoint</span> <span class="o">=</span> <span class="n">director</span><span class="o">.</span><span class="n">makeGraph</span><span class="p">(</span><span class="n">builder</span><span class="p">,</span> <span class="p">[</span><span class="n">pStart</span><span class="p">])</span>
<span class="linenos">16</span><span class="n">pStart</span> <span class="o">=</span> <span class="n">tiedPoint</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="linenos">17</span>
<span class="linenos">18</span><span class="n">graph</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">graph</span><span class="p">()</span>
<span class="linenos">19</span>
<span class="linenos">20</span><span class="n">idStart</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">findVertex</span><span class="p">(</span><span class="n">pStart</span><span class="p">)</span>
<span class="linenos">21</span>
<span class="linenos">22</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">costs</span><span class="p">)</span> <span class="o">=</span> <span class="n">QgsGraphAnalyzer</span><span class="o">.</span><span class="n">dijkstra</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">idStart</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="linenos">23</span>
<span class="linenos">24</span><span class="k">for</span> <span class="n">edgeId</span> <span class="ow">in</span> <span class="n">tree</span><span class="p">:</span>
<span class="linenos">25</span>  <span class="k">if</span> <span class="n">edgeId</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
<span class="linenos">26</span>    <span class="k">continue</span>
<span class="linenos">27</span>  <span class="n">rb</span> <span class="o">=</span> <span class="n">QgsRubberBand</span><span class="p">(</span><span class="n">iface</span><span class="o">.</span><span class="n">mapCanvas</span><span class="p">())</span>
<span class="linenos">28</span>  <span class="n">rb</span><span class="o">.</span><span class="n">setColor</span> <span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">red</span><span class="p">)</span>
<span class="linenos">29</span>  <span class="n">rb</span><span class="o">.</span><span class="n">addPoint</span> <span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">vertex</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="n">edgeId</span><span class="p">)</span><span class="o">.</span><span class="n">fromVertex</span><span class="p">())</span><span class="o">.</span><span class="n">point</span><span class="p">())</span>
<span class="linenos">30</span>  <span class="n">rb</span><span class="o">.</span><span class="n">addPoint</span> <span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">vertex</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="n">edgeId</span><span class="p">)</span><span class="o">.</span><span class="n">toVertex</span><span class="p">())</span><span class="o">.</span><span class="n">point</span><span class="p">())</span>
</pre></div>
</div>
<section id="finding-shortest-paths">
<h3><a class="toc-backref" href="#id5" role="doc-backlink"><span class="section-number">19.3.1. </span>最短経路を見つける</a><a class="headerlink" href="#finding-shortest-paths" title="Link to this heading"></a></h3>
<p>2点間の最適経路を求めるには、次のようなアプローチが用いられます。両方の点（始点Aと終点B）はグラフが構築されるときそれに「結び付け」されています。その後、 <a class="reference external" href="https://qgis.org/pyqgis/3.34/analysis/QgsGraphAnalyzer.html#qgis.analysis.QgsGraphAnalyzer.shortestTree" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">shortestTree()</span></code></a> または <a class="reference external" href="https://qgis.org/pyqgis/3.34/analysis/QgsGraphAnalyzer.html#qgis.analysis.QgsGraphAnalyzer.dijkstra" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">dijkstra()</span></code></a> メソッドを用いて、始点Aを根とする最短経路木を構築します。 同じ木で終点Bも求め、点Bから点Aまで木を歩き始めます。アルゴリズム全体は次のように書けます：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="n">assign</span> <span class="n">T</span> <span class="o">=</span> <span class="n">B</span>
<span class="linenos">2</span><span class="k">while</span> <span class="n">T</span> <span class="o">!=</span> <span class="n">B</span>
<span class="linenos">3</span>    <span class="n">add</span> <span class="n">point</span> <span class="n">T</span> <span class="n">to</span> <span class="n">path</span>
<span class="linenos">4</span>    <span class="n">get</span> <span class="n">incoming</span> <span class="n">edge</span> <span class="k">for</span> <span class="n">point</span> <span class="n">T</span>
<span class="linenos">5</span>    <span class="n">look</span> <span class="k">for</span> <span class="n">point</span> <span class="n">TT</span><span class="p">,</span> <span class="n">that</span> <span class="ow">is</span> <span class="n">start</span> <span class="n">point</span> <span class="n">of</span> <span class="n">this</span> <span class="n">edge</span>
<span class="linenos">6</span>    <span class="n">assign</span> <span class="n">T</span> <span class="o">=</span> <span class="n">TT</span>
<span class="linenos">7</span><span class="n">add</span> <span class="n">point</span> <span class="n">A</span> <span class="n">to</span> <span class="n">path</span>
</pre></div>
</div>
<p>この時点において、この経路で走行中に訪問される頂点の反転リストの形（頂点は逆順で終点から始点へと列挙されている）で、経路が得られます。</p>
<p>以下は、QGIS Pythonコンソールで <a class="reference external" href="https://qgis.org/pyqgis/3.34/analysis/QgsGraphAnalyzer.html#qgis.analysis.QgsGraphAnalyzer.shortestTree" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">shortestTree()</span></code></a> メソッドを使うサンプルコードです（TOCにあるラインストリングレイヤを読み込んで選択し、コード内の座標を自分のものに置き換える必要があるかもしれません）</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">from</span> <span class="nn">qgis.core</span> <span class="kn">import</span> <span class="o">*</span>
<span class="linenos"> 2</span><span class="kn">from</span> <span class="nn">qgis.gui</span> <span class="kn">import</span> <span class="o">*</span>
<span class="linenos"> 3</span><span class="kn">from</span> <span class="nn">qgis.analysis</span> <span class="kn">import</span> <span class="o">*</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="kn">from</span> <span class="nn">qgis.PyQt.QtCore</span> <span class="kn">import</span> <span class="o">*</span>
<span class="linenos"> 6</span><span class="kn">from</span> <span class="nn">qgis.PyQt.QtGui</span> <span class="kn">import</span> <span class="o">*</span>
<span class="linenos"> 7</span>
<span class="linenos"> 8</span><span class="n">vectorLayer</span> <span class="o">=</span> <span class="n">QgsVectorLayer</span><span class="p">(</span><span class="s1">&#39;testdata/network.gpkg|layername=network_lines&#39;</span><span class="p">,</span> <span class="s1">&#39;lines&#39;</span><span class="p">)</span>
<span class="linenos"> 9</span><span class="n">builder</span> <span class="o">=</span> <span class="n">QgsGraphBuilder</span><span class="p">(</span><span class="n">vectorLayer</span><span class="o">.</span><span class="n">sourceCrs</span><span class="p">())</span>
<span class="linenos">10</span><span class="n">director</span> <span class="o">=</span> <span class="n">QgsVectorLayerDirector</span><span class="p">(</span><span class="n">vectorLayer</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">QgsVectorLayerDirector</span><span class="o">.</span><span class="n">DirectionBoth</span><span class="p">)</span>
<span class="linenos">11</span>
<span class="linenos">12</span><span class="n">startPoint</span> <span class="o">=</span> <span class="n">QgsPointXY</span><span class="p">(</span><span class="mf">1179661.925139</span><span class="p">,</span><span class="mf">5419188.074362</span><span class="p">)</span>
<span class="linenos">13</span><span class="n">endPoint</span> <span class="o">=</span> <span class="n">QgsPointXY</span><span class="p">(</span><span class="mf">1180942.970617</span><span class="p">,</span><span class="mf">5420040.097560</span><span class="p">)</span>
<span class="linenos">14</span>
<span class="linenos">15</span><span class="n">tiedPoints</span> <span class="o">=</span> <span class="n">director</span><span class="o">.</span><span class="n">makeGraph</span><span class="p">(</span><span class="n">builder</span><span class="p">,</span> <span class="p">[</span><span class="n">startPoint</span><span class="p">,</span> <span class="n">endPoint</span><span class="p">])</span>
<span class="linenos">16</span><span class="n">tStart</span><span class="p">,</span> <span class="n">tStop</span> <span class="o">=</span> <span class="n">tiedPoints</span>
<span class="linenos">17</span>
<span class="linenos">18</span><span class="n">graph</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">graph</span><span class="p">()</span>
<span class="linenos">19</span><span class="n">idxStart</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">findVertex</span><span class="p">(</span><span class="n">tStart</span><span class="p">)</span>
<span class="linenos">20</span>
<span class="linenos">21</span><span class="n">tree</span> <span class="o">=</span> <span class="n">QgsGraphAnalyzer</span><span class="o">.</span><span class="n">shortestTree</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">idxStart</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="linenos">22</span>
<span class="linenos">23</span><span class="n">idxStart</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">findVertex</span><span class="p">(</span><span class="n">tStart</span><span class="p">)</span>
<span class="linenos">24</span><span class="n">idxEnd</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">findVertex</span><span class="p">(</span><span class="n">tStop</span><span class="p">)</span>
<span class="linenos">25</span>
<span class="linenos">26</span><span class="k">if</span> <span class="n">idxEnd</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
<span class="linenos">27</span>    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;No route!&#39;</span><span class="p">)</span>
<span class="linenos">28</span>
<span class="linenos">29</span><span class="c1"># Add last point</span>
<span class="linenos">30</span><span class="n">route</span> <span class="o">=</span> <span class="p">[</span><span class="n">tree</span><span class="o">.</span><span class="n">vertex</span><span class="p">(</span><span class="n">idxEnd</span><span class="p">)</span><span class="o">.</span><span class="n">point</span><span class="p">()]</span>
<span class="linenos">31</span>
<span class="linenos">32</span><span class="c1"># Iterate the graph</span>
<span class="linenos">33</span><span class="k">while</span> <span class="n">idxEnd</span> <span class="o">!=</span> <span class="n">idxStart</span><span class="p">:</span>
<span class="linenos">34</span>    <span class="n">edgeIds</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">vertex</span><span class="p">(</span><span class="n">idxEnd</span><span class="p">)</span><span class="o">.</span><span class="n">incomingEdges</span><span class="p">()</span>
<span class="linenos">35</span>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">edgeIds</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<span class="linenos">36</span>        <span class="k">break</span>
<span class="linenos">37</span>    <span class="n">edge</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="n">edgeIds</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="linenos">38</span>    <span class="n">route</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">tree</span><span class="o">.</span><span class="n">vertex</span><span class="p">(</span><span class="n">edge</span><span class="o">.</span><span class="n">fromVertex</span><span class="p">())</span><span class="o">.</span><span class="n">point</span><span class="p">())</span>
<span class="linenos">39</span>    <span class="n">idxEnd</span> <span class="o">=</span> <span class="n">edge</span><span class="o">.</span><span class="n">fromVertex</span><span class="p">()</span>
<span class="linenos">40</span>
<span class="linenos">41</span><span class="c1"># Display</span>
<span class="linenos">42</span><span class="n">rb</span> <span class="o">=</span> <span class="n">QgsRubberBand</span><span class="p">(</span><span class="n">iface</span><span class="o">.</span><span class="n">mapCanvas</span><span class="p">())</span>
<span class="linenos">43</span><span class="n">rb</span><span class="o">.</span><span class="n">setColor</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">green</span><span class="p">)</span>
<span class="linenos">44</span>
<span class="linenos">45</span><span class="c1"># This may require coordinate transformation if project&#39;s CRS</span>
<span class="linenos">46</span><span class="c1"># is different than layer&#39;s CRS</span>
<span class="linenos">47</span><span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">route</span><span class="p">:</span>
<span class="linenos">48</span>    <span class="n">rb</span><span class="o">.</span><span class="n">addPoint</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</pre></div>
</div>
<p>以下は同じサンプルですが、 <a class="reference external" href="https://qgis.org/pyqgis/3.34/analysis/QgsGraphAnalyzer.html#qgis.analysis.QgsGraphAnalyzer.dijkstra" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">dijkstra()</span></code></a> メソッドを使用しています</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">from</span> <span class="nn">qgis.core</span> <span class="kn">import</span> <span class="o">*</span>
<span class="linenos"> 2</span><span class="kn">from</span> <span class="nn">qgis.gui</span> <span class="kn">import</span> <span class="o">*</span>
<span class="linenos"> 3</span><span class="kn">from</span> <span class="nn">qgis.analysis</span> <span class="kn">import</span> <span class="o">*</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="kn">from</span> <span class="nn">qgis.PyQt.QtCore</span> <span class="kn">import</span> <span class="o">*</span>
<span class="linenos"> 6</span><span class="kn">from</span> <span class="nn">qgis.PyQt.QtGui</span> <span class="kn">import</span> <span class="o">*</span>
<span class="linenos"> 7</span>
<span class="linenos"> 8</span><span class="n">vectorLayer</span> <span class="o">=</span> <span class="n">QgsVectorLayer</span><span class="p">(</span><span class="s1">&#39;testdata/network.gpkg|layername=network_lines&#39;</span><span class="p">,</span> <span class="s1">&#39;lines&#39;</span><span class="p">)</span>
<span class="linenos"> 9</span><span class="n">director</span> <span class="o">=</span> <span class="n">QgsVectorLayerDirector</span><span class="p">(</span><span class="n">vectorLayer</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">QgsVectorLayerDirector</span><span class="o">.</span><span class="n">DirectionBoth</span><span class="p">)</span>
<span class="linenos">10</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">QgsNetworkDistanceStrategy</span><span class="p">()</span>
<span class="linenos">11</span><span class="n">director</span><span class="o">.</span><span class="n">addStrategy</span><span class="p">(</span><span class="n">strategy</span><span class="p">)</span>
<span class="linenos">12</span>
<span class="linenos">13</span><span class="n">builder</span> <span class="o">=</span> <span class="n">QgsGraphBuilder</span><span class="p">(</span><span class="n">vectorLayer</span><span class="o">.</span><span class="n">sourceCrs</span><span class="p">())</span>
<span class="linenos">14</span>
<span class="linenos">15</span><span class="n">startPoint</span> <span class="o">=</span> <span class="n">QgsPointXY</span><span class="p">(</span><span class="mf">1179661.925139</span><span class="p">,</span><span class="mf">5419188.074362</span><span class="p">)</span>
<span class="linenos">16</span><span class="n">endPoint</span> <span class="o">=</span> <span class="n">QgsPointXY</span><span class="p">(</span><span class="mf">1180942.970617</span><span class="p">,</span><span class="mf">5420040.097560</span><span class="p">)</span>
<span class="linenos">17</span>
<span class="linenos">18</span><span class="n">tiedPoints</span> <span class="o">=</span> <span class="n">director</span><span class="o">.</span><span class="n">makeGraph</span><span class="p">(</span><span class="n">builder</span><span class="p">,</span> <span class="p">[</span><span class="n">startPoint</span><span class="p">,</span> <span class="n">endPoint</span><span class="p">])</span>
<span class="linenos">19</span><span class="n">tStart</span><span class="p">,</span> <span class="n">tStop</span> <span class="o">=</span> <span class="n">tiedPoints</span>
<span class="linenos">20</span>
<span class="linenos">21</span><span class="n">graph</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">graph</span><span class="p">()</span>
<span class="linenos">22</span><span class="n">idxStart</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">findVertex</span><span class="p">(</span><span class="n">tStart</span><span class="p">)</span>
<span class="linenos">23</span><span class="n">idxEnd</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">findVertex</span><span class="p">(</span><span class="n">tStop</span><span class="p">)</span>
<span class="linenos">24</span>
<span class="linenos">25</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">costs</span><span class="p">)</span> <span class="o">=</span> <span class="n">QgsGraphAnalyzer</span><span class="o">.</span><span class="n">dijkstra</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">idxStart</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="linenos">26</span>
<span class="linenos">27</span><span class="k">if</span> <span class="n">tree</span><span class="p">[</span><span class="n">idxEnd</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
<span class="linenos">28</span>    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;No route!&#39;</span><span class="p">)</span>
<span class="linenos">29</span>
<span class="linenos">30</span><span class="c1"># Total cost</span>
<span class="linenos">31</span><span class="n">cost</span> <span class="o">=</span> <span class="n">costs</span><span class="p">[</span><span class="n">idxEnd</span><span class="p">]</span>
<span class="linenos">32</span>
<span class="linenos">33</span><span class="c1"># Add last point</span>
<span class="linenos">34</span><span class="n">route</span> <span class="o">=</span> <span class="p">[</span><span class="n">graph</span><span class="o">.</span><span class="n">vertex</span><span class="p">(</span><span class="n">idxEnd</span><span class="p">)</span><span class="o">.</span><span class="n">point</span><span class="p">()]</span>
<span class="linenos">35</span>
<span class="linenos">36</span><span class="c1"># Iterate the graph</span>
<span class="linenos">37</span><span class="k">while</span> <span class="n">idxEnd</span> <span class="o">!=</span> <span class="n">idxStart</span><span class="p">:</span>
<span class="linenos">38</span>    <span class="n">idxEnd</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="n">tree</span><span class="p">[</span><span class="n">idxEnd</span><span class="p">])</span><span class="o">.</span><span class="n">fromVertex</span><span class="p">()</span>
<span class="linenos">39</span>    <span class="n">route</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">graph</span><span class="o">.</span><span class="n">vertex</span><span class="p">(</span><span class="n">idxEnd</span><span class="p">)</span><span class="o">.</span><span class="n">point</span><span class="p">())</span>
<span class="linenos">40</span>
<span class="linenos">41</span><span class="c1"># Display</span>
<span class="linenos">42</span><span class="n">rb</span> <span class="o">=</span> <span class="n">QgsRubberBand</span><span class="p">(</span><span class="n">iface</span><span class="o">.</span><span class="n">mapCanvas</span><span class="p">())</span>
<span class="linenos">43</span><span class="n">rb</span><span class="o">.</span><span class="n">setColor</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">red</span><span class="p">)</span>
<span class="linenos">44</span>
<span class="linenos">45</span><span class="c1"># This may require coordinate transformation if project&#39;s CRS</span>
<span class="linenos">46</span><span class="c1"># is different than layer&#39;s CRS</span>
<span class="linenos">47</span><span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">route</span><span class="p">:</span>
<span class="linenos">48</span>    <span class="n">rb</span><span class="o">.</span><span class="n">addPoint</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="areas-of-availability">
<h3><a class="toc-backref" href="#id6" role="doc-backlink"><span class="section-number">19.3.2. </span>利用可能領域</a><a class="headerlink" href="#areas-of-availability" title="Link to this heading"></a></h3>
<p>頂点Aに対する利用可能領域とは、頂点Aから到達可能であり、Aからこれらの頂点までの経路のコストがある値以下になるような、グラフの頂点の部分集合です。</p>
<p>より明確に、これは次の例で示すことができます。「消防署があります。消防車が5分、10分、15分で到達できるのは市内のどの部分ですか？」。これらの質問への回答が消防署の利用可能領域です。</p>
<p>利用可能領域を見つけるには、 <a class="reference external" href="https://qgis.org/pyqgis/3.34/analysis/QgsGraphAnalyzer.html#qgis.analysis.QgsGraphAnalyzer" title="(in QGIS Python API v3.34)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QgsGraphAnalyzer</span></code></a> クラスの <a class="reference external" href="https://qgis.org/pyqgis/3.34/analysis/QgsGraphAnalyzer.html#qgis.analysis.QgsGraphAnalyzer.dijkstra" title="(in QGIS Python API v3.34)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">dijkstra()</span></code></a> メソッドを使用します。cost配列の要素をあらかじめ定義された値と比較するだけです。もしcost[i]があらかじめ定義された値以下であれば、頂点iは利用可能領域内であり、そうでなければ領域外です。</p>
<p>より難しい問題は、利用可能領域の境界を取得することです。下限はまだ到達できる頂点の集合であり、上限は到達できない頂点の集合です。実際にはこれは簡単です：それは、辺の元頂点が到達可能であり辺の先頂点が到達可能ではないような、最短経路木の辺に基づく利用可能境界です。</p>
<p>例です</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="n">director</span> <span class="o">=</span> <span class="n">QgsVectorLayerDirector</span><span class="p">(</span><span class="n">vectorLayer</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">QgsVectorLayerDirector</span><span class="o">.</span><span class="n">DirectionBoth</span><span class="p">)</span>
<span class="linenos"> 2</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">QgsNetworkDistanceStrategy</span><span class="p">()</span>
<span class="linenos"> 3</span><span class="n">director</span><span class="o">.</span><span class="n">addStrategy</span><span class="p">(</span><span class="n">strategy</span><span class="p">)</span>
<span class="linenos"> 4</span><span class="n">builder</span> <span class="o">=</span> <span class="n">QgsGraphBuilder</span><span class="p">(</span><span class="n">vectorLayer</span><span class="o">.</span><span class="n">crs</span><span class="p">())</span>
<span class="linenos"> 5</span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span><span class="n">pStart</span> <span class="o">=</span> <span class="n">QgsPointXY</span><span class="p">(</span><span class="mf">1179661.925139</span><span class="p">,</span> <span class="mf">5419188.074362</span><span class="p">)</span>
<span class="linenos"> 8</span><span class="n">delta</span> <span class="o">=</span> <span class="n">iface</span><span class="o">.</span><span class="n">mapCanvas</span><span class="p">()</span><span class="o">.</span><span class="n">getCoordinateTransform</span><span class="p">()</span><span class="o">.</span><span class="n">mapUnitsPerPixel</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1</span>
<span class="linenos"> 9</span>
<span class="linenos">10</span><span class="n">rb</span> <span class="o">=</span> <span class="n">QgsRubberBand</span><span class="p">(</span><span class="n">iface</span><span class="o">.</span><span class="n">mapCanvas</span><span class="p">())</span>
<span class="linenos">11</span><span class="n">rb</span><span class="o">.</span><span class="n">setColor</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">green</span><span class="p">)</span>
<span class="linenos">12</span><span class="n">rb</span><span class="o">.</span><span class="n">addPoint</span><span class="p">(</span><span class="n">QgsPointXY</span><span class="p">(</span><span class="n">pStart</span><span class="o">.</span><span class="n">x</span><span class="p">()</span> <span class="o">-</span> <span class="n">delta</span><span class="p">,</span> <span class="n">pStart</span><span class="o">.</span><span class="n">y</span><span class="p">()</span> <span class="o">-</span> <span class="n">delta</span><span class="p">))</span>
<span class="linenos">13</span><span class="n">rb</span><span class="o">.</span><span class="n">addPoint</span><span class="p">(</span><span class="n">QgsPointXY</span><span class="p">(</span><span class="n">pStart</span><span class="o">.</span><span class="n">x</span><span class="p">()</span> <span class="o">+</span> <span class="n">delta</span><span class="p">,</span> <span class="n">pStart</span><span class="o">.</span><span class="n">y</span><span class="p">()</span> <span class="o">-</span> <span class="n">delta</span><span class="p">))</span>
<span class="linenos">14</span><span class="n">rb</span><span class="o">.</span><span class="n">addPoint</span><span class="p">(</span><span class="n">QgsPointXY</span><span class="p">(</span><span class="n">pStart</span><span class="o">.</span><span class="n">x</span><span class="p">()</span> <span class="o">+</span> <span class="n">delta</span><span class="p">,</span> <span class="n">pStart</span><span class="o">.</span><span class="n">y</span><span class="p">()</span> <span class="o">+</span> <span class="n">delta</span><span class="p">))</span>
<span class="linenos">15</span><span class="n">rb</span><span class="o">.</span><span class="n">addPoint</span><span class="p">(</span><span class="n">QgsPointXY</span><span class="p">(</span><span class="n">pStart</span><span class="o">.</span><span class="n">x</span><span class="p">()</span> <span class="o">-</span> <span class="n">delta</span><span class="p">,</span> <span class="n">pStart</span><span class="o">.</span><span class="n">y</span><span class="p">()</span> <span class="o">+</span> <span class="n">delta</span><span class="p">))</span>
<span class="linenos">16</span>
<span class="linenos">17</span><span class="n">tiedPoints</span> <span class="o">=</span> <span class="n">director</span><span class="o">.</span><span class="n">makeGraph</span><span class="p">(</span><span class="n">builder</span><span class="p">,</span> <span class="p">[</span><span class="n">pStart</span><span class="p">])</span>
<span class="linenos">18</span><span class="n">graph</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">graph</span><span class="p">()</span>
<span class="linenos">19</span><span class="n">tStart</span> <span class="o">=</span> <span class="n">tiedPoints</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="linenos">20</span>
<span class="linenos">21</span><span class="n">idStart</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">findVertex</span><span class="p">(</span><span class="n">tStart</span><span class="p">)</span>
<span class="linenos">22</span>
<span class="linenos">23</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">cost</span><span class="p">)</span> <span class="o">=</span> <span class="n">QgsGraphAnalyzer</span><span class="o">.</span><span class="n">dijkstra</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">idStart</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="linenos">24</span>
<span class="linenos">25</span><span class="n">upperBound</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos">26</span><span class="n">r</span> <span class="o">=</span> <span class="mf">1500.0</span>
<span class="linenos">27</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos">28</span><span class="n">tree</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
<span class="linenos">29</span>
<span class="linenos">30</span><span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">cost</span><span class="p">):</span>
<span class="linenos">31</span>    <span class="k">if</span> <span class="n">cost</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">r</span> <span class="ow">and</span> <span class="n">tree</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
<span class="linenos">32</span>        <span class="n">outVertexId</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="n">tree</span> <span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">toVertex</span><span class="p">()</span>
<span class="linenos">33</span>        <span class="k">if</span> <span class="n">cost</span><span class="p">[</span><span class="n">outVertexId</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">r</span><span class="p">:</span>
<span class="linenos">34</span>            <span class="n">upperBound</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="linenos">35</span>    <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
<span class="linenos">36</span>
<span class="linenos">37</span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">upperBound</span><span class="p">:</span>
<span class="linenos">38</span>    <span class="n">centerPoint</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">vertex</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">point</span><span class="p">()</span>
<span class="linenos">39</span>    <span class="n">rb</span> <span class="o">=</span> <span class="n">QgsRubberBand</span><span class="p">(</span><span class="n">iface</span><span class="o">.</span><span class="n">mapCanvas</span><span class="p">())</span>
<span class="linenos">40</span>    <span class="n">rb</span><span class="o">.</span><span class="n">setColor</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">red</span><span class="p">)</span>
<span class="linenos">41</span>    <span class="n">rb</span><span class="o">.</span><span class="n">addPoint</span><span class="p">(</span><span class="n">QgsPointXY</span><span class="p">(</span><span class="n">centerPoint</span><span class="o">.</span><span class="n">x</span><span class="p">()</span> <span class="o">-</span> <span class="n">delta</span><span class="p">,</span> <span class="n">centerPoint</span><span class="o">.</span><span class="n">y</span><span class="p">()</span> <span class="o">-</span> <span class="n">delta</span><span class="p">))</span>
<span class="linenos">42</span>    <span class="n">rb</span><span class="o">.</span><span class="n">addPoint</span><span class="p">(</span><span class="n">QgsPointXY</span><span class="p">(</span><span class="n">centerPoint</span><span class="o">.</span><span class="n">x</span><span class="p">()</span> <span class="o">+</span> <span class="n">delta</span><span class="p">,</span> <span class="n">centerPoint</span><span class="o">.</span><span class="n">y</span><span class="p">()</span> <span class="o">-</span> <span class="n">delta</span><span class="p">))</span>
<span class="linenos">43</span>    <span class="n">rb</span><span class="o">.</span><span class="n">addPoint</span><span class="p">(</span><span class="n">QgsPointXY</span><span class="p">(</span><span class="n">centerPoint</span><span class="o">.</span><span class="n">x</span><span class="p">()</span> <span class="o">+</span> <span class="n">delta</span><span class="p">,</span> <span class="n">centerPoint</span><span class="o">.</span><span class="n">y</span><span class="p">()</span> <span class="o">+</span> <span class="n">delta</span><span class="p">))</span>
<span class="linenos">44</span>    <span class="n">rb</span><span class="o">.</span><span class="n">addPoint</span><span class="p">(</span><span class="n">QgsPointXY</span><span class="p">(</span><span class="n">centerPoint</span><span class="o">.</span><span class="n">x</span><span class="p">()</span> <span class="o">-</span> <span class="n">delta</span><span class="p">,</span> <span class="n">centerPoint</span><span class="o">.</span><span class="n">y</span><span class="p">()</span> <span class="o">+</span> <span class="n">delta</span><span class="p">))</span>
</pre></div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="pluginlayer.html" class="btn btn-neutral float-left" title="18. プラグインレイヤを使う" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="server.html" class="btn btn-neutral float-right" title="20. QGIS ServerとPython" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2002-now, QGIS project.
      <span class="lastupdated">最終更新: 2024 6月 25, 05:29 +0900
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <!-- Transifex follows a particular logic to build target pages:
Expected French translation link for https://docs.qgis.org/3.28/en/docs/user_manual/print_composer/overview_composer.html
would return https://app.transifex.com/qgis/qgis-documentation/translate/#fr/aa6d8bc653526d38b295ca94bf8eee5e
with the md5 value of "github#qgis/QGIS-Documentation#release_3.28#locale/en/LC_MESSAGES/docs/user_manual/print_composer/overview_composer.po"-->
<!--Make sure that mismatching language codes between Transifex and Sphinx are converted-->


  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-info-circle"> QGIS Documentation </span>
      v: 3.34
      <span class="fa fa-caret-down"></span>
    </span>

    <div class="rst-other-versions">
      <dl>
        <dt>Languages</dt>
        
          <dd><a href="https://docs.qgis.org/3.34/en/docs/pyqgis_developer_cookbook/network_analysis.html">en</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/cs/docs/pyqgis_developer_cookbook/network_analysis.html">cs</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/de/docs/pyqgis_developer_cookbook/network_analysis.html">de</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/es/docs/pyqgis_developer_cookbook/network_analysis.html">es</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/fr/docs/pyqgis_developer_cookbook/network_analysis.html">fr</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/hu/docs/pyqgis_developer_cookbook/network_analysis.html">hu</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/it/docs/pyqgis_developer_cookbook/network_analysis.html">it</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/ja/docs/pyqgis_developer_cookbook/network_analysis.html">ja</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/ko/docs/pyqgis_developer_cookbook/network_analysis.html">ko</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/lt/docs/pyqgis_developer_cookbook/network_analysis.html">lt</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/nl/docs/pyqgis_developer_cookbook/network_analysis.html">nl</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/pt_BR/docs/pyqgis_developer_cookbook/network_analysis.html">pt_BR</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/pt_PT/docs/pyqgis_developer_cookbook/network_analysis.html">pt_PT</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/ro/docs/pyqgis_developer_cookbook/network_analysis.html">ro</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/ru/docs/pyqgis_developer_cookbook/network_analysis.html">ru</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/zh-Hans/docs/pyqgis_developer_cookbook/network_analysis.html">zh-Hans</a></dd>
        
      </dl>

      <dl>
        <dt>Versions</dt>
        
          <dd><a href="https://docs.qgis.org/testing/ja/docs/pyqgis_developer_cookbook/network_analysis.html">testing</a></dd>
        
          <dd><a href="https://docs.qgis.org/latest/ja/docs/pyqgis_developer_cookbook/network_analysis.html">latest</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/ja/docs/pyqgis_developer_cookbook/network_analysis.html">3.34</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.28/ja/docs/pyqgis_developer_cookbook/network_analysis.html">3.28</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.22/ja/docs/pyqgis_developer_cookbook/network_analysis.html">3.22</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.16/ja/docs/pyqgis_developer_cookbook/network_analysis.html">3.16</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.10/ja/docs/pyqgis_developer_cookbook/network_analysis.html">3.10</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.4/ja/docs/pyqgis_developer_cookbook/network_analysis.html">3.4</a></dd>
        
          <dd><a href="https://docs.qgis.org/2.18/ja/docs/pyqgis_developer_cookbook/network_analysis.html">2.18</a></dd>
        
      </dl>

       
       <dl>
        <dt>Downloads</dt>
        
          <dd><a href="https://docs.qgis.org/3.34/pdf">PDF</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/zip">HTML</a></dd>
        
      </dl>
      

      
       
      <dl>
        <dt>Contribute to Docs</dt>
          <dd>
            <a href="https://github.com/qgis/QGIS-Documentation/edit/master/docs/pyqgis_developer_cookbook/network_analysis.rst" target="_blank" rel="noopener noreferrer">Edit on GitHub</a>
          </dd>
          
          
          <dd>
            <a href="https://app.transifex.com/qgis/qgis-documentation/translate/#ja/7576b22d462f9f1a87323bd11d803567" target="_blank" rel="noopener noreferrer">Translate Page</a>
          </dd>
          
          <dd>
            <a href="https://github.com/qgis/QGIS-Documentation/issues" target="_blank" rel="noopener noreferrer">Report Issue</a>
          </dd>
      </dl>
      

      <dl>
        <dt>On QGIS Project</dt>
          <dd>
            <a href="https://qgis.org/ja" target="_blank" rel="noopener noreferrer">Home</a>
          </dd>
          <dd>
            <a href="https://qgis.org/api/3.34" target="_blank" rel="noopener noreferrer">C++ API</a>
          </dd>
          <dd>
            <a href="https://qgis.org/pyqgis/3.34" target="_blank" rel="noopener noreferrer">PyQGIS API</a>
          </dd>
          <dd>
            <a href="https://github.com/qgis/QGIS/tree/release-3_34" target="_blank" rel="noopener noreferrer">Source</a>
          </dd>
      </dl>

    </div>
  </div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>