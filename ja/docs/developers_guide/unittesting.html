<!DOCTYPE html>
<html class="writer-html5" lang="ja" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>6. ユニットテスト &mdash; QGIS Documentation  ドキュメント</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/qgis_docs.css?v=5415a924" />
      <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
      <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />

  
    <link rel="shortcut icon" href="../../_static/qgis_logo.ico"/>
    <link rel="canonical" href="https://docs.qgis.org/latest/en/docs/developers_guide/unittesting.html"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=c033477b"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../../_static/copybutton.js?v=f281be69"></script>
        <script>let toggleHintShow = 'Click to show';</script>
        <script>let toggleHintHide = 'Click to hide';</script>
        <script>let toggleOpenOnPrint = 'true';</script>
        <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
        <script src="../../_static/translations.js?v=4dbe4bdc"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="索引" href="../../genindex.html" />
    <link rel="search" title="検索" href="../../search.html" />
    <link rel="next" title="7. プロセシングアルゴリズムをテストする" href="processingtesting.html" />
    <link rel="prev" title="5. ローカライズ" href="localization.html" />
  <meta name="description" content="QGIS 3.34 documentation: 6. ユニットテスト">
</head>

<body class="wy-body-for-nav">

  <nav class="release_status_topbar">
  </nav>

   

 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
   

          
          
          <a href="../index.html" class="icon icon-home">
            QGIS Documentation
              <img src="../../_static/logo.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                3.34
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
   <a href= "../../genindex.html">Index</a>
 
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">ユーザ向け</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/index.html">QGIS Desktopユーザーガイド／マニュアル (QGIS 3.34)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../server_manual/index.html">QGIS Serverガイド／マニュアル (QGIS 3.34)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../training_manual/index.html">トレーニングマニュアル</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gentle_gis_introduction/index.html">やさしい GIS 入門</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">ドキュメント執筆者向け</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../documentation_guidelines/index.html">ドキュメント作成のガイドライン</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">開発者向け</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../pyqgis_developer_cookbook/index.html">PyQGISクックブック (QGIS 3.34)</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">開発者ガイド</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="codingstandards.html">1. QGIS コーディング基準</a></li>
<li class="toctree-l2"><a class="reference internal" href="hig.html">2. HIG（ヒューマンインターフェイスガイドライン）</a></li>
<li class="toctree-l2"><a class="reference internal" href="git.html">3. 開発プロセス</a></li>
<li class="toctree-l2"><a class="reference internal" href="qtcreator.html">4. QtCreatorとQGISで起動および実行する</a></li>
<li class="toctree-l2"><a class="reference internal" href="localization.html">5. ローカライズ</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">6. ユニットテスト</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#the-qgis-testing-framework-an-overview">6.1. QGISのテストフレームワーク - 概要</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creating-a-unit-test">6.2. ユニットテストの作成</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#implementing-a-regression-test">6.2.1. 回帰テストを実装する</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#comparing-images-for-rendering-tests">6.3. レンダリングテスト用に画像を比較する</a></li>
<li class="toctree-l3"><a class="reference internal" href="#adding-your-unit-test-to-cmakelists-txt">6.4. CMakeLists.txtにユニットテストを追加する</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#the-add-qgis-test-macro-explained">6.4.1. 説明されたADD_QGIS_TESTマクロ</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#building-your-unit-test">6.5. ユニットテストをビルドする</a></li>
<li class="toctree-l3"><a class="reference internal" href="#run-your-tests">6.6. テストを実行</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#running-individual-tests">6.6.1. 個々のテストの実行</a></li>
<li class="toctree-l4"><a class="reference internal" href="#debugging-unit-tests">6.6.2. ユニットテストをデバッグする</a></li>
<li class="toctree-l4"><a class="reference internal" href="#have-fun">6.6.3. 楽しむ</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="processingtesting.html">7. プロセシングアルゴリズムをテストする</a></li>
<li class="toctree-l2"><a class="reference internal" href="ogcconformancetesting.html">8. OGC適合性試験</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">QGIS Documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">QGIS開発者ガイド</a></li>
      <li class="breadcrumb-item active"><span class="section-number">6. </span>ユニットテスト</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/qgis/QGIS-Documentation/blob/master/docs/developers_guide/unittesting.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul><div class="rst-breadcrumbs-buttons" role="navigation" aria-label="Sequential page navigation">
        <a href="localization.html" class="btn btn-neutral float-left" title="5. ローカライズ" accesskey="p"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="processingtesting.html" class="btn btn-neutral float-right" title="7. プロセシングアルゴリズムをテストする" accesskey="n">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
  </div>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <blockquote>
<div><div class="admonition important">
<p class="admonition-title">重要</p>
<p>翻訳は <a class="reference external" href="https://qgis.org/en/site/getinvolved/translate.html#becoming-a-translator">あなたが参加できる</a> コミュニティの取り組みです。このページは現在 100.00% 翻訳されています。</p>
</div>
</div></blockquote>
<section id="unit-testing">
<span id="qgis-unittesting"></span><h1><span class="section-number">6. </span>ユニットテスト<a class="headerlink" href="#unit-testing" title="Link to this heading"></a></h1>
<nav class="contents local" id="id1">
<ul class="simple">
<li><p><a class="reference internal" href="#the-qgis-testing-framework-an-overview" id="id2">QGISのテストフレームワーク - 概要</a></p></li>
<li><p><a class="reference internal" href="#creating-a-unit-test" id="id3">ユニットテストの作成</a></p>
<ul>
<li><p><a class="reference internal" href="#implementing-a-regression-test" id="id4">回帰テストを実装する</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#comparing-images-for-rendering-tests" id="id5">レンダリングテスト用に画像を比較する</a></p></li>
<li><p><a class="reference internal" href="#adding-your-unit-test-to-cmakelists-txt" id="id6">CMakeLists.txtにユニットテストを追加する</a></p>
<ul>
<li><p><a class="reference internal" href="#the-add-qgis-test-macro-explained" id="id7">説明されたADD_QGIS_TESTマクロ</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#building-your-unit-test" id="id8">ユニットテストをビルドする</a></p></li>
<li><p><a class="reference internal" href="#run-your-tests" id="id9">テストを実行</a></p>
<ul>
<li><p><a class="reference internal" href="#running-individual-tests" id="id10">個々のテストの実行</a></p></li>
<li><p><a class="reference internal" href="#debugging-unit-tests" id="id11">ユニットテストをデバッグする</a></p>
<ul>
<li><p><a class="reference internal" href="#c-tests" id="id12">C++ テスト</a></p></li>
<li><p><a class="reference internal" href="#python-tests" id="id13">Pythonテスト</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#have-fun" id="id14">楽しむ</a></p></li>
</ul>
</li>
</ul>
</nav>
<p>2007年11月の時点で、私たちはマスターに入るすべての新機能は、ユニットテストを伴うことを要求しています。当初は私たちはこの要件はqgis_coreに制限してきましたが、皆様が次のセクションで説明するユニットテストのための手続きに精通した後は、この要件をコードベースの他の部分に拡張するつもりです。</p>
<section id="the-qgis-testing-framework-an-overview">
<h2><a class="toc-backref" href="#id2" role="doc-backlink"><span class="section-number">6.1. </span>QGISのテストフレームワーク - 概要</a><a class="headerlink" href="#the-qgis-testing-framework-an-overview" title="Link to this heading"></a></h2>
<p>ユニットテストは、QTestLib（Qtのテストライブラリ）とCTest（CMakeのビルドプロセスの一部としてテストをコンパイルして実行するためのフレームワーク）の組み合わせを使って行われます。詳細に入る前に、プロセスの概要を説明しましょう:</p>
<ol class="arabic simple">
<li><p>テストしたいコード、例えばクラスや関数があるとします。エクストリーム・プログラミングの提唱者たちは、コードは、テストを作る前に書いてはならない、そうすればコードを実装したときに、追加した新しい機能の箇所をテストを使ってすぐに検証することができる、と提唱しています。実際には、多くのアプリケーションロジックが実装された後にテストフレームワークを開始するため、QGISの既存のコードに対してテストを記述する必要があるでしょう。</p></li>
<li><p>ユニットテストを作成します。これはcore libの場合 <code class="docutils literal notranslate"><span class="pre">&lt;QGIS</span> <span class="pre">Source</span> <span class="pre">Dir&gt;/tests/src/core</span></code> の下で起こります。テストは、基本的には、クラスのインスタンスを作成し、そのクラスにいくつかのメソッドを呼び出すクライアントです。それは各メソッドからの戻りをチェックし、期待値と一致することを確認します。呼び出しのいずれかに障害が発生した場合、そのユニットは失敗します。</p></li>
<li><p>テストクラスにQtTestLibマクロを含めます。このマクロは、Qtのメタオブジェクトコンパイラ（MOC）によって処理され、実行可能なアプリケーションにテストクラスを拡張します。</p></li>
<li><p>テストを構築するtestsディレクトリにCMakeLists.txtにセクションを追加します。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ENABLE_TESTING</span></code> がccmake/cmakesetupで有効になっていることを確認します。これは、makeと入力すると、テストが実際にコンパイルされることを保証します。</p></li>
<li><p>テストがデータ駆動型の場合（シェープファイルを読み込む必要があるなど）、オプションで <code class="docutils literal notranslate"><span class="pre">&lt;QGIS</span> <span class="pre">Source</span> <span class="pre">Dir&gt;</span> <span class="pre">/tests/testdata</span></code> にテストデータを追加することもできます。これらのテストデータはできるだけ小さくし、可能な限り既存のデータセットを使用します。テストは決してその場でこのデータを変更してはならず、必要な場合は一時的なコピーをどこかに作るべきです。</p></li>
<li><p>ソースをコンパイルしてインストールします。これは通常の <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">&amp;&amp;</span> <span class="pre">(sudo)</span> <span class="pre">make</span> <span class="pre">install</span></code> 手順を使用して実行します。</p></li>
<li><p>テストを実行します。通常は <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">install</span></code> の後に <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">test</span></code> を実行するだけですが、テストの実行をより細かく制御する他の方法についても説明します。</p></li>
</ol>
<p>概要を理解した上で、もう少し詳しく説明します。すでにCMakeやソースツリーの他の場所で、あなたのために多くの設定を行っているので、あなたがする必要があるのは簡単なこと、つまりユニットテストを書くことだけです！</p>
</section>
<section id="creating-a-unit-test">
<h2><a class="toc-backref" href="#id3" role="doc-backlink"><span class="section-number">6.2. </span>ユニットテストの作成</a><a class="headerlink" href="#creating-a-unit-test" title="Link to this heading"></a></h2>
<p>ユニットテストの作成は簡単で、通常は <code class="file docutils literal notranslate"><span class="pre">.cpp</span></code> ファイルを1つ作成し（ <code class="file docutils literal notranslate"><span class="pre">.h</span></code> ファイルは使用しない）、すべてのテストメソッドを void を返す private メソッドとして実装するだけです。この後のセクションで <code class="docutils literal notranslate"><span class="pre">QgsRasterLayer</span></code> の簡単なテストクラスを使って説明します。テストの名前は、慣例として、テストするクラスと同じ名前にプレフィックス 'Test' を付けます。ですから、テストの実装は <code class="file docutils literal notranslate"><span class="pre">testqgsrasterlayer.cpp</span></code> というファイルに記述し、クラス名は <code class="docutils literal notranslate"><span class="pre">TestQgsRasterLayer</span></code> となります。最初に標準的なコピーライトのバナーを追加します：</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cm">/***************************************************************************</span>
<span class="cm"> testqgsvectorfilewriter.cpp</span>
<span class="cm"> --------------------------------------</span>
<span class="cm">  Date : Friday, Jan 27, 2015</span>
<span class="cm">  Copyright: (C) 2015 by Tim Sutton</span>
<span class="cm">  Email: tim@kartoza.com</span>
<span class="cm"> ***************************************************************************</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> * it under the terms of the GNU General Public License as published by</span>
<span class="cm"> * the Free Software Foundation; either version 2 of the License, or</span>
<span class="cm"> * (at your option) any later version.</span>
<span class="cm"> *</span>
<span class="cm"> ***************************************************************************/</span>
</pre></div>
</div>
<p>次に、実行予定のテストに必要なインクルードを開始します。すべてのテストが持つべき特別なインクルードがひとつあります：</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;QtTest/QtTest&gt;</span>
</pre></div>
</div>
<p>その他は、必要となる可能性があるヘッダは何でも引っ張って、通常通りあなたのクラスを実装し続けるだけです：</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">//Qt includes...</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;QObject&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;QString&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;QObject&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;QApplication&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;QFileInfo&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;QDir&gt;</span>

<span class="c1">//qgis includes...</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;qgsrasterlayer.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;qgsrasterbandstats.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;qgsapplication.h&gt;</span>
</pre></div>
</div>
<p>ここではクラス宣言と実装の両方を単一のファイルに組み合わせているので、クラス宣言が次に来ます。doxygenのドキュメントで始めます。すべてのテストケースは適切に文書化されなければなりません。すべてのユニットテストが生成されたDoxygenのドキュメントのモジュールとして表示されるように、doxygenのingroupディレクティブを使用します。その後にユニットテストの短い説明が来て、このクラスはQObjectを継承し、Q_OBJECTマクロをインクルードする必要があります。</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cm">/** \ingroup UnitTests</span>
<span class="cm"> * This is a unit test for the QgsRasterLayer class.</span>
<span class="cm"> */</span>

<span class="k">class</span><span class="w"> </span><span class="nc">TestQgsRasterLayer</span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">QObject</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Q_OBJECT</span>
</pre></div>
</div>
<p>すべてのテストメソッドはプライベートスロットとして実装されています。QtTestフレームワークは、テストクラスの各プライベートスロットメソッドを順次呼び出します。もし4つの '特別な' メソッドが実装されていれば、ユニットテストの開始時 (<code class="docutils literal notranslate"><span class="pre">initTestCase</span></code>) と終了時 (<code class="docutils literal notranslate"><span class="pre">cleanupTestCase</span></code>) に呼び出されます。各テストメソッドが呼ばれる前に <code class="docutils literal notranslate"><span class="pre">init()</span></code> メソッドが呼ばれ、各テストメソッドが呼ばれた後に <code class="docutils literal notranslate"><span class="pre">cleanup()</span></code> メソッドが呼ばれます。これらのメソッドは、各テストやテストユニット全体を実行する前にリソースを割り当てたりクリーンアップしたりできるという点で便利です。</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">private</span><span class="w"> </span><span class="n">slots</span><span class="o">:</span>
<span class="w">  </span><span class="c1">// will be called before the first testfunction is executed.</span>
<span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="n">initTestCase</span><span class="p">();</span>
<span class="w">  </span><span class="c1">// will be called after the last testfunction was executed.</span>
<span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">cleanupTestCase</span><span class="p">(){};</span>
<span class="w">  </span><span class="c1">// will be called before each testfunction is executed.</span>
<span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">init</span><span class="p">(){};</span>
<span class="w">  </span><span class="c1">// will be called after every testfunction.</span>
<span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">cleanup</span><span class="p">();</span>
</pre></div>
</div>
<p>次にテストメソッドが来ますが、これらはすべてパラメータをとらず、voidを返します。メソッドは宣言順に呼び出される。ここでは、2種類のテストを説明する2つのメソッドを実装します。</p>
<p>最初のケースでは、クラスのさまざまな部分が機能しているかどうかを一般的にテストします。関数的なテスト方法のアプローチが使えます。繰り返しますが、エクストリームプログラマはクラスを実装する前にこれらのテストを書くことを推奨します。そして、クラスの実装を進めながら、ユニットテストを繰り返し実行します。クラス実装の作業が進むにつれて、より多くのテスト関数が正常に完了するはずです。そして、すべてのユニットテストがパスしたら、新しいクラスは完成し、それを検証するための再現可能な方法が完成したことになります。</p>
<p>通常、ユニットテストはクラスのパブリック API のみを対象とし、accessorやmutatorのテストを書く必要はありません。もしaccessorやmutatorが期待通りに動作しないようなことがあれば、通常は <a class="reference internal" href="#regression-test"><span class="std std-ref">regression test</span></a> を実装してそれをチェックします。</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">//</span>
<span class="c1">// Functional Testing</span>
<span class="c1">//</span>

<span class="cm">/** Check if a raster is valid. */</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">isValid</span><span class="p">();</span>

<span class="c1">// more functional tests here ...</span>
</pre></div>
</div>
<section id="implementing-a-regression-test">
<span id="regression-test"></span><h3><a class="toc-backref" href="#id4" role="doc-backlink"><span class="section-number">6.2.1. </span>回帰テストを実装する</a><a class="headerlink" href="#implementing-a-regression-test" title="Link to this heading"></a></h3>
<p>次に回帰テストを実装します。回帰テストは、特定のバグの状態を再現するように実装する必要があります。例えば ：</p>
<ol class="arabic">
<li><p>ラスタバンドのセルカウントが1ずれたため、ラスタバンドの統計がすべて狂ってしまったという報告をメールで受け取りました。</p></li>
<li><p>バグレポート (<a class="reference external" href="https://issues.qgis.org/issues/832">ticket #832</a>) を開きました。</p></li>
<li><p>小さなテストデータセット（10x10のラスター）を使ってバグを再現する回帰テストを作成しました。</p></li>
<li><p>テストを実行し、確かに失敗することを確認しました（セルカウントは100ではなく99でした）。</p></li>
<li><p>そしてバグを修正し、ユニットテストを再実行したところ、回帰テストはパスしました。バグ修正と一緒に回帰テストもコミットしました。これで、将来誰かがソースコードでこれを再び壊した場合、コードが回帰したことをすぐに特定できるようになりました。</p>
<p>さらに、今後変更をコミットする前に、テストを実行することで、変更が予期せぬ副作用（既存の機能を壊すなど）をもたらさないことを確認できます。</p>
</li>
</ol>
<p>回帰テストへの1つの以上の利点があります - それらは時間を節約できます。ソースに変更を加えてからアプリケーションを実行して問題を再現するために複雑な一連のステップを実行することに関わるバグを修正したことがあれば、バグを修正する前に回帰テストを実装するだけで、効率的な方法でバグの解決のためのテストを自動化できることがすぐに明らかになるでしょう。</p>
<p>回帰テストを実装するには、テスト関数の命名規則 <strong>regression &lt;TicketID&gt;</strong> に従わなければなりません。回帰のチケットが存在しない場合、最初にチケットを作成する必要があります。このアプローチを使うことで、失敗した回帰テストを実行する人が、より多くの情報を簡単に見つけることができます。</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">//</span>
<span class="c1">// Regression Testing</span>
<span class="c1">//</span>

<span class="cm">/** This is our second test case...to check if a raster</span>
<span class="cm"> *  reports its dimensions properly. It is a regression test</span>
<span class="cm"> *  for ticket #832 which was fixed with change r7650.</span>
<span class="cm"> */</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">regression832</span><span class="p">();</span>

<span class="c1">// more regression tests go here ...</span>
</pre></div>
</div>
<p>最後にテストクラスの宣言で、ユニットテストが必要とするデータメンバーやヘルパーメソッドを非公開で宣言します。この例ではどのテストメソッドでも使える <code class="docutils literal notranslate"><span class="pre">QgsRasterLayer</span> <span class="pre">*</span></code> を宣言します。ラスタレイヤは他のテストの前に実行される <code class="docutils literal notranslate"><span class="pre">initTestCase()</span></code> 関数で作成され、全てのテストの後に実行される <code class="docutils literal notranslate"><span class="pre">cleanupTestCase()</span></code> で破棄されます。ヘルパーメソッド（様々なテスト関数から呼び出される可能性のあるもの）をプライベートで宣言することで、 テストをコンパイルしたときに作成される QTest 実行ファイルから自動的に実行されないようにすることができます。</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="k">private</span><span class="o">:</span>
<span class="w">    </span><span class="c1">// Here we have any data structures that may need to</span>
<span class="w">    </span><span class="c1">// be used in many test cases.</span>
<span class="w">    </span><span class="n">QgsRasterLayer</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">mpLayer</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<p>これで私たちのクラス宣言を終了します。実装は単に同じファイル中で下方にインライン化されます。まず、私たちのinitおよびcleanup関数：</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">TestQgsRasterLayer::initTestCase</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">  </span><span class="c1">// init QGIS&#39;s paths - true means that all path will be inited from prefix</span>
<span class="w">  </span><span class="n">QString</span><span class="w"> </span><span class="n">qgisPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">QCoreApplication</span><span class="o">::</span><span class="n">applicationDirPath</span><span class="w"> </span><span class="p">();</span>
<span class="w">  </span><span class="n">QgsApplication</span><span class="o">::</span><span class="n">setPrefixPath</span><span class="p">(</span><span class="n">qgisPath</span><span class="p">,</span><span class="w"> </span><span class="n">TRUE</span><span class="p">);</span>
<span class="cp">#ifdef Q_OS_LINUX</span>
<span class="w">  </span><span class="n">QgsApplication</span><span class="o">::</span><span class="n">setPkgDataPath</span><span class="p">(</span><span class="n">qgisPath</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;/../share/qgis&quot;</span><span class="p">);</span>
<span class="cp">#endif</span>
<span class="w">  </span><span class="c1">//create some objects that will be used in all tests...</span>

<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;PrefixPATH: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">QgsApplication</span><span class="o">::</span><span class="n">prefixPath</span><span class="p">().</span><span class="n">toLocal8Bit</span><span class="p">().</span><span class="n">data</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;PluginPATH: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">QgsApplication</span><span class="o">::</span><span class="n">pluginPath</span><span class="p">().</span><span class="n">toLocal8Bit</span><span class="p">().</span><span class="n">data</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;PkgData PATH: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">QgsApplication</span><span class="o">::</span><span class="n">pkgDataPath</span><span class="p">().</span><span class="n">toLocal8Bit</span><span class="p">().</span><span class="n">data</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;User DB PATH: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">QgsApplication</span><span class="o">::</span><span class="n">qgisUserDbFilePath</span><span class="p">().</span><span class="n">toLocal8Bit</span><span class="p">().</span><span class="n">data</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

<span class="w">  </span><span class="c1">//create a raster layer that will be used in all tests...</span>
<span class="w">  </span><span class="n">QString</span><span class="w"> </span><span class="n">myFileName</span><span class="w"> </span><span class="p">(</span><span class="n">TEST_DATA_DIR</span><span class="p">);</span><span class="w"> </span><span class="c1">//defined in CmakeLists.txt</span>
<span class="w">  </span><span class="n">myFileName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">myFileName</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">QDir</span><span class="o">::</span><span class="n">separator</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;tenbytenraster.asc&quot;</span><span class="p">;</span>
<span class="w">  </span><span class="n">QFileInfo</span><span class="w"> </span><span class="n">myRasterFileInfo</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">myFileName</span><span class="w"> </span><span class="p">);</span>
<span class="w">  </span><span class="n">mpLayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">QgsRasterLayer</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">myRasterFileInfo</span><span class="p">.</span><span class="n">filePath</span><span class="p">(),</span>
<span class="w">  </span><span class="n">myRasterFileInfo</span><span class="p">.</span><span class="n">completeBaseName</span><span class="p">()</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">TestQgsRasterLayer::cleanupTestCase</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">delete</span><span class="w"> </span><span class="n">mpLayer</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>上記のinit関数はいくつかの興味深い物事を示しています。</p>
<ol class="arabic simple">
<li><p><code class="file docutils literal notranslate"><span class="pre">srs.db</span></code> などのリソースが適切に見つかるように、QGISアプリケーションのデータパスを手動で設定する必要がありました。</p></li>
<li><p>次に、これはデータ駆動型のテストなので、 <code class="file docutils literal notranslate"><span class="pre">tenbytenraster.asc</span></code> ファイルを一般的に見つける方法を提供する必要がありました。これはコンパイラ定義の <code class="docutils literal notranslate"><span class="pre">TEST_DATA_PATH</span></code> を使うことで実現しました。この定義は <code class="file docutils literal notranslate"><span class="pre">&lt;QGIS</span> <span class="pre">Source</span> <span class="pre">Root&gt;/tests/CMakeLists.txt</span></code> にある <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> 設定ファイルに作成され、すべての QGIS ユニットテストで利用可能です。テストにテストデータが必要な場合は、 <code class="file docutils literal notranslate"><span class="pre">&lt;QGIS</span> <span class="pre">Source</span> <span class="pre">Root&gt;/tests/testdata</span></code> の下にコミットしてください。ここにコミットすべきなのは、非常に小さなデータセットだけです。テストデータを変更する必要がある場合は、まずそのコピーを作成する必要があります。</p></li>
</ol>
<p>Qtではまた、テストをデータ駆動するためのいくつかの他の興味深いメカニズムを提供していますので、この話題に関してもっと知りたいと興味をお持ちの方は、Qtのドキュメントを参照してください。</p>
<p>次に機能テストを見てみましょう。<code class="docutils literal notranslate"><span class="pre">isValid()</span></code> テストは、initTestCaseでラスタレイヤが正しくロードされたかどうかをチェックします。QVERIFY は Qt マクロで、テスト条件を評価するために使うことができます。Qt が提供するマクロは他にもいくつかあります：</p>
<ul class="simple">
<li><p>QCOMPARE ( <em>actual, expected</em> )</p></li>
<li><p>QEXPECT_FAIL ( <em>dataIndex, comment, mode</em> )</p></li>
<li><p>QFAIL ( <em>message</em> )</p></li>
<li><p>QFETCH ( <em>type, name</em> )</p></li>
<li><p>QSKIP ( <em>description, mode</em> )</p></li>
<li><p>QTEST ( <em>actual, testElement</em> )</p></li>
<li><p>QTEST_APPLESS_MAIN ( <em>TestClass</em> )</p></li>
<li><p>QTEST_MAIN ( <em>TestClass</em> )</p></li>
<li><p>QTEST_NOOP_MAIN ()</p></li>
<li><p>QVERIFY2 ( <em>condition, message</em> )</p></li>
<li><p>QVERIFY ( <em>condition</em> )</p></li>
<li><p>QWARN ( <em>message</em> )</p></li>
</ul>
<p>これらのマクロの一部は（詳細はQtのドキュメントを参照してください）、テスト駆動型のデータのためのQtフレームワークを使用している場合にのみ便利です。</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">TestQgsRasterLayer::isValid</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">QVERIFY</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">mpLayer</span><span class="o">-&gt;</span><span class="n">isValid</span><span class="p">()</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>通常、あなたの機能テストが可能な場合、あなたのクラスのパブリックAPIのすべての機能範囲をカバーするでしょう。私たちの機能テストは out the way、回帰テストの例を見ることができます。</p>
<p>バグ＃832での問題はセル数の誤った報告なので、私たちのテストを書くことは、単純にセル数が期待値を満たしていることをQVERIFYを使用して確認する問題です。</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">TestQgsRasterLayer::regression832</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">QVERIFY</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">mpLayer</span><span class="o">-&gt;</span><span class="n">getRasterXDim</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="p">);</span>
<span class="w">  </span><span class="n">QVERIFY</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">mpLayer</span><span class="o">-&gt;</span><span class="n">getRasterYDim</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="p">);</span>
<span class="w">  </span><span class="c1">// regression check for ticket #832</span>
<span class="w">  </span><span class="c1">// note getRasterBandStats call is base 1</span>
<span class="w">  </span><span class="n">QVERIFY</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">mpLayer</span><span class="o">-&gt;</span><span class="n">getRasterBandStats</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">elementCountInt</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>すべてのユニットテスト関数を実装したところで、最後にテストクラスに追加しなければならないものがあります：</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">QTEST_MAIN</span><span class="p">(</span><span class="n">TestQgsRasterLayer</span><span class="p">)</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;testqgsrasterlayer.moc&quot;</span>
</pre></div>
</div>
<p>この2行の目的は、QtのmocにこれがQtTestであることを知らせることです（mainメソッドを生成し、それが順番に各テスト関数を呼び出します）。最後の行はMOCが生成するソースのインクルードです。<code class="docutils literal notranslate"><span class="pre">testqgsrasterlayer</span></code> を小文字のクラス名に置き換えてください。</p>
</section>
</section>
<section id="comparing-images-for-rendering-tests">
<h2><a class="toc-backref" href="#id5" role="doc-backlink"><span class="section-number">6.3. </span>レンダリングテスト用に画像を比較する</a><a class="headerlink" href="#comparing-images-for-rendering-tests" title="Link to this heading"></a></h2>
<p>異なる環境で画像をレンダリングすると、プラットフォーム固有の実装（フォントレンダリングやアンチエイリアシングアルゴリズムの違いなど）や、システムで利用可能なフォント、その他の不明瞭な理由により、微妙な違いが生じることがあります。</p>
<p>Travis でレンダリングテストを実行して失敗した場合、Travis ログの一番下にある dash リンクを探します。このリンクから cdash ページに移動し、レンダリングされた画像と期待される画像の比較や、参照画像と一致しなかったピクセルを赤くハイライトする「差分」画像を見ることができます。</p>
<p>QGISユニットテストシステムは、レンダリング画像が参照画像と異なる可能性がある場合に使用される「マスク」画像の追加をサポートしています。マスク画像は画像（参照画像と同じ名前ですが、<a href="#id1"><span class="problematic" id="id2">**</span></a>_mask.png**という接尾辞が付きます）で、参照画像と同じ寸法である必要があります。マスク画像のピクセル値は、個々のピクセルが参照画像とどの程度異なってもよいかを示します。したがって、黒いピクセルは、レンダリング画像のピクセルが参照画像の同じピクセルと完全に一致しなければならないことを示します。RGB 2, 2, 2のピクセルは、レンダリング画像が参照画像とRGB値で最大2まで異なる可能性があることを意味し、完全な白ピクセル（255, 255, 255）は、期待画像とレンダリング画像を比較する際に、そのピクセルが事実上無視されることを意味します。</p>
<p>マスク画像を生成するユーティリティスクリプトが <code class="docutils literal notranslate"><span class="pre">scripts/generate_test_mask_image.py</span></code> として用意されています。このスクリプトは参照画像のパス（例えば <code class="docutils literal notranslate"><span class="pre">tests/testdata/control_images/annotations/expected_annotation_fillstyle/expected_annotation_fillstyle.png</span></code>）とレンダリング画像のパスを渡して使用します。</p>
<p>例</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>scripts/generate_test_mask_image.py<span class="w"> </span>tests/testdata/control_images/annotations/expected_annotation_fillstyle/expected_annotation_fillstyle.png<span class="w"> </span>/tmp/path_to_rendered_image.png
</pre></div>
</div>
<p>代わりにテスト名の一部を渡すことで、参照画像へのパスをショートカットすることができます。例</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>scripts/generate_test_mask_image.py<span class="w"> </span>annotation_fillstyle<span class="w"> </span>/tmp/path_to_rendered_image.png
</pre></div>
</div>
<p>（このショートカットは、一致する参照画像が1つだけ見つかった場合にのみ機能します。一致する画像が複数見つかった場合は、参照画像へのフルパスを入力する必要があります。）</p>
<p>スクリプトはレンダリング画像のhttp urlも受け付けるので、cdashの結果ページからレンダリング画像のurlを直接コピーしてスクリプトに渡すことができます。</p>
<p>マスク画像を生成するときには注意が必要です。生成されたマスク画像を見て、画像内の白い部分を常に確認する必要があります。これらのピクセルは無視されるので、これらの白いイメージが参照イメージの重要な部分をカバーしていないことを確認してください。そうでなければ、ユニットテストは無意味なものになってしまいます！</p>
<p>同様に、意図的にテストから除外したい場合は、マスクの一部を手動で「ホワイトアウト」することができます。これは、シンボルとテキストのレンダリングが混在するテスト（凡例のテストなど）で、ユニットテストがレンダリングされたテキストをテストするように設計されておらず、テストがクロスプラットフォームのテキストレンダリングの違いに左右されたくない場合などに便利です。</p>
<p>QGISのユニットテストで画像を比較するには、クラス <code class="docutils literal notranslate"><span class="pre">QgsMultiRenderChecker</span></code> またはそのサブクラスのいずれかを使用する必要があります。</p>
<p>テストの堅牢性を高めるためのヒントをいくつか紹介します：</p>
<ol class="arabic simple">
<li><p>クロスプラットフォームでのレンダリングの違いを最小限に抑えるため、可能であればアンチエイリアスを無効にしてください。</p></li>
<li><p>参考画像は「がっしりした」ものにしてください...つまり、1px幅の線やその他の細かい地物がないようにし、大きくて太いフォント（14ポイント以上を推奨）を使ってください。</p></li>
<li><p>時々、テストはわずかに異なるサイズの画像を生成します（例えば、凡例のレンダリングテストでは、画像サイズはフォントのレンダリングサイズに依存し、クロスプラットフォームの違いに左右されます）。 これを考慮するには、<code class="docutils literal notranslate"><span class="pre">QgsMultiRenderChecker::setSizeTolerance()</span></code> を使用して、レンダリング画像の幅と高さが参照画像と異なる最大ピクセル数を指定します。</p></li>
<li><p>参照画像に透明な背景を使用しないでください（CDashはそれをサポートしていません）。その代わりに、 <code class="docutils literal notranslate"><span class="pre">QgsMultiRenderChecker::drawBackground()</span></code> を使用して、参照画像の背景にチェックボードパターンを描画してください。</p></li>
<li><p>フォントが必要な場合は、<a href="#id1"><span class="problematic" id="id2">``</span></a>QgsFontUtils::standardTestFontFamily()``（&quot;QGIS Vera Sans&quot;）で指定されたフォントを使用します。</p></li>
</ol>
<p>travis が新しい画像に対してエラーを報告した場合 (例えば、アンチエイリアスやフォントの違いによるもの)、 <a class="reference external" href="https://github.com/qgis/QGIS/blob/release-3_34/scripts/parse_dash_results.py">parse_dash_results.py</a> スクリプトは、ローカルのテストマスクを更新するときに役立ちます。</p>
</section>
<section id="adding-your-unit-test-to-cmakelists-txt">
<h2><a class="toc-backref" href="#id6" role="doc-backlink"><span class="section-number">6.4. </span>CMakeLists.txtにユニットテストを追加する</a><a class="headerlink" href="#adding-your-unit-test-to-cmakelists-txt" title="Link to this heading"></a></h2>
<p>ユニットテストをビルドシステムに追加するのは単純で、testディレクトリの <code class="file docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> を編集して、既存のテストブロックのひとつを複製し、テストクラス名を置き換えるだけです。例えば：</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="c"># QgsRasterLayer test</span>
<span class="nb">ADD_QGIS_TEST</span><span class="p">(</span><span class="s">rasterlayertest</span><span class="w"> </span><span class="s">testqgsrasterlayer.cpp</span><span class="p">)</span>
</pre></div>
</div>
<section id="the-add-qgis-test-macro-explained">
<h3><a class="toc-backref" href="#id7" role="doc-backlink"><span class="section-number">6.4.1. </span>説明されたADD_QGIS_TESTマクロ</a><a class="headerlink" href="#the-add-qgis-test-macro-explained" title="Link to this heading"></a></h3>
<p>これらの行が何をするのかを簡単に説明するが、興味がなければ、上のセクションで説明したステップを実行するだけでよい。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>MACRO<span class="w"> </span><span class="o">(</span>ADD_QGIS_TEST<span class="w"> </span>testname<span class="w"> </span>testsrc<span class="o">)</span>
SET<span class="o">(</span>qgis_<span class="si">${</span><span class="nv">testname</span><span class="si">}</span>_SRCS<span class="w"> </span><span class="si">${</span><span class="nv">testsrc</span><span class="si">}</span><span class="w"> </span><span class="si">${</span><span class="nv">util_SRCS</span><span class="si">}</span><span class="o">)</span>
SET<span class="o">(</span>qgis_<span class="si">${</span><span class="nv">testname</span><span class="si">}</span>_MOC_CPPS<span class="w"> </span><span class="si">${</span><span class="nv">testsrc</span><span class="si">}</span><span class="o">)</span>
QT4_WRAP_CPP<span class="o">(</span>qgis_<span class="si">${</span><span class="nv">testname</span><span class="si">}</span>_MOC_SRCS<span class="w"> </span><span class="si">${</span><span class="nv">qgis_</span><span class="si">${</span><span class="nv">testname</span><span class="si">}</span><span class="nv">_MOC_CPPS</span><span class="si">}</span><span class="o">)</span>
ADD_CUSTOM_TARGET<span class="o">(</span>qgis_<span class="si">${</span><span class="nv">testname</span><span class="si">}</span>moc<span class="w"> </span>ALL<span class="w"> </span>DEPENDS<span class="w"> </span><span class="si">${</span><span class="nv">qgis_</span><span class="si">${</span><span class="nv">testname</span><span class="si">}</span><span class="nv">_MOC_SRCS</span><span class="si">}</span><span class="o">)</span>
ADD_EXECUTABLE<span class="o">(</span>qgis_<span class="si">${</span><span class="nv">testname</span><span class="si">}</span><span class="w"> </span><span class="si">${</span><span class="nv">qgis_</span><span class="si">${</span><span class="nv">testname</span><span class="si">}</span><span class="nv">_SRCS</span><span class="si">}</span><span class="o">)</span>
ADD_DEPENDENCIES<span class="o">(</span>qgis_<span class="si">${</span><span class="nv">testname</span><span class="si">}</span><span class="w"> </span>qgis_<span class="si">${</span><span class="nv">testname</span><span class="si">}</span>moc<span class="o">)</span>
TARGET_LINK_LIBRARIES<span class="o">(</span>qgis_<span class="si">${</span><span class="nv">testname</span><span class="si">}</span><span class="w"> </span><span class="si">${</span><span class="nv">QT_LIBRARIES</span><span class="si">}</span><span class="w"> </span>qgis_core<span class="o">)</span>
SET_TARGET_PROPERTIES<span class="o">(</span>qgis_<span class="si">${</span><span class="nv">testname</span><span class="si">}</span>
PROPERTIES
<span class="c1"># skip the full RPATH for the build tree</span>
SKIP_BUILD_RPATHTRUE
<span class="c1"># when building, use the install RPATH already</span>
<span class="c1"># (so it doesn&#39;t need to relink when installing)</span>
BUILD_WITH_INSTALL_RPATH<span class="w"> </span>TRUE
<span class="c1"># the RPATH to be used when installing</span>
INSTALL_RPATH<span class="w"> </span><span class="si">${</span><span class="nv">QGIS_LIB_DIR</span><span class="si">}</span>
<span class="c1"># add the automatically determined parts of the RPATH</span>
<span class="c1"># which point to directories outside the build tree to the install RPATH</span>
INSTALL_RPATH_USE_LINK_PATH<span class="w"> </span><span class="nb">true</span><span class="o">)</span>
IF<span class="w"> </span><span class="o">(</span>APPLE<span class="o">)</span>
<span class="c1"># For macOS, the executable must be at the root of the bundle&#39;s executable folder</span>
INSTALL<span class="o">(</span>TARGETS<span class="w"> </span>qgis_<span class="si">${</span><span class="nv">testname</span><span class="si">}</span><span class="w"> </span>RUNTIME<span class="w"> </span>DESTINATION<span class="w"> </span><span class="si">${</span><span class="nv">CMAKE_INSTALL_PREFIX</span><span class="si">}</span><span class="o">)</span>
ADD_TEST<span class="o">(</span>qgis_<span class="si">${</span><span class="nv">testname</span><span class="si">}</span><span class="w"> </span><span class="si">${</span><span class="nv">CMAKE_INSTALL_PREFIX</span><span class="si">}</span>/qgis_<span class="si">${</span><span class="nv">testname</span><span class="si">}</span><span class="o">)</span>
ELSE<span class="w"> </span><span class="o">(</span>APPLE<span class="o">)</span>
INSTALL<span class="o">(</span>TARGETS<span class="w"> </span>qgis_<span class="si">${</span><span class="nv">testname</span><span class="si">}</span><span class="w"> </span>RUNTIME<span class="w"> </span>DESTINATION<span class="w"> </span><span class="si">${</span><span class="nv">CMAKE_INSTALL_PREFIX</span><span class="si">}</span>/bin<span class="o">)</span>
ADD_TEST<span class="o">(</span>qgis_<span class="si">${</span><span class="nv">testname</span><span class="si">}</span><span class="w"> </span><span class="si">${</span><span class="nv">CMAKE_INSTALL_PREFIX</span><span class="si">}</span>/bin/qgis_<span class="si">${</span><span class="nv">testname</span><span class="si">}</span><span class="o">)</span>
ENDIF<span class="w"> </span><span class="o">(</span>APPLE<span class="o">)</span>
ENDMACRO<span class="w"> </span><span class="o">(</span>ADD_QGIS_TEST<span class="o">)</span>
</pre></div>
</div>
<p>個々の行をもう少し詳しく見てみましょう。まず、テストのソースのリストを定義します。ソースファイルは1つしかない（クラス宣言と定義が同じファイルにある上述の方法に従って）ので、単純な記述になります：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>SET<span class="o">(</span>qgis_<span class="si">${</span><span class="nv">testname</span><span class="si">}</span>_SRCS<span class="w"> </span><span class="si">${</span><span class="nv">testsrc</span><span class="si">}</span><span class="w"> </span><span class="si">${</span><span class="nv">util_SRCS</span><span class="si">}</span><span class="o">)</span>
</pre></div>
</div>
<p>我々のテストクラスは、Qtのメタオブジェクトコンパイラ(moc)を介して実行する必要があるので、それをするために数行を提供する必要があります：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>SET<span class="o">(</span>qgis_<span class="si">${</span><span class="nv">testname</span><span class="si">}</span>_MOC_CPPS<span class="w"> </span><span class="si">${</span><span class="nv">testsrc</span><span class="si">}</span><span class="o">)</span>
QT4_WRAP_CPP<span class="o">(</span>qgis_<span class="si">${</span><span class="nv">testname</span><span class="si">}</span>_MOC_SRCS<span class="w"> </span><span class="si">${</span><span class="nv">qgis_</span><span class="si">${</span><span class="nv">testname</span><span class="si">}</span><span class="nv">_MOC_CPPS</span><span class="si">}</span><span class="o">)</span>
ADD_CUSTOM_TARGET<span class="o">(</span>qgis_<span class="si">${</span><span class="nv">testname</span><span class="si">}</span>moc<span class="w"> </span>ALL<span class="w"> </span>DEPENDS<span class="w"> </span><span class="si">${</span><span class="nv">qgis_</span><span class="si">${</span><span class="nv">testname</span><span class="si">}</span><span class="nv">_MOC_SRCS</span><span class="si">}</span><span class="o">)</span>
</pre></div>
</div>
<p>次に、cmakeにテストクラスから実行ファイルを作るように指示します。前のセクションのクラス実装の最後の行で、mocの出力をテストクラスに直接インクルードし、（とりわけ）メインメソッドが与えられ、クラスを実行ファイルとしてコンパイルできるようになるのを思い出してください：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ADD_EXECUTABLE<span class="o">(</span>qgis_<span class="si">${</span><span class="nv">testname</span><span class="si">}</span><span class="w"> </span><span class="si">${</span><span class="nv">qgis_</span><span class="si">${</span><span class="nv">testname</span><span class="si">}</span><span class="nv">_SRCS</span><span class="si">}</span><span class="o">)</span>
ADD_DEPENDENCIES<span class="o">(</span>qgis_<span class="si">${</span><span class="nv">testname</span><span class="si">}</span><span class="w"> </span>qgis_<span class="si">${</span><span class="nv">testname</span><span class="si">}</span>moc<span class="o">)</span>
</pre></div>
</div>
<p>次に、ライブラリの依存関係を指定する必要があります。現時点では、クラスは QT_LIBRARIES 依存関係をキャッチオールにして実装されていますが、今後は各クラスが必要とする特定の Qt ライブラリのみに置き換える予定です。もちろん、ユニットテストで必要とされる関連するqgisライブラリにリンクする必要もあります。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>TARGET_LINK_LIBRARIES<span class="o">(</span>qgis_<span class="si">${</span><span class="nv">testname</span><span class="si">}</span><span class="w"> </span><span class="si">${</span><span class="nv">QT_LIBRARIES</span><span class="si">}</span><span class="w"> </span>qgis_core<span class="o">)</span>
</pre></div>
</div>
<p>次に、テストをqgisバイナリと同じ場所にインストールするようcmakeに指示します。これは将来的に削除する予定なので、テストはソースツリーの中から直接実行できるようにします。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>SET_TARGET_PROPERTIES<span class="o">(</span>qgis_<span class="si">${</span><span class="nv">testname</span><span class="si">}</span>
PROPERTIES
<span class="c1"># skip the full RPATH for the build tree</span>
SKIP_BUILD_RPATHTRUE
<span class="c1"># when building, use the install RPATH already</span>
<span class="c1"># (so it doesn&#39;t need to relink when installing)</span>
BUILD_WITH_INSTALL_RPATH<span class="w"> </span>TRUE
<span class="c1"># the RPATH to be used when installing</span>
INSTALL_RPATH<span class="w"> </span><span class="si">${</span><span class="nv">QGIS_LIB_DIR</span><span class="si">}</span>
<span class="c1"># add the automatically determined parts of the RPATH</span>
<span class="c1"># which point to directories outside the build tree to the install RPATH</span>
INSTALL_RPATH_USE_LINK_PATH<span class="w"> </span><span class="nb">true</span><span class="o">)</span>
IF<span class="w"> </span><span class="o">(</span>APPLE<span class="o">)</span>
<span class="c1"># For macOS, the executable must be at the root of the bundle&#39;s executable folder</span>
INSTALL<span class="o">(</span>TARGETS<span class="w"> </span>qgis_<span class="si">${</span><span class="nv">testname</span><span class="si">}</span><span class="w"> </span>RUNTIME<span class="w"> </span>DESTINATION<span class="w"> </span><span class="si">${</span><span class="nv">CMAKE_INSTALL_PREFIX</span><span class="si">}</span><span class="o">)</span>
ADD_TEST<span class="o">(</span>qgis_<span class="si">${</span><span class="nv">testname</span><span class="si">}</span><span class="w"> </span><span class="si">${</span><span class="nv">CMAKE_INSTALL_PREFIX</span><span class="si">}</span>/qgis_<span class="si">${</span><span class="nv">testname</span><span class="si">}</span><span class="o">)</span>
ELSE<span class="w"> </span><span class="o">(</span>APPLE<span class="o">)</span>
INSTALL<span class="o">(</span>TARGETS<span class="w"> </span>qgis_<span class="si">${</span><span class="nv">testname</span><span class="si">}</span><span class="w"> </span>RUNTIME<span class="w"> </span>DESTINATION<span class="w"> </span><span class="si">${</span><span class="nv">CMAKE_INSTALL_PREFIX</span><span class="si">}</span>/bin<span class="o">)</span>
ADD_TEST<span class="o">(</span>qgis_<span class="si">${</span><span class="nv">testname</span><span class="si">}</span><span class="w"> </span><span class="si">${</span><span class="nv">CMAKE_INSTALL_PREFIX</span><span class="si">}</span>/bin/qgis_<span class="si">${</span><span class="nv">testname</span><span class="si">}</span><span class="o">)</span>
ENDIF<span class="w"> </span><span class="o">(</span>APPLE<span class="o">)</span>
</pre></div>
</div>
<p>最後に、<code class="docutils literal notranslate"><span class="pre">ADD_TEST</span></code> を使って cmake / ctest にテストを登録します。ここで最高のマジックが起こります - クラスを ctest に登録するのです。このセクションの最初に説明した概要を思い出すと、QtTest と CTest の両方を一緒に使っています。まとめると、QtTest はテストユニットに main メソッドを追加し、クラス内でテストメソッドを呼び出す処理を行います。QtTest には <code class="docutils literal notranslate"><span class="pre">QVERIFY</span></code> のようなマクロも用意されており、条件を使ってテストの失敗をテストすることができます。QtTest のユニットテストの出力は、コマンドラインから実行できる実行ファイルです。しかし、一連のテストがあり、各実行ファイルを順番に実行したい場合、さらにテストの実行をビルドプロセスに統合したい場合は、CTest を使用します。</p>
</section>
</section>
<section id="building-your-unit-test">
<h2><a class="toc-backref" href="#id8" role="doc-backlink"><span class="section-number">6.5. </span>ユニットテストをビルドする</a><a class="headerlink" href="#building-your-unit-test" title="Link to this heading"></a></h2>
<p>ユニットテストをビルドするには、cmakeの設定で <code class="docutils literal notranslate"><span class="pre">ENABLE_TESTS=true</span></code> を確認するだけが必要です。これを行うには2つの方法があります：</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ccmake..</span></code> （またはウィンドウズの下では <code class="docutils literal notranslate"><span class="pre">cmakesetup..</span></code> ）を実行し、対話的に <code class="docutils literal notranslate"><span class="pre">ENABLE_TESTS</span></code> フラグを <code class="docutils literal notranslate"><span class="pre">ON</span></code> に設定します。</p></li>
<li><p>cmakeのためのコマンドラインフラグを追加します、例えば <code class="docutils literal notranslate"><span class="pre">cmake</span> <span class="pre">-DENABLE_TESTS=true</span> <span class="pre">..</span></code></p></li>
</ol>
<p>それ以外は、通常通りQGISをビルドするだけであり、またテストもビルドする必要があります。</p>
</section>
<section id="run-your-tests">
<h2><a class="toc-backref" href="#id9" role="doc-backlink"><span class="section-number">6.6. </span>テストを実行</a><a class="headerlink" href="#run-your-tests" title="Link to this heading"></a></h2>
<p>テストを実行する最も簡単な方法は、通常のビルドプロセスの一部としてです：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>make<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>make<span class="w"> </span>install<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>make<span class="w"> </span><span class="nb">test</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">test</span></code> コマンドは CTest を起動し、前述の ADD_TEST CMake ディレクティブを使って登録された各テストを実行します。<code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">test</span></code> の典型的な出力は以下のようになります：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Running<span class="w"> </span>tests...
Start<span class="w"> </span>processing<span class="w"> </span>tests
Test<span class="w"> </span>project<span class="w"> </span>/Users/tim/dev/cpp/qgis/build
<span class="c1">## 13 Testing qgis_applicationtest***Exception: Other</span>
<span class="c1">## 23 Testing qgis_filewritertest *** Passed</span>
<span class="c1">## 33 Testing qgis_rasterlayertest*** Passed</span>

<span class="c1">## 0 tests passed, 3 tests failed out of 3</span>

The<span class="w"> </span>following<span class="w"> </span>tests<span class="w"> </span>FAILED:
<span class="c1">## 1- qgis_applicationtest (OTHER_FAULT)</span>
Errors<span class="w"> </span><span class="k">while</span><span class="w"> </span>running<span class="w"> </span>CTest
make:<span class="w"> </span>***<span class="w"> </span><span class="o">[</span>test<span class="o">]</span><span class="w"> </span>Error<span class="w"> </span><span class="m">8</span>
</pre></div>
</div>
<p>テストが失敗した場合は、それが失敗した理由をより密接に検討するctestコマンドを使用できます。実行したいテストするために正規表現を指定するためには <code class="docutils literal notranslate"><span class="pre">-R</span></code> オプションを、冗長な出力を得るためには <code class="docutils literal notranslate"><span class="pre">-V</span></code> オプションを使用してください：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>ctest<span class="w"> </span>-R<span class="w"> </span>appl<span class="w"> </span>-V

Start<span class="w"> </span>processing<span class="w"> </span>tests
Test<span class="w"> </span>project<span class="w"> </span>/Users/tim/dev/cpp/qgis/build
Constructing<span class="w"> </span>a<span class="w"> </span>list<span class="w"> </span>of<span class="w"> </span>tests
Done<span class="w"> </span>constructing<span class="w"> </span>a<span class="w"> </span>list<span class="w"> </span>of<span class="w"> </span>tests
Changing<span class="w"> </span>directory<span class="w"> </span>into<span class="w"> </span>/Users/tim/dev/cpp/qgis/build/tests/src/core
<span class="c1">## 13 Testing qgis_applicationtest</span>
Test<span class="w"> </span>command:<span class="w"> </span>/Users/tim/dev/cpp/qgis/build/tests/src/core/qgis_applicationtest
*********<span class="w"> </span>Start<span class="w"> </span>testing<span class="w"> </span>of<span class="w"> </span>TestQgsApplication<span class="w"> </span>*********
Config:<span class="w"> </span>Using<span class="w"> </span>QTest<span class="w"> </span>library<span class="w"> </span><span class="m">4</span>.3.0,<span class="w"> </span>Qt<span class="w"> </span><span class="m">4</span>.3.0
PASS<span class="w"> </span>:<span class="w"> </span>TestQgsApplication::initTestCase<span class="o">()</span>
PrefixPATH:<span class="w"> </span>/Users/tim/dev/cpp/qgis/build/tests/src/core/../
PluginPATH:<span class="w"> </span>/Users/tim/dev/cpp/qgis/build/tests/src/core/..//lib/qgis
PkgData<span class="w"> </span>PATH:<span class="w"> </span>/Users/tim/dev/cpp/qgis/build/tests/src/core/..//share/qgis
User<span class="w"> </span>DB<span class="w"> </span>PATH:<span class="w"> </span>/Users/tim/.qgis/qgis.db
PASS<span class="w"> </span>:<span class="w"> </span>TestQgsApplication::getPaths<span class="o">()</span>
PrefixPATH:<span class="w"> </span>/Users/tim/dev/cpp/qgis/build/tests/src/core/../
PluginPATH:<span class="w"> </span>/Users/tim/dev/cpp/qgis/build/tests/src/core/..//lib/qgis
PkgData<span class="w"> </span>PATH:<span class="w"> </span>/Users/tim/dev/cpp/qgis/build/tests/src/core/..//share/qgis
User<span class="w"> </span>DB<span class="w"> </span>PATH:<span class="w"> </span>/Users/tim/.qgis/qgis.db
QDEBUG<span class="w"> </span>:<span class="w"> </span>TestQgsApplication::checkTheme<span class="o">()</span><span class="w"> </span>Checking<span class="w"> </span><span class="k">if</span><span class="w"> </span>a<span class="w"> </span>theme<span class="w"> </span>icon<span class="w"> </span>exists:
QDEBUG<span class="w"> </span>:<span class="w"> </span>TestQgsApplication::checkTheme<span class="o">()</span>
/Users/tim/dev/cpp/qgis/build/tests/src/core/..//share/qgis/themes/default//mIconProjectionDisabled.png
FAIL!:<span class="w"> </span>TestQgsApplication::checkTheme<span class="o">()</span><span class="w"> </span><span class="s1">&#39;!myPixmap.isNull()&#39;</span><span class="w"> </span>returned<span class="w"> </span>FALSE.<span class="w"> </span><span class="o">()</span>
Loc:<span class="w"> </span><span class="o">[</span>/Users/tim/dev/cpp/qgis/tests/src/core/testqgsapplication.cpp<span class="o">(</span><span class="m">59</span><span class="o">)]</span>
PASS<span class="w"> </span>:<span class="w"> </span>TestQgsApplication::cleanupTestCase<span class="o">()</span>
Totals:<span class="w"> </span><span class="m">3</span><span class="w"> </span>passed,<span class="w"> </span><span class="m">1</span><span class="w"> </span>failed,<span class="w"> </span><span class="m">0</span><span class="w"> </span>skipped
*********<span class="w"> </span>Finished<span class="w"> </span>testing<span class="w"> </span>of<span class="w"> </span>TestQgsApplication<span class="w"> </span>*********
--<span class="w"> </span>Process<span class="w"> </span>completed
***Failed

<span class="c1">## 0 tests passed, 1 tests failed out of 1</span>

The<span class="w"> </span>following<span class="w"> </span>tests<span class="w"> </span>FAILED:
<span class="c1">## 1- qgis_applicationtest (Failed)</span>
Errors<span class="w"> </span><span class="k">while</span><span class="w"> </span>running<span class="w"> </span>CTest
</pre></div>
</div>
<section id="running-individual-tests">
<h3><a class="toc-backref" href="#id10" role="doc-backlink"><span class="section-number">6.6.1. </span>個々のテストの実行</a><a class="headerlink" href="#running-individual-tests" title="Link to this heading"></a></h3>
<p>C++テストは普通のアプリケーションです。他の実行ファイルと同じように、ビルド・フォルダーから実行できます。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>./output/bin/qgis_dxfexporttest

*********<span class="w"> </span>Start<span class="w"> </span>testing<span class="w"> </span>of<span class="w"> </span>TestQgsDxfExport<span class="w"> </span>*********
Config:<span class="w"> </span>Using<span class="w"> </span>QtTest<span class="w"> </span>library<span class="w"> </span><span class="m">5</span>.12.5,<span class="w"> </span>Qt<span class="w"> </span><span class="m">5</span>.12.5<span class="w"> </span><span class="o">(</span>x86_64-little_endian-lp64<span class="w"> </span>shared<span class="w"> </span><span class="o">(</span>dynamic<span class="o">)</span><span class="w"> </span>release<span class="w"> </span>build<span class="p">;</span><span class="w"> </span>by<span class="w"> </span>GCC<span class="w"> </span><span class="m">9</span>.2.1<span class="w"> </span><span class="m">20190827</span><span class="w"> </span><span class="o">(</span>Red<span class="w"> </span>Hat<span class="w"> </span><span class="m">9</span>.2.1-1<span class="o">))</span>
PASS<span class="w">   </span>:<span class="w"> </span>TestQgsDxfExport::initTestCase<span class="o">()</span>
PASS<span class="w">   </span>:<span class="w"> </span>TestQgsDxfExport::testPoints<span class="o">()</span>
PASS<span class="w">   </span>:<span class="w"> </span>TestQgsDxfExport::testLines<span class="o">()</span>
...
Totals:<span class="w"> </span><span class="m">19</span><span class="w"> </span>passed,<span class="w"> </span><span class="m">4</span><span class="w"> </span>failed,<span class="w"> </span><span class="m">0</span><span class="w"> </span>skipped,<span class="w"> </span><span class="m">0</span><span class="w"> </span>blacklisted,<span class="w"> </span>612ms
*********<span class="w"> </span>Finished<span class="w"> </span>testing<span class="w"> </span>of<span class="w"> </span>TestQgsDxfExport<span class="w"> </span>*********
</pre></div>
</div>
<p>これらのテストは <a class="reference external" href="https://doc.qt.io/qt-5/qtest-overview.html#qt-test-command-line-arguments">コマンドライン引数</a> も取ります。これにより、特定のテストのサブセットを実行することができます：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>./output/bin/qgis_dxfexporttest<span class="w"> </span>testPoints
*********<span class="w"> </span>Start<span class="w"> </span>testing<span class="w"> </span>of<span class="w"> </span>TestQgsDxfExport<span class="w"> </span>*********
Config:<span class="w"> </span>Using<span class="w"> </span>QtTest<span class="w"> </span>library<span class="w"> </span><span class="m">5</span>.12.5,<span class="w"> </span>Qt<span class="w"> </span><span class="m">5</span>.12.5<span class="w"> </span><span class="o">(</span>x86_64-little_endian-lp64<span class="w"> </span>shared<span class="w"> </span><span class="o">(</span>dynamic<span class="o">)</span><span class="w"> </span>release<span class="w"> </span>build<span class="p">;</span><span class="w"> </span>by<span class="w"> </span>GCC<span class="w"> </span><span class="m">9</span>.2.1<span class="w"> </span><span class="m">20190827</span><span class="w"> </span><span class="o">(</span>Red<span class="w"> </span>Hat<span class="w"> </span><span class="m">9</span>.2.1-1<span class="o">))</span>
PASS<span class="w">   </span>:<span class="w"> </span>TestQgsDxfExport::initTestCase<span class="o">()</span>
PASS<span class="w">   </span>:<span class="w"> </span>TestQgsDxfExport::testPoints<span class="o">()</span>
PASS<span class="w">   </span>:<span class="w"> </span>TestQgsDxfExport::cleanupTestCase<span class="o">()</span>
Totals:<span class="w"> </span><span class="m">3</span><span class="w"> </span>passed,<span class="w"> </span><span class="m">0</span><span class="w"> </span>failed,<span class="w"> </span><span class="m">0</span><span class="w"> </span>skipped,<span class="w"> </span><span class="m">0</span><span class="w"> </span>blacklisted,<span class="w"> </span>272ms
*********<span class="w"> </span>Finished<span class="w"> </span>testing<span class="w"> </span>of<span class="w"> </span>TestQgsDxfExport<span class="w"> </span>*********
</pre></div>
</div>
</section>
<section id="debugging-unit-tests">
<h3><a class="toc-backref" href="#id11" role="doc-backlink"><span class="section-number">6.6.2. </span>ユニットテストをデバッグする</a><a class="headerlink" href="#debugging-unit-tests" title="Link to this heading"></a></h3>
<section id="c-tests">
<h4><a class="toc-backref" href="#id12" role="doc-backlink">C++ テスト</a><a class="headerlink" href="#c-tests" title="Link to this heading"></a></h4>
<p>C++ ユニットテストでは、QtCreator が自動的に実行ターゲットを追加するので、デバッガから開始できます。</p>
<p><em>Projects</em> から <em>Build &amp; Run</em> --&gt; Desktop <em>Run</em> タブを開くと、デバッガの.cppファイル内でテストのサブセットを実行するためのコマンドラインパラメータを指定することもできます。</p>
</section>
<section id="python-tests">
<h4><a class="toc-backref" href="#id13" role="doc-backlink">Pythonテスト</a><a class="headerlink" href="#python-tests" title="Link to this heading"></a></h4>
<p>GDBを使ってQtCreatorからPythonのユニットテストを開始することも可能です。そのためには <span class="guilabel">Projects</span> に行き、 <span class="guilabel">Build &amp; Run</span> の下にある <span class="guilabel">Run</span> を選択する必要があります。次に、実行ファイル <code class="docutils literal notranslate"><span class="pre">/usr/bin/python3</span></code> とコマンドライン引数をユニットテストのPythonファイルのパスに設定した新しい <code class="docutils literal notranslate"><span class="pre">Run</span> <span class="pre">configuration</span></code> を追加します。 例 <code class="file docutils literal notranslate"><span class="pre">/home/user/dev/qgis/QGIS/tests/src/python/test_qgsattrbuteformeditorwidget.py</span></code>。</p>
<p>次に <code class="docutils literal notranslate"><span class="pre">Run</span> <span class="pre">Environment</span></code> を変更し、3つの新しい変数を追加します：</p>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p>Variable</p></td>
<td><p>値</p></td>
</tr>
<tr class="row-even"><td><p>PYTHONPATH</p></td>
<td><p>[build]/output/python/:[build]/output/python/plugins:[source]/tests/src/python</p></td>
</tr>
<tr class="row-odd"><td><p>QGIS_PREFIX_PATH</p></td>
<td><p>[build]/output</p></td>
</tr>
<tr class="row-even"><td><p>LD_LIBRARY_PATH</p></td>
<td><p>[build]/output/lib</p></td>
</tr>
</tbody>
</table>
<p><code class="docutils literal notranslate"><span class="pre">[build]</span></code> はビルドディレクトリに、<code class="docutils literal notranslate"><span class="pre">[source]</span></code> はソースディレクトリに置き換えてください。</p>
</section>
</section>
<section id="have-fun">
<h3><a class="toc-backref" href="#id14" role="doc-backlink"><span class="section-number">6.6.3. </span>楽しむ</a><a class="headerlink" href="#have-fun" title="Link to this heading"></a></h3>
<p>これでQGISのユニットテストの書き方についてのこのセクションは終わりです。新しい機能をテストしたり、リグレッションをチェックするためにテストを書く習慣をつけていただければと思います。テストシステムのいくつかの側面（特に <code class="file docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> の部分）は、テストフレームワークが真にプラットフォームに依存しない方法で動作するように、まだ作業中です。</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="localization.html" class="btn btn-neutral float-left" title="5. ローカライズ" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="processingtesting.html" class="btn btn-neutral float-right" title="7. プロセシングアルゴリズムをテストする" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2002-now, QGIS project.
      <span class="lastupdated">最終更新: 2024 6月 25, 05:29 +0900
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <!-- Transifex follows a particular logic to build target pages:
Expected French translation link for https://docs.qgis.org/3.28/en/docs/user_manual/print_composer/overview_composer.html
would return https://app.transifex.com/qgis/qgis-documentation/translate/#fr/aa6d8bc653526d38b295ca94bf8eee5e
with the md5 value of "github#qgis/QGIS-Documentation#release_3.28#locale/en/LC_MESSAGES/docs/user_manual/print_composer/overview_composer.po"-->
<!--Make sure that mismatching language codes between Transifex and Sphinx are converted-->


  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-info-circle"> QGIS Documentation </span>
      v: 3.34
      <span class="fa fa-caret-down"></span>
    </span>

    <div class="rst-other-versions">
      <dl>
        <dt>Languages</dt>
        
          <dd><a href="https://docs.qgis.org/3.34/en/docs/developers_guide/unittesting.html">en</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/cs/docs/developers_guide/unittesting.html">cs</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/de/docs/developers_guide/unittesting.html">de</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/es/docs/developers_guide/unittesting.html">es</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/fr/docs/developers_guide/unittesting.html">fr</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/hu/docs/developers_guide/unittesting.html">hu</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/it/docs/developers_guide/unittesting.html">it</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/ja/docs/developers_guide/unittesting.html">ja</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/ko/docs/developers_guide/unittesting.html">ko</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/lt/docs/developers_guide/unittesting.html">lt</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/nl/docs/developers_guide/unittesting.html">nl</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/pt_BR/docs/developers_guide/unittesting.html">pt_BR</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/pt_PT/docs/developers_guide/unittesting.html">pt_PT</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/ro/docs/developers_guide/unittesting.html">ro</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/ru/docs/developers_guide/unittesting.html">ru</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/zh-Hans/docs/developers_guide/unittesting.html">zh-Hans</a></dd>
        
      </dl>

      <dl>
        <dt>Versions</dt>
        
          <dd><a href="https://docs.qgis.org/testing/ja/docs/developers_guide/unittesting.html">testing</a></dd>
        
          <dd><a href="https://docs.qgis.org/latest/ja/docs/developers_guide/unittesting.html">latest</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/ja/docs/developers_guide/unittesting.html">3.34</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.28/ja/docs/developers_guide/unittesting.html">3.28</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.22/ja/docs/developers_guide/unittesting.html">3.22</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.16/ja/docs/developers_guide/unittesting.html">3.16</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.10/ja/docs/developers_guide/unittesting.html">3.10</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.4/ja/docs/developers_guide/unittesting.html">3.4</a></dd>
        
          <dd><a href="https://docs.qgis.org/2.18/ja/docs/developers_guide/unittesting.html">2.18</a></dd>
        
      </dl>

       
       <dl>
        <dt>Downloads</dt>
        
          <dd><a href="https://docs.qgis.org/3.34/pdf">PDF</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/zip">HTML</a></dd>
        
      </dl>
      

      
       
      <dl>
        <dt>Contribute to Docs</dt>
          <dd>
            <a href="https://github.com/qgis/QGIS-Documentation/edit/master/docs/developers_guide/unittesting.rst" target="_blank" rel="noopener noreferrer">Edit on GitHub</a>
          </dd>
          
          
          <dd>
            <a href="https://app.transifex.com/qgis/qgis-documentation/translate/#ja/af0b99843b86070149765886bd634ecd" target="_blank" rel="noopener noreferrer">Translate Page</a>
          </dd>
          
          <dd>
            <a href="https://github.com/qgis/QGIS-Documentation/issues" target="_blank" rel="noopener noreferrer">Report Issue</a>
          </dd>
      </dl>
      

      <dl>
        <dt>On QGIS Project</dt>
          <dd>
            <a href="https://qgis.org/ja" target="_blank" rel="noopener noreferrer">Home</a>
          </dd>
          <dd>
            <a href="https://qgis.org/api/3.34" target="_blank" rel="noopener noreferrer">C++ API</a>
          </dd>
          <dd>
            <a href="https://qgis.org/pyqgis/3.34" target="_blank" rel="noopener noreferrer">PyQGIS API</a>
          </dd>
          <dd>
            <a href="https://github.com/qgis/QGIS/tree/release-3_34" target="_blank" rel="noopener noreferrer">Source</a>
          </dd>
      </dl>

    </div>
  </div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>